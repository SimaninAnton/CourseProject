rylanchiu commented on Oct 30, 2015
I am following the link in the page to scrape the content in this page:
http://www.littleoslo.com/lyc/home/category/style/rap/
However, the url address of the songs contains url characters. I try to scrape the data using following code but failed:
import scrapy
from scrapy.spiders import CrawlSpider, Rule
from scrapy.linkextractor import LinkExtractor
from scrapy.selector import HtmlXPathSelector

class LyricSpider(scrapy.Spider):
     name = "lyric_spider"
     allowed_domains = ["littleoslo.com"]
     start_urls = [
        "http://www.littleoslo.com/lyc/home/category/style/rap/"
     ]
     rules = (
         Rule(LinkExtractor(allow = (r'page/\d+')), follow = True),
     )



    def parse(self, response):
        for href in response.css("div > div > a::attr('href')"):
            url = response.urljoin(href.extract())
            yield scrapy.Request(url, callback = self.parse_dir_contents)

    def parse_dir_contents(self, response):
        for sel in response.xpath('//div/h3/a'):
            item = LyricItem()
            link = sel.xpath('@href').extract()
            yield item
Thanks in advance!!!