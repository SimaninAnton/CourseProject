guybowden commented on Dec 7, 2011
lines 49 and 50 of scrapy.contrib.spidermiddleware.offsite:
    regex = r'^(.*\.)?(%s)$' % '|'.join(domains)
    return re.compile(regex)
Tested with a list of 3000 allowed domains -
Caught OverflowError while rendering: regular expression code size limit exceeded
Fixed by subclassing and using url_is_from_any_domain
class MyOffsiteMiddleware(OffsiteMiddleware):

def should_follow(self, request, spider):
    allowed_domains = getattr(spider, 'allowed_domains', None)
    return url_is_from_any_domain(request.url, allowed_domains)

def spider_opened(self, spider):
    self.host_regexes[spider] = re.compile('')
    self.domains_seen[spider] = set()