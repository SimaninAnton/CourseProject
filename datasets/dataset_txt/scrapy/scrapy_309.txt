heltleo commented on Aug 28, 2018 ‚Ä¢
edited
I'm trying to scrape the data from website with Form. I set all necessary information with headers, cookies and formData.
But it doesn't scrape the data(TableView), but scrape the website.
import scrapy

class NominationSpider(scrapy.Spider):
    name = "nomination"
    start_urls = [
        'https://ivo.opal-gastransport.biz/ivo/nominations'
    ]

    def parse(self, response):
        print(response.url)

        index = response.url.split('?')[1]

        headers = {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
            'Accept-Encoding': 'gzip, deflate, br',
            'Accept-Language': 'en-US,en;q=0.9',
            'Connection': 'keep-alive',
            'Host': 'ivo.opal-gastransport.biz',
            'Referer': str(response.url),
            'Upgrade-Insecure-Requests': 1,
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36'
        }

        cookies = {
            'JSESSIONID': '8A0837174D603BE97441F0B579307316'
        }

        formData = {
            'reportparameterselect_hf_0': str(index) + '-1.IFormSubmitListener-form:',
            'netpoint': '92IEAPR',
            'flowDirection': 'EXIT',
            'from': '01/08/2018',
            'to': '08/08/2018',
            'fileType': '0',
            'p::submit': 'Preview'
        }

        yield scrapy.FormRequest.from_response(
            response,
            method="GET",
            headers=headers,
            formdata=formData,
            cookies=cookies,
            clickdata={'name': 'p::submit'},
            callback=self.parseResponse
        )



    def parseResponse(self, response):
        print('------------------------')
        print(response.body)
it seems cookies doesn't applied or clickdata doesn't work.
I am not sure what is problem correctly.
but I can see tableview with data on browser by selecting options and clicking Preview button.
https://ivo.opal-gastransport.biz/ivo/nominations?0
üëç 1