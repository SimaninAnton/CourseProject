canonicalize_url() function breaks some urls