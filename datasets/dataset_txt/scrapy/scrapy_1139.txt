idella commented on Aug 29, 2015
I do packaging @ gentoo and I am quite confused / unclear on setting the dependencies for this package given the content of setup.py and tox.ini
First; python implementations supported.
From setup.py
'Programming Language :: Python',
'Programming Language :: Python :: 2',
'Programming Language :: Python :: 2.7',
from tox.ini
[tox]
envlist = py27
[testenv:py33]
basepython = python3.3
Second; Runtime / test phase deps
from setup.py
install_requires=[
'Twisted>=10.0.0',
from tox.ini
pyOpenSSL==0.13
lxml==2.3.2
Twisted==11.1.0
which comes under [testenv:precise]
precise (ubunutu) has little to do with packaging for gentoo. However if it actually requires Twisted==11.1.0 for the tests, gentoo has a real problem. Twisted==11.1.0 is so old it was dropped from portage some time ago. I still don't have leveldb installed and the testsuite runs and passes all except the tests listed in /issues/1464.
Ideally a setup.py has a listing of tests_require like install_requires. I am guessing this was not done due to the mass conflict of versioning of dependencies between the various python versions. Currently the ebuilds of scrapy have only python 2.7 support and given all the above, to add python3 support would require a new ebuild of the same package due only to the disparate versioning of dependencies.
Quite simply, if runtime deps have conflicting versions against deps of the testsuite, it breaks portage in the form of a qa violation. The deps ought match those listed in setup.py and any other source file listing them.