pek77 commented on May 8, 2017 •
edited
Lost and content.
When I crawled a table named "基本概况" on this site: http://fund.eastmoney.com/f10/jbgk_000001.html
I found the tr List length is 9, not 10. The th named "最高申购费率" and "最高赎回费率" were lost.
I think this is a bug.
The spider code is as follows:
import scrapy
import requests
import re
import json
from scrapy.selector import HtmlXPathSelector
from fund.items import FundItem
import logging

fundHead = []
fundContent = []
class fundSpider(scrapy.Spider):
    name = "fund"
    allowed_domains = ['fund.eastmoney.com']
    fundJS = requests.get('http://fund.eastmoney.com/js/fundcode_search.js')
    jstext = fundJS.text
    start_urls = ["http://fund.eastmoney.com/f10/jbgk_000001.html"]
    #    "http://fund.eastmoney.com/f10/jbgk_003816.html",
    start = jstext.index("[")
    end = jstext.index(";")
    jstext=jstext[start:end];
    fundJSON = json.loads(jstext)
    j = 0;
    # for obj in fundJSON:
    #     start_urls.append("http://fund.eastmoney.com/f10/jbgk_"+obj[0]+".html");
    #     #if (j>3):
    #     break
    #    # j= j+1;
    #

    def parse(self, response):
        print("++++++++++++++++++++")
        i = 0
        fund = [];
        print len(response.xpath("//table[@class='info w790']/tr"))
        thList =response.xpath("//table[@class='info w790']/tr/th")
        for th in thList:
            #print tr.extract()
            #if (len(fundHead) < len(thList)):
            print th.xpath("text()").extract()[0].encode('utf-8')
                #fundHead.append(th.xpath("text()").extract()[0])
            td = response.xpath("//table[@class='info w790']/tr/td")[i]
            if(len(td.xpath("text()"))!=0):
                print td.xpath("text()").extract()[0].encode('utf-8')
                #fund.append(td.xpath("text()").extract()[0])
            elif (len(td.xpath("a"))!=0):
                print td.xpath("a/text()").extract()[0].encode('utf-8')
                #fund.append(td.xpath("a/text()").extract()[0])
            else :
                print ""
                #fund.append(" ")
            i = i+1
        print("++++++++++++++++++++")