fangpenlin commented on Aug 9, 2014
I encountered an issue when writing a spider with scrapy. Some websites, they writes multiple Set-Cookie in HTTP headers. Like this
Set-Cookie: foo=bar
Set-Cookie: eggs=spam
Since the http headers is implemented as a dict like object, which means, only one key will survive in that dict. The last one will do. So the first Set-Cookie will be simply ignored.
The situation is mentioned here in this question - Set more than one HTTP header with the same name?
I think this bug is from Twisted http agent, but since scrapy maintains a copy of twisted http agent, and reasonable usage for multiple header might only be cookie, so I think it's better to address the issue here. The way dict implemented is already widely used, mapping string from string is also widely used, it's pretty hard to change it (like use a list instead or set value as list of string instead of string). I think a better approach is to provide a new raw_headers attribute attached on response object. For cookie handler, it should scan Set-Cookie in the raw_headers instead of headers.
I may create a pull request soon.