RavenHustler commented on Jan 26, 2018
Cannot override the default Connection: close header of scrapy requests. I want to scrape a site for which I need to send Connection: keep-alive headers and remove the default Connection: close header.
Tried using custom settings, custom headers and default headers to change Connection: close to Connection: keep-alive but it instead merges and sends two Connection headers.
It works in scrapy shell but not when used in a spider.
I used Fiddler to check the headers scrapy was sending. Please use Fiddler or any other packet sniffing tool to check the headers as it works fine in scrapy shell.
Below is the different things I tried:
Using custom settings:
custom_settings = {
        'DEFAULT_REQUEST_HEADERS': {
            'Connection': 'keep-alive'
        }
    }
Using custom headers:
headers = {"Connection": "keep-alive"}

for url in urls:
        yield scrapy.Request(url=url, callback=self.parse, headers=headers)
Changing default header settings:
DEFAULT_REQUEST_HEADERS = {
  'Connection': 'keep-alive',
}