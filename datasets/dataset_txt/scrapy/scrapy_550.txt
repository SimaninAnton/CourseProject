mahaoyang commented on Aug 29, 2017 â€¢
edited
scrapy.dupefilters.RFPDupeFilter
line 47 - 53
def request_seen(self, request):
    fp = self.request_fingerprint(request)
    if fp in self.fingerprints:
        return True
    self.fingerprints.add(fp)
    if self.file:
        self.file.write(fp + os.linesep)
The file.write() function only write this to cahce . So when I restart the spider, all fingerprints gone.
I change it to
class SeenURLFilter(RFPDupeFilter):
"""A dupe filter that considers the URL"""
def __init__(self, path=None, debug=False):
    RFPDupeFilter.__init__(self, path, debug)

def request_seen(self, request):
    fp = request.url
    if fp in self.fingerprints:
        return True
    self.fingerprints.add(fp)
    if self.file:
        self.file.write(fp + os.linesep)
        self.file.flush()