LoveDarkblue commented on Aug 28, 2019
Description
I have a api doc that need send a header with the key that start with lowercase word.
But the scrapy always change the key of the headers into capitalized.
I'm setting the headers like this:
headers = {
    "sign": 'sssssssign',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'
}
yield scrapy.Request(url,headers=headers, callback=self.parse_page, meta={'cookiejar': 1})
Then i found that "sign" is changed into "Sign" in the DEBUG log.
And then i try to do like this:
from twisted.web.http_headers import Headers as TwistedHeaders

TwistedHeaders._caseMappings.update({
    b'sign': b'sign',  
    b'User-Agent': b'user-agent',
})
I put the code in start_request method of spider file, but I still got the following log:
{b'User-Agent': [b'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'], b'Accept-Language': [b'en'], b'Sign': [b'sssssssign'], b'Accept': [b'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8']}
How to prevent scrapy from forcing the key of the request headers in uppercase?