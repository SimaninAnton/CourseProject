nukc commented on May 10, 2017
code:
# import ...
from scrapy.spiders.crawl import CrawlSpider
from scrapy.http import Request

class ArticleSpider(CrawlSpider):
    # code.....

    def start_requests(self):
        yield Request(url=self.setting_url,
                      callback=self.parse_setting)  

    def parse_setting(self, response):
        # code.....
        for uid in users:
            yield Request(url=self.user_url % uid,
                          callback=self.parse_user,
                          meta={'user_id': uid, "count": count})

    def parse_user(self, response):
        data = json.loads(response.text)['data']
        item = Article()
        item['user_id'] = response.meta['user_id']

        # code.....

        count = response.meta['count']
        print("username = %s" % data['name'])

        yield Request(url=self.start_url % (item['user_id'], count),
                      callback=self.parse_item,
                      meta={'item': item})

    def parse_item(self, response):
        data = json.loads(response.text)
        data = data['data']

        item = response.meta['item']

        for cell in data:
            if cell['has_video'] is False:
                item['id'] = cell['item_id']
                # code...
                print("parse_item--------%s" % item['id'])
                yield Request(url=self.content_url % item['id'],
                              callback=self.parse_content,
                              meta={'item': item})

    def parse_content(self, response):
        item = response.meta['item']
        print("parse_content--------%s" % item['id'])
        content = json.loads(response.text)['data']['content']
        item['content'] = content
        yield item
item is right in parse_item, but item has changed in parse_content, there are a lot of the same items in
parse_content
log:
parse_item--------6418342558736335361
parse_item--------6418286349643678209
parse_item--------6418284239581610498
parse_item--------6418295974489227777
parse_item--------6418034829111067138
parse_item--------6418293518971699714
parse_item--------6417979940523737601
parse_item--------6417981035316773377
parse_item--------6402028097360626178
parse_item--------6418431607643832833
parse_item--------6418431597376176642
parse_item--------6418415582135190018
parse_item--------6418415570441470466
parse_item--------6418415567752921602
parse_item--------6418400026266960385
parse_item--------6418399974828016129
parse_item--------6418399827670860290
parse_item--------6418399798528836097
parse_item--------6418399798004548097
parse_item--------6418409949893755393
parse_item--------6418400361773531650
parse_item--------6418390433314898433
parse_item--------6418048335759802881
parse_item--------6417830522428326401
parse_item--------6417351676604187137
parse_item--------6416922409391096322
parse_item--------6414183060027212290
parse_item--------6418404844897305089
parse_item--------6418403936591413762
parse_item--------6418361360911958530
parse_item--------6418360522529309186
parse_item--------6418329324931252738
parse_item--------6418150524058599937
parse_item--------6418082048350618114
parse_item--------6418048844008784385
parse_item--------6417991904180306433
parse_item--------6411412992780403202
parse_item--------6416114889642738177
parse_item--------6417330059622744577
parse_item--------6417681599206261250
parse_item--------6418128879294087682
parse_item--------6417674545829773825
parse_item--------6417673373089792514
parse_item--------6417682781802856962
parse_item--------6417672227549872642
parse_item--------6417394300459418113
parse_item--------6418419045539774977
parse_item--------6418281614052164098
parse_item--------6417915107245818370
parse_item--------6417708495272935938
parse_item--------6417537333049950722
parse_item--------6417351560539406849
parse_item--------6416430286560559618
parse_item--------6416224528753492482
parse_item--------6416060406762045953
parse_item--------6416054120792195585
parse_item--------6418332079066448385
parse_item--------6418329433404342785
parse_item--------6417945603132621313
parse_item--------6417944451234136577
parse_item--------6418402985272934914
parse_item--------6418401409477116417
parse_item--------6418401281844445698
parse_item--------6418401155897885185
parse_item--------6418382959304245761
parse_item--------6418382957760741889
parse_item--------6418030742470656514
parse_item--------6418019819144086017
parse_item--------6418113665009975809
parse_item--------6418113772384158210
parse_item--------6418383427241771521
parse_item--------6417985925728436738
parse_item--------6417638036871315969
parse_item--------6418393940222804482
parse_item--------6418390984832320001
parse_item--------6418137921240433153
parse_item--------6418013655916347905
parse_item--------6418010737435738625
parse_item--------6417976118363554305
parse_item--------6417968722933187074
parse_item--------6417651330243887617
parse_item--------6417602714796032514
parse_item--------6417722539400757762
parse_item--------6418343702871147010
parse_item--------6418342645881373185
parse_item--------6418341865510142465
parse_item--------6418340769089716738
parse_item--------6418340303010267650
parse_item--------6418339311539716609
parse_item--------6418337020082389505
parse_item--------6418336611213246978
parse_item--------6418335688655110658
parse_item--------6411470870673359362
parse_item--------6418047333631525377
parse_item--------6418050097505894913
parse_item--------6418058875357889025
parse_item--------6417936940816925185
parse_item--------6417673720365580802
parse_item--------6417677126643745281
parse_item--------6417645913178636802
parse_item--------6417391467400004098

parse_content--------6417394300459418113
parse_content--------6417981035316773377
parse_content--------6417981035316773377
parse_content--------6417394300459418113
parse_content--------6417981035316773377
parse_content--------6416922409391096322
parse_content--------6417981035316773377
parse_content--------6416922409391096322
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417944451234136577
parse_content--------6417944451234136577
parse_content--------6416054120792195585
parse_content--------6417944451234136577
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6418113772384158210
parse_content--------6418113772384158210
parse_content--------6418113772384158210
parse_content--------6418113772384158210
parse_content--------6417391467400004098
parse_content--------6418113772384158210
parse_content--------6418113772384158210
parse_content--------6417391467400004098
parse_content--------6417391467400004098
parse_content--------6417391467400004098
parse_content--------6417391467400004098
parse_content--------6417391467400004098
parse_content--------6418335688655110658
parse_content--------6417391467400004098
parse_content--------6418335688655110658
parse_content--------6417391467400004098
parse_content--------6417391467400004098
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6418335688655110658
parse_content--------6417602714796032514
parse_content--------6418335688655110658
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417638036871315969
parse_content--------6417602714796032514
parse_content--------6417602714796032514
parse_content--------6417638036871315969
parse_content--------6418113772384158210
parse_content--------6418113772384158210
parse_content--------6417638036871315969
parse_content--------6418113772384158210
parse_content--------6417944451234136577
parse_content--------6418113772384158210
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6416054120792195585
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417394300459418113
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6416922409391096322
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6417991904180306433
parse_content--------6418048335759802881
parse_content--------6418048335759802881
parse_content--------6418048335759802881
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418048335759802881
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6418399798004548097
parse_content--------6402028097360626178
parse_content--------6417981035316773377
parse_content--------6417981035316773377
parse_content--------6417981035316773377
parse_content--------6418399798004548097
parse_content--------6417981035316773377

spider_closed
Although I have other solutions, but I want to know why this problem.
👍 1