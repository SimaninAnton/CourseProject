reyman commented on Jun 16, 2017 â€¢
edited
Hi,
I try to use some imbricated/recursive scrapy.Request(...) (scrapy 1.4.0) using the new yield from keyword of python 3.3, without success.
I test my algorithm with simple example and fixed data, it works, but i cannot reproduce the same algorithm using yield from on Scrapy Request :
2017-06-16 15:20:45 [scrapy.core.scraper] ERROR: Spider error processing <GET https://api.flightradar24.com/common/v1/airport.json?code=VAR&plugin%5C%5B%5C%5D=&plugin-setting%5C%5Bschedule%5C%5D%5C%5Bmode%5C%5D=&plugin-setting%5C%5Bschedule%5C%5D%5C%5Btimestamp%5C%5D=1493251200&page=1&limit=100&token=> (referer: https://www.flightradar24.com/data/airports/bulgaria)
Traceback (most recent call last):
  File "/home/reyman/.pyenv/versions/venv352/lib/python3.5/site-packages/scrapy/utils/defer.py", line 102, in iter_errback
    yield next(it)
  File "/home/reyman/.pyenv/versions/venv352/lib/python3.5/site-packages/scrapy/spidermiddlewares/offsite.py", line 29, in process_spider_output
    for x in result:
  File "/home/reyman/.pyenv/versions/venv352/lib/python3.5/site-packages/scrapy/spidermiddlewares/referer.py", line 339, in <genexpr>
    return (_set_referer(r) for r in result or ())
  File "/home/reyman/.pyenv/versions/venv352/lib/python3.5/site-packages/scrapy/spidermiddlewares/urllength.py", line 37, in <genexpr>
    return (r for r in result or () if _filter(r))
  File "/home/reyman/.pyenv/versions/venv352/lib/python3.5/site-packages/scrapy/spidermiddlewares/depth.py", line 58, in <genexpr>
    return (r for r in result or () if _filter(r))
  File "/home/reyman/Projets/Flight-Scrapping/flight/flight_project/spiders/AirportsSpider.py", line 209, in parse_schedule
    yield from scrapy.Request(url, self.parse_schedule, meta={'airport_item': item, 'airport_urls': urls, 'i': i + 1})
TypeError: 'Request' object is not iterable
2017-06-16 15:20:45 [scrapy.core.engine] INFO: Closing spider (finished)
2017-06-16 15:20:45 [scrapy.statscollectors] INFO: Dumping Scrapy stats:
You could find the original script here , do you have an idea to help me on this point ?