Chelsea31 commented on Oct 17, 2018
I want to add a trace id to my logs. This trace id is present in my request. But I am unable to add it to my scrapy logs. I have tried multiple solutions.
creating my own logger and adding trace id using loggerAdapter.
This works but only for the logs which I personally code. Also, there are failures for logs which are generated by engine.py, middleware.py and so on.
  File "/usr/lib/python2.7/logging/__init__.py", line 861, in emit
    msg = self.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 734, in format
    return fmt.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 469, in format
    s = self._fmt % record.__dict__
KeyError: 'trace_id'
Logged from file middlewares.py, line 69
Traceback (most recent call last):
  File "/usr/lib/python2.7/logging/__init__.py", line 861, in emit
    msg = self.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 734, in format
    return fmt.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 469, in format
    s = self._fmt % record.__dict__
KeyError: 'trace_id'
Logged from file redirect.py, line 41
Traceback (most recent call last):
  File "/usr/lib/python2.7/logging/__init__.py", line 861, in emit
    msg = self.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 734, in format
    return fmt.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 469, in format
    s = self._fmt % record.__dict__
KeyError: 'trace_id'
Logged from file middlewares.py, line 69
^CTraceback (most recent call last):
  File "/usr/lib/python2.7/logging/__init__.py", line 861, in emit
    msg = self.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 734, in format
    return fmt.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 469, in format
    s = self._fmt % record.__dict__
KeyError: 'trace_id'
Logged from file crawler.py, line 258
Traceback (most recent call last):
  File "/usr/lib/python2.7/logging/__init__.py", line 861, in emit
    msg = self.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 734, in format
    return fmt.format(record)
  File "/usr/lib/python2.7/logging/__init__.py", line 469, in format
    s = self._fmt % record.__dict__
KeyError: 'trace_id'
Logged from file engine.py, line 295
Added trace id in the LOG_FORMAT setting. But I can't find a way to pass that argument to scrapy.
LOG_FORMAT = "%(asctime)s %(levelname)s [%(trace_id)s]: %(message)s" 
Turning off scrapy logs is not an option to me.