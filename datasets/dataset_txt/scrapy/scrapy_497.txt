Textcat commented on Nov 18, 2017
import re
import os
from scrapy import signals
from scrapy.exporters import CsvItemExporter

class multipleOutputTestPipeline(object):
    def __init__(self):
        self.exporters = {}

    @classmethod
    def from_crawler(cls, crawler):
        pipeline = cls()
        crawler.signals.connect(pipeline.spider_opened, signals.spider_opened)
        crawler.signals.connect(pipeline.spider_closed, signals.spider_closed)
        return pipeline

    def spider_opened(self, spider):
        pass

    def spider_closed(self, spider):
        for exporter in self.exporters.values():
            exporter.finish_exporting()
    def process_item(self, item, spider):
        #if the exporter already exists, export the item directly
        if item["start_url"] in self.exporters:
            self.exporters[item["start_url"]].export_item(item)
        else:
            #if the exporter doesn't exist, create one and start it
            catname = item["start_url"][-1] + ".csv"
            thefile = open('/Users/apple/Desktop/multipleFileOutputTest/' + catname, 'w+b')

            self.exporters[item["start_url"]] = CsvItemExporter(thefile)
            self.exporters[item["start_url"]].start_exporting()
            self.exporters[item["start_url"]].export_item(item)


        return item
I'm trying to export items to multiple CSV files, the names of these files are based on the start_url, the problem is that the exported files except the first one are empty.