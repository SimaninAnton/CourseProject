Contributor
pawelmhm commented on May 28, 2015
Currently if HTTP response contains multiple headers with same name Scrapy spider will get only first value in response.
For example response containing following headers
Set-Cookie:visid_incap_41120=SOdwDQFZSKyIVH4gYFaRyw8IZ1UAAAAAQUIPAAAAAABTKkcWDVDo9bCbj+nVIygb; expires=Fri, 26 May 2017 19:18:33 GMT; path=/; Domain=.nextworth.com
Set-Cookie:incap_ses_133_41120=GojSSxpMZFtuOlBBgYPYAQ8IZ1UAAAAAeDlo/Gc3JjyBa4ayRvSQjw==; path=/; Domain=.nextworth.com
will be represented like this in scrapy spider
In [11]: response.headers
Out[11]: 
{
 'Set-Cookie': 'visid_incap_41120=B+qHstQzQx2iYZcXTqWEKmkEZ1UAAAAAQUIPAAAAAABRy0c541mfOL+Q4tAYtmaQ; expires=Fri, 26 May 2017 18:14:02 GMT; path=/; Domain=.nextworth.com',
}
as you see only first cookie is visible in headers, others are ignored.
I know there is response.headers.getlist which will return all values of given header, I also know well I can get all cookies from spider by just accessing cookie middleware that keeps track of cookies. But most users probably don't know that and they expect to have all cookies in response and it is extremely common to get multiple "set-cookie" headers.
Also it seems to me that this is an actual bug. I checked the standard and it openly allows sending multiple Set-Cookie headers:
An origin server may include multiple Set-Cookie headers in a
response. Note that an intervening gateway could fold multiple such
headers into a single header.
-- http://www.w3.org/Protocols/rfc2109/rfc2109
Can we change response object to get proper value of multiple headers with same keys?