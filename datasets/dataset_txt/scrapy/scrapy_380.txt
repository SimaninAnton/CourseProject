Yuan-Hang commented on Apr 30, 2018 â€¢
edited
i have write down the middleware:
def process_request(self, request, spider):
    request = self.change_proxy(request)   # set request proxy

def process_response(self, request, response, spider):
    if response.status != 200:
        self.delete_proxy()           # remove unusable proxy
        return request.copy()         # send request to process_request to change proxy
    return response

def process_exception(self, request, exception, spider):
    self.delete_proxy()              # remove unusable proxy
    # if comment the code below, i will not get 302. but maybe i will lost crawl some webpage?
    return request.copy()            # send request to process_request to change proxy
First, I have some proxies in redis, what i want to do is:
give each request a random proxy,
when the connection to proxy failed(process_exception called), change a new proxy and re-crawl the webpage.
when proxy is banned by the website(response.status != 200), change a new proxy and re-crawl the webpage.