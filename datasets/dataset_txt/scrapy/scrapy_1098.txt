Contributor
starrify commented on Oct 29, 2015
Issue Description
Incorrectly picked URL in scrapy.linkextractors.regex.RegexLinkExtractor when there is a <base> tag.
How to Reproduce the Issue & Version Used
[pengyu@GLaDOS tmp]$ python2
Python 2.7.10 (default, Sep  7 2015, 13:51:49) 
[GCC 5.2.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import scrapy
>>> scrapy.__version__
u'1.0.3'
>>> html_body = '''
... <html>
...     <head>
...         <base href="http://b.com/">
...     </head>
...     <body>
...         <a href="test.html"></a>
...     </body>
... </html>
... '''
>>> response = scrapy.http.TextResponse(url='http://a.com/', body=html_body)
>>> import scrapy.linkextractors.regex
>>> scrapy.linkextractors.regex.RegexLinkExtractor().extract_links(response)
__main__:1: ScrapyDeprecationWarning: SgmlLinkExtractor is deprecated and will be removed in future releases. Please use scrapy.linkextractors.LinkExtractor
[Link(url='http://a.com/test.html', text=u'', fragment='', nofollow=False)]
Expected Result
URL of the extracted link shall start with 'http://b.com/'
Suggested Fix
The issue can be fixed by editing a few lines in scrapy/linkextractors/regex.py