theduman commented on Jan 11, 2018 â€¢
edited by kmike
I fetch url and other parameters from database and use them in for loop and pass to scrapy.request() function but when i run the code i succesfully pass first element only. Scrapy can't get other elements of list. Here is my code
class QuotesSpider(scrapy.Spider):
    name = "quotes"
    custom_settings = {
        'CONCURRENT_REQUESTS': 1,
    }
    def start_requests(self):
        sourceArr = []
        connection = db.connect()
        try:
            with connection.cursor() as cursor:
                # Read a single record
                sql = "SELECT `code`, `url`, `target`,`next` FROM `source`"
                cursor.execute(sql)
                result = cursor.fetchall()
        finally:
            connection.close()
        print(result)
        for i in result:
            source = Source(i['code'], i['url'], i['target'], i['next'])
            sourceArr.append(source)
        print(sourceArr)
        #for url in urls:
           #yield scrapy.Request(url=url, callback=self.parse)
        for s in sourceArr:
            print(s.target)
            yield scrapy.Request(url=s.url, meta={'target': s.target, 'next': s.next})
            print("slept")


    def parse(self, response):
        titlearr = []
        count = 0
        print(response.meta)
        for title in response.css(response.meta['target']):
            count += 1
            titlearr.append(title.css('p a::text').extract_first())
            #yield {'title': title.css('p a::text').extract_first()}
        print("total count " + str(count))
        print(titlearr)
        for next_page in response.css(response.meta['next']):
            yield response.follow(next_page, self.parse)
When i print response.meta i got target and next values for only first item. List contains more than 1 item. How can i make scrapy.Request() function wait for the next element to run?