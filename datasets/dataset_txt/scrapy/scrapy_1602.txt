domguard commented on Apr 21, 2012
I have python objects in my scraped item that do have accents in their unicode representation,
Through the debugger, I can see that the text fields containing UTF-8 accents are correctly ascii-encoded but the object representation, like the category field here keeps its accents :
{'category': <Category: Electro-mÃ©nager :: TV>,
 'description': u' Ecran monochrome\r\nFonction \xe9co \r\nPr\xe9sentation du num\xe9ro \r\n1 combin\xe9\r\nAutonomie : 10 h en communication / 100 h en veille\r\nSonneries : 10\r\nVerrouillage du clavier \r\nR\xe9pertoire : 20 noms\r\nFonctionnalit\xe9 main-libres\r\n',
...
When using a simple pipeline to drop them and raising the DropItem exception to do so, I get :
2012-04-21 16:43:08+0200 [-] Unhandled Error
    Traceback (most recent call last):
      File "/Users/dom/django/.virtualenvs/cheze/lib/python2.7/site-packages/scrapy/utils/defer.py", line 57, in <genexpr>
        work = (callable(elem, *args, **named) for elem in iterable)
      File "/Users/dom/django/.virtualenvs/cheze/lib/python2.7/site-packages/scrapy/core/scraper.py", line 173, in _process_spidermw_output
        dfd.addBoth(self._itemproc_finished, output, response, spider)
      File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/twisted/internet/defer.py", line 320, in addBoth
        callbackKeywords=kw, errbackKeywords=kw)
      File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/twisted/internet/defer.py", line 286, in addCallbacks
        self._runCallbacks()
    --- <exception caught here> ---
      File "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/twisted/internet/defer.py", line 542, in _runCallbacks
        current.result = callback(current.result, *args, **kw)
      File "/Users/dom/django/.virtualenvs/cheze/lib/python2.7/site-packages/scrapy/core/scraper.py", line 199, in _itemproc_finished
        log.msg(log.formatter.dropped(item, ex, response, spider), \
      File "/Users/dom/django/.virtualenvs/cheze/lib/python2.7/site-packages/scrapy/logformatter.py", line 22, in dropped
        return u"Dropped: %s%s%s" % (exception, os.linesep, item)
    exceptions.UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 33: ordinal not in range(128)
This is not coming from my exception message, its an ascii string
I've been looking for long how to avoid this bug which clutters my log, but it's not really clear to me where I have to modifiy Scrapy.