johtso commented on Mar 15, 2016
I have a CrawlSpider that needs to batch up it's items and send them off in groups once the crawl has completely finished.
I initially saw the closed method that can be defined on a scraper which is supposed to be called with the reason. I found that this didn't work. The base scraper close is called, but when that calls my class's closed method it goes into some Twisted deferred code and never seems to be executed.
I tried the hacky solution of just overriding close instead, but yielding Items from there doesn't seem to work.
I then tried solving the problem at the pipeline level.
I added this to my pipeline, but again, the method doesn't seem to be called:
    @classmethod
    def from_crawler(cls, crawler):
        pipeline = cls()
        crawler.signals.connect(pipeline.spider_closed, signals.spider_closed)

    def spider_closed(self, *args, **kwargs):
        print args, kwargs
        1/0
Am I misunderstanding something / doing something wrong?