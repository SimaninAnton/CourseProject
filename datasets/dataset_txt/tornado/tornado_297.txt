chenasraf commented on 10 Aug 2017
Not sure what's going on. Our code doesn't handle its own IO loop and relies on the implementations inside tornado's defaults - and I keep getting this error:
2017-08-10 12:10:11,581 http1connection 67799:731 tornado.general ERROR Uncaught exception
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/site-packages/tornado/http1connection.py", line 722, in _server_request_loop
    ret = yield conn.read_response(request_delegate)
  File "/usr/local/lib/python2.7/site-packages/tornado/gen.py", line 1055, in run
    value = future.result()
  File "/usr/local/lib/python2.7/site-packages/tornado/concurrent.py", line 238, in result
    raise_exc_info(self._exc_info)
  File "/usr/local/lib/python2.7/site-packages/tornado/gen.py", line 1069, in run
    yielded = self.gen.send(value)
  File "/usr/local/lib/python2.7/site-packages/tornado/http1connection.py", line 245, in _read_message
    self.stream.set_close_callback(self._on_connection_close)
  File "/usr/local/lib/python2.7/site-packages/tornado/iostream.py", line 420, in set_close_callback
    self._maybe_add_error_listener()
  File "/usr/local/lib/python2.7/site-packages/tornado/iostream.py", line 941, in _maybe_add_error_listener
    self._add_io_state(ioloop.IOLoop.READ)
  File "/usr/local/lib/python2.7/site-packages/tornado/iostream.py", line 971, in _add_io_state
    self.fileno(), self._handle_events, self._state)
  File "/usr/local/lib/python2.7/site-packages/tornado/ioloop.py", line 728, in add_handler
    self._impl.register(fd, events | self.ERROR)
  File "/usr/local/lib/python2.7/site-packages/tornado/platform/kqueue.py", line 40, in register
    raise IOError("fd %s already registered" % fd)
IOError: fd 12 already registered
2017-08-10 12:10:11,582 ioloop 67799:741 tornado.general DEBUG Error deleting fd from IOLoop
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/site-packages/tornado/ioloop.py", line 739, in remove_handler
    self._impl.unregister(fd)
  File "/usr/local/lib/python2.7/site-packages/tornado/platform/kqueue.py", line 50, in unregister
    self._control(fd, events, select.KQ_EV_DELETE)
  File "/usr/local/lib/python2.7/site-packages/tornado/platform/kqueue.py", line 63, in _control
    self._kqueue.control([kevent], 0)
OSError: [Errno 2] No such file or directory
And I mean me, specifically, and I don't know where to start debugging.
It happens on one process which relies on other services that run similarly, each as its own process, but none of them give out this error.
I'm not sure a de-facto solution is available but I'd at least like to find where I can even begin to find the source of this problem. Any ideas?