Contributor
WGH- commented on 24 Apr 2015
For some reason, this example hangs if you pass n>1. It works if n==1.
import tornado.gen
import tornado.ioloop

@tornado.gen.coroutine
def f(n=1):
    for _ in range(n):
        yield tornado.gen.sleep(0.5)
    return 5

@tornado.gen.coroutine
def g():
    raise RuntimeError

@tornado.gen.coroutine
def main():
    waiter = tornado.gen.WaitIterator(g(), f(2))
    while not waiter.done():
        try:
            val = yield waiter.next()
        except Exception as e:
            print("Caught %r" % e)
        else:
            print("Returned val=%r" % val)

    print("waiter loop finished")

if __name__ == "__main__":
    tornado.ioloop.IOLoop.instance().run_sync(main)