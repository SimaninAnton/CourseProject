Contributor
noyainrain commented on 20 May 2017 â€¢
edited
Let's assume we have a Tornado app with the following structure
testapp/
  __init__.py
  __main__.py
  foo.py
  ...
where __main__ contains a relative import like from .foo import Bar.
Running the app with python -m testapp will work as expected. If autoreload is enabled, a reload will however fail with the following exception:
SystemError: Parent module '' not loaded, cannot perform relative import
As explained in the source of autoreload, this happens because the command line arguments are transformed by Python from -m testapp to testapp/__main__.py. On reload, __main__ will be run as a script, preventing relative imports.
According to http://bugs.python.org/msg289874 it is now possible to detect if __main__ has been invoked with -m and reconstruct the original command line for reloading.
PS: Thanks for your awesome work on Tornado!