huashengdun commented on 4 Apr 2018 â€¢
edited
Here is the demo code.
import threading
import time
from tornado.concurrent import Future
from tornado import gen, ioloop


@gen.coroutine
def foo(url):
    future = Future()
    threading.Thread(target=fetch_url_wrapped, args=(url, future)).start()
    res = yield future
    print(res)


def fetch_url(url):
    time.sleep(1)
    return 'hello world'


def fetch_url_wrapped(url, future):
    print('fetching {}'.format(url))
    result = fetch_url(url)
    future.set_result(result)
    print('set result {}'.format(result))

loop = ioloop.IOLoop.current()
loop.run_sync(lambda: foo('http://bar.com'))
Before Tornado 5.0.0, it is ok.
After version 5.0.0 (including 5.0.0), the program just blocks.