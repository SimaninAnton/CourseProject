pmccurdy commented on 20 Jul 2010
If you have an URI regex like /foo/(bar)? (that is, an optional captured group), the regex match will return a None element if you match against plain /foo/, since the string matches but the group doesn't exist. But you can't unquote None, so the recent change to unquote URI matches in commit 557da3d breaks.
The following patch fixes it, at least for me (though I'll confess that I took the opportunity to clean up my URI matching to no longer have any optional captured groups, for sanity, so it's no longer much of a pressing concern for me).
diff --git a/tornado/web.py b/tornado/web.py
index 3beac23..d75ccd0 100644
--- a/tornado/web.py
+++ b/tornado/web.py
@@ -1069,7 +1069,7 @@ class Application(object):
                     if kwargs:
                         args = []
                     else:
-                        args = [urllib.unquote(s) for s in match.groups()]
+                        args = [s and urllib.unquote(s) for s in match.groups()]
                     break
             if not handler:
                 handler = ErrorHandler(self, request, 404)