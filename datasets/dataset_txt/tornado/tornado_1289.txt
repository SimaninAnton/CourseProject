wangchyz commented on 25 Mar 2010
this bug can maybe cause add_handlers invalid
diff --git a/tornado/web.py b/tornado/web.py
index 8cba99a..5126fb8 100644
--- a/tornado/web.py
+++ b/tornado/web.py
@@ -934,7 +934,13 @@ class Application(object):
if not host_pattern.endswith("$"):
host_pattern += "$"
handlers = []
   self.handlers.append((re.compile(host_pattern), handlers))
   for h_pattern, h_handlers in self.handlers:
       if h_pattern.pattern == host_pattern:
           handlers = h_handlers
   if handlers == []:
       self.handlers.append((re.compile(host_pattern), handlers))

 for spec in host_handlers:
     if type(spec) is type(()):