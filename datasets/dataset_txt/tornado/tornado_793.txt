Contributor
lilydjwg commented on 21 Jul 2014
Tornado uses urljoin to join self.request.uri and the destination but when self.request.uri starts with '//' it generates locations still start with '//' because this behaviour of urljoin:
>>> from urllib.parse import urljoin                                                                                                                   
>>> urljoin('//abc', '/abc')
'//abc/abc'
I suggest using self.request.full_url() instead. Also, the HTTP specification says that the Location header should include the host part.
PS: self.request.full_url() doesn't work for proxy requests that have full urls in their request line.