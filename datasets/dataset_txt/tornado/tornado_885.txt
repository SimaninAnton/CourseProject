jakubroztocil commented on 31 Oct 2013
I'm fetching a URL with 10s delay using AsyncHTTPClient. The calls are blocking, however.
import tornado.ioloop
import tornado.web
import tornado.gen
import tornado.httpclient


class Handler(tornado.web.RequestHandler):

    @tornado.gen.coroutine
    def get(self):
        print('START')
        yield tornado.gen.Task(
            tornado.httpclient.AsyncHTTPClient().fetch,
            'https://httpbin.org/delay/10' 
        )
        print('FINISH')
        self.finish()


app = tornado.web.Application(handlers=[('/', Handler)])
app.listen(8888)
tornado.ioloop.IOLoop.instance().start()
To test, I run it and open http://localhost:8888 in two browser tabs. This is the actual output:
$ python test.py
START
FINISH
START
FINISH
The expected output is:
START
START
FINISH
FINISH
Tested on tornado==3.1.1, Python 2.7.5, OS X 10.9 Mavericks.
The same code tested on Ubuntu works as expected.