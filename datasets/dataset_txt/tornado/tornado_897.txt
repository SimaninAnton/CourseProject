gabtremblay commented on 16 Sep 2013
web.py
245: # set the date header
"Date": httputil.format_timestamp(time.time()),
Will fall in httputil to:
if isinstance(ts, numbers.Real):
pass
Which will call :
email.utils.formatdate(time.time(), usegmt=True)
'Mon, 16 Sep 2013 12:42:11 GMT'
Sadly, the correct time would be
'Mon, 16 Sep 2013 08:42:11 GMT'
The reason is because python email.utils.formatdate does not use localtime by default.
One could be tempted to use
email.utils.formatdate(time.time(), localtime=True, usegmt=True)
but this makes python ignore the "usegmt=True".
it then output the correct date, in the wrong format:
'Mon, 16 Sep 2013 08:52:57 -0400'
The right call would be
email.utils.formatdate(calendar.timegm(time.localtime()), usegmt=True)
And in order for this to happen, the easyest way is to replace in web.py@245
"Date": httputil.format_timestamp(time.time()),
with
"Date": httputil.format_timestamp(time.localtime()),