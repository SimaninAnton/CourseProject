rafaelcapucho commented on 12 May 2016
When I try to get request.query_arguments.get('amount')[0] I get errors:
Traceback (most recent call last):
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/web.py", line 1445, in _execute
    result = yield result
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/gen.py", line 1008, in run
    value = future.result()
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/concurrent.py", line 232, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/gen.py", line 1014, in run
    yielded = self.gen.throw(*exc_info)
  File "/home/kepler/Workspace/beauty/beauty_site_venv/beauty_site/handlers/categories/__init__.py", line 78, in get
    'h2': 'Categoria %s' % category['name'],
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/gen.py", line 1008, in run
    value = future.result()
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/concurrent.py", line 232, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/gen.py", line 1017, in run
    yielded = self.gen.send(value)
  File "/home/kepler/Workspace/beauty/beauty_site_venv/beauty_site/handlers/search/__init__.py", line 414, in render_search_groups
    self.render('list_groups.html', **args)
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/web.py", line 699, in render
    html = self.render_string(template_name, **kwargs)
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/web.py", line 806, in render_string
    return t.generate(**namespace)
  File "/home/kepler/Workspace/beauty/beauty_site_venv/lib/python3.5/site-packages/tornado/template.py", line 345, in generate
    return execute()
  File "list_groups_html.generated.py", line 146, in _tt_execute
    if value in request.query_arguments.get('amount')[0]:  # list_groups_filters.html:27 (via list_groups.html:28, base.html:44)
TypeError: a bytes-like object is required, not 'str'
When I execute without [0] like request.query_arguments.get('amount') it complete without warning, it was a legacy code and was running on py27 and previous version of Tornado.
the env:
Request Info:

   method: GET
   remote_ip: 127.0.0.1
   arguments: {'amount': [b'40ml!50ml']}
   uri: /c/cabelos.html?amount=40ml!50ml
   body: b''
   headers: <tornado.httputil.HTTPHeaders object at 0x7fa3ae6672b0>
   connection: <tornado.http1connection.HTTP1Connection object at 0x7fa3ae944b00>
   _finish_time: None
   host: 127.0.0.1:8089
   path: /c/cabelos.html
   files: {}
   body_arguments: {}
   query_arguments: {'amount': [b'40ml!50ml']}
   protocol: http
   version: HTTP/1.1
   _start_time: 1463019081.1243713
   query: amount=40ml!50ml
Tornado 4.3 and Python 3.5.1