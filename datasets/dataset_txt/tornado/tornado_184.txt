kunal-bajpai commented on 8 May 2018
Hi,
I encountered the following error in the logs of a Salt minion that uses tornado's IOLoop.
[tornado.application][ERROR   ][18889] Exception in callback <functools.partial object at 0x7f094dbf8e10>
Traceback (most recent call last):
  File "/root/.pex/install/tornado-4.5.1-cp27-cp27mu-linux_x86_64.whl.fb67a9263e015c45296bb7103c9afdb612cd69fa/tornado-4.5.1-cp27-cp27mu-linux_x86_64.whl/tornado/ioloop.py", line 605, in _run_callback
    ret = callback()
  File "/root/.pex/install/tornado-4.5.1-cp27-cp27mu-linux_x86_64.whl.fb67a9263e015c45296bb7103c9afdb612cd69fa/tornado-4.5.1-cp27-cp27mu-linux_x86_64.whl/tornado/stack_context.py", line 279, in null_wrapper
    _state.contexts = current_state
UnboundLocalError: local variable 'current_state' referenced before assignment
Here's the construct this originates from
https://github.com/tornadoweb/tornado/blob/branch4.5/tornado/stack_context.py#L274-L279
This seems like a weird construct given that there are no globals by the name current_state. Any pointers as to why this could happen?