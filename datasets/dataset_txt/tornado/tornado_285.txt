bindlock commented on 18 Sep 2017 â€¢
edited
Hello guys. Please, explain to me where IOStream hides banner from SSH connection? I prepared code for test below.
import datetime
import socket

import tornado.gen
import tornado.ioloop
import tornado.iostream


HOST = ('127.0.0.1', 22)


def pure_socket():
    sock = socket.socket()
    sock.connect(HOST)
    print(sock.recv(1024))


async def iostream():
    stream = tornado.iostream.IOStream(socket.socket())
    await stream.connect(HOST)

    try:
        data = await tornado.gen.with_timeout(
            datetime.timedelta(seconds=5),
            stream.read_bytes(1024)
        )
    except tornado.gen.TimeoutError:
        print('Timeout')
    else:
        print(data)


if __name__ == '__main__':
    print('PURE SOCKET:')
    pure_socket()

    print('IOSTREAM:')
    tornado.ioloop.IOLoop.current().run_sync(iostream)
And output:
PURE SOCKET:
b'SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.8\r\n'
IOSTREAM:
Timeout
Python 3.6.2
Tornado 4.5.2