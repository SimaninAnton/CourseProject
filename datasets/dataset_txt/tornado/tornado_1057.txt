gorillamania commented on 7 Aug 2012
Hi,
It's accepted practice that when you support compression, Vary: Accept-Encoding http header is sent. From:
https://developers.google.com/speed/docs/best-practices/caching
"Set the Vary: Accept-Encoding response header. This instructs the proxies to cache two versions of the resource: one compressed, and one uncompressed. The correct version of the resource is delivered based on the client request header. This is a good choice for applications that are singly homed and depend on public proxies for user locality."
Apache does this:
http://httpd.apache.org/docs/2.2/mod/mod_deflate.html#proxies
The functionality can be enabled with the following patch:
*************** class GZipContentEncoding(OutputTransfor
*** 1670,1675 ****
--- 1670,1676 ----
("Content-Encoding" not in headers)
if self._gzipping:
headers["Content-Encoding"] = "gzip"
        headers["Vary"] = "Accept-Encoding"
      self._gzip_value = BytesIO()
      self._gzip_file = gzip.GzipFile(mode="w", fileobj=self._gzip_value)
      chunk = self.transform_chunk(chunk, finishing)
I'm using tornado==2.2