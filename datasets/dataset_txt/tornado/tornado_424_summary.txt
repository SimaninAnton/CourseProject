add_callback() isn't safe against reentrancy