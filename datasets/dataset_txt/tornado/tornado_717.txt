moloch-- commented on 10 Dec 2014
Malformed file names on upload cause a stacktrack (newlines):
Request
POST /user/share/files HTTP/1.1
Host: 192.168.6.132:8888
User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:34.0) Gecko/20100101 Firefox/34.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://192.168.6.132:8888/user/share/files
Cookie: _xsrf=2|bc84a83c|854187cbb6f98741a3bd8dcb9d308438|1418192086; session_id="2|1:0|10:1418196229|10:session_id|44:MjhiNThmNjBhZjg2Mzk5MjI3YjNjNWZiZWQzMTg1M2M=|ccec410256872ff6ecd0bf108e8f0820369a7f6c5391e74fb178fedab152e7cf"
Connection: keep-alive
Content-Type: multipart/form-data; boundary=---------------------------202882737716448
Content-Length: 56563

-----------------------------202882737716448
Content-Disposition: form-data; name="_xsrf"

2|f67ca701|cfb988f6fc01887ce94582f6d7c88b05|1418192086
-----------------------------202882737716448
Content-Disposition: form-data; name="files"; filename="
"
Content-Type: madeup/madeup

GIF89a/*��÷
Response
[E 141209 23:36:27 http1connection:53] Uncaught exception
    Traceback (most recent call last):
      File "/usr/local/lib/python2.7/dist-packages/tornado/http1connection.py", line 234, in _read_message
        delegate.finish()
      File "/usr/local/lib/python2.7/dist-packages/tornado/httpserver.py", line 282, in finish
        self.delegate.finish()
      File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 1883, in finish
        self.request._parse_body()
      File "/usr/local/lib/python2.7/dist-packages/tornado/httputil.py", line 436, in _parse_body
        self.headers)
      File "/usr/local/lib/python2.7/dist-packages/tornado/httputil.py", line 689, in parse_body_arguments
        parse_multipart_form_data(utf8(v), body, arguments, files)
      File "/usr/local/lib/python2.7/dist-packages/tornado/httputil.py", line 721, in parse_multipart_form_data
        headers = HTTPHeaders.parse(part[:eoh].decode("utf-8"))
      File "/usr/local/lib/python2.7/dist-packages/tornado/httputil.py", line 198, in parse
        h.parse_line(line)
      File "/usr/local/lib/python2.7/dist-packages/tornado/httputil.py", line 184, in parse_line
        name, value = line.split(":", 1)
    ValueError: need more than 1 value to unpack