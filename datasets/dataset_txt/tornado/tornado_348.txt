stefanoborini commented on 26 Apr 2017
I encountered a weird behavior I am unable to say if it's a bug or expected behavior. I am using tornado 4.4.2.
I have a delete handler in which I perform an operation and then issue a 204 as a response. I also clear Content-Type and called flush().
It turns out that my client was getting 599 errors with the following error
Malformed HTTP message from None: Response with code 204 should not have body.
I investigated the content, and it turns out that this message is generated because the following entry is in the header of the response.
Transfer-Encoding: chunked
This header is added in http1connection.write_headers, only if a series of conditions apply. In my case, calling flush apparently removed the Content-Length header. Without flush, it is kept as Content-Length: 0. The result is that no Transfer-Encoding header is added, and the 204 response is accepted.
Is this a bug or intended behavior?
Thanks