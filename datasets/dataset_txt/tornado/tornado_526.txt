frtmelody commented on 1 Apr 2016
I have use multiprocess in tornao httpserver, i have created 100 subprocess to serve. I think this server can server 30 request/sec, but only 3 request/sec. Why ?
ab -n100 http://127.0.0.1:8084
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import time

import tornado.web
import tornado.httpserver
import tornado.ioloop
import tornado.netutil
import tornado.process
# from tornado.options import define, options


# define("port", default=8101, help="run on the given port", type=int)


class LongHandler(tornado.web.RequestHandler):

    def get(self):
        time.sleep(3)
        self.write(str(os.getpid()))


if __name__ == "__main__":
    # tornado.options.parse_command_line()
    app = tornado.web.Application(([r'/', LongHandler], ))
    sockets = tornado.netutil.bind_sockets(18090)
    tornado.process.fork_processes(100)
    server = tornado.httpserver.HTTPServer(app)
    # server.listen(options.port)
    server.add_sockets(sockets)
    tornado.ioloop.IOLoop.instance().start()