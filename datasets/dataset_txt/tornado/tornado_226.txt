Contributor
lerks commented on 27 Feb 2018
We're using Tornado on top of the WSGI server provided by gevent. We've recently realized that, when downloading large files, they would first be fully read from disk to memory and only then be sent on the HTTP connection. Since we're copying them (from the file to the connection) in small chunks and flushing after every write, we were surprised by this. We traced it down to Tornado's _WSGIConnection simply adding the chunk to its _write_buffer when calling the write method, and the whole buffer being only sent at the very end of WSGIAdapter's __call__ method, all at once. This is quite problematic. Could anyone have a look at this and attempt a fix?