Contributor
brickZA commented on 10 Sep 2014
When multiple callbacks that raise exceptions are run on the ioloop AsyncTestCase seems to swallow all exceptions apart from the last, as demonstrated by this snippet below. With python 2.7 and tornado 4.0.1 only Exception(2) is printed, although both callbacks ran and raised exceptions. This is particularly problematic when the failure in cb2() was caused by cb1() not performing some expected action.
import unittest
import tornado.testing

class TestTest(tornado.testing.AsyncTestCase):

    @tornado.testing.gen_test()
    def test_testy(self):

        def start():
            self.io_loop.add_callback(cb1)
            self.io_loop.add_callback(cb2)

        def cb1():
            print('hi 1!')
            raise Exception(1)

        def cb2():
            print 'hi 2!'
            raise Exception(2)

        start()

if __name__ == '__main__'
    unittest.main()