zhoufankai commented on 20 Jul 2018
I use tornado tcp process on windows 10. But my process always break by too many file descriptors. I am a little nervous that it will happen on Linux.
There is my linux config.
Limit Soft Limit Hard Limit Units Max open files 1000000 1000000 files
Right now. I can see my process's FD number below:
[root@10-10-216-144 data]# ll /proc/25116/fd/ | wc -l 12578
It increased all the time. Never reduce. Does my code have some problems?
class EchoServer(TCPServer):
    def handle_stream(self, stream, address):
        conn = TcpConnection(stream,address)
        conn.stream_handler()

class TcpConnection(object):
    def __init__(self,stream,address):
        self._stream=stream
        self._address=address

    @coroutine
    def stream_handler(self):
        while True:
            try:
                message = yield self._stream.read_until(b'\r\n')
                # ...

            except StreamClosedError:
                break

        self._stream.close()