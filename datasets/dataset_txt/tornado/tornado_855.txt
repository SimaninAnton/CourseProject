MatsDahlberg commented on 21 Feb 2014
I have a tornado application that receives HEAD requests on very large static files (15-25 GB files). These files happens to be located on a remote server that is mounted over sshfs.
The HEAD request took 140-250 seconds which seemed strange to me. I found that even though it was a HEAD request tornado would read the whole file just to determine the length of it.
From web.py, lines 1947-1952:
        content_length = 0
        for chunk in content:
            if include_body:
                self.write(chunk)
            else:
                content_length += len(chunk)
In my server I have changed this to:
        content_length = 0
        if include_body:
            for chunk in content:
                self.write(chunk)
        else:
            content_length = os.stat(self.absolute_path).st_size
Now the HEAD request takes 2 ms instead of 140-250 seconds.