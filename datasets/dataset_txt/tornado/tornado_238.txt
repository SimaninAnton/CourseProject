icu0755 commented on 12 Feb 2018
How to reproduce:
MacOS 10.12.6
Python 3.6.1
Tornado 4.5.3
class Handler(tornado.web.RequestHandler):
    executor = ThreadPoolExecutor(max_workers=MAX_WORKERS)

    @run_on_executor
    def background_task(self, i):
        """ This will be executed in `executor` pool. """
        time.sleep(3)
        return i

    async def get(self):
        """ Request that asynchronously calls background task. """
        res = await self.background_task('hello world')
        self.write(res)
raises TypeError: object Future can't be used in 'await' expression.
I found a workaround proposal to use tornado.gen.convert_yielded
here
https://mail.python.org/pipermail//python-list/2017-February/719519.html
and in the documentation here
http://www.tornadoweb.org/en/stable/guide/coroutines.html?highlight=submit#python-3-5-async-and-await
But apparently it does not work due to the native future being returned untouched here
tornado/tornado/gen.py
Line 1297 in 15e350a
 return yielded 