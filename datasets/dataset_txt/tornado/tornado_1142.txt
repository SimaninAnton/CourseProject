Lawouach commented on 8 Aug 2011
The opcode is overridden on each continuation frame the server receives which means that on the final frame, it's not set to the proper opcode (text or binar) but instead set to continuation.
Can be easily fixed by using:
if self._fragmented_message_opcode is None:
      self._fragmented_message_opcode = self._frame_opcode