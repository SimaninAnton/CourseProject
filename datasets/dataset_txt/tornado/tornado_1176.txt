justinfx commented on 27 Apr 2011
This is my first project using Tornado... building a message service
with TornadIO + ZMQ. I'm using pyzmq's ioloop.
I have been running into this issue of a recursive loop between the
iostream and the websocket, and can't yet pinpoint why. Seems a client
connects fine and sends plenty of messages and receives fine. Someone
else connects and is fine for a bit then crash. I dont know if I'm not
handling a disconnect properly, or if something in a message is
causing a read error in the tornado code. Maybe someone can tell me
whats really happening here and if its something I'm not handling
properly...
// Start of the traceback...

[E 110426 01:45:28 ioloop:295] Exception in I/O handler for fd 22
Traceback (most recent call last):
File "/usr/local/lib/python2.6/dist-packages/pyzmq-2.1.4-py2.6-
linux-x86_64.egg/zmq/eventloop/ioloop.py", line 282, in start
self._handlers[fd](fd, events)
File "/usr/local/lib/python2.6/dist-packages/pyzmq-2.1.4-py2.6-
linux-x86_64.egg/zmq/eventloop/stack_context.py", line 133, in wrapped
callback(_args, *_kwargs)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 199, in _handle_events
self._handle_read()
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 258, in _handle_read
if self._read_from_buffer():

// START: here is the start of the block that loops recursively

File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 325, in _read_from_buffer
self._consume(loc + delimiter_len))
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 230, in _run_callback
callback(_args, *_kwargs)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/stack_context.py", line 173, in wrapped
callback(_args, *_kwargs)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/websocket.py", line 193, in _on_end_delimiter
self._receive_message()
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/websocket.py", line 178, in _receive_message
self.stream.read_bytes(1, self._on_frame_type)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 149, in read_bytes
if self._read_from_buffer():
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 314, in _read_from_buffer
self._run_callback(callback, self._consume(num_bytes))
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 230, in _run_callback
callback(_args, *_kwargs)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/stack_context.py", line 173, in wrapped
callback(_args, *_kwargs)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/websocket.py", line 183, in _on_frame_type
self.stream.read_until("\xff", self._on_end_delimiter)
File "/usr/local/lib/python2.6/dist-packages/tornado-1.2.1-
py2.6.egg/tornado/iostream.py", line 133, in read_until
if self._read_from_buffer():

// Loop back to start (line 325 in iostream
Any help??????
Im using the pypi tornado
1.2.1, tornadIO 0.0.4, zeromq 2.1.4, and pypi pyzmq, on ubuntu linux