orpheuslummis commented on 23 Jun 2011
As the title says, tornado.websocket (v2.0) crashes with its chatdemo on Python3.2. My traceback is here. Running on Python 2.7 worked fine though.
I'm not very Tornado-literate nor WebSocket-savvy, yet, so I fear I cannot help with this issue in the very short-term. Still, the problem might be because Python3 division is true division, and struct.pack(">I", key_number) requires an int.
def _calculate_part(self, key):
    """Processes the key headers and calculates their key value.

    Raises ValueError when feed invalid key."""
    number = int(''.join(c for c in key if c.isdigit()))
    spaces = len([c for c in key if c.isspace()])
    try:
        key_number = number / spaces # <-- Yields a float
    except (ValueError, ZeroDivisionError):
        raise ValueError
    return struct.pack(">I", key_number) # <-- struct.pack(">I", ...) wants an int
Going further, if I use struct.pack(">f", key_number) (doc) I get this error:
File "/home/orftz/virtualenvs/tornado/lib/python3.2/site-packages/tornado/iostream.py", line 166, in write
    assert isinstance(data, bytes_type)
AssertionError