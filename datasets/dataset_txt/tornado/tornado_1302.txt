ghost commented on 15 Feb 2010
Without this fix, _get_host_handlers only return the first host_pattern match. It's a real problem because if for example you do many add_handlers with same host, only the first will get return.
Fix :
def _get_host_handlers(self, request):
    host = request.host.lower().split(':')[0]
    result = []
    for pattern, handlers in self.handlers:
        if pattern.match(host):
            result += handlers
    # Look for default host if not behind load balancer (for debugging)
    if "X-Real-Ip" not in request.headers:
        for pattern, handlers in self.handlers:
            if pattern.match(self.default_host):
                result += handlers

    if result:
        return result
    return None