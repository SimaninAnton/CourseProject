Aireed commented on 28 May 2018 •
edited
FYI:
window: tornado==5.0
linux: tornado==4.4
I just found that,
on windows, i can get TimeoutError error, but on linux, the get function hang.
on Windows:
on linux:
it hang
my code :
QUEUE_MAX_SIZE = 10000
QUERY_TASK_QUE = Queue(maxsize=QUEUE_MAX_SIZE)

@gen.coroutine
def worker(gen_id):
   """空worker"""
   while True:
       try:
           print "[query_keyword-{} restore to run!!]".format(gen_id)
           item = yield QUERY_TASK_QUE.get(timeout=time.time() + 2)
           print item
       except tornado.util.TimeoutError:
           # yield gen.sleep(10)
           print traceback.format_exc()
           continue
       except Exception as e:
           print traceback.format_exc()
           continue

def check_proc_main(*args, **kwargs):
   parse_command_line()

   # 检查更新时间
   io_loop = tornado.ioloop.IOLoop.current()
   # io_loop.spawn_callback(wucInst.wechat_loader)
   
   for item in range(0, 10):
       io_loop.spawn_callback(worker, item)
   
   io_loop.start()


if __name__ == "__main__":
   check_proc_main()