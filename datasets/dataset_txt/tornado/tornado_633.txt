rsmith31415 commented on 1 Jul 2015
I need to test a POST request occurring immediately after a message sent using websockets, but I get tornado.access: ERROR: 500 POST. This is what I have so far:
    @gen_test
    def test_interaction(self):
        url = "ws://localhost:%d/websocket" % self.get_http_port()
        ws = yield websocket.websocket_connect(url, io_loop=self.io_loop)
        data = json.dumps(data) # data includes something that sends an initial message
        ws.write_message(data)
        data_post = urlencode(other_data)
        response_post = yield self.http_client.fetch(self.get_url('/my_url'), method='POST', body=data_post)
        response = yield ws.read_message()
        response = json.loads(response.body)
        self.assertEqual(some_condition)
Is it possible to test this kind of interaction? The idea is to test that the POST request modifies the result of the websocket response.