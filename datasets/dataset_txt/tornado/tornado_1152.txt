yablochkin commented on 15 Jul 2011
Have problem with bad url arguments. Got uncaught exeption on http://127.0.0.1:8888/%d8cdaa%7Cblack with this simple app:
import tornado.ioloop
import tornado.web

class MainHandler(tornado.web.RequestHandler):
    def get(self, value):
        self.write(value)

application = tornado.web.Application([
    (r"/(.*)", MainHandler),
])

if __name__ == "__main__":
    application.listen(8888)
    tornado.ioloop.IOLoop.instance().start()
Exception:
ERROR:root:Uncaught exception GET /%d8cdaa%7Cblack (127.0.0.1)
HTTPRequest(protocol='http', host='127.0.0.1:8888', method='GET', uri='/%d8cdaa%7Cblack', version='HTTP/1.1', remote_ip='127.0.0.1', body='', headers={'Accept-Language': 'ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4', 'Accept-Encoding': 'gzip,deflate,sdch', 'Host': '127.0.0.1:8888', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'User-Agent': 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.30 (KHTML, like Gecko) Chrome/12.0.742.124 Safari/534.30', 'Accept-Charset': 'windows-1251,utf-8;q=0.7,*;q=0.3', 'Connection': 'keep-alive', 'Cookie': 'sessionid=14ef6569e7fffe0bdb032e88372b37a9; csrftoken=8150301284c77c2cfda482944148aa27; clicked="\\054127"; last_widget=7; last_widget_clicks=0', 'Cache-Control': 'max-age=0'})
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/tornado-2.0-py2.7.egg/tornado/web.py", line 924, in _execute
    args = [self.decode_argument(arg) for arg in args]
  File "/usr/local/lib/python2.7/dist-packages/tornado-2.0-py2.7.egg/tornado/web.py", line 278, in decode_argument
    return _unicode(value)
  File "/usr/local/lib/python2.7/dist-packages/tornado-2.0-py2.7.egg/tornado/escape.py", line 172, in to_unicode
    return value.decode("utf-8")
  File "/usr/lib/python2.7/encodings/utf_8.py", line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeDecodeError: 'utf8' codec can't decode byte 0xd8 in position 0: invalid continuation byte
ERROR:root:500 GET /%d8cdaa%7Cblack (127.0.0.1) 1.41ms
Maybe you may use something like arg.decode(arg, 'ignore') when escaping arguments?
Python 2.7.1
Tornado 2.0.0