mayfield commented on 18 Jun 2013
I have some StaticFileHandler subclasses that partially override the get() method. Sometimes they return internally compiled templates when appropriate and otherwise they call super().get() which will do the regular StaticFilterHandler stuff. After upgrading to tornado 3.1.0 (from 3.0.1) I get the following AttributeError that results from the 'absolute_path' attribute not being set.
Traceback (most recent call last):
  File "/local/home/mayfield/project/rome/mayfield-rome/packages_venv/lib/python2.7/site-packages/tornado/web.py", line 1141, in _when_complete
    callback()
  File "/local/home/mayfield/project/rome/mayfield-rome/packages_venv/lib/python2.7/site-packages/tornado/web.py", line 1167, in _execute_finish
    self.finish()
  File "/local/home/mayfield/project/rome/mayfield-rome/packages_venv/lib/python2.7/site-packages/tornado/web.py", line 741, in finish
    self.set_etag_header()
  File "/local/home/mayfield/project/rome/mayfield-rome/packages_venv/lib/python2.7/site-packages/tornado/web.py", line 1084, in set_etag_header
    etag = self.compute_etag()
  File "/local/home/mayfield/project/rome/mayfield-rome/packages_venv/lib/python2.7/site-packages/tornado/web.py", line 1862, in compute_etag
    version_hash = self._get_cached_version(self.absolute_path)
AttributeError: 'DiagHandler' object has no attribute 'absolute_path'
This attribute is not setup until mid body of the get() method in StaticFileHandler. I can easily work around this by setting up the attribute myself (in get(), prepare(), or initialize(), but I feel like this needlessly violates DRY.
I'm sure you could tell me I shouldn't do this and the superclass must always be invoked even for something seemingly virtual like get(); I will go away if you insist I shouldn't do this, but I've found this pattern to be quite useful in the past and the fact that this sort of thing was so easy to do without complication has been, in my opinion, one of the reasons for tornado's popularity.
If you accept the issue I'd be happy to submit a pull request with a fix.