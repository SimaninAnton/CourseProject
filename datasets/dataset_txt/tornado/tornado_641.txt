opoplawski commented on 19 May 2015
I have ipv64.disable=1 on my kernel boot line. Trying to build 4.1.0 through current git master I get:
ERROR: test_ipv6 (tornado.test.simple_httpclient_test.SimpleHTTPClientTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 119, in __call__
    result = self.orig_method(*args, **kwargs)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/simple_httpclient_test.py", line 256, in test_ipv6
    [sock] = bind_sockets(None, '::1', family=socket.AF_INET6)
ValueError: need more than 0 values to unpack

======================================================================
ERROR: test_ipv6 (tornado.test.simple_httpclient_test.SimpleHTTPSClientTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 119, in __call__
    result = self.orig_method(*args, **kwargs)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/simple_httpclient_test.py", line 256, in test_ipv6
    [sock] = bind_sockets(None, '::1', family=socket.AF_INET6)
ValueError: need more than 0 values to unpack

======================================================================
ERROR: test_connect_ipv6_dual (tornado.test.tcpclient_test.TCPClientTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 119, in __call__
    result = self.orig_method(*args, **kwargs)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 107, in test_connect_ipv6_dual
    self.do_test_connect(socket.AF_INET6, 'localhost')
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 500, in post_coroutine
    timeout=timeout)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/ioloop.py", line 444, in run_sync
    return future_cell[0].result()
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/concurrent.py", line 214, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/gen.py", line 230, in wrapper
    yielded = next(result)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 84, in do_test_connect
    port = self.start_server(family)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 60, in start_server
    self.server = TestTCPServer(family)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 40, in __init__
    self.port = sockets[0].getsockname()[1]
IndexError: list index out of range

======================================================================
ERROR: test_connect_ipv6_ipv6 (tornado.test.tcpclient_test.TCPClientTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 119, in __call__
    result = self.orig_method(*args, **kwargs)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 100, in test_connect_ipv6_ipv6
    self.do_test_connect(socket.AF_INET6, '::1')
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 500, in post_coroutine
    timeout=timeout)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/ioloop.py", line 444, in run_sync
    return future_cell[0].result()
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/concurrent.py", line 214, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/gen.py", line 230, in wrapper
    yielded = next(result)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 84, in do_test_connect
    port = self.start_server(family)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 60, in start_server
    self.server = TestTCPServer(family)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 40, in __init__
    self.port = sockets[0].getsockname()[1]
IndexError: list index out of range

======================================================================
ERROR: test_connect_unspec_ipv6 (tornado.test.tcpclient_test.TCPClientTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 119, in __call__
    result = self.orig_method(*args, **kwargs)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 115, in test_connect_unspec_ipv6
    self.do_test_connect(socket.AF_UNSPEC, '::1')
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/testing.py", line 500, in post_coroutine
    timeout=timeout)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/ioloop.py", line 444, in run_sync
    return future_cell[0].result()
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/concurrent.py", line 214, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/gen.py", line 876, in run
    yielded = self.gen.throw(*exc_info)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/test/tcpclient_test.py", line 85, in do_test_connect
    stream = yield self.client.connect(host, port)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/gen.py", line 870, in run
    value = future.result()
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/concurrent.py", line 214, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/gen.py", line 879, in run
    yielded = self.gen.send(value)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/tcpclient.py", line 167, in connect
    af, addr, stream = yield connector.start()
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/tcpclient.py", line 80, in start
    self.try_connect(iter(self.primary_addrs))
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/tcpclient.py", line 95, in try_connect
    future = self.connect(af, addr)
  File "/export/home/orion/fedora/python-tornado/python-tornado-4.2.0git/python3/tornado/tcpclient.py", line 179, in _create_stream
    stream = IOStream(socket.socket(af),
  File "/usr/lib64/python3.4/socket.py", line 123, in __init__
    _socket.socket.__init__(self, family, type, proto, fileno)
OSError: [Errno 97] Address family not supported by protocol
I'm not sure if this is worth handling better or not.