gtmanfred commented on 17 May 2018
Hello, I am hoping you can help me.
I am working on the last failure for salt to support tornado 5.0.
We are currently hanging on this line
https://github.com/gtmanfred/salt/blob/2017.7.6/salt/transport/tcp.py#L907
But only on python2.7 with tornado 5.0.
To replicate this
git clone git://github.com/gtmanfred/salt.git -b 2017.7.6
cd salt
pip2 install -r requirements/dev_python27.txt -r requirements/zeromq.py
pytest -ra -sv --log-cli-level=debug tests/unit/transport/test_tcp.py -k test_basic
It works when running running each one of those tests individually, but when running them together, it fails.
If I put a PeriodicCallback there, to see if it continue, everything works, but then when the whole test suite runs, I get an error for too many open files, so I think that the ioloop is not actually getting stopped.
I tried also setting set_blocking_log_threshold, since we are still on py2 and not asyncio (which works fine), but nothing gets logged ever.
Any help on what I can do to troubleshoot this further would be greatly appreciated
Thanks,
Daniel