Member
bdarnell commented on 29 Apr 2013
IOStream allows for reads after close only as long as there is an unbroken chain of callbacks. If anything else happens in the meantime, the close callback will be run even if there is buffered data. _maybe_run_close_callback should check the status of the buffer and only run the close callback if either the buffer is empty or if there is a pending read that cannot be satisfied from the buffer.
See discussion in #747.