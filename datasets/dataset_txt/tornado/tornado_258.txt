layer3switch commented on 29 Dec 2017 â€¢
edited
While most HTTP server response will provide "version", "code" and "reason" in response header string such as "HTTP/1.1 200 OK", it is also not necessary to include "OK" as reason key value. Some http servers will not include reason in its header response.
When "reason" key value is missing in the header, tornado.httputil.parse_response_start_line() will raise HTTPInputError and fails to parse rest of response header.
As shown below when "OK" is missing in the first header line;
>>> tornado.httputil.parse_response_start_line("HTTP/1.1 200")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python2.7/site-packages/tornado/httputil.py", line 854, in parse_response_start_line
    raise HTTPInputError("Error parsing response start line")
tornado.httputil.HTTPInputError: Error parsing response start line
In parse_response_start_line() definition, re.match expects exactly 3 keys assigned from line string due to space as delimiter;
tornado/tornado/httputil.py
Line 853 in c60c7f0
 match = re.match("(HTTP/1.[0-9]) ([0-9]+) ([^\r]*)", line) 
My proposal to fix this, remove space between 2nd and 3rd match case.
    match = re.match("(HTTP/1.[0-9]) ([0-9]+)([^\r]*)", line)