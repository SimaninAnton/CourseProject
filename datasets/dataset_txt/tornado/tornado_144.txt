garg10may commented on 24 Aug 2018 â€¢
edited
We are receiving stocks market data at a high burst rate over UDP connection. It is then relayed to the browser using tornado. However once in a while (once in few hours to few minutes) it fails randomly/unpredictably with the below error.
The data is sent to majorly all connected sockets with the tornado.
Not sure why it is failing.
ERROR:2018-08-24 18:17:01,033:get_broadcast
Traceback (most recent call last):
  File "/release/manik/muTrade-1.0.0-1.7.4.5/web/utrade/WebSocket/get_broadcast.py", line 321, in _send_msg_to_clients
    socketConnectionObject.send(smart_str(simplejson.dumps(data)))
  File "/release/st01/py3Env/lib/python3.6/site-packages/sockjs/tornado/conn.py", line 49, in send
    self.session.send_message(message, binary=binary)
  File "/release/st01/py3Env/lib/python3.6/site-packages/sockjs/tornado/session.py", line 322, in send_message
    self.send_jsonified(proto.json_encode(bytes_to_str(msg)), stats)
  File "/release/st01/py3Env/lib/python3.6/site-packages/sockjs/tornado/session.py", line 337, in send_jsonified
    self.handler.send_pack('a[%s]' % msg)
  File "/release/st01/py3Env/lib/python3.6/site-packages/sockjs/tornado/transports/websocket.py", line 86, in send_pack
    self.write_message(message, binary)
  File "/release/st01/py3Env/lib/python3.6/site-packages/tornado/websocket.py", line 252, in write_message
    return self.ws_connection.write_message(message, binary=binary)
  File "/release/st01/py3Env/lib/python3.6/site-packages/tornado/websocket.py", line 783, in write_message
    message = self._compressor.compress(message)
  File "/release/st01/py3Env/lib/python3.6/site-packages/tornado/websocket.py", line 548, in compress
    assert data.endswith(b'\x00\x00\xff\xff')
AssertionError