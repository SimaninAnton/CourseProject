tab1293 commented on 7 Feb 2017 â€¢
edited
When assigning an instance of AsyncHTTPClient to a class variable, calling fetch on it just hangs. In the code below, the google_request responds with a 200 but google_request_self does not respond at all. Is this a bug or an intended side effect?
from tornado.ioloop import IOLoop
from tornado.gen import coroutine, Return
from tornado.httpclient import AsyncHTTPClient

class GoogleGetter:
    def __init__(self):
        self.url = "http://google.com"
        self.http_client = AsyncHTTPClient()

    @coroutine
    def google_request_self(self):
        resp = yield self.http_client.fetch(self.url)
        print resp.code
        raise Return(resp)

    @coroutine
    def google_request(self):
        http_client = AsyncHTTPClient()
        resp = yield http_client.fetch(self.url)
        print resp.code
        raise Return(resp)

gg = GoogleGetter()
ioloop = IOLoop()
ioloop.run_sync(gg.google_request)
ioloop.run_sync(gg.google_request_self)