jbaiter commented on 13 May 2014
I ran into a weird issue in my application where sometimes events (which are triggered via a websocket message) were fired twice.
The logs indicated that while my Tornado-backend was only issuing one write_message call, the (JavaScript)-Client was receiving two messages.
I inspected the traffic with Wireshark and found that in those cases, a single WebSocket packet was containing two payloads, as can be seen in this screenshot:
http://i.imgur.com/R1QAuv7.png
This packet contained both the payload from the preceding and the following packet, hence the duplicate events.
You can find the traffic dump under this link, the relevant packet is no. 170:
http://jbaiter.de/jbaiter.de/websocket_weirdness.pcap
Here is the code that sends the messages:
def send_event(self, event):
    data = json.dumps(event, cls=CustomJSONEncoder)
    # SocketHandler is a custom 'WebSocketHandler' that tracks open connections
    for sock in SocketHandler.clients:
        sock.write_message(data)