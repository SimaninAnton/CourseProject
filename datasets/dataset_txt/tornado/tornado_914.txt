mehmetkose commented on 8 Aug 2013
Hello, I would like to send WebSocket listeners with the flow of the page only.
the most logical way to do this is to use the structure of slug and I think dictionary.
e.g :
listenners = {
"page-234" : [client1, client2, client3],
"page-235" : [client5, client4, client2],
"page-236" : [client7, client2, client1]
}
I've added a list of the listener into a connection is established.
Slug with a key provided in the open.
class UpdateHandler(tornado.websocket.WebSocketHandler,BaseHandler):
cache = []
cache_size = 200
listenners = {}
def open(self,slug):
    try:
        UpdateHandler.listenners[slug].append(self)
    except Exception, e:
        UpdateHandler.listenners[slug] = []
        UpdateHandler.listenners[slug].append(self)

def on_close(self,slug):
    UpdateHandler.listenners[slug].remove(self)

.....
.....
on_close in a get slug, causes error.
[E 130807 20:43:34 iostream:308] Uncaught exception, closing connection.
Traceback (most recent call last):
File "/usr/local/lib/python2.7/dist-packages/tornado-2.4-py2.7.egg/tornado/iostream.py", line 305, in wrapper
callback(_args)
File "/usr/local/lib/python2.7/dist-packages/tornado-2.4-py2.7.egg/tornado/websocket.py", line 229, in on_connection_close
self.on_close()
TypeError: on_close() takes exactly 2 arguments (1 given)
[E 130807 20:43:34 ioloop:435] Exception in callback <tornado.stack_context._StackContextWrapper object at 0x953ecac>
Traceback (most recent call last):
File "/usr/local/lib/python2.7/dist-packages/tornado-2.4-py2.7.egg/tornado/ioloop.py", line 421, in _run_callback
callback()
File "/usr/local/lib/python2.7/dist-packages/tornado-2.4-py2.7.egg/tornado/iostream.py", line 305, in wrapper
callback(_args)
File "/usr/local/lib/python2.7/dist-packages/tornado-2.4-py2.7.egg/tornado/websocket.py", line 229, in on_connection_close
self.on_close()
TypeError: on_close() takes exactly 2 arguments (1 given)
on_close can slug you think should be made?