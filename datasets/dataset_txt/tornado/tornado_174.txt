ManiDOSS commented on 13 Jun 2018 â€¢
edited
I am really very tried to configure tornado websocket configuration with nginx finally I got one issue but i cannot fix it. Is I made any mistake in my configuration?
This is my websocket.py:
import logging
import tornado.escape
import tornado.ioloop
import tornado.options
import tornado.web
import tornado.websocket
import os.path
import uuid
import tornado.wsgi

class Application(tornado.web.Application):
    def __init__(self):
        handlers = [
                     (r"/", MainHandler),
     ("/chatsocket",ChatSocketHandler)
        ]
        settings = dict(
                    cookie_secret="__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__",
                    template_path=os.path.join(os.path.dirname(__file__), "templates"),
                   static_path=os.path.join(os.path.dirname(__file__), "static"),
                   xsrf_cookies=False,
                  debug = True
        )
       super(Application, self).__init__(handlers, **settings)

class ChatSocketHandler(tornado.websocket.WebSocketHandler):
    def check_origin(self, origin):
        return True
    def open(self, *args, **kwargs):
       print('connection opened')

    def on_close(self):
        print('connection closed')
    def on_message(self, message):
        print(message)
        self.write_message(message)

class MainHandler(tornado.web.RequestHandler):
    def get(self):
        self.render("index.html")

app = Application()
application = tornado.wsgi.WSGIAdapter(app)

def main():
    # tornado.options.parse_command_line()
     tornado.ioloop.IOLoop.instance().start()


if __name__ == "__main__":
    main()
This is my client script:
let url = "ws://209.97.139.107/chatsocket";
let socket = new WebSocket(url);
socket.onmessage = function(event) {
       console.log(event);
 };
socket.onopen = function () {
       console.log('opend');
       socket.send('Hello World')
};
socket.onclose = function () {
       console.log('closed');
};
In my web browser console:
opened
closed
In my web browser console without nginx configuration:
opened
MessageEvent{....}