johnbazan commented on 18 Jul 2014
Hi guys, i have just moved to Tornado 4.0 from 3.8 and i am experiencing an issue with the HTTPServerRequest class from httputil.py module.
The init method takes these arguments:
self, method=None,
uri=None,
version="HTTP/1.0",
headers=None,
body=None,
host=None,
files=None,
connection=None,
start_line=None
So, it should be able to create an HTTPServerRequest without taking any arguments
i.e.: HTTPServerRequest()
But there's a getattr that has no default value, so if connection is None, then context is None too, and we can't get a remote_ip from it.
    context = getattr(connection, 'context', None)
    self.remote_ip = getattr(context, 'remote_ip')
    self.protocol = getattr(context, 'protocol', "http")
The traceback is something like this:
base_handler = base.BaseHandler(app, HTTPServerRequest())
File "PATH/tornado/httputil.py", line 338, in init
self.remote_ip = getattr(context, 'remote_ip')
AttributeError: 'NoneType' object has no attribute 'remote_ip'
This breaks the retro-compatibility with 3.8
If i am wrong, please let me know, hope this report can be useful.
Kind Regards,
Jonathan