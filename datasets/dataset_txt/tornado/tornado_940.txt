luwenjin commented on 21 Jun 2013
I was trying to write a static file server with tornado, but memory leaks when it serves html5 videos, the code is pretty simple.
server.py
import tornado.ioloop
import tornado.web

if __name__ == "__main__":
    application = tornado.web.Application([
        (r"/(.*)", tornado.web.StaticFileHandler, {'path': '.'}),
    ])
    application.listen(8888)
    tornado.ioloop.IOLoop.instance().start()
video.html
<html>
<body>
<video src="demo.mp4"></video>
</body>
</html>
Details:
My platform: windows 7 64bit, chrome 27, python 2.7, tornado 2.4
When the html page was loaded, python.exe's memory goes up.
Every time I reload the page, memory goes up again ( + 5MB for every reload in my situation )
On reloading, an error was raised by tornado ( see the last part )
If I play the video, I can see the memory going down during the playing (but always higher than last reload)
Error Traceback on Page Reloading
WARNING:tornado.general:error on read
Traceback (most recent call last):
  File "D:\PROJECTS\Working\PyF5\tornado\iostream.py", line 391, in _handle_read
    if self._read_to_buffer() == 0:
  File "D:\PROJECTS\Working\PyF5\tornado\iostream.py", line 447, in _read_to_buffer
    chunk = self.read_from_fd()
  File "D:\PROJECTS\Working\PyF5\tornado\iostream.py", line 683, in read_from_fd
    chunk = self.socket.recv(self.read_chunk_size)
error: [Errno 10053] 