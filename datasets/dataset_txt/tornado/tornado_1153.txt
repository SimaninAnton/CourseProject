landongn commented on 13 Jul 2011
I'm working on an async (using IOStream) based mysql client for python. I'm running into a strange error when i try to connect to the mysql server via a standard socket.socket() connection.
File "/home/spot/asyncmysql/pysymy/pysymy/init.py", line 93, in Connect
return Connection(_args, *_kwargs)
File "/home/spot/asyncmysql/pysymy/pysymy/connections.py", line 513, in init
self._connect()
File "/home/spot/asyncmysql/pysymy/pysymy/connections.py", line 676, in _connect
raise OperationalError(2003, "Can't connect to MySQL server on %r (%s)" % (dumb_socket, e.args[0]))
pysymy.err.OperationalError: (2003, "Can't connect to MySQL server on <socket._socketobject object at 0x7f981211e670> ('IOStream' object has no attribute 'connect')")
The first instance listing there on that last line is the socket instance. The other is the exception i'm getting when i try to execute the connect with the iostream. here's the relevant code:
            dumb_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
            t = dumb_socket.gettimeout()
            dumb_socket.settimeout(self.connect_timeout)


            self.dumb_socket = dumb_socket
            self.async_socket = iostream.IOStream(self.dumb_socket)
            self.async_socket.connect((self.host, self.port), self.wait_for_packet)
            self.mainLoop = ioloop.IOLoop.instance().start()
            self.host_info = "socket %s:%d" % (self.host, self.port)
I'm flummoxed. Any suggestions?