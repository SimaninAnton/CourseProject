murdav commented on 14 Nov 2013
Hello,
My serializer class is based on this concept Generic relationships: http://django-rest-framework.org/api-guide/relations.html#generic-relationships
But I need to add several fields which are in Class1 in serializer.data.
I added this:
http://django-rest-framework.org/api-guide/serializers.html#deserializing-objects
{CUT}
By default, serializers must be passed values for all required fields or they will throw validation errors. You can use the partial argument in order to allow partial updates.
{/CUT}
class Class1Serializer(serializers.ModelSerializer):
class Meta:
model = Class1
def to_native(self, value):        
    if isinstance(value.content_object, Class2):
        serializer = Class2Serializer(value.content_object, data={'visibility': value.visibility, 'stack_order': value.stack_order}, partial=True)            
    elif isinstance(value.content_object, Class3):
        serializer = Class3Serializer(value.content_object, data={'visibility': value.visibility, 'stack_order': value.stack_order}, partial=True)
    else:
        raise Exception('Unexpected type of tagged object')                

    # Not so sure about these the following 2 lines
    # When deserializing data, you always need to call is_valid() before attempting to access the deserialized object. 
    # If any validation errors occur, the .errors property will contain a dictionary representing the resulting error messages. 
    if serializer.is_valid():
        serializer.save()

    return serializer.data
But serializer.data doesn't contain the 2 new fields. They are in serializer.init_data.
Ideas?
Django==1.5.4
djangorestframework==2.3.8
Thanks a lot!