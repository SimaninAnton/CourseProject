solex commented on 14 Jul 2013
Steps to reproduce:
Have an APIView with CSRF protection and accepting application/json
Use SessionAuthentication
Render a normal Django form, including {% csrf_token %}
Submit an AJAX POST request by serializing a form as JSON
Get 403 Forbidden error with "CSRF Failed: CSRF token missing or incorrect."
The problem is that CsrfViewMiddleware (from both compat and django.middleware.csrf) explicitly looks for csrfmiddlewaretoken in request.POST (that is, assuming application/x-www-form-urlencoded)
The workaround is to use HTTP_X_CSRFTOKEN header, but it still looks like unexpected behavior. Perhaps it should be mentioned that you have to use HTTP header, if fixing CsrfViewMiddleware is too cumbersome.