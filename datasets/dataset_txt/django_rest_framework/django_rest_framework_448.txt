elcolie commented on 21 Mar 2018
Hi. My question is very simple, but I could not find the recent solution fit to my problem. I had read this and this. In the ordinary case url expose my pk. It works. But this time I do not want to expose my user's id to the url. Then I decided to cover by username.
Error:
Could not resolve URL for hyperlinked relationship using view name "api:user-list". You may have failed to include the related model in your API, or incorrectly configured the lookup_field attribute on this field.
    class UserViewSet(viewsets.ModelViewSet):
        permission_classes = (IsAuthenticated,)
        queryset = User.objects.all()
        serializer_class = UserSerializer
        lookup_field = 'username'
        lookup_url_kwarg = 'username'
    
        def get_queryset(self):
            # Always return only his record
            return self.queryset.filter(username=self.request.user.username)
    
    class UserSerializer(serializers.ModelSerializer):
        url = serializers.HyperlinkedIdentityField(view_name='api:user-list', source='username',
                                                   lookup_url_kwarg='username', lookup_field='username')
    
        class Meta:
            model = User
            fields = [
                'url',
                'id',
                'username',
                'first_name',
                'last_name',
                'email',
            ]
            read_only_fields = ['id','url', 'username']
Question:

Where am I wrong?