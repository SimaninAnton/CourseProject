JensTimmerman commented on 2 Feb 2016
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/django/core/handlers/base.py", line 132, in get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "/usr/lib/python2.7/site-packages/django/utils/decorators.py", line 145, in inner
    return func(*args, **kwargs)
  File "/usr/lib/python2.7/site-packages/django/views/generic/base.py", line 71, in view
    return self.dispatch(request, *args, **kwargs)
  File "/usr/lib/python2.7/site-packages/django/views/decorators/csrf.py", line 58, in wrapped_view
    return view_func(*args, **kwargs)
  File "/usr/lib/python2.7/site-packages/rest_framework/views.py", line 401, in dispatch
    self.response = self.finalize_response(request, response, *args, **kwargs)
  File "/usr/lib/python2.7/site-packages/rest_framework/views.py", line 332, in finalize_response
    % type(response)
AssertionError: Expected a `Response`, `HttpResponse` or `HttpStreamingResponse` to be returned from the view, but received a `<class 'rest_framework.exceptions.PermissionDenied'>`.
When a request with insufficient permissions is made in views.dispatch the following happens:
in dispatch:
self.initial (request)
will call self.check_permissions(request)
which will call self.permission_denied(request)
this will raise a rest_framework.exceptions.PermissionDenied()
this exception is except'ed in dispatch, where
respons = self.handle_exception(exc) is called
handle_exception only checks for exceptions of instance NotAuthenticated or AuthenticationFailed, but not for PermissionDenied (which would also be appropriate for a 403_FORBIDDEN response, no?)
After this, response is generated as by self.settings.EXCEPTION_HANDLER(exc)
which in this case does not seem to generate a valid response, since I'm getting this internal server error.
It would be nice if:
The response was 403_FROBIDDEN if there's a Permissiondenied
The default self.settings.EXCEPTION_HANDLER would print out some info on how to change it's behavior (at the moment I don't know where to start looking to set the default exception handler)
The default EXCEPTION_HANDLER would generate valid HttpResponse's