yaserrahimi commented on 18 May 2019 â€¢
edited
i have two view first one is :
class MyUploadView(APIView):

    parser_class = (FileUploadParser,)
    media_type = "video/mp4"

    def put(self, request, ):
        if 'file' not in request.FILES:
            return Response({'error': 'file was exist'},
                            status=status.HTTP_400_BAD_REQUEST)
        file = request.FILES.get("file")
        file_type = magic.from_buffer(file.read())
        if "MP4" not in file_type:
            return Response({"error": "file type is incorect"}, status=status.HTTP_400_BAD_REQUEST)

        if 'name' not in request.data:
            return Response({'error': 'name was exist'},
                            status=status.HTTP_400_BAD_REQUEST)
        print(request.data.get("class"))
        if 'class' not in request.data:
            return Response({'error': 'class was exist'},
                            status=status.HTTP_400_BAD_REQUEST)
        elif len(Class.objects.filter(pk=request.data.get("class"))) < 1:
            return Response({'error': 'class not found'},
                            status=status.HTTP_400_BAD_REQUEST)

        if 'name' not in request.data:
            return Response({'error': 'description was exist'},
                            status=status.HTTP_400_BAD_REQUEST)

        name = request.data.get("name")
        study_class = request.data.get("class")
        description = request.data.get("description")
        file_name = request.FILES.get("file")
        study = Class.objects.get(pk=study_class)
        print("ok")
        obj = Video.objects.create(name=name,
                                   description=description,
                                   study_class=study,
                                   video_field=file_name)
        return Response({'name:': obj.name}, status=status.HTTP_201_CREATED)
and second is:
class ClassThumbnailSetter(APIView):
    parser_classes = (FileUploadParser,)
    media_type = 'image/jpg'

    def put(self, request,):
        if 'image' not in request.FILES:
            return Response({'error:': 'image is required'}, status=status.HTTP_400_BAD_REQUEST)
        if 'class' not in request.data:
            return Response({'error': "class is required"}, status=status.HTTP_400_BAD_REQUEST)
        if not Class.objects.filter(pk=request.data.get('class')).exists():
            return Response({'error': 'class not found'}, status=status.HTTP_400_BAD_REQUEST)
        image = request.FILES.get('image')
        image_type = magic.from_buffer(image.read())
        if "image" not in image_type:
            return Response({"error": "file type is incorrect"}, status=status.HTTP_400_BAD_REQUEST)
        Class.objects.filter(pk=request.data.get('class')).update(thumbnail=request.FILES.get('image'))

        return Response({'massage:': "ok"}, status=status.HTTP_201_CREATED)
first view work correctly but second view return an error:
{
    "detail": "Missing filename. Request should include a Content-Disposition header with a filename parameter."
}
i don't have any idea why first one work one second one don't work!
can you help me?