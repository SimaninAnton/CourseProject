SiddharthMantri commented on 16 Oct 2014
I'm facing issues unit-testing my file upload endpoint
My test case:
class PhotoUploadTests(TestCase):

    def setUp(self):
        self.b1 = SomeFactory()
        self.oauth_header = _get_oauth2_header()

    def test_upload_photo(self):
        c = Client()
        test_location = os.path.dirname(__file__)
        project_path = os.path.join(test_location, os.pardir)
        project_path = os.path.abspath(project_path)
        file_path = os.path.join(project_path, os.pardir)
        test_file = os.path.join(file_path, 'data/images.jpg')
        with open(test_file, 'rb') as data:
            response = c.post('/url/api/{}/photos'.format(self.b1.aid), {'image': data}, **self.oauth_header)
            self.assertEqual(response.status_code, 201)
My views:
class PictureUpload(APIView):
    parser_classes = (FormParser, MultiPartParser,)

    def post(self, request, aid, format='multipart'):
        '''
        Upload New Image
        '''
        field_this = SomeModel.objects.get(aid=aid)
        serialiser = PictureSerialiser(data={'business': field_this.aid}, files=request.FILES['image'])
        if serialiser.is_valid():
            serialiser.save()
            return Response(serialiser.data, status=status.HTTP_201_CREATED)
    return Response(serialiser.errors, status=status.HTTP_400_BAD_REQUEST)
On running tests, I face InterfaceError: Error binding parameter 0 - probably unsupported type.. I could really use some help on this.