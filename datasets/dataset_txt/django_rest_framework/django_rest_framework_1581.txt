liquidpele commented on 2 Sep 2015
We have a viewset something like this:
class RepoViewSet(ReadOnlyModelViewSet):
    queryset = SoftwareRepository.objects.all()
    serializer_class = RepositorySerializer

   @list_route(methods=['GET', 'PUT'])
   def sync(self, request):
        # do stuff
However, in the api browser, if I visit that URL and then click OPTIONS then it throws a 500 error due to AssertionError being thrown by SimpleMetadata object... it seems that it tries get_object() which bombs out because it assumes that there is a pk just from it accepting PUT ?
Traceback:
File "/usr/lib/python2.6/site-packages/django/core/handlers/base.py" in get_response
  112.                     response = wrapped_callback(request, *callback_args, **callback_kwargs)
File "/usr/lib/python2.6/site-packages/django/views/decorators/csrf.py" in wrapped_view
  57.         return view_func(*args, **kwargs)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/viewsets.py" in view
  85.             return self.dispatch(request, *args, **kwargs)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/views.py" in dispatch
  456.             response = self.handle_exception(exc)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/views.py" in dispatch
  453.             response = handler(request, *args, **kwargs)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/views.py" in options
  467.         data = self.metadata_class().determine_metadata(request, self)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/metadata.py" in determine_metadata
  64.             actions = self.determine_actions(request, view)
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/metadata.py" in determine_actions
  83.                     view.get_object()
File "/usr/lib/python2.6/site-packages/djangorestframework-3.1.3-py2.6.egg/rest_framework/generics.py" in get_object
  91.             (self.__class__.__name__, lookup_url_kwarg)

Exception Type: AssertionError at /rest/v1/repositories/sync
Exception Value: Expected view RepoViewSet to be called with a URL keyword argument named "pk". Fix your URL conf, or set the `.lookup_field` attribute on the view correctly.