KushGoyal commented on 29 Jun 2017
PrimaryKeyRelatedField does not work properly if you don't use a specific queryset.
for example:
my_field = PrimaryKeyRelatedField(queryset=MyModel.objects.all())
If I use the above field it will give me json serialization error in response. Sinceuse_pk_only_optimization is set to true and the field assumes that the objects returned by the queryset are pk objects. But instead they are full objects.
While this will work fine:
my_field = PrimaryKeyRelatedField(queryset=MyModel.objects.all().values_list('pk', flat=True))
This behaviour of PrimaryKeyRelatedField field is undocumented on page [1]. It would really help a lot if this behaviour is explicitly mentioned and users know which queryset to use.
MyModel.objects.all() will work fine for write_only cases but not for read and write both.
[1] http://www.django-rest-framework.org/api-guide/relations/?q=use_pk_only_optimization#primarykeyrelatedfield