cristianocca commented on 1 May 2016
Hello there,
I have come to a very odd behaviour, where I was getting exceptions raised twice, the first one correctly handled at the custom exception handler, but for my surprise, the exception handler failed with yet ANOTHER exception breaking the complete exception handling chain.
After looking a bit, I found out that the reason is that I'm trying to log on the exception handler the actual logged in user (using request.user), but since the first exception initially raised during authentication (at request._authenticate) and was not handled by the except part because it was not an APIException (it was another unexpected DB error), the actual request.user was not set, so it would try to authenticate again when trying to access the request.user property at my custom exception handler, resulting on a new exception that wouldn't get handled by any means.
Is there any specific reason that request._authenticate only handles APIException? Could it be safely changed to be an except Exception instead? Do I really need to surround all my request.user access in a try catch everywhere just in case the property wasn't cached due to non APIException? In my opinion the exception catched should be Exception and not APIException.