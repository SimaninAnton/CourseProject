commonorgarden commented on 25 Sep 2013
An error seems to have been introduced by the pre-populated raw data feature in v2.3.8. It is exhibited in a ListCreateAPIView when its serializer includes a SerializerMethodField whose associated method performs an operation on an attribute of an object.
The problem arises when renderers.get_rendered_html_form tries to create an instance of the serializer with instance=None. The SerializerMethodField methods get called with this None and fail when they try to access atrributes of it.
This code demonstrates the problem:
from rest_framework import serializers, generics

# Serializer
class TestSerializer(serializers.Serializer):
    id = serializers.IntegerField()
    name = serializers.CharField()
    id_method_field = serializers.SerializerMethodField('do_something_with_obj_id')

    def do_something_with_obj_id(self, obj):
        return obj['id']


# View
class TestList(generics.ListCreateAPIView):
    serializer_class = TestSerializer

    def get_queryset(self):
        # list of dicts, not QuerySet, but you get the picture
        result = [{"id":1,"name":"one"},
                  {"id":2,"name":"two"},
                  {"id":3,"name":"three"}]
        return result
Is this an error or should I be testing for obj is None in all my SerializerMethodFields?