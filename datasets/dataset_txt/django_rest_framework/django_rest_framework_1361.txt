john2x commented on 23 Dec 2015
I have a ModelSerializer for a model that has a TaggableManager field named tags. In this ModelSerialzer, the tags field is not listed in the Meta.fields of the serializer class.
But when using the docs UI of django-rest-swagger, I'm getting:
Internal Server Error: /api-docs/api-docs/api/foo
Traceback (most recent call last):
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/django/core/handlers/base.py", line 149, in get_response
    response = self.process_exception_by_middleware(e, request)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/django/core/handlers/base.py", line 147, in get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/django/views/decorators/csrf.py", line 58, in wrapped_view
    return view_func(*args, **kwargs)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/django/views/generic/base.py", line 68, in view
    return self.dispatch(request, *args, **kwargs)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/views.py", line 466, in dispatch
    response = self.handle_exception(exc)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/views.py", line 463, in dispatch
    response = handler(request, *args, **kwargs)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework_swagger/views.py", line 152, in get
    'models': generator.get_models(apis),
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework_swagger/docgenerator.py", line 122, in get_models
    self._find_field_serializers(serializers)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework_swagger/docgenerator.py", line 260, in _find_field_serializers
    fields = serializer().get_fields()
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/serializers.py", line 918, in get_fields
    info = model_meta.get_field_info(model)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/utils/model_meta.py", line 69, in get_field_info
    reverse_relations = _get_reverse_relationships(opts)
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/utils/model_meta.py", line 144, in _get_reverse_relationships
    to_field=_get_to_field(relation.field),
  File "/var/www/myapp/venv/local/lib/python2.7/site-packages/rest_framework/utils/model_meta.py", line 95, in _get_to_field
    return field.to_fields[0] if field.to_fields else None
AttributeError: 'TaggableManager' object has no attribute 'to_fields'
[23/Dec/2015 10:44:52] "GET /api-docs/api-docs/api/foo HTTP/1.1" 500 124349
I tried changing the _get_to_field utility function to:
def _get_to_field(field):
    if not hasattr(field, 'to_fields'):
        return None
    return field.to_fields[0] if field.to_fields else None
and it works around the issue, but still need to verify if it doesn't break anything else.