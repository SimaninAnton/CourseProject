belen-mapplas commented on 5 Jun 2014
I'm having a problem while configuring database cache and throttling. The problem I'm having is that when I set the rate of my custom CustomUserRateThrottle, the timeout of the DatabaseCache is overwritten. The value that I have configured as rate, is set as database timeout.
Example:
    class CustomUserRateThrottle(UserRateThrottle):
        cache = get_cache('throttle-user')
        rate = "2/minute"
The 'minute' is set as the timeout of the DB, thus after a minute has passed the cache data is removed even though I have set a timeout as custom configuration.
'throttle-user': {
    'BACKEND': 'django.core.cache.backends.db.DatabaseCache',
    'LOCATION': 'cache_api_request_user',
    'TIMEOUT' : 0,
    'OPTIONS': {
        'MAX_ENTRIES': 10000000,
    },
},
I've tried to change database timeout config but to no avail.
I've checked the code and seen that at throttling.py at line 120,
   self.cache.set(self.key, self.history, self.duration)
so, no matter what I set as database configuration, it will always use the rate's time value.
I propose to check if there is any configuration set in django, and use it as expiration.
Would that be possible?
Thank you!!