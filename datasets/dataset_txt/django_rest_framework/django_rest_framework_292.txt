chpmrc commented on 31 Oct 2018
Description
DRF checks if the user is authenticated when applying custom permissions. This makes it impossible to write custom permissions based on other parameters that apply even with unauthenticated users.
Example
class IsCorrectSubdomain(permissions.BasePermission):
    message = "Can only access through the right subdomain."

    def has_permission(self, request, view):
        return request.get_host().startswith('mysubdomain.')


class ResourceViewSet(viewsets.ModelViewSet):
    queryset = Resource.objects.all()
    permission_classes = (IsCorrectSubdomain,)
Expected result:
HTTP 403 with message "Can only access through the right subdomain."
Actual result:
HTTP 401 with message "Authentication credentials were not provided."
Notes
Seems like the problem is here:
django-rest-framework/rest_framework/views.py
Line 175 in 40da2a2
 if request.authenticators and not request.successful_authenticator: 
1