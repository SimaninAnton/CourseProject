paweljasinski commented on 3 Jun 2016
Checklist
I have verified that that issue exists against the master branch of Django REST framework.
I have searched for similar issues in both open and closed tickets and cannot find a duplicate.
This is not a usage question. (Those should be directed to the discussion group instead.)
This cannot be dealt with as a third party library. (We prefer new functionality to be in the form of third party libraries where possible.)
I have reduced the issue to the simplest possible case.
I have included a failing test as a pull request. (If you are unable to do so we can still accept the issue.)
Steps to reproduce
setup a minimum raw file upload based on FileUploadParser
upload file using:
curl 'http://d2:8000/uploadapp/uploadfile?filename=2.jpg --upload-file 1.jpg
Expected behavior
request.data['file'].name should be 2.jpg
Actual behavior
request.data['file'].name is tmp[random].upload, actual value: tmpgxxugw2g.upload
Workaround
Use Content disposition header.
curl 'http://d2:8000/uploadapp/uploadfile --upload-file 1.jpg --header "Content-Disposition: attachment; filename=1.jpg"
gives the expected:
request.data['file'].name == 1.jpg
Investigated
get_filename in parsers.py, parser_context['kwargs'] appears empty
dirty fix, just to demonstrate the problem
diff rest_framework/parsers.py .hide/rest_framework/parsers.py
192c196
<             return parser_context['kwargs']['filename']

---
>             return parser_context['request'].query_params['filename']