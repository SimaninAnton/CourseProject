py2010 commented 18 days ago
django 2.2.*
rest_framework 3.9.1
multipart/form-data POST (have files upload)
DateTimeField "required": false,
from rest_framework import fields

def rewrite(cls, func='to_internal_value'):
    # 重写函数,使提交保存的日期时间字段为""时,不报格式错误
    old_func = getattr(cls, func)

    def new_func(self, value):
        # import ipdb; ipdb.set_trace()
        if value == '':
            # return self.get_default()  # 旧数据原值不变或新数据取默认值
            return None  # 表字段数据设置为null
        return old_func(self, value)
    setattr(cls, func, new_func)
    # print(cls, '已重写函数', func)

rewrite(fields.DateTimeField)
rewrite(fields.DateField)
rewrite(fields.TimeField)
#3726