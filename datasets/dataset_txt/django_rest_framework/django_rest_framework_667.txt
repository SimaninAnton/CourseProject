Contributor
jonsongoffwhite commented on 4 Sep 2017 â€¢
edited
Checklist
I have verified that that issue exists against the master branch of Django REST framework.
I have searched for similar issues in both open and closed tickets and cannot find a duplicate.
This is not a usage question. (Those should be directed to the discussion group instead.)
This cannot be dealt with as a third party library. (We prefer new functionality to be in the form of third party libraries where possible.)
I have reduced the issue to the simplest possible case.
I have included a failing test as a pull request. (If you are unable to do so we can still accept the issue.)
Steps to reproduce
Create a ModelSerializer including a field in Meta with a custom name (that isn't on the model).
Set the source of the field, in extra_kwargs to a named field within the model.
Initialise the Serializer.
Expected behavior
Creates a Serializer with a field with a custom field name, that has it's source as the specified field on the Model.
Actual behavior
TypeError: hasattr(): attribute name must be string
Caused by #5138 when accounting for *-sourced fields.
django-rest-framework/rest_framework/serializers.py
Line 1013 in 79be20a
 source = extra_field_kwargs.get('source', '*') != '*' or field_name 
In the case that source is specified AND is not '*',
extra_field_kwargs.get('source', '*') != '*' evaluates to True, and thus source = True,
leading to the TypeError
Pull Request with test that fails on master, and fix: #5388