mo-mughrabi commented on 31 Dec 2013
Am using the dispatch function in ModelViewSet to assign the primary key in case it was given as specific string, am using this approach on development server and its working fine.
When I tried to build test cases for it, it seems like the request is always seen as anonymous inside the dispatch
def dispatch(self, request, *args, **kwargs):
    if kwargs.get('pk') == u'current' and not request.user.is_anonymous():
        kwargs['pk'] = request.user.pk
    resp = super(UserViewSet, self).dispatch(request, *args, **kwargs)
    print request.user  #always prints AnonymousUser 
    return resp
The above code works when used with runserver or deployed on uWSGI but won't work when trying to build test cases for because request.user is always anonymous
In the test cases, I used
from rest_framework.test import APIClient
as the api_client,
Please advise if am missing something or its indeed a bug