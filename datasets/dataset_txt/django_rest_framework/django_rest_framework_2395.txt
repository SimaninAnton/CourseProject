Contributor
erikcw commented on 10 Sep 2014
I'm in the middle of upgrading from Django 1.6 with DRF 2.3 to Django 1.7 and DRF 2.4.
This test worked previously, but now seems to fail. The API for the User model is setup to use the username as the lookup_field.
Everything works fine until I reach a page in the results where the username is an email address. DRF then throws the following exception:
Traceback:
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/django/core/handlers/base.py" in get_response
  111.                     response = wrapped_callback(request, *callback_args, **callback_kwargs)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/viewsets.py" in view
  78.             return self.dispatch(request, *args, **kwargs)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/django/views/decorators/csrf.py" in wrapped_view
  57.         return view_func(*args, **kwargs)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/views.py" in dispatch
  401.             response = self.handle_exception(exc)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/views.py" in dispatch
  398.             response = handler(request, *args, **kwargs)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/mixins.py" in list
  98.         return Response(serializer.data)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/serializers.py" in data
  572.                 self._data = self.to_native(obj)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/serializers.py" in to_native
  351.             value = field.field_to_native(obj, field_name)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/serializers.py" in field_to_native
  410.             return [self.to_native(item) for item in value.all()]
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/serializers.py" in to_native
  351.             value = field.field_to_native(obj, field_name)
File "/Users/erik/.virtualenvs/proj/lib/python2.7/site-packages/rest_framework/relations.py" in field_to_native
  556.             raise Exception(msg % view_name)

Exception Type: Exception at /api/admin/v1/users/
Exception Value: Could not resolve URL for hyperlinked relationship using view name "user-detail". You may have failed to include the related model in your API, or incorrectly configured the `lookup_field` attribute on this field.
Took me a good amount of time to realize that it was related to @ in the email address and not a problem with my router config. If HyperlinkedModelSerializers choke on "special characters" -- thenI think it probably makes sense to escape them...