rakanalh commented on 14 Feb 2013
Hello,
I've encountered a problem which is as follows:
class NodesList(generics.ListAPIView):
"""
API endpoint that lists nodes
"""
model = Node
serializer_class = NodeSerializer
permission_classes = (permissions.AllowAny,)
def get_queryset(self):
    try:
        queryset = Node.objects.all()
        queryset = queryset.prefetch_related('images', 'objectmeta_set')
        return queryset

    except Exception as e:
        logging.exception("Error", e)
        return []
What happens here is that, say i have 1000 nodes. django evaluates the queryset, groups all node ids into a query to prefetch images and objectmeta records. The 1000 ID will be added to the IN query. I tried reading the page parameter from QUERY_PARAMS and paginating the nodes queryset with the code above but i realized that DRF repaginates the resultset before rendering which results in no data being rendered.
How can i limit the queryset without affecting paginating so that i can decrease the amount of prefetching that is needed to be done in my case to improve performance?
Thanks