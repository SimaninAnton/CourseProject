mark0978 commented on 8 Apr 2014
I only have one database, so something is failing to set the database on the ManyToManyField models. Django==1.6.2, djangorestframework==2.3.13
class EmployeeSkillType(models.Model):
    customer = models.ForeignKey(Customer)
    display = models.CharField(max_length=32)

    class Meta:
        unique_together = ('customer', 'display')
        ordering = ('display', )

class Employee(models.Model):
    skills = models.ManyToManyField(EmployeeSkillType)

class EmployeeSkillTypeSerializer(serializers.ModelSerializer):
    class Meta:
        model = EmployeeSkillType
        exclude = ('customer', )

class EmployeeFullSerializer(serializers.ModelSerializer):
    skills = EmployeeSkillTypeSerializer(source="skills", many=True, allow_add_remove=True, required=False)
File "---/local/lib/python2.7/site-packages/django/core/handlers/base.py", line 114, in get_response
response = wrapped_callback(request, _callback_args, *_callback_kwargs)
File "---/local/lib/python2.7/site-packages/rest_framework/viewsets.py", line 78, in view
return self.dispatch(request, _args, *_kwargs)
File "---/local/lib/python2.7/site-packages/django/views/decorators/csrf.py", line 57, in wrapped_view
return view_func(_args, *_kwargs)
File "---/local/lib/python2.7/site-packages/rest_framework/views.py", line 400, in dispatch
response = self.handle_exception(exc)
File "---/local/lib/python2.7/site-packages/rest_framework/views.py", line 397, in dispatch
response = handler(request, _args, *_kwargs)
File "--/apps/employees/views.py", line 79, in update
self.object = serializer.save(**save_kwargs)
File "--/apps/employees/serializers.py", line 176, in save
super(EmployeeFullSerializer, self).save(**kwargs)
File "---/local/lib/python2.7/site-packages/rest_framework/serializers.py", line 596, in save
self.save_object(self.object, *_kwargs)
File "---/local/lib/python2.7/site-packages/rest_framework/serializers.py", line 995, in save_object
setattr(obj, accessor_name, object_list)
File "---/local/lib/python2.7/site-packages/django/db/models/fields/related.py", line 840, in set
manager.add(_value)
File "---/local/lib/python2.7/site-packages/django/db/models/fields/related.py", line 581, in add
self._add_items(self.source_field_name, self.target_field_name, *objs)
File "---/local/lib/python2.7/site-packages/django/db/models/fields/related.py", line 640, in _add_items
(obj, self.instance._state.db, obj._state.db))
ValueError: Cannot add "<EmployeeSkillType: Animal Training>": instance is on database "default", value is on database "None"