youshutong2080 commented on 10 Jan 2019
Checklist
I have verified that that issue exists against the master branch of Django REST framework.
I have searched for similar issues in both open and closed tickets and cannot find a duplicate.
This is not a usage question. (Those should be directed to the discussion group instead.)
This cannot be dealt with as a third party library. (We prefer new functionality to be in the form of third party libraries where possible.)
I have reduced the issue to the simplest possible case.
I have included a failing test as a pull request. (If you are unable to do so we can still accept the issue.)
Steps to reproduce
code below:
#url.py
router = DefaultRouter()
router.register('app-combine', CombineViewSet, base_name='app-combine')

urlpatterns = [
    url(r'combine/(?P<short_name>\w+)/$', CombineAPIView.as_view()),
]

urlpatterns  += router.urls


#views.py
class CombineViewSet(ViewSet):
    permission_classes = [IsAuthenticated]
    authentication_classes = [JSONWebTokenAuthentication]

    def list(self, request):
        queryset = Combine.objects.filter(creator=request.user.id)
        serializer = CombineSerializer(queryset, many=True, context={'request': request})
        return Response({'code': 0, 'data': serializer.data, 'msg': None}, status=status.HTTP_200_OK)

    @action(methods=['post'], detail=False, url_path='test')
    def test(self, request):
        print('helo')
        return Response({'code': 0})

class CombineAPIView(APIView):
    permission_classes = [IsAuthenticated]
    authentication_classes = [JSONWebTokenAuthentication]

    def get(self, request, short_name):
        queryset = Combine.objects.get(uri__exact=short_name)
        serializer = CombineSerializer(queryset, context={'request': request})
        return Response({'code': 0, 'data': serializer.data, 'msg': None}, status=status.HTTP_200_OK)
Expected behavior
request app-combine/test/ route toCombineViewSet
Actual behavior
request app-combine/test/ route toCombineAPIView