Contributor
thedrow commented on 13 Oct 2014
The following code:
class UserSerializationTestCase(SimpleTestCase):
    def test_that_when_serializing_a_user_with_a_modified_password_but_without_the_old_password_then_the_serializer_is_not_valid(self):
        user = UserFactory.build()

        request = APIRequestFactory().get('/users/%s' % user.slug)

        sut = UserSerializer(instance=user, data={'password': '1234'}, context={'request': request}, partial=True)

        self.assertFalse(sut.is_valid())
Produces this traceback:
======================================================================
ERROR: test_that_when_serializing_a_user_with_a_modified_password_but_without_the_old_password_then_the_serializer_is_not_valid (users.tests.unit.test_user_serializer.UserSerializationTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/omer/Documents/Projects/startup/users/tests/unit/test_user_serializer.py", line 29, in test_that_when_serializing_a_user_with_a_modified_password_but_without_the_old_password_then_the_serializer_is_not_valid
    sut.is_valid()
  File "/home/omer/.virtualenvs/startup/lib/python3.4/site-packages/rest_framework/serializers.py", line 103, in is_valid
    self._validated_data = self.run_validation(self._initial_data)
  File "/home/omer/.virtualenvs/startup/lib/python3.4/site-packages/rest_framework/serializers.py", line 328, in run_validation
    self.run_validators(value)
  File "/home/omer/.virtualenvs/startup/lib/python3.4/site-packages/rest_framework/fields.py", line 275, in run_validators
    validator(value)
  File "/home/omer/.virtualenvs/startup/lib/python3.4/site-packages/rest_framework/validators.py", line 71, in __call__
    (field_name, value[field_name]) for field_name in self.fields
  File "/home/omer/.virtualenvs/startup/lib/python3.4/site-packages/rest_framework/validators.py", line 71, in <listcomp>
    (field_name, value[field_name]) for field_name in self.fields
KeyError: 'slug'