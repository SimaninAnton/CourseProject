diamondap commented on 9 Jan 2013
I'm using django-rest-framework version 2.1.15. If I have a serializer with this field:
user = serializers.HyperlinkedIdentityField(view_name='user-detail')
And this in my urls.py:
url(r'^user/(?P<id>\d+)?/$', views.UserDetail.as_view(), name='user-detail')
Note that I'm calling the id captured from the URL id and not pk.
Then I get this error when my serializer tries to create the user-detail URL:
Traceback (most recent call last):
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/django/core/handlers/base.py", line 111, in get_response
    response = callback(request, *callback_args, **callback_kwargs)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/django/views/generic/base.py", line 48, in view
    return self.dispatch(request, *args, **kwargs)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/django/views/decorators/csrf.py", line 77, in wrapped_view
    return view_func(*args, **kwargs)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/views.py", line 363, in dispatch
    response = self.handle_exception(exc)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/views.py", line 360, in dispatch
    response = handler(request, *args, **kwargs)
  File "/home/diamond/emergensee-server/emergensee/api/decorators.py", line 20, in _checklogin
    return view_func(view_obj, request, *args, **kwargs)
  File "/home/diamond/emergensee-server/emergensee/api/views.py", line 87, in get
    return Response(serializer.data)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/serializers.py", line 333, in data
    self._data = self.to_native(self.object)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/serializers.py", line 270, in to_native
    return [self.convert_object(item) for item in obj]
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/serializers.py", line 200, in convert_object
    value = field.field_to_native(obj, field_name)
  File "/home/diamond/.virtualenv/emc/lib/python2.7/site-packages/rest_framework/relations.py", line 446, in field_to_native
    raise ValidationError('Could not resolve URL for field using view name "%s"' % view_name)
ValidationError: [u'Could not resolve URL for field using view name "user-detail"']
However, if I change my urls.py so to use pk instead of id, everything works as expected. That is, this works correctly in urls.py:
url(r'^user/(?P<pk>\d+)?/$', views.UserDetail.as_view(), name='user-detail')
You might want to document this, particularly for people inclined to follow the django docs convention of using id. Otherwise, the error is very confusing.