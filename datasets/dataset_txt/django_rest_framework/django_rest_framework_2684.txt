commonorgarden commented on 31 Oct 2013
I am trying to compress PUT requests to a DRF web service but it's not working. What appears to be happening is that the request content is being uncompressed properly by mod_deflate, but then the data is being truncated as CONTENT_LENGTH is still set to the length of the compressed content.
My Apache config:
SetInputFilter DEFLATE
AddInputFilter DEFLATE application/json
Apache log reports that the content is inflated properly:
mod_deflate.c(915): Zlib: Inflated 1345 to 22300 : URL /api/1.0/whatever/
The content length from the HTTP header, as seen in my view is still set to the compressed size:
'CONTENT_LENGTH': 1362
And Django REST framework raises the following error, presumably when it's attempting to parse the content:
{"detail": "JSON parse error - Expecting object: line 68 column 31 (char 1363)"}
The documentation for mod_deflate includes this warning:
Note on Content-Length
If you evaluate the request body yourself, don't trust the Content-Length header! The Content-Length header reflects the length of the incoming data from the client and not the byte count of the decompressed data stream.
I am not sure whether this a DRF problem or a mod_wsgi problem.