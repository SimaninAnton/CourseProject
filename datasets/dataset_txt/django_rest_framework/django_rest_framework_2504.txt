chibisov commented on 15 Jun 2014
Hi, i have failed tests in 2.3.14 version.
Here https://github.com/tomchristie/django-rest-framework/blob/2.3.14/rest_framework/serializers.py#L917 you've added hasattr(instance, field_name)
It works nice with python2, but fails with python3. For example here is the model:
class CommentModel(models.Model):
    users_liked = models.ManyToManyField(UserModel, blank=True, null=True)
    text = models.CharField(max_length=200)
Python 2:
hasattr(CommentModel(text='hello'), 'users_liked')  # => False
Python 3:
hasattr(CommentModel(text='hello'), 'users_liked')

Traceback (most recent call last):
  File "tests.py", line 33, in test_should_use_default_saving_without_partial
    hasattr(CommentModel(text='hello'), 'users_liked')
  File ".tox/django1.6.2/lib/python3.4/site-packages/django/db/models/fields/related.py", line 825, in __get__
    through=self.field.rel.through,
  File ".tox/django1.6.2/lib/python3.4/site-packages/django/db/models/fields/related.py", line 522, in __init__
    (instance, source_field_name))
ValueError: "<CommentModel: CommentModel object>" needs to have a value for field "commentmodel" before this many-to-many relationship can be used.
As i understand, it's django problem (i've tested with django>=1.5). But maybe it's a good idea to switch from hasattr to something like field_name in dir(instance)
1