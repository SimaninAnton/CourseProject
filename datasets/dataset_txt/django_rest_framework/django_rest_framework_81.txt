Contributor
knivets commented on 22 Aug 2019
When I try to set allowed_methods to a lower case HTTP verb, it results in:
not including a request body
breaking schema for an operation completely if I set it to operation, or arbitrary value
Checklist
I have verified that that issue exists against the master branch of Django REST framework.
I have searched for similar issues in both open and closed tickets and cannot find a duplicate.
This is not a usage question. (Those should be directed to the discussion group instead.)
This cannot be dealt with as a third party library. (We prefer new functionality to be in the form of third party libraries where possible.)
I have reduced the issue to the simplest possible case.
I have included a failing test as a pull request. (If you are unable to do so we can still accept the issue.)
Steps to reproduce
class Book(models.Model):  
    title = models.CharField(max_length=200)

class BookSerializer(serializers.ModelSerializer):
    class Meta:
        model = Book
        fields = ['__all__']

class BookDetail(generics.UpdateAPIView):
    queryset = Book.objects.all()   
    serializer_class = BookSerializer
    allowed_methods = ['put'] # results in request body not being included
    # allowed_methods = ['test'] # results in a single operation with the `test` verb (shouldn't generate anything)
Expected behavior
./manage.py generateschema 
openapi: 3.0.2
info:
  title: ''
  version: TODO
paths:
  /api/books/{id}/:
    put:
      operationId: UpdateBook
      parameters:
      - name: id
        in: path
        required: true
        description: A unique integer value identifying this book.
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              required:
              - title
              properties:
                title:
                  type: string
                  maxLength: 200
      responses:
        '200':
          content:
            application/json:
              schema:
                required:
                - title
                properties:
                  title:
                    type: string
                    maxLength: 200
Actual behavior
./manage.py generateschema 
openapi: 3.0.2
info:
  title: ''
  version: TODO
paths:
  /api/books/{id}/:
    put:
      operationId: UpdateBook
      parameters:
      - name: id
        in: path
        required: true
        description: A unique integer value identifying this book.
        schema:
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                required:
                - title
                properties:
                  title:
                    type: string
                    maxLength: 200
here's another case with allowed_methods = ['test']
./manage.py generateschema 
openapi: 3.0.2
info:
  title: ''
  version: TODO
paths:
  /api/books/{id}/:
    test:
      operationId: testBook
      parameters:
      - name: id
        in: path
        required: true
        description: A unique integer value identifying this book.
        schema:
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                required:
                - title
                properties:
                  title:
                    type: string
                    maxLength: 200