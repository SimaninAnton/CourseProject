Contributor
cancan101 commented on 21 Oct 2014
If you POST a new object from the HTML Browesable API, it appears that the data is de-serialized twice:
Here are the two stack traces. First time:
  File "/usr/local/lib/python2.7/site-packages/django/core/handlers/wsgi.py", line 206, in __call__
    response = self.get_response(request)
  File "/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py", line 112, in get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File "/usr/local/lib/python2.7/site-packages/rest_framework/viewsets.py", line 78, in view
    return self.dispatch(request, *args, **kwargs)
  File "/usr/local/lib/python2.7/site-packages/django/views/decorators/csrf.py", line 57, in wrapped_view
    return view_func(*args, **kwargs)
  File "/usr/local/lib/python2.7/site-packages/rest_framework/views.py", line 397, in dispatch
    response = handler(request, *args, **kwargs)
  File "/usr/local/lib/python2.7/site-packages/rest_framework/mixins.py", line 52, in create
    if serializer.is_valid():
and second:
  File "/usr/local/lib/python2.7/site-packages/django/core/handlers/wsgi.py", line 206, in __call__
    response = self.get_response(request)
  File "/usr/local/lib/python2.7/site-packages/django/core/handlers/base.py", line 137, in get_response
    response = response.render()
  File "/usr/local/lib/python2.7/site-packages/django/template/response.py", line 105, in render
    self.content = self.rendered_content
  File "/usr/local/lib/python2.7/site-packages/rest_framework/response.py", line 59, in rendered_content
    ret = renderer.render(self.data, media_type, context)
  File "/usr/local/lib/python2.7/site-packages/rest_framework/renderers.py", line 601, in render
    context = self.get_context(data, accepted_media_type, renderer_context)
  File "/usr/local/lib/python2.7/site-packages/rest_framework/renderers.py", line 578, in get_context
    'post_form': self.get_rendered_html_form(view, 'POST', request),
  File "/usr/local/lib/python2.7/site-packages/rest_framework/renderers.py", line 457, in get_rendered_html_form
    serializer.is_valid()
The second de-serialization is caused by: https://github.com/tomchristie/django-rest-framework/blob/6ffc97c808f8026c063011e2d048604f3a6b70fa/rest_framework/renderers.py#L461
where the obj is passed to the Serializer along with the data and files. In this case that in not an empty object but actually has fields already set from the first de-serialization.
This means that I actually get two calls to the various from_native, etc with the same data which is different from a regular POST.