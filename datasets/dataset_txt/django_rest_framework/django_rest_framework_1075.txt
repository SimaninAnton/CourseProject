mbande commented on 28 Aug 2016 â€¢
edited
I'm prefetching some related filed based on some value in query params:
def get_queryset(self):
    queryset = self.queryset
    foo = self.request.query_params.get('foo', None)
    if foo:
        queryset = queryset.prefetch_related(Prefetch('resources', queryset=Resource.objects.filter(bar=foo)))
    else:
        queryset = queryset.prefetch_related('resources')
    return queryset
also i defined a FilterSet for other query params that uses prefetched relation(i.e. resources),
as DRF docs says:
Note that you can use both an overridden .get_queryset() and generic filtering together, and everything will work as expected., i expect the FilterSet to use filtered relation if foo exists, But it uses it's own Model queryset (i.e. all()), ignoring whatever queryset it is operating on