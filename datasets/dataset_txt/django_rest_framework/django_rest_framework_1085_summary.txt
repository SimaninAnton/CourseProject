Inconsistent behavior when authenticating users