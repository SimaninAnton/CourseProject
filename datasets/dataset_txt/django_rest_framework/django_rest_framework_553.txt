ahmadhaidarahmad commented on 8 Dec 2017 â€¢
edited by carltongibson
If I didn't add a token to the header in django restframework Token authentication it works normally and doesn't do any authentication and the response of the view is always 200 not 401 or 403
Also if I put a token in the header I got anonymous user and request.user is anonymous user
here you can see an example of what i'm talking about
#####view.py####
@api_view(['Post'])
@permission_classes((IsAuthenticated,))
def listofgroups(request):
    try:
        logout(request)
        data = request.data
        page_size = data.get('pagesize')
        page_number = data.get('pagenumber')
        group_qs = Group.objects.all()
        paginator = Paginator(group_qs, int(page_size))
        group_list = paginator.page(int(page_number))
        #group_list = tools.paginate_query_set(group_qs, 1, 3)
        #list  = group_list[0]['model']
        groups = [get_group_dto(g) for g in group_list]
        sorted_groups = sorted(groups, key=lambda k: k['user_count'], reverse = True)
        group_list_dto = {
        "grps": sorted_groups, 
        "success":1,
        "fail":0
        }
        return Response(group_list_dto)
    except Exception as e:
        #.error("Error %s"(e), exc_info = 1) 
        return Response({"success" : 0, "error": str(e)})
The token got from database of the user and set in header
"Authorization":"Token a26171d30745cc94bcd6ac42d9bc94e1d3992948"
this token is based on rest_framework.authtoken
my middleware classes:
MIDDLEWARE_CLASSES = [

    'django.contrib.sessions.middleware.SessionMiddleware',
    #'middleware.FirstTokenAuth.AuthenticationMiddlewareJWT',
    #'middleware.TokenAuthTest.JWTAuthenticationMiddleware',  
    'django.contrib.auth.middleware.AuthenticationMiddlewareJWT', 
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.middleware.security.SecurityMiddleware',
    #'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    #'django.middleware.csrf.CsrfViewMiddleware',
   
    #'django.contrib.auth.middleware.SessionAuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    
]

REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
        #'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.TokenAuthentication',
        #'rest_framework.authentication.BasicAuthentication',
        #'rest_framework.authentication.SessionAuthentication'
    
    )
}

AUTHENTICATION_BACKENDS = (
    # Use Django's session framework for authentication.
    #'rest_framework.authentication.SessionAuthentication,'
  
    'rest_framework.authentication.TokenAuthentication',
)

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'Abwab_local',
    #'utils',
    'schedule',
    "fcm_django",
]
Always getting anonymous user how can i prevent anonymous users from calling any api by returning 403 response and allow only database users
Please help me in this im stuck in it