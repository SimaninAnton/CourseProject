Contributor
maryokhin commented on 24 Feb 2015
I'm not even sure if I'm doing something legal:
owner = serializers.HiddenField(source='user',
        default=serializers.CreateOnlyDefault(
            serializers.CurrentUserDefault()
        )
    )
Which is supposed to be a write-only hidden field that gets populated only during writes, and skipped during updates (I don't allow changing FKs once an object is created).
Result is:
Request Method: POST
Request URL: http://127.0.0.1:8000/posts/1/ratings/

Traceback:
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/django/core/handlers/base.py" in get_response
  111.                     response = wrapped_callback(request, *callback_args, **callback_kwargs)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/django/views/decorators/csrf.py" in wrapped_view
  57.         return view_func(*args, **kwargs)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/viewsets.py" in view
  85.             return self.dispatch(request, *args, **kwargs)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/views.py" in dispatch
  407.             response = self.handle_exception(exc)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/views.py" in dispatch
  404.             response = handler(request, *args, **kwargs)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/mixins.py" in create
  20.         serializer.is_valid(raise_exception=True)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/serializers.py" in is_valid
  186.                 self._validated_data = self.run_validation(self.initial_data)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/serializers.py" in run_validation
  364.         value = self.to_internal_value(data)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/serializers.py" in to_internal_value
  397.                 validated_value = field.run_validation(primitive_value)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/fields.py" in run_validation
  364.         (is_empty_value, data) = self.validate_empty_values(data)
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/fields.py" in validate_empty_values
  345.             return (True, self.get_default())
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/fields.py" in get_default
  323.             return self.default()
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/fields.py" in __call__
  115.             return self.default()
File "/Users/maryokhin/.virtualenvs/backend/lib/python3.4/site-packages/rest_framework/fields.py" in __call__
  129.         return self.user

Exception Type: AttributeError at /posts/1/ratings/
Exception Value: 'CurrentUserDefault' object has no attribute 'user'