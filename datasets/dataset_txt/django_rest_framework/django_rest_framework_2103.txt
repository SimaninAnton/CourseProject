avoidwork commented on 5 Jan 2015
Hi,
I'm working on an API which was added to an existing django app, which utilizes a few auth strategies, including 'session', which is last in the list. If I authenticate against the web app, I receive a 'sessionid' cookie, and then if I use that cookie to make an API request, I'll end up in DRF authentication.py at line ~129 for 3.0, which is reason = CSRFCheck().process_view(request, None, (), {}).
The None is the bug. Without a resolver, the token check will not know if the view is @csrf_exempt, and my valid request results in a 403, with a body of CSRF Failed: CSRF cookie not set.. Passing an invalid token results in the expected 'invalid token' error, if the view wasn't exempt ;)
Changing the None to utilize a resolver should be sufficient to pass the check.