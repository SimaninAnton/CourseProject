newsham commented on Sep 17, 2014
When using the requests library through a web proxy, requests includes a full URL in the request line instead of just the path for all https requests. Http requests send just the path, as expected. Https requests send the full URL in place of the path. This can cause problems with certain proxies (for example, the BURP proxy (http://portswigger.net/burp/download.html) will not properly process these requests unless the special "transparent" proxy mode is enabled).
The following script demonstrates his problem:
#!/usr/bin/env python
"""
Requests library will send full URL as the request path
when sending HTTPS requests to a proxy.. WHY?

Run this script through a proxy listening on the local host,
such as BURP, which records all traffic.  Look at the proxy
logs to see the request lines.  Notice that this will send
a full URL in the request line.
"""

import requests

proxies = { 
   'http': 'http://127.0.0.1:8080/',
   'https': 'https://127.0.0.1:8080/' 
}

# sends full URL in the request line:
r = requests.get("https://www.yahoo.com/the/path/goes/here", proxies=proxies, allow_redirects=False)

# sends full just the path in the request line:
r = requests.get("http://www.yahoo.com/the/path/goes/here", proxies=proxies, allow_redirects=False)