ghost commented on Feb 25, 2017 â€¢
edited by ghost
Dear everyone!
i am facing strange beahvior with python requests.
here is my snippet:
    for x in range(0,len(url)):
    retrys = 0

    while retrys < 10 :
        try:
            res = requests.get(
                url[x],
                timeout=(5, 60),
                proxies=dict(   http='socks5://localhost:' + str(s_port),
                                https='socks5://localhost:' + str(s_port)
                            )
            )

        except requests.exceptions.RequestException as err:

            print( str(res.status_code) )
            print( str(len(res.content)) )

            retrys += 1
            time.sleep(1)

            if retrys % 5 == 0 :
                print( str( threading.currentThread() ) + " - Querry failed? -> Need to reconnect TOR")
                import pdb; pdb.set_trace()

                print( str( threading.currentThread() ) )

        else:
            if isinstance(res.content, bytes) == True:

                output.append( res.content )

                break
            else:
                import pdb; pdb.set_trace()
it is giving my the right output look:
We are fetching now :  178  urls in :  26 Blobs
200
26943
200
26943
200
26943
200
26943
200
26943
So statuscode is all the time 200 OK and the len is okay. When i drop to my debug console i can catch the content from result, parse json, as ecxpected. But my requsts is still ecxepting my function. err is telling me inside ecxeption that connection has been refused.
(Caused by NewConnectionError(': Failed to establish a new connection: [Errno 111] Connection refused',))",),)
Any thoughts?
EDIT: it is a tor proxy.