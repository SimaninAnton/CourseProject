uvwild commented on Nov 26, 2018
Summary.
Calling this code is not working in python 3.6 on ubuntu.
There is a change adding .encode('ascii')
to the _null constant which causes the type error.
Removing the encoding call fixes the problem!
I am confused!
Expected Result
no exception
Actual Result
TypeError: must be str, not bytes
Reproduction Steps
import requests
jsonstr="{ 'bla' : 'blub'}"
resp = requests.Response()
resp._content = jsonstr
resp.json()

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/lib/python3/dist-packages/requests/models.py", line 880, in json
    encoding = guess_json_utf(self.content)
  File "/usr/lib/python3/dist-packages/requests/utils.py", line 798, in guess_json_utf
    nullcount = sample.count(_null)
TypeError: must be str, not bytes
System Information
$ python3 -m requests.help
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.7"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.7"
  },
  "platform": {
    "release": "4.15.0-39-lowlatency",
    "system": "Linux"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": "1010007f"
  },
  "urllib3": {
    "version": "1.21.1"
  },
  "using_pyopenssl": false
}
This command is only available on Requests v2.16.4 and greater. Otherwise,
please provide some basic information about your system (Python version,
operating system, &c).
ubuntu 18.04 (ubuntustudio)