glebourgeois commented on Oct 17, 2013
Example webpage : http://www.patisserielidy.com/
HTTP headers :
HTTP/1.1 200 OK
Server: Apache
X-Powered-By: PHP/5.3.26
X-Pingback: http://www.patisserielidy.com/xmlrpc.php
Transfer-Encoding: chunked
Content-Type: text/html; charset=UTF-7
Declared encoding :
<meta http-equiv="Content-Type" content="text/html; charset=UTF-7" />
Detected encoding by Chromium :
ISO-8859-1
Exception thrown on requests/models.py:664 when trying to get content of the request result, with the attribute text.
Stack :
File "/home/glebourg/dev/companies/pycompanycrawler/virtualenv/lib/python3.3/site-packages/requests/models.py", line 664, in text
    content = str(self.content, encoding, errors='replace')
  File "/home/glebourg/local/datapublica/lib/python3.3/encodings/utf_7.py", line 12, in decode
    return codecs.utf_7_decode(input, errors, True)
SystemError: invalid maximum character passed to PyUnicode_New
It seems the trial of conversion from UTF-7 to UTF-8 causes an unexpected error (SystemError, while only LookupError, TypeError are planned to happen there).
I have also filled a report on Python bugs tracker : http://bugs.python.org/msg200117