Contributor
schlamar commented on Mar 19, 2013
A zlib.Decompress object consumes at least one byte without raising an error and without returning any output:
>>> zlib_mode = 16 + zlib.MAX_WBITS
>>> any(zlib.decompressobj(zlib_mode).decompress(chr(i)) for i in xrange(256))
False
So if there is an zlib.error in stream_decompress, there will be at least one byte missing in the output string.
Additionally, there are two variations of the deflate compression in urllib3, while requests is only handling one of them: https://github.com/shazow/urllib3/blob/master/urllib3/response.py#L25