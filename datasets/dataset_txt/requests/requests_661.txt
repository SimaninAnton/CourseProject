jacquerie commented on May 17, 2017
Hi,
I'm not sure if this is a bug in requests or a misconfiguration in the server I'm interacting with, but I have the following very puzzling result:
>>> from requests import get
>>> response = get('http://edok01.tib.uni-hannover.de/edoks/e01dh15/815761511.pdf', stream=True)
>>> next(response.iter_content(4))
'%PD'
which returns 3 characters instead of the 4 that I requested, but also:
>>> from requests import get
>>> response = get('http://edok01.tib.uni-hannover.de/edoks/e01dh15/815761511.pdf', stream=True)
>>> iter = response.iter_content(1)
>>> next(iter)
'%'
>>> next(iter)
'P'
>>> next(iter)
'D'
>>> next(iter)
'F'
which instead returns all the 4 characters. Note also that this happens with both unicode_decode=True or unicode_decode=False.
How is this possible? This is happening with requests==2.14.2. The description of the problem in #3980 (comment) looks relevant, but its fix in #3984 looks less relevant. In fact, I still see the problem on a local checkout of master.