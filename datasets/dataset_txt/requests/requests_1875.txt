adamsc commented on Dec 19, 2013
I have been getting a requests.packages.urllib3.exceptions.DecodeError exception raised. From my understanding of the documentation, shouldn't this be translated to a Requests exception which inherits from requests.exceptions.RequestException?
This occurred using Requests 2.1.0 when making a GET request through a misconfigured HTTP proxy.
Here is the stack trace:
Traceback (most recent call last):
  File "proxy-manager.py", line 94, in <module>
    good, comment = is_good(proxy, base_headers, base_latency * 10)
  File "proxy-manager.py", line 42, in is_good
    headers = get_header_data(proxy)
  File "proxy-manager.py", line 14, in get_header_data
    r = requests.get('http://proxyjudge.us/azenv.php', proxies=proxies, timeout=timeout)
  File "/usr/local/lib/python2.7/dist-packages/requests/api.py", line 55, in get
    return request('get', url, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/api.py", line 44, in request
    return session.request(method=method, url=url, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/sessions.py", line 382, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/sessions.py", line 485, in send
    r = adapter.send(request, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/adapters.py", line 388, in send
    r.content
  File "/usr/local/lib/python2.7/dist-packages/requests/models.py", line 676, in content
    self._content = bytes().join(self.iter_content(CONTENT_CHUNK_SIZE)) or bytes()
  File "/usr/local/lib/python2.7/dist-packages/requests/models.py", line 615, in generate
    decode_content=True):
  File "/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/response.py", line 236, in stream
    data = self.read(amt=amt, decode_content=decode_content)
  File "/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/response.py", line 204, in read
    e)
requests.packages.urllib3.exceptions.DecodeError: ('Received response with content-encoding: gzip, but failed to decode it.', error('Error -3 while decompressing: incorrect header check',))