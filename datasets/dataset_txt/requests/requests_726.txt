JeffXue commented on Mar 27, 2017 â€¢
edited
send a request with allow_redirect=true and set the Host, but auto redirect the 302 response will use the wrong Host in Headers
s = requests.session()
url = 'https://sso.jeffxue.com/login'
headers.update({'Host', 'sso.jeffxue.com'})
datas = {'username': 'xxxx', 'password': 'xxxxx', service: 'web'}
cookies = {'xxxx': 'xxxxx'}
r = s.post(url, data=datas, headers=headers, cookies=cookies, allow_redirects=True, timeout=10)
but after checking the history, found it use the wrong Host like:
first request use the right host, because i set the Host in headers
history request url: https://sso.jeffxue.com/login
history request headers: {'Content-Length': '52', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'keep-alive', 'Accept': '*/*', 'User-Agent': 'python-requests/2.9.1', 'Host': u'sso.jeffxue.com', 'Cookie': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'Content-Type': 'application/x-www-form-urlencoded'}
history response status_code: 302
history response headers: {'Content-Length': '0', 'Set-Cookie': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'Business-Status': '200', 'Expires': 'Wed, 31 Dec 1969 23:59:59 GMT', 'Connection': 'keep-alive', 'Location':
'https://corp.jeffxue.com/index?ticket=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&client=web', 'Pragma': 'no-cache', 'Cache-Control': 'no-store', 'Date': 'Mon, 27 Mar 2017 07:58:02 GMT'}
first 302 request will redirect to the diff host(corp.jeffxue.com), but it will use the sso.jeffxue.com in headers
history request url: https://corp.jeffxue.com/index?ticket=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&client=web
history request headers: {'Accept-Encoding': 'gzip, deflate', 'Host': u'sso.jeffxue.com', 'Accept': '*/*', 'User-Agent': 'python-requests/2.9.1', 'Connection': 'keep-alive', 'Cookie': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'Content-Type': 'application/x-www-form-urlencoded'}
history response status_code: 302
history response headers: {'Content-Length': '0', 'Set-Cookie': 'xxxxxxxxxxxxxxxxxxxxxxxxx', 'Business-Status': '200', 'Connection': 'keep-alive', 'Location': 'http://sso.jeffxue.com/index?fileTicket=xxxxxxxxxxxxxxxxxxxxxxxx&client=web', 'Date': 'Mon, 27 Mar 2017 07:58:02 GMT'}