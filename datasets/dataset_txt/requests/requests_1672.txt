mmessmore commented on Aug 16, 2014
I noticed it when trying to add proxy support to python-foreman, but have reduced it down to just being an issue with requests. The cert on my destination is self-signed, but verify is set to false.
The following code reproduces the problem. When I observe the traffic I see it make a request out to the proxy server, then it follows up by trying to make a request directly to the server without using the proxy and times out because it can't get there.
I'm not seeing other people complain about this issue, and wonder if I'm just missing something.
#!/usr/bin/env python
import requests
s = requests.Session()
s.proxies = {
        'http': 'proxy.example.com:3128',
        'https': 'proxy.example.com:3128'
    }
s.get('https://uri.that.redirects.example.com', verify=False)
I've tried setting the environment variables HTTP_PROXY and HTTPS_PROXY, and setting explicitly on my session object, or passing it to each Session.get() request as part of the **kwargs (like verify). I've tried with http:// URI's and with just host:port for the proxy values in both the internal dict and the env variables, as the documentation seems to suggest both in different places.
I can provide more specific details or a packet dump if necessary.