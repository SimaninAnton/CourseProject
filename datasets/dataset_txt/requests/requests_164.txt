jgrobbel commented on Oct 29, 2018
Summary.
Expected Result
What you expected. (as seen with downgrading to 2.19.1)
Successfully installed requests-2.19.1 urllib3-1.23
(pytest-env) ./test_send_request.py
-> assert result.headers.get('x-content-type-options') == 'nosniff', \
(Pdb) result.headers
{'Server': 'nginx', 'Date': 'Sat, 27 Oct 2018 08:22:52 GMT', 'Content-Type': 'application/json', 'Content-Length': '675', 'Connection': 'keep-alive', 'Set-Cookie': 'redacted; HttpOnly; Path=/', 'Strict-Transport-Security': 'max-age=63072000; includeSubDomains; preload', 'X-Content-Type-Options': 'nosniff', 'X-Frame-Options': 'DENY', 'X-XSS-Protection': '1; mode=block', 'Referrer-Policy': 'same-origin'}
Actual Result (2.20.0)
-> assert result.headers.get('x-content-type-options') == 'nosniff', \
(Pdb) result.headers.get('x-content-type-options') <--- no header returned
(Pdb) result.headers
{'Date': 'Sat, 27 Oct 2018 08:04:06 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'Vary': 'Accept-Encoding', Max-Age=864000000; Path=/usernamepassword/login; HttpOnly; Secure', 'X-Robots-Tag': 'noindex, nofollow, noindex, nofollow, nosnippet, noarchive', 'Cache-Control': 'private, no-store, no-cache, must-revalidate, post-check=0, pre-check=0', 'Strict-Transport-Security': 'max-age=15724800', 'Content-Encoding': 'gzip'}
What happened instead.
Reproduction Steps
import requests
System Information
$ python3 -m requests.help
python3 -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.7"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.5"
  },
  "platform": {
    "release": "17.7.0",
    "system": "Darwin"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.20.0"
  },
  "system_ssl": {
    "version": "100020ff"
  },
  "urllib3": {
    "version": "1.23"
  },
  "using_pyopenssl": false
}