Member
Lukasa commented on Sep 27, 2013
Cookies set as part of a call to Session.request() (or any of the top level methods that call it) are not persisted, including on redirects.
Expected behaviour:
>>> s = requests.Session()
>>> r = s.get('http://httpbin.org/redirect/1', cookies={'Hi': 'There'})
>>> print r.request.headers['Cookie']
'hi=there'
Actual behaviour:
>>> s = requests.Session()
>>> r = s.get('http://httpbin.org/redirect/1', cookies={'Hi': 'There'})
>>> print r.request.headers['Cookie']
KeyError: 'cookie'
And, a super extra bonus bug:
>>> r.history[0].request.headers['Cookie']
KeyError: 'cookie'
even though we definitely sent the cookie on the first request.