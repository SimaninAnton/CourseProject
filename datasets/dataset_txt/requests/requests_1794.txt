cboscolo commented on Mar 15, 2014
When using requests lib on Google App Engine, requests to sites over HTTPS on 443 were actually going out as HTTP on port 80. The problem appears to be an incompatibility with the version of httplib on GAE. I am new to GAE (and python for that matter), so I am not clear as to which lib is responsible for fixing it. To see the problem just do this in the GAE console:
import requests

s = requests.Session()
r = s.get("https://www.somewebsite.com/")
The request will go out over http instead of https. I was able to work around the issue with this patch:
--- a/requests/packages/urllib3/connection.py
+++ b/requests/packages/urllib3/connection.py
@@ -99,6 +99,10 @@ class HTTPSConnection(HTTPConnection):
         HTTPConnection.__init__(self, host, port, strict, timeout, source_address)
     except TypeError: # Python 2.6
         HTTPConnection.__init__(self, host, port, strict, timeout)
+
+       # This fixes an issue on Google App Engine 1.9.0 causing https requests to go out as http
+       self._protocol = "https"
+
     self.key_file = key_file
     self.cert_file = cert_file