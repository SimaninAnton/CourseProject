Contributor
michaelhelmick commented on Oct 17, 2012
Alright,
So, in 0.14.1, I've ran into the problem with using OAuth and posting a file and data (specifically with Twitter, updating a status with media (passing the media file and parameter status) or updating background image (passing image file and parameter tile).
auth = OAuth1(self.app_key, self.app_secret,
                               self.oauth_token, self.oauth_token_secret,
                               signature_type='auth_header')

client = requests.session(auth=self.auth)

url = 'https://api.twitter.com/1/account/update_profile_background_image.json'
file_ = '/Users/mikehelmick/Dropbox/Avatars/avvy1004112.jpg'
client.post(url, data={'tile': 'True'}, files={'image': (file_, open(file_, 'rb'))})
If auth signature_type is auth_header I get this error (I realize this is throws a TwythonError but this method worked in versions of requests as late as 0.14.0:
Traceback (most recent call last):
  File "twython.py", line 571, in <module>
    print t.updateProfileBackgroundImage(file)
  File "twython.py", line 425, in updateProfileBackgroundImage
    **{'tile': tile})
  File "twython.py", line 464, in _media_update
    return self.post(url, params=params, files=file_)
  File "twython.py", line 249, in post
    return self.request(endpoint, 'POST', params=params, files=files, version=version)
  File "twython.py", line 241, in request
    content = self._request(url, method=method, params=params, files=files, api_call=url)
  File "twython.py", line 218, in _request
    retry_after=response.headers.get('retry-after'))
__main__.TwythonError: u'Unauthorized: Authentication credentials were missing or incorrect. -- Could not authenticate with OAuth.'
(^^ That is thrown when a status code is greater than 304)
Anyways, I'm looking into this, but it'd be appreciated if anyone else would like to take a look into this as well. ðŸ˜¸