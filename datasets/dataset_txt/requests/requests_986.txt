ifooth commented on Aug 4, 2016 •
edited by Lukasa
when i use requests post data with unicode, and the content-length will be wrong, and the post data will be truncated, test with requests 2.10.0
test code
# -*- coding: utf-8 -*
import json
import requests
# use utf-8
import sys
reload(sys)
sys.setdefaultencoding('utf-8')

data = json.dumps({'test': u"测试"}, ensure_ascii=False)
print data
resp = requests.post('https://github.com/kennethreitz/requests/issues', data=data, verify=False)
fiddler snapshot
reason
data = json.dumps({'test': u"测试"}, ensure_ascii=False)
the unicode length: len(data) = 14
the utf-8 chars length len(data.encode('utf-8')) = 18
encode with utf-8 but the content-length not change, so, the post body is truncated data
data.encode('utf-8')[:len(data)] = {"test": "测
is it a bug? need help