aeos commented on Oct 21, 2014
Hi,
Hopefully I am not using the API wrong, but I am stuck with how to fix an issue I am having. We are making hundreds of HTTP requests to an end point in a single script and after a while we receive a "Connection reset by peer" exception. I have put in a sleep and then retry recovery, but I get the same connection issue. If I restart the script, everything is fine.
From what I have read, there is connection pooling and I am worried that the second request is being dispatched on the same connection (which has been closed). I am wondering if maybe I am using the API wrong and should be closing the connection some how. My implementation is pretty straight forward:
with requests.Session() as s:
            s.headers['Connection'] = 'close'
            rs              = s.request(method, url, **kwargs)
kwargs includes timeout=None. Should I be catching exceptions within the with block to ensure the connection is closed properly? Or is this the correct usage?
Thanks!