wtip commented on Apr 8, 2014
I have the following code that was working fine with requests 1.2.0 but is not working with 2.2.1
while True:
    try: # Try to upload the image
        f = open (img_name,'rb')
        r =  requests.post(url='http://myurl.com/post', data = {'Upload':'upload'}, files = {'userfile':f}, timeout=30)
        print r.status_code
        r.raise_for_status()
        break # If the upload completes without errors break out of the loop
    except requests.exceptions.RequestException:
        print "Something went wrong, waiting and then trying again"
        time.sleep(30)
The code runs without errors but the image is not uploaded. The upload page rejects the post due to unsupported file type. I did a tcpdump capture while running the code with both versions of requests. The main difference I saw was that requests 1.2.0 properly sets Content-Type: image/jpeg while with requests 2.2.1 I did not see Content-Type header.
Am I doing something wrong or is this a bug?