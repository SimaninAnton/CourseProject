sebastienvercammen commented on Aug 7, 2017 â€¢
edited
Using requests with an HTTPS proxy (Node.js with https to receive incoming requests and http-proxy to tunnel) always results in:
requests.exceptions.ConnectionError: ('Connection aborted.', BadStatusLine("''",))
The Node.js proxy server intentionally returns 401 on all requests for testing purposes. If 401 won't work, there's no reason to add the rest of the functionality.
Using httplib (correct response):
>>> import httplib
>>> conn = httplib.HTTPSConnection('censored-proxy-domain.com', 8081)
>>> conn.request('HEAD', 'https://www.google.com')
>>> res = conn.getresponse()
>>> res.status
401
Using urllib.urlopen (correct response):
>>> urllib.urlopen('https://www.google.com', proxies=proxies)
...
IOError: ('http error', 401, 'Unauthorized', <httplib.HTTPMessage instance at 0x032A7AA8>)
But using requests:
r = requests.get('https://www.google.com', proxies=proxies)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "C:\Python27\lib\site-packages\requests\api.py", line 72, in get
    return request('get', url, params=params, **kwargs)
  File "C:\Python27\lib\site-packages\requests\api.py", line 58, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Python27\lib\site-packages\requests\sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Python27\lib\site-packages\requests\sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "C:\Python27\lib\site-packages\requests\adapters.py", line 490, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', BadStatusLine("''",))
The requests request also never gets received or handled/logged in the proxy server. Any other library or 3rd party tool has worked (test in browser, Proxifier, ProxyCap).
Expected Result
I expect requests to return a similar result to any other library.
Actual Result
Logs above.
Reproduction Steps
import requests
System Information
$ python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": ""
  },
  "implementation": {
    "name": "CPython",
    "version": "2.7.12"
  },
  "platform": {
    "release": "10",
    "system": "Windows"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.3"
  },
  "system_ssl": {
    "version": "1000208f"
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": false
}
This command is only available on Requests v2.16.4 and greater. Otherwise,
please provide some basic information about your system (Python version,
operating system, &c).