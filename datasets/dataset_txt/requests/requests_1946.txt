Contributor
sigmavirus24 commented on Oct 13, 2013
import requests

expected = 11424397 # whatever size the file should be

for i in range(0, 100):
    size = 0
    print "Downloading %d..." % i
    r = requests.get("http://somehost.com/bigfile.mp4", stream=True)

    while True:
        d = r.raw.read(1024 * 1024)
        if not d: break
        size += len(d)

    print "Size %d and expected %d" % (size, expected)
    assert size == expected, "Size %d != expected %d" % (size, expected)
In trying to download a large file, the above code exposes two apparent problems:
Regardless of the read size, the CPU gets pegged
Periodically one of the streams closes early
Reported for @zedshaw since he's apparently blocked from the repo.