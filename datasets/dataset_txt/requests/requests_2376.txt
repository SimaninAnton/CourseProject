joeshaw commented on Sep 13, 2012
This may be related to issue #606 and is caused by pull request #799.
With requests 0.14.0, if you attempt to visit a site with a certificate whose CA is not trusted and who doesn't support SSLv2, you'll get an error like this:
_ssl.c:480: error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol
when you should instead be getting an error like this:
_ssl.c:480: error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed
This is because SSLError is caught when calling ssl.wrap_socket() in VerifiedHTTPSConnection attempting only a SSLv3 connection and then tries SSLv23. Since my server doesn't support SSLv2, the latter call throws the "unknown protocol" error. From my interpretation of issue #606 it seems like that was an intentional OpenSSL policy decision (although reversed in later OpenSSL?)
Requests 0.12.1 returns the right error. This is testing on Ubuntu 10.04 LTS (Lucid) with Python 2.6.5 and OpenSSL 0.9.8k-7ubuntu8.13