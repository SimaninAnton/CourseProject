yurii-polishchuk commented on Apr 12, 2013
server# FreeBSD 8.1-RELEASE
server# python3 -V
Python 3.3.0
server# python3 -c 'import requests; print(requests.__version__)'
1.2.0
I need to solve one issue by using Python3 and requests. So the main purpose:
I have Python script on my PC on the one hand and Web Forum with forms on the other hand.
Web forum accept in forms only multipart/form-data, so I POST them to it by:
s = requests.Session()
q = s.post('http://siteforum.com/index.php?', headers=headers, data=postdata, files={'':''})
All is ok, data are posted.
But the main problem appears when I'm using text encoding in dictionary (cp1251) with .encode()
This is my example of the code:
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import requests
def main():
    s_cp1251 = 'тест'.encode('cp1251')

    postdata = {
        "TopicTitle" : s_cp1251,
        "TopicDesc" : 'тест'.encode('cp1251'),
        "Post" : 'test'
    }
    headers = {
        'User-Agent' : 'Mozilla/5.0 (Windows NT 5.1; rv:20.0) Gecko/20100101 Firefox/20.0',
        'Accept' : 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
        'Accept-Language' : 'en-US,en;q=0.5',
        'Accept-Encoding' : 'gzip, deflate',
        'Connection' : 'keep-alive'
    }

    s = requests.Session()
    q = s.post('http://siteforum.com/index.php?', headers=headers, data=postdata, files={'':''})
    print(q.status_code)

if __name__ == '__main__':
    main()
'тест' is a 'test' in cyrillic windows 1251 encoding
POST multipart/form-data to Web Forum forms:
TopicTitle -> b'\xf2\xe5\xf1\xf2'
TopicDesc -> b'\xf2\xe5\xf1\xf2'
Post -> test
The interesting thing is, that in The Python2 code example works fine, TopicTitle - is 'тест' in Web Forum form,
but with Python 3 something like this: b'\xf2\xe5\xf1\xf2'
If i send POST form-urlencoded , everything is ok too.