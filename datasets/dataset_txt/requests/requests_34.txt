longweiqiang commented on Nov 20, 2019 •
edited
Using the request library to match the requests_toolbelt library request to upload a file, the second request cannot be passed.
from requests_toolbelt import MultipartEncoder
import requests

m = MultipartEncoder(fields={'upload': open('test.txt', 'rb')},
                     boundary='----WebKitFormBoundarytZTJQrWcjjcJIMVQ')
params = {'path': 'test.txt',
          'token': '123456',
          'num': 0, 'offset': 0,
          'limit': 8}
response = requests.post('http://httpbin.org/post',
                         params=params,
                         data=m,
                         headers={'Content-Type': m.content_type})
# print("1: ", response.text)
# print("2: ", response.request.body)
# print("3: ", response.request.headers)

print(2)
response1 = requests.post('http://httpbin.org/post',
                         params=params,
                         data=m,
                         headers={'Content-Type': m.content_type})
Note：The request for the response1 variable cannot be completed, where test.txt is an empty file