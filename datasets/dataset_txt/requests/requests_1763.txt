hxuanji commented on Apr 22, 2014
Hi all,
I'm using requests 2.2.1. I encounter a problem as follows.
In ordinary situation, it all works fine. I use requests to do some communications with server and all the header I use is:
{"Connection": "close"}
But "occasionally" I got the exception as follows:
  File "/share/HDA_DATA/package/lib/python2.7/site-packages/requests/api.py", line 88, in post
    return request('post', url, data=data, **kwargs)
  File "/share/HDA_DATA/package/lib/python2.7/site-packages/requests/api.py", line 44, in request
    return session.request(method=method, url=url, **kwargs)
  File "/share/HDA_DATA/package/lib/python2.7/site-packages/requests/sessions.py", line 383, in request
    resp = self.send(prep, **send_kwargs)
  File "/share/HDA_DATA/package/lib/python2.7/site-packages/requests/sessions.py", line 486, in send
    r = adapter.send(request, **kwargs)
  File "/share/HDA_DATA/package/lib/python2.7/site-packages/requests/adapters.py", line 378, in send
    raise ConnectionError(e)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=9200): Max retries exceeded with url: /cate/main/3719e564ece2ad3a267ecac0f4d8db6e74333046/ (Caused by <class 'socket.error'>: [Errno 104] Connection reset by peer)
And then I check the server log, I found the error log:
handler.codec.frame.TooLongFrameException: HTTP header is larger than 8192 bytes.
It's strange, because the header is less than 8k apparently and this situation does not always happen.
Does the requests append some extra http header?
Any suggestions?
cheers,
Ivan