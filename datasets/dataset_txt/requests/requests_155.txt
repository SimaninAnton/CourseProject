hiranya911 commented on Nov 17, 2018
Summary.
I have the following code to stream an SSE response.
resp = session.get(self.url, stream=True)
resp_iterator = resp.iter_content(decode_unicode=True, chunk_size=None)
while _some_condition():
    nextchar = next(resp_iterator)
    _add_to_buffer(nextchar)
Expected Result
According to the documentation, when chunk_size is None, it should stream the content as it is received.
Actual Result
No content is received by the consumer. It simply hangs. If I simply remove the chunk_size argument, I can see the consumer receiving 1 byte at a time.
System Information
$ python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  }, 
  "cryptography": {
    "version": ""
  }, 
  "idna": {
    "version": "2.7"
  }, 
  "implementation": {
    "name": "CPython", 
    "version": "2.7.13"
  }, 
  "platform": {
    "release": "4.17.0-3rodete2-amd64", 
    "system": "Linux"
  }, 
  "pyOpenSSL": {
    "openssl_version": "", 
    "version": null
  }, 
  "requests": {
    "version": "2.20.1"
  }, 
  "system_ssl": {
    "version": "1010008f"
  }, 
  "urllib3": {
    "version": "1.24.1"
  }, 
  "using_pyopenssl": false
}