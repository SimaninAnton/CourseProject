Contributor
tzuryby commented on May 23, 2012
I am using requests to perform security tests against my site (in this case, a simple sql-injection vector) and getting
error (dumped below) which points to unquote_unreserved function.
see below
snippets of my code:
#   tuple structure: 
#   (path, data, headers, cookies, files)
(r"""/default.asp?id=1+AND+1=(SELECT+TOP+1+1+FROM+information_schema.tables+WHERE+TABLE_SCHEMA="blind_sqli"+and+table_name+NOT+IN+(+SELECT+TOP+1+table_name+FROM+information_schema.tables)+and+table_name+LIKE+'[a-z]%'+)""", {}, {}, {}, {})

...

requests.get(options.host + path, data=data, headers=headers, cookies=cookies, files=files)...
The exception dumps
Traceback (most recent call last):
  File "sqli.py", line 460, in run_case
    return fetch[method](options.host + path, data=data, headers=headers, cookies=cookies, files=files).status_code
  File "/usr/local/lib/python2.7/dist-packages/requests/api.py", line 52, in get
    return request('get', url, *_kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/api.py", line 40, in request
    return s.request(method=method, url=url, *_kwargs)
  File "/usr/local/lib/python2.7/dist-packages/requests/sessions.py", line 229, in request
    r.send(prefetch=prefetch)
  File "/usr/local/lib/python2.7/dist-packages/requests/models.py", line 468, in send
    url = self.full_url
  File "/usr/local/lib/python2.7/dist-packages/requests/models.py", line 411, in full_url
    url = requote_uri(url)
  File "/usr/local/lib/python2.7/dist-packages/requests/utils.py", line 448, in requote_uri
    return quote(unquote_unreserved(uri), safe="!#$%&'()*+,/:;=?@[]~")
  File "/usr/local/lib/python2.7/dist-packages/requests/utils.py", line 429, in unquote_unreserved
    c = chr(int(h, 16))
ValueError: invalid literal for int() with base 16: "'+"