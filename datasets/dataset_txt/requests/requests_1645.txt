Contributor
blueyed commented on Sep 12, 2014
requests merges the proxies from the environment unconditionally (https://github.com/kennethreitz/requests/blob/master/requests/sessions.py#L439-443).
The use case would be pip --proxy localhost:3128 install example, which should make requests use the specified proxy always.
I could imagine PipSession to override merge_environment_settings and discard changes from the environment, but there should be cleaner way to indicate that only the explicitly provided proxies should be used.
Another idea might be to set PipSession.trust_env = False, but that would also affect CA bundles and seems even more dirty.
And while pip could unset the environment variables (in case a proxy is provided via its options), this requires to know the implementation details about looking them up.
I would have assumed that requests take proxy information from the environment only if no proxies are provided through the API.