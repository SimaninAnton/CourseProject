redspider commented on Sep 13, 2013
Incorrect use of mutable default dictionary in the Request class can lead to incorrect behaviour in advanced usage.
The mutable defaults are specified at:
https://github.com/kennethreitz/requests/blob/master/requests/models.py#L189
and should be None, not dict(). In order to maintain interface consistency it may be necessary to change the following lines to ensure data is set to a dict() if data is None, otherwise it will change to an empty list in the default case.
A demonstration of the flaw is:
>>> import requests
>>> s = requests.Session()
>>> r = requests.Request('GET','http://google.com/')
>>> r.data
{}
>>> r.data['foo'] = 'cat'
>>> r2 = requests.Request('GET','http://google.com/')
>>> r2.data
{'foo': 'cat'}