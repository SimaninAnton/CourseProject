dmorri commented on Nov 13, 2014
This code will work on my personal laptop, but then when I move to a windows server where we have to use a proxy to access the outside world, I get a 407 error. I added the proxies to this (just like I have setup in my Internet explorer settings that work). Any ideas?
import requests
proxies = {
"http": "10.51.1.140:8080",
"https": "10.51.1.140:8080",
}
r = requests.get('https://epfws.usps.gov/ws/resources/epf/version', proxies=proxies)
print(r.text)
Here is what I get:
G:\Python34>python uspsver.py
Traceback (most recent call last):
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connectionpool.py", line 511, in urlopen
conn = self._get_conn(timeout=pool_timeout)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connectionpool.py", line 231, in _get_conn
return conn or self._new_conn()
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connectionpool.py", line 712, in _new_conn
return self._prepare_conn(conn)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connectionpool.py", line 685, in _prepare_conn
conn.connect()
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connection.py", line 208, in connect
self._tunnel()
File "G:\Python34\lib\http\client.py", line 822, in _tunnel
message.strip()))
OSError: Tunnel connection failed: 407 Proxy Authentication Required
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\adapters
.py", line 364, in send
timeout=timeout
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\connectionpool.py", line 559, in urlopen
_pool=self, _stacktrace=stacktrace)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\packages
\urllib3\util\retry.py", line 265, in increment
raise MaxRetryError(_pool, url, error)
requests.packages.urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='ep
fws.usps.gov', port=443): Max retries exceeded with url: /ws/resources/epf/versi
on (Caused by ProxyError('Cannot connect to proxy.', OSError('Tunnel connection
failed: 407 Proxy Authentication Required',)))
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
File "uspsver.py", line 5, in
r = requests.get('https://epfws.usps.gov/ws/resources/epf/version', proxies=
proxies)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\api.py",
line 65, in get
return request('get', url, *_kwargs)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\api.py",
line 49, in request
response = session.request(method=method, url=url, *_kwargs)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\sessions
.py", line 459, in request
resp = self.send(prep, *_send_kwargs)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\sessions
.py", line 571, in send
r = adapter.send(request, *_kwargs)
File "G:\Python34\lib\site-packages\requests-2.4.3-py3.4.egg\requests\adapters
.py", line 415, in send
raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='epfws.usps.gov',
port=443): Max retries exceeded with url: /ws/resources/epf/version (Caused by P
roxyError('Cannot connect to proxy.', OSError('Tunnel connection failed: 407 Pro
xy Authentication Required',)))
G:\Python34>