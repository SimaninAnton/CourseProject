gauttham commented on Jan 5, 2018 â€¢
edited
Summary:
I am trying to hit an API from my MAC to a local server with verify=False Option.
The below curl command works perfectly fine for my use case.
However, the same thing when done via Python requests module,
returns the following error:
SSLError: ("bad handshake: Error([('SSL routines', 'ssl3_read_bytes', 'sslv3 alert handshake failure')],)",)
Here is the Curl Command:
curl -vX POST -H "Content-Type: application/json" -d '{"filters":{"cpcode":["ymdfile"]}}' '/api/v1/nkarkala/reports/mkttrafficedgebycpcode_D_t-cp_v1?start=2017-11-30T00:00:00Z&end=2017-11-30T01:00:00Z'
def refreshARLHostnameInfo():
headers = {
'Content-Type': 'application/json',
'X-Source-Id': 'sshete',
}
params = (
    ('start', '2017-11-30T00:00:00Z'),
    ('end', '2017-11-30T01:00:00Z'),
)

data = '{"filters":{"cpcode":["ymdfile"]}}'

print(requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS)
response = requests.post(
    '<URL>/api/v1/nkarkala/reports/mkttrafficedgebycpcode_D_t-cp_v1',
    headers=headers, params=params, data=data,verify=daconstants.VERIFY)

print (response)

return response
Expected Result
What you expected.
Actual Result
Error Traceback (most recent call last)
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/contrib/pyopenssl.py in ssl_wrap_socket(sock, keyfile, certfile, cert_reqs, ca_certs, server_hostname, ssl_version, ca_cert_dir)
347 try:
--> 348 cnx.do_handshake()
349 except OpenSSL.SSL.WantReadError:
~/projects/premium_env/lib/python3.5/site-packages/OpenSSL/SSL.py in do_handshake(self)
1805 result = _lib.SSL_do_handshake(self._ssl)
-> 1806 self._raise_ssl_error(self._ssl, result)
1807
~/projects/premium_env/lib/python3.5/site-packages/OpenSSL/SSL.py in _raise_ssl_error(self, ssl, result)
1545 else:
-> 1546 _raise_current_error()
1547
~/projects/premium_env/lib/python3.5/site-packages/OpenSSL/_util.py in exception_from_error_queue(exception_type)
53
---> 54 raise exception_type(errors)
55
Error: [('SSL routines', 'ssl3_read_bytes', 'sslv3 alert handshake failure')]
During handling of the above exception, another exception occurred:
SSLError Traceback (most recent call last)
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/connectionpool.py in urlopen(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)
594 body=body, headers=headers,
--> 595 chunked=chunked)
596
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/connectionpool.py in _make_request(self, conn, method, url, timeout, chunked, **httplib_request_kw)
351 try:
--> 352 self._validate_conn(conn)
353 except (SocketTimeout, BaseSSLError) as e:
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/connectionpool.py in _validate_conn(self, conn)
830 if not getattr(conn, 'sock', None): # AppEngine might not have .sock
--> 831 conn.connect()
832
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/connection.py in connect(self)
288 server_hostname=hostname,
--> 289 ssl_version=resolved_ssl_version)
290
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/contrib/pyopenssl.py in ssl_wrap_socket(sock, keyfile, certfile, cert_reqs, ca_certs, server_hostname, ssl_version, ca_cert_dir)
354 except OpenSSL.SSL.Error as e:
--> 355 raise ssl.SSLError('bad handshake: %r' % e)
356 break
SSLError: ("bad handshake: Error([('SSL routines', 'ssl3_read_bytes', 'sslv3 alert handshake failure')],)",)
During handling of the above exception, another exception occurred:
SSLError Traceback (most recent call last)
~/projects/premium_env/lib/python3.5/site-packages/requests/adapters.py in send(self, request, stream, timeout, verify, cert, proxies)
422 retries=self.max_retries,
--> 423 timeout=timeout
424 )
~/projects/premium_env/lib/python3.5/site-packages/requests/packages/urllib3/connectionpool.py in urlopen(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, **response_kw)
620 clean_exit = False
--> 621 raise SSLError(e)
622
SSLError: ("bad handshake: Error([('SSL routines', 'ssl3_read_bytes', 'sslv3 alert handshake failure')],)",)
During handling of the above exception, another exception occurred:
SSLError Traceback (most recent call last)
in ()
----> 1 response = vds_controllers.refreshARLHostnameInfo()
~/projects/premium_env/premium_healthcheck_platform/src/ab-www/premium_healthcheck_platform/storage/vds/vds_controllers.py in refreshARLHostnameInfo()
26 response = requests.post(
27 '/api/v1/nkarkala/reports/mkttrafficedgebycpcode_D_t-cp_v1',
---> 28 headers=headers, params=params, data=data,verify=daconstants.VERIFY)
29
30
~/projects/premium_env/lib/python3.5/site-packages/requests/api.py in post(url, data, json, **kwargs)
108 """
109
--> 110 return request('post', url, data=data, json=json, **kwargs)
111
112
~/projects/premium_env/lib/python3.5/site-packages/requests/api.py in request(method, url, **kwargs)
54 # cases, and look like a memory leak in others.
55 with sessions.Session() as session:
---> 56 return session.request(method=method, url=url, **kwargs)
57
58
~/projects/premium_env/lib/python3.5/site-packages/requests/sessions.py in request(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)
473 }
474 send_kwargs.update(settings)
--> 475 resp = self.send(prep, **send_kwargs)
476
477 return resp
~/projects/premium_env/lib/python3.5/site-packages/requests/sessions.py in send(self, request, **kwargs)
594
595 # Send the request
--> 596 r = adapter.send(request, **kwargs)
597
598 # Total elapsed time of the request (approximately)
~/projects/premium_env/lib/python3.5/site-packages/requests/adapters.py in send(self, request, stream, timeout, verify, cert, proxies)
495 except (_SSLError, _HTTPError) as e:
496 if isinstance(e, _SSLError):
--> 497 raise SSLError(e, request=request)
498 elif isinstance(e, ReadTimeoutError):
499 raise ReadTimeout(e, request=request)
SSLError: ("bad handshake: Error([('SSL routines', 'ssl3_read_bytes', 'sslv3 alert handshake failure')],)",)
Reproduction Steps
Run the function
PIP Freeze Output:
aenum==2.0.8
appnope==0.1.0
asn1crypto==0.24.0
bleach==2.1.2
certifi==2017.11.5
cffi==1.11.2
chardet==3.0.4
config==0.3.9
coreapi==2.3.3
coreschema==0.0.4
cryptography==2.1.4
dbattery-python-api==1.2
decorator==4.1.2
Django==1.10.1
django-redis-cache==1.7.1
django-rest-swagger==2.1.2
djangorestframework==3.4.4
dnspython==1.15.0
entrypoints==0.2.3
html5lib==1.0.1
idna==2.6
ijson==2.3
ipdb==0.10.3
ipykernel==4.7.0
ipython==6.2.1
ipython-genutils==0.2.0
ipywidgets==7.0.5
itypes==1.1.0
jedi==0.11.0
Jinja2==2.10
jsonschema==2.6.0
jupyter==1.0.0
jupyter-client==5.1.0
jupyter-console==5.2.0
jupyter-core==4.4.0
MarkupSafe==1.0
mistune==0.8.3
nbconvert==5.3.1
nbformat==4.4.0
ndg-httpsclient==0.4.3
netstorageapi==1.2.8
notebook==5.2.2
openapi-codec==1.3.2
pandocfilters==1.4.2
parso==0.1.0
pexpect==4.3.0
pickleshare==0.7.4
prompt-toolkit==1.0.15
psycopg2==2.7.3.2
ptyprocess==0.5.2
pyasn1==0.4.2
pycparser==2.18
Pygments==2.2.0
PyJWT==1.5.3
pyOpenSSL==17.5.0
PyPika==0.9.4
python-dateutil==2.6.1
pytz==2017.3
pyzmq==16.0.3
qtconsole==4.3.1
redis==2.10.6
requests==2.11.1
simplegeneric==0.8.1
simplejson==3.13.2
six==1.11.0
terminado==0.8.1
testpath==0.3.1
tornado==4.5.2
traitlets==4.3.2
uncurl==0.0.8
uritemplate==3.0.0
urllib3==1.22
wcwidth==0.1.7
webencodings==0.5.1
widgetsnbextension==3.0.8
xerox==0.4.1
Regards,
Gautam