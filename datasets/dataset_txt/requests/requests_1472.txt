bepetersn commented on Mar 19, 2015
Hey guys, I don't know if this is the right place to make this bug report, but I could sure use some help, I have been banging my head against a wall for a bit. See this repo where I'm reproducing my error: https://github.com/bepetersn/special-repo.
Using Flask, I'm seeing weird behavior around its request object. After uploading a file with the requests library, e.g. requests.post(uri, files=<my_files>), by the time the request propagated to my view function, request.files was empty. Oddly, I observed that the contents of the file itself was available under request.form[None].
After quite a lot of debugging, I saw that Werkzeug received roughly the following as the form/multipart-encoded data, and proceeded to try to parse it:
Content-Disposition: form-data; name_=utf-8''Spirit%20Airlines%20-%20cheap%20tickets%2C%0A %20cheap%20flights%2C%20discount%20airfare%2C%20cheap%20hotels %2C%20cheap%20car%20rentals%2C%20cheap%20travel.pdf; filename_=utf- 8''Spirit%20Airlines%20-%20cheap%20tickets%2C%0A%20cheap%20flights %2C%20discount%20airfare%2C%20cheap%20hotels%2C%20cheap%20car%20rentals %2C%20cheap%20travel.pdf\r\n
Do you notice the little "*" characters just after the "name" and "filename" header definitions? From my sense of things, Werkzeug looks for exactly "name" and "filename", doesn't know how to parse these in their place, fails to find an attachment name, and thus doesn't create a werkzeug.datastructures.FileStorage. For this reason, request.files is empty.
What does anyone think? Is requests responsible for adding these extra characters in?
üëç 2