suonto commented on Nov 12, 2014
The following code behaviour is not logical in a specific case:
response = requests.post(url, data=yielding_function())
If the server sends error in prepare, for example 401 before processing data, then in the client requests will raise:
ConnectionError [Errno 104] Connection reset by peer
In my opinion, the proper behaviour would be to not raise the exception, and return 401 and the body in the standard way. Of course only in the case that 401 is received before data is rejected.
I further tested this by adding 1 second delay before yielding any data, and even if the 401 comes back from the server before any data is sent, requests will still ignore it, send the data, and then raise ConnectionError: [Errno 104] Connection reset by peer because the data get's rejected.