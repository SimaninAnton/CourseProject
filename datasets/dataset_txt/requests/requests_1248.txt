sjmh commented on Nov 9, 2015
Ran into an interesting issue in the past week while testing things out with SaltStack. ( SaltStack is a remote execution engine / cfg mgmt tool ). SaltStack uses requests internally.
However, one of the 'modules' you can use is python-etcd. python-etcd uses urllib3. But, because of request's wrapping of urllib3 exceptions, some of the python-etcd code bombs because it tries to catch urllib3 exceptions via fully-qualified names.
An example of this happening can be easily demo'd with:
#!/usr/bin/python

#import requests
import etcd

c = etcd.Client('127.0.0.1', 4001)
c.read("/blah", wait=True, timeout=2)
Without Requests, you get etcd.EtcdConnectionFailed. With it, you get urllib3.exceptions.ReadTimeoutError. python-etcd tries to catch urllib3 exceptions, but because of request's wrapping, it fails to catch them.
Is there a way to work around this properly ( besides going to the python-etcd author and asking him to change everything to use requests instead of urllib3 )?