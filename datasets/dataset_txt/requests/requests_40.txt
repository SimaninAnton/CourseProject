varkychen commented on Oct 29, 2019 â€¢
edited
Hi All
I'm kinda new to python and I'm facing issues with TLS handshakes. My project currently uses python 2.7.6, requests 2.13.0 with no pip. I'm running on a Windows machine. I've been currently asked to stick with these versions.
I'm using code similar to the the one below.
import requests
import requests.packages.urllib3

requests.packages.urllib3.disable_warnings()
response = requests.get('https://www.verisign.com')
print(response.status_code)
After running this code, I get the following error
requests.exceptions.SSLError: [Errno 8] _ssl.c:507: EOF occurred in violation of protocol
I also tried this piece of code to check the underlying ssl library
import socket, ssl, certifi

print(certifi.where())

CIPHERS = (
    'AES256-SHA:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+HIGH:'
    'DH+HIGH:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+HIGH:RSA+3DES:!aNULL:'
    '!eNULL:!MD5'
)

server_address = ('www.verisign.com', 443)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
ssl_sock = ssl.wrap_socket(s, 
                            cert_reqs=ssl.CERT_REQUIRED, 
                            ca_certs=certifi.where(),
                            ssl_version=ssl.PROTOCOL_TLSv1,
                            ciphers=CIPHERS)
ssl_sock.connect(server_address)

print(ssl_sock.cipher())
This fails with
File "***python\2.7.6\lib\ssl.py", line 305, in do_handshake
    self._sslobj.do_handshake()
socket.error: [Errno 10054] An existing connection was forcibly closed by the remote host
I suspect this might have something to do with the older versions of TLS supported by python 2.7.6. Can anyone help me with this issue and how to fix this?