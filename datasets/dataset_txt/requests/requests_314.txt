ahuigo commented on Apr 9, 2018 •
edited
Summary
When I send a json request, the json.dumps does not keeps non-ASCII characters.
Reproduction Steps
cat <<MM | python3 - &
from flask import Flask,request
app = Flask('')

@app.route('/', methods=['POST', 'GET'])
def test():
    return(request.data)

app.run()
MM

cat <<MM | python3 -
import time
import requests as r
time.sleep(1)
print(r.post('http://localhost:5000/', json={'bar':'程序员'}).text)
MM
Expected Result
I expect result keeps non-ASCII request:
{"bar": "程序员"}
Actual Result
{"bar": "\u7a0b\u5e8f\u5458"}
Suggest
Modify the models vim modles.py +458 to keep the non-ASCII characters.
For example:
body = complexjson.dumps(json, ensure_ascii=False)
 >>> json.dumps('程序员', ensure_ascii=False)
'"程序员"'
>>> json.dumps('程序员')
'"\\u7a0b\\u5e8f\\u5458"'
System Information
$ python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.1"
  },
  "platform": {
    "release": "15.6.0",
    "system": "Darwin"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.1"
  },
  "system_ssl": {
    "version": "100020cf"
  },
  "urllib3": {
    "version": "1.21.1"
  },
  "using_pyopenssl": false
}