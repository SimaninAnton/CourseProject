russellballestrini commented on Nov 17, 2012
Problem
Setting a request timeout causes a TypeError when attempting to throw TimeoutError which is inherits from PoolError.
Possible solution
Set a default message in the PoolError constructor.
#def __init__(self, pool, message):
def __init__(self, pool, message=''):
Traceback
 [2012-11-17 15:47:24,980: ERROR/MainProcess] Unrecoverable error: TypeError('__init__() takes exactly 3 arguments (2 given)', <class 'requests.packages.urllib3.exceptions.TimeoutError'>, ("HTTPConnectionPool(host='looney.com', port=80):   Request timed out. (timeout=1.0)",))

 Traceback (most recent call last):
   File "/home/user/virtpy/lib/python2.6/site-packages/celery/worker/__init__.py", line 347, in start
     component.start()
   File "/home/user/virtpy/lib/python2.6/site-packages/celery/worker/consumer.py", line 390, in start
     self.consume_messages()
   File "/home/user/virtpy/lib/python2.6/site-packages/celery/worker/consumer.py", line 474, in consume_messages
     readers[fileno](fileno, event)
   File "/home/user/virtpy/lib/python2.6/site-packages/billiard/pool.py", line 669, in handle_event
     self._it.next()
   File "/home/user/virtpy/lib/python2.6/site-packages/billiard/pool.py", line 642, in _process_result
     ready, task = poll(timeout)
   File "/home/user/virtpy/lib/python2.6/site-packages/billiard/pool.py", line 1059, in _poll_result
     return True, self._quick_get()
 TypeError: ('__init__() takes exactly 3 arguments (2 given)', <class 'requests.packages.urllib3.exceptions.TimeoutError'>,("HTTPConnectionPool(host='looney.com', port=80): Request timed out. (timeout=1.0)",))