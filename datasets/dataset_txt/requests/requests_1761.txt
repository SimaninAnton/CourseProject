cournape commented on Apr 23, 2014
I noticed that using stream=True is really slow in some cases. Code that shows the issue:
import requests


url = "https://api.enthought.com/eggs/rh5-64/numpy-1.8.0-1.egg"
target = "numpy-1.8.0-1.egg"

use_streaming = True

if use_streaming:
    resp = requests.get(url, stream=True)
else:
    resp = requests.get(url)

resp.raise_for_status()

with open(target, "wb") as target:
    if use_streaming:
        for chunk in resp.iter_content():
            target.write(chunk)
    else:
        target.write(resp.content)
With use_streaming=True, it takes around 40 sec, and only 2 sec when False. Running this script with strace, it looks like the chunk size is 1 byte:
...
recvfrom(4, "\345", 1, 0, NULL, NULL)   = 1 # I see many lines like this
Looks like for some reason the chunk size is ridiculously small ?
I am using requests 2.2.1 on python 2.7 on debian.