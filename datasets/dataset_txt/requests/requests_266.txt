dwightgunning commented on May 25, 2018
WIth the 18.0.0 release, pyOpenSSL dropped support for Python 2.6.
As requests[security] pins pyOpenSSL with only a minimum version, fresh installations of requests pick up the latest and incompatible dependency.
Expected Result
Requests[security] functions to work.
Actual Result
NameError: global name 'memoryview' is not defined
Reproduction Steps
>>> import requests
/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/cryptography/__init__.py:26: DeprecationWarning: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. The next version of cryptography will drop support for Python 2.6
  DeprecationWarning
>>> requests.get('https://www.dwightgunning.com')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/requests/api.py", line 72, in get
    return request('get', url, params=params, **kwargs)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/requests/api.py", line 58, in request
    return session.request(method=method, url=url, **kwargs)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/urllib3/connectionpool.py", line 357, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/Users/dwight/.pyenv/versions/2.6.6/lib/python2.6/httplib.py", line 914, in request
    self._send_request(method, url, body, headers)
  File "/Users/dwight/.pyenv/versions/2.6.6/lib/python2.6/httplib.py", line 951, in _send_request
    self.endheaders()
  File "/Users/dwight/.pyenv/versions/2.6.6/lib/python2.6/httplib.py", line 908, in endheaders
    self._send_output()
  File "/Users/dwight/.pyenv/versions/2.6.6/lib/python2.6/httplib.py", line 780, in _send_output
    self.send(msg)
  File "/Users/dwight/.pyenv/versions/2.6.6/lib/python2.6/httplib.py", line 759, in send
    self.sock.sendall(str)
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/urllib3/contrib/pyopenssl.py", line 316, in sendall
    sent = self._send_until_done(data[total_sent:total_sent + SSL_WRITE_BLOCKSIZE])
  File "/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/urllib3/contrib/pyopenssl.py", line 304, in _send_until_done
    return self.connection.send(data)
  File "build/bdist.macosx-10.13-x86_64/egg/OpenSSL/SSL.py", line 1719, in send

NameError: global name 'memoryview' is not defined
System Information
$ python --version
Python 2.6.6
$ python -m requests.help
/Users/dwight/.local/share/virtualenvs/stream-python-z8k7CN8K/lib/python2.6/site-packages/cryptography/__init__.py:26: DeprecationWarning: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. The next version of cryptography will drop support for Python 2.6
  DeprecationWarning
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": "2.1.4"
  },
  "idna": {
    "version": "2.6"
  },
  "implementation": {
    "name": "CPython",
    "version": "2.6.6"
  },
  "platform": {
    "release": "17.5.0",
    "system": "Darwin"
  },
  "pyOpenSSL": {
    "openssl_version": "100020ff",
    "version": "18.0.0"
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": ""
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": true
}