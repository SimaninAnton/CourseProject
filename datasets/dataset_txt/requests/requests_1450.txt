Glandos commented on Apr 8, 2015
I am currently using pip and requests on SLES11SP3, which has the following software installed:
python-2.6.8 (but I got the same behavior with a self-compiled 2.7.9)
openssl-0.9.8j
curl-7.19.7
python-pip-6.0.8
I am experiencing really strange issues. With the bundled cacert.pem from requests-2.6.0, I have an SSL exception:
    >>> import requests
    >>> requests.get('https://pypi.python.org')
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
      File "/root/test/lib/python2.6/site-packages/requests/api.py", line 65, in get
        return request('get', url, **kwargs)
      File "/root/test/lib/python2.6/site-packages/requests/api.py", line 49, in request
        response = session.request(method=method, url=url, **kwargs)
      File "/root/test/lib/python2.6/site-packages/requests/sessions.py", line 461, in request
        resp = self.send(prep, **send_kwargs)
      File "/root/test/lib/python2.6/site-packages/requests/sessions.py", line 573, in send
        r = adapter.send(request, **kwargs)
      File "/root/test/lib/python2.6/site-packages/requests/adapters.py", line 431, in send
        raise SSLError(e, request=request)
    requests.exceptions.SSLError: [Errno 1] _ssl.c:491: error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed
This behavior is confirmed with curl:
# curl --capath /dev/null --cacert cacert.pem.requests https://pypi.python.org
curl: (60) SSL certificate problem, verify that the CA cert is OK. Details:
error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed
However, if I remove any of the last 4 certificates in the bundle, everything works as expected. Currently, the last 4 issuers are:
# Issuer: CN=CA Disig Root R1 O=Disig a.s.
# Issuer: CN=CA Disig Root R2 O=Disig a.s.
# Issuer: CN=ACCVRAIZ1 O=ACCV OU=PKIACCV
# Issuer: CN=TWCA Global Root CA O=TAIWAN-CA OU=Root CA
Do you have any idea why? Is it linked to openssl being too old? Unfortunately, I can't upgrade it, it is a system library. But modifying every virtualenv I create on this machine to change the bundle will be a painâ€¦