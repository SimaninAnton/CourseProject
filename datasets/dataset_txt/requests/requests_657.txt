pfoppe commented on May 20, 2017
Hello,
I've written a pretty basic Custom Authentication Handler to work with a vendor product we have deployed. This product requires an HTTP request with a username/password to a specific web-endpoint which will generate an 'authentication token' that expires at a set time. This authentication token is then passed with future requests which will authorize access to the services.
I successfully have this working by setting the PreparedRequest "method" to POST and update the body to include the authorization token.
I have been successful with this if I access a URL that does not have a re-direct. Unfortunately I've stumbled across a few re-directs in the system, and it seems that my method overwrite (from get -> post) and including my token in the body of the request are lost on re-directs (these are not persisted with requests following the re-direct).
I enabled IIS Failed Request Tracing on the server side to confirm this scenario. I can see the following requests:
1st Request - Generate the authentication token with username/password. Successful HTTP 200 response with the token returned. My Custom Auth Handler uses this token to update the PreparedRequest.body
2nd Request - Executed HTTP POST to the protected management console (that requires this token). Server responds with an HTTP Status code 302 (re-direct) with a new location in the response header (in this case it just added a '/' at the end of the path). I can see my authorization token in the request body
3rd Request - Requests does follow the re-direct, however it is re-converted back to an HTTP GET and my token (from the body) is also lost. It does appear that my request headers did persist.
Thoughts? Thanks for any help!!!