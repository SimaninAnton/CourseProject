wangshuai666 commented on Jul 3, 2018 â€¢
edited
Summary.
Expected Result
What you expected.
utils.py proxy = proxies[proxy_key]
proxies is a set
What happened instead.
ip = random.choice(p_list)
proxy = {'http', 'http://{0}:{1}'.format(ip, port)}
req = requests.get(url=target, proxies=proxy)
Traceback (most recent call last):
  File "d:\spider\main.py", line 53, in get_list
    req = requests.get(url=target, proxies=proxy)
  File "C:\Python27\lib\site-packages\requests\api.py", line 70, in get
    return request('get', url, params=params, **kwargs)
  File "C:\Python27\lib\site-packages\requests\api.py", line 56, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Python27\lib\site-packages\requests\sessions.py", line 488, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Python27\lib\site-packages\requests\sessions.py", line 609, in send
    r = adapter.send(request, **kwargs)
  File "C:\Python27\lib\site-packages\requests\adapters.py", line 390, in send
    conn = self.get_connection(request.url, proxies)
  File "C:\Python27\lib\site-packages\requests\adapters.py", line 286, in get_connection
    proxy = select_proxy(url, proxies)
  File "C:\Python27\lib\site-packages\requests\utils.py", line 643, in select_proxy
    proxy = proxies[proxy_key]
TypeError: 'set' object has no attribute '__getitem__'
System Information
python 2.7 win10
$ python -m requests.help
This command is only available on Requests v2.16.4 and greater. Otherwise,
please provide some basic information about your system (Python version,
operating system, &c).