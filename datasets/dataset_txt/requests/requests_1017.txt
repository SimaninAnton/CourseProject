ryanwy commented on Jul 13, 2016 â€¢
edited
I'm not sure if this is a bug? please take a look. Thanks.
I use proxy below and it doesn't work, when I change scheme to lower 'http', it's fine.
proxy = {'HTTP': '218.26.237.18:3128'}
url = http://httpbin.org/ip
I track the source code and don't find anywhere to handle scheme case conversion.
-> requests.get
-> request
-> settings = self.merge_environment_settings(
prep.url, proxies, stream, verify, cert
)
from function self.merge_environment_settings, get orderdict object proxies:
OrderedDict([('HTTP', '118.144.187.254:3128')])
-> resp = self.send(prep, *_send_kwargs)
-> r = adapter.send(request, *_kwargs)
-> conn = self.get_connection(request.url, proxies)
-> proxy = select_proxy(url, proxies)
def select_proxy(url, proxies):
proxies = proxies or {}
urlparts = urlparse(url)
if urlparts.hostname is None:
return proxies.get('all', proxies.get(urlparts.scheme))
......
in function select_proxy, urlparts.scheme = 'http' and proxies.scheme is 'HTTP', so it returns None and the setting proxy is invalid '