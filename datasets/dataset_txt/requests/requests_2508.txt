Contributor
reclosedev commented on Apr 13, 2012
Code that reproduces the problem:
import pickle
import requests

url = 'http://httpbin.org/cookies'
session = requests.session()
session.get('%s/set/key1/value1' % url)
before_pickle = session.get(url).text

pickled_session = pickle.dumps(session)
session = pickle.loads(pickled_session)

# AttributeError: 'Session' object has no attribute 'prefetch'
after_pickle = session.get(url).text
assert before_pickle == after_pickle
Ways to solve:
Dirty one: dont' save prefetch, just replace sessions.py#L158
prefetch = self.prefetch or prefetch
to
prefetch = getattr(self, 'prefetch', False) or prefetch
Add prefetch to Session.__attrs__, args at sessions.py#L169 and to Request.__init__()
Another one?