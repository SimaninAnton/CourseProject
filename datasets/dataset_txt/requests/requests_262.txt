1600 commented on May 29, 2018 â€¢
edited
when using requests with sites that returns a 302 Moved Temporarily, and in the response header there will be a 'Location' header given the target redirect domain.
Now if you also defined the 'Host' header in a headers parameter to be some fixed domain, the redirect won't be correctly performed.
for example:
Expected Result
using requests to access https://login.website.com, while customizing headers= {'Host':'login.website.com'}
website returns 302 with 'Location' header > 'https://someothersubdomain.website.com/1.html'
at this moment I expected it redirects correctly to https://someothersubdomain.website.com
Actual Result
it follows redirect to "https://login.website.com/1.html" rather than the correct someothersubdomain.website.com
inspecting the second http requests automatically sent by 'requests' we can see that the host header is incorrectly persisted to 'login.website.com'
Reproduction Steps
like I described above.
import requests
url = 'some url that redirect to another subdomain'
headers= {'Host':'login.website.com'}   
res = requests.get(url,headers=headers)
System Information
$ python -m requests.help
{
"chardet": {
"version": "3.0.4"
},
"cryptography": {
"version": "1.8.1"
},
"idna": {
"version": "2.6"
},
"implementation": {
"name": "CPython",
"version": "3.6.1"
},
"pyOpenSSL": {
"openssl_version": "100020bf",
"version": "17.0.0"
},
"requests": {
"version": "2.18.4"
},
"system_ssl": {
"version": "100020bf"
},
"urllib3": {
"version": "1.22"
},
"using_pyopenssl": true
}