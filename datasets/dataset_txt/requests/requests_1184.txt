swmerko commented on Jan 11, 2016
Hi,
i'm trying to force ssl.PROTOCOL_TLSv1 as written in documentation:
http://docs.python-requests.org/en/latest/user/advanced/#example-specific-ssl-version
from requests.adapters import HTTPAdapter
from requests.packages.urllib3.poolmanager import PoolManager
import ssl

class MyAdapter(HTTPAdapter):
    def init_poolmanager(self, connections, maxsize, block=False):
        self.poolmanager = PoolManager(num_pools=connections,
                                       maxsize=maxsize,
                                       block=block,
                                       ssl_version=ssl.PROTOCOL_TLSv1)

import requests
s = requests.Session()
s.mount('https://', MyAdapter())

requests.get('https://services.mailup.com/')
but this gives me
requests.exceptions.SSLError: [SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:600)
so i tried to patch requests/packages/urllib3/poolmanager.py with:
class PoolManager(RequestMethods):
    proxy = None

    def __init__(self, num_pools=10, headers=None, **connection_pool_kw):
        RequestMethods.__init__(self, headers)
        connection_pool_kw['ssl_version'] = ssl.PROTOCOL_TLSv1
        self.connection_pool_kw = connection_pool_kw
        self.pools = RecentlyUsedContainer(num_pools,
                                           dispose_func=lambda p: p.close())
and i get:
>>> import requests
>>> requests.get('https://services.mailup.com/')
<Response [403]>
Any ideas?
Thanks,
Matteo