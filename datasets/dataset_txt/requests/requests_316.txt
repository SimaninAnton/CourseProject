YannLuo commented on Apr 9, 2018
I run the pytest tests and find requests.api.post receive data whose type is list_iterator, which is inconsistent with its docstring.
Expected Result
modify docstring of requests.api.post to :param data: (optional) Dictionary (will be form-encoded), bytes,list_iterator,or file-like object to send in the body of the :class:Request.
Actual Result
what the docstring shows.
Reproduction Steps
the test case is in requests/tests/test_lowlevel.py::test_chunked_upload, which data is a iter and passed to requests.api.post.
import requests
def test_chunked_upload():
    """can safely send generators"""
    close_server = threading.Event()
    server = Server.basic_response_server(wait_to_close_event=close_server)
    data = iter([b'a', b'b', b'c'])

    with server as (host, port):
        url = 'http://{0}:{1}/'.format(host, port)
        r = requests.post(url, data=data, stream=True)
        close_server.set()  # release server block

    assert r.status_code == 200
    assert r.request.headers['Transfer-Encoding'] == 'chunked'
System Information
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": "2.2.2"
  },
  "idna": {
    "version": "2.6"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.5"
  },
  "platform": {
    "release": "17.5.0",
    "system": "Darwin"
  },
  "pyOpenSSL": {
    "openssl_version": "1010008f",
    "version": "17.5.0"
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": "100020ef"
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": true
}