dmfigol commented on Dec 4, 2017 â€¢
edited
requests.Session does not honor Set-Cookie header
Expected Result
The cookie should be set for the session.
Actual Result
Cookie is not set.
Reproduction Steps
session = requests.Session()
r = session.get(AUTH_URL, auth=(USERNAME,PASSWORD), verify=False)
print(r.status_code)
print(r.headers)
print(r.content)
print(session.cookies, r.cookies)
r = session.get(GROUP_URL, verify=False)
print(r.content)
print(r.status_code)
 
########## OUTPUT #########
200
{'Date': 'Mon, 04 Dec 2017 00:30:40 GMT', 'Content-Type': 'application/json', 'Content-Length': '7', 'Connection': 'keep-alive', 'Set-Cookie': 'X-JWT-ACCESS-TOKEN=<long-token>;Version=-1;Comment=;Domain=;Path=/;Secure', 'X-Kong-Upstream-Latency': '200', 'X-Kong-Proxy-Latency': '31', 'Via': 'kong/0.9.7'}
b'success'
<RequestsCookieJar[]> <RequestsCookieJar[]> ##### << here, cookies are NOT set
b'{"message":"Unauthorized"}\n'
401
Additional Information
I see a bug in API: 'Content-Type' for the response is 'application/json', but the response itself is not a valid JSON (b'success'). I am going to contact API developers to fix this. I am not 100% sure it is related to my problem, but I thought you should know.
System Information
$ python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.6"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.3"
  },
  "platform": {
    "release": "7",
    "system": "Windows"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": "100020bf"
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": false
}