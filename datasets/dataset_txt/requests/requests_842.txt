arao-nnl commented on Dec 3, 2016 â€¢
edited
Hi,
Requests ver: 2.11.1
I'm using a session object (s) to make a POST to a specific URL:
r=s.send(prepared)
I expect this to return 302, which is happening.
I set s.max_redirects=0 because I don't want Requests to automatically visit the new URL.
So, I promptly receive a TooManyRedirects exception, which is good.
However, in the exception handler, I'm unable to get hold of the header 'Location'.
The response object itself is empty.
I debugged it and saw that the Location header was captured correctly. But, when the exception is thrown, it's all gone.
(Pdb) n
/Library/Python/2.7/site-packages/requests/adapters.py(275)build_response()
-> return response
(Pdb) response
<Response [302]>
(Pdb) response.dict
{'cookies': <RequestsCookieJar[]>, '_content': False, 'headers': {'Date': 'Fri, 02 Dec 2016 22:27:44 GMT', 'Content-Length': '0', 'Location': 'http://XXX:8080/openam?goto=https:YYY', 'Server': 'Apache-Coyote/1.1'}, 'url': u'https://XXX:8443/proxyplus/nnl/reg', 'status_code': 302, '_content_consumed': False, 'encoding': None, 'request': <PreparedRequest [POST]>, 'connection': <requests.adapters.HTTPAdapter object at 0x1053ae1d0>, 'elapsed': datetime.timedelta(0), 'raw': <requests.packages.urllib3.response.HTTPResponse object at 0x1055e3550>, 'reason': 'Found', 'history': []}
As you can see, 'Location' is found at this stage in 'response', but when the exception is thrown, response becomes empty.
Thanks!