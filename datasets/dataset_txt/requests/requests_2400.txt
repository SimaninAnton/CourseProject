Pewpewarrows commented on Aug 13, 2012
On https://github.com/kennethreitz/requests/blob/develop/requests/models.py#L556
if proxy and not any(map(_p.netloc.endswith, no_proxy)):
I don't believe _p.netloc.endswith is the correct way to check if the hostname is in the $no_proxy ENV variable (or proxies dict param). If the URL passed to requests contains a port, then netloc will look like 127.0.0.1:8000, which will incorrectly fail to exempt 127.0.0.1 from the proxy.
I'd submit a pull request, but the test suite doesn't play nicely with the proxy I'm behind to begin with. It should be as simple as replacing:
_p.netloc.endswith
with:
_p.netloc.split(':')[0].endswith
But I don't know if you want to account for more complex scenarios.