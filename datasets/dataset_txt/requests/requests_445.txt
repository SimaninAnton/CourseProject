miili commented on Nov 22, 2017 â€¢
edited
Loosing credentials over redirect
https://e4ftl01.cr.usgs.gov/SRTM/SRTMGL3.003/2000.02.11/N01E041.SRTMGL3.hgt.zip
Cannot send credentials to the website.
Actual Result
401 - Unauthorized ðŸ˜ 
Reproduction Steps
import requests
from requests.auth import HTTPDigestAuth

cred = ('usr', 'pwd')
s = requests.Session()
s.auth = HTTPDigestAuth(*cred)

r = s.get('https://e4ftl01.cr.usgs.gov/SRTM/SRTMGL3.003/2000.02.11/N01E041.SRTMGL3.hgt.zip')
>>> <Response 401>
print(r.headers)
>>> {'Server': 'nginx/1.10.2', 'Date': 'Wed, 22 Nov 2017 13:38:23 GMT', 'Content-Type': 'text/html; charset=utf-8', 'Transfer-Encoding': 'chunked', 'Connection': 'keep-alive', 'X-Frame-Options': 'SAMEORIGIN', 'X-XSS-Protection': '1; mode=block', 'X-Content-Type-Options': 'nosniff', 'WWW-Authenticate': 'Basic realm="Please enter your Earthdata Login credentials. If you do not have a Earthdata Login, create one at https://urs.earthdata.nasa.gov//users/new"', 'Cache-Control': 'no-cache', 'X-Request-Id': 'a40e5c15-2072-4ac2-832d-293db65a87d2', 'X-Runtime': '0.040991', 'Strict-Transport-Security': 'max-age=31536000'}
Solution
import requests
from requests.auth import HTTPDigestAuth

cred = ('usr', 'pwd')
s = requests.Session()
s.auth = HTTPDigestAuth(*cred)

r = s.get('https://e4ftl01.cr.usgs.gov/SRTM/SRTMGL3.003/2000.02.11/N01E041.SRTMGL3.hgt.zip')
r = s.get(r.url, stream=True)

with open('/tmp/file', 'wb') as f:
    for d in r.iter_content():
        f.write(d)
System Information
$ python3 -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.6"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.6.3"
  },
  "platform": {
    "release": "4.12.0-1-amd64",
    "system": "Linux"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": "1010007f"
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": false
}