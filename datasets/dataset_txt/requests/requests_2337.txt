hartator commented on Oct 30, 2012
Hey to all, and thank you for great library!
I might have found an issue with the way of requests handle file POST upload when they are sent with additional params which aren't files. It adds an extra Content-Type: text/plain to fields that aren't a file. (according to the W3c and from sniffing my own browsers to be sure)
For example, when I run this :
requests.post('localhost',files={'file1.txt' : open('file1.txt','rb')},data={'submit-name':'Larry'})
or this (I don't really which one to prefer I guess data over params) :
requests.post('localhost',files={'file1.txt' : open('file1.txt','rb')},params={'submit-name':'Larry'}))
requests send this :
   Content-Type: multipart/form-data; boundary=AaB03x

   --AaB03x
   Content-Disposition: form-data; name="submit-name"
   Content-Type: text/plain

   Larry
   --AaB03x
   Content-Disposition: form-data; name="files"; filename="file1.txt"
   Content-Type: text/plain

   ... contents of file1.txt ...
   --AaB03x--
when it should have sent this :
   Content-Type: multipart/form-data; boundary=AaB03x

   --AaB03x
   Content-Disposition: form-data; name="submit-name"

   Larry
   --AaB03x
   Content-Disposition: form-data; name="files"; filename="file1.txt"
   Content-Type: text/plain

   ... contents of file1.txt ...
   --AaB03x--
I think the issue is more urllib3 related than requests related and I've opened an issue here (urllib3/urllib3#111) but maybe I am wrong or maybe you guys would want to know!