Bleno commented on Sep 10, 2014
Hello friends.
I spent a few days trying to upload files using the requests, but had issues with the version 2.4.0 and python version 3.2.2.
I have a web application that receives a file via a html form, this application sends the received file to a web service, but when the file name contains Latin characters, for example: "ç, ã, á, ú" web service can not receive the file name that is not given a cgi.FieldStorage.
After several attempts trying to encode utf-8 which is already the default string sent did not succeed. I managed to solve the problem only when I made a downgrade to version 1.2.3 of requests, so it worked perfectly. Does anyone know what might be happening to most current versions of requests? An important detail: must do everything in memory, then pass the file name and bytes of it.
I did the following test and it still fails:
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Test upload file
Pyramid-based application

namefile = self.post['filename_0'].filename #str
input_file = self.post['filename_0'].file #bytes
input_file.seek(0) #cursor position 0
binary_content = input_file.read() #read bytes file

r = requests.post(url = "http://webservide.net", 
                         files = {'file': (filename, content)}
                          )
Response(r.text)
"""
import requests

f = open("Atenção 1ª.txt", "rb")

filename = f.name

print(filename)

content = f.read()

#print(content)


r = requests.post(url = "http://webservice.net", 
                         files = {'file': (filename, content)}
                          )

print(r.text)
This even works with version 1.2.3
with latest versions like 2.3.2 and 2.4.0 code does not work.
It will be a bug in the file upload?