krey commented on Apr 29, 2015
The code below prints <PreparedRequest [GET]>
This isn't a huge issue (as I'm using Version 2), just kinda weird that POST is flipped to GET
import pickle
import requests
from lxml import html
from urllib.parse import urljoin

session = requests.Session()

form_url = "http://www.transtats.bts.gov/Data_Elements.aspx"

get_request = requests.Request("GET", form_url)
get_response = session.send(get_request.prepare())

page_html = html.fromstring(get_response.content)

form = page_html.xpath("id('form1')")[0]
action_url = urljoin(form_url, form.xpath("@action")[0])
hidden_inputs = form.xpath("//input[@type='hidden']")
extra_data = dict([(hidden.xpath("@name")[0],hidden.xpath("@value")[0]) for hidden in hidden_inputs ])

data = {"CarrierList" : "VX", "AirportList" : "All", "Submit": "Submit"}
data.update(extra_data)
post_request = requests.Request("POST", action_url, data=data)

# Version 1
post_response = session.send(post_request.prepare())

# Version 2
#post_response = session.send(session.prepare_request(post_request))

print(post_response.request)
(I'm using 2.6.2 on Arch)