Member
Lukasa commented on Jan 20, 2014
We use a PoolManager to provide us with connection pools from urllib3. However, we don't actually run our requests through it: instead we get a suitable ConnectionPool and then use urlopen on that instead.
This can lead to bugs when using threads and hitting a large number of hosts from one Session object. Each host creates a new ConnectionPool in the PoolManager: if too many are created, the least recently used one is evicted.
If that eviction happens in between us getting hold of the ConnectionPool and us actually trying to send a request, we can try to send on a closed connection pool. That's pretty lame. You can see the discussion on IRC that led to this issue here.
We can either try to make that section thread safe, or try to reconnect when we hit closed pool errors. Thoughts?
üëç 1