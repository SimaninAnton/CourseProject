mattbennett commented on Sep 5, 2017
If you have proxy bypass settings, requests tries to resolve the hostname before stripping credentials from the URL.
It looks like this happens because the proxy bypass logic is called before urldefragauth strips the credentials from the URL.
Expected Result
Should not try to resolve an invalid hostname.
Actual Result
DNS resolution for user:pass@host is made:
Reproduction Steps
On OS X with proxy bypass hosts configured:
import requests
requests.get('http://user:pass@localhost')
System Information
$ python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.6"
  },
  "implementation": {
    "name": "CPython",
    "version": "2.7.10"
  },
  "platform": {
    "release": "15.6.0",
    "system": "Darwin"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.18.4"
  },
  "system_ssl": {
    "version": "100020cf"
  },
  "urllib3": {
    "version": "1.22"
  },
  "using_pyopenssl": false
}