jichifly commented on Nov 3, 2014
Is it possible to add an option to disable decoding str URL to unicode in requests.get?
I am using Python 2.7.8. After a recent update to the requests 2.4.3, I find I am not able to pass SHIFT-JIS str/bytes URL to requests.get.
I am using requests to access some Japanese websites, which require raw SHIFT-JIS encoding string as URL.
But requests.get will always decode my SHIFT-JIS str URL to UTF8 in the beginning of models.py::prepare_url, which will raise decode error. But if I pass UTF8 URL, I am not able to get correct response from those Japanese websites.
If I restore the old version code in models.py::prepare_url as follows, it will work for me like before. I am wondering is it possible to add an option to disable modifying the URL passed to requests?
    # if isinstance(url, bytes):
    #     url = url.decode('utf8')
    # else:
    #     url = unicode(url) if is_py2 else str(url)
    try:
        url = unicode(url)
    except NameError:
        # We're on Python 3.
        url = str(url)
    except UnicodeDecodeError:
        pass