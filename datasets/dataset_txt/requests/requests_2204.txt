Member
Lukasa commented on Feb 14, 2013
After updating master to f73bda0, I find that some requests raise a CookieConflictError. Specifically, any page that sets a cookie on a 302 and then redirects to a page that sets the same cookie raises a CookieConflictError.
Steps To Reproduce:
Update Requests to the version shown above.
Make a request to http://www.google.com/ from anywhere outside the US.
Expected Behaviour:
Requests should return a 200 OK with the 302 in the history.
Actual Behaviour:
>>> import requests
>>> r = requests.get('http://www.google.com/')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "requests/api.py", line 55, in get
    return request('get', url, **kwargs)
  File "requests/api.py", line 44, in request
    return session.request(method=method, url=url, **kwargs)
  File "requests/sessions.py", line 312, in request
    resp = self.send(prep, **send_kwargs)
  File "requests/sessions.py", line 426, in send
    history = [resp for resp in gen] if allow_redirects else []
  File "requests/sessions.py", line 163, in resolve_redirects
    resp.cookies.update(cookiejar)
  File "venv/lib/python2.7/_abcoll.py", line 494, in update
    self[key] = other[key]
  File "requests/cookies.py", line 246, in __getitem__
    return self._find_no_duplicates(name)
  File "requests/cookies.py", line 285, in _find_no_duplicates
    raise CookieConflictError('There are multiple cookies with name, %r' % (name))
requests.cookies.CookieConflictError: There are multiple cookies with name, 'NID'
This is very clearly related to the changes made in #1180.