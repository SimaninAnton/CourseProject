djt commented on Jul 27, 2012
Not 100% sure if there is a wider use case for this, but working with the tumblr API (and I believe others, will investigate further soon) submitting a post request with an attached file, as well as other data, requires that the data dict be included in the signature.
The following code does not sign the data dict at all as it removes it from the request.
if r.files:
    # Omit body data in the signing and since it will always
    # be empty (cant add paras to body if multipart) and we wish
    # to preserve body.
    r.headers['Content-Type'] = 'multipart/form-encoded'
    r.url, r.headers, _ = self.client.sign(
        unicode(r.full_url), unicode(r.method), None, r.headers)
I can confirm that if I bypass the check for files, the signature will include the data dict (but not the attached files), and produce the needed signed request.
Is Tumblr out of spec for this, or could it be that the check for files is not needed?