theyoprst commented on Mar 2, 2017
Consider this piece of code:
retries = Retry(total=3)
session = requests.Session()
session.mount('http://', HTTPAdapter(max_retries=retries))
with open('big_file.txt', 'rb') as f:
    session.put(url, data=f)
It has a bug.
When network error occurred during transmission of the file, the corresponding file handle points to some position inside the file. So the next retry performs new HTTP connection which uploads the rest of the file. Thankfully, in this case, Content-Length doesn't change, so the server waits for the rest of data and then disconnects after some timeout.
Here is the script which demonstrates this bug. And here is it's output.
So retries are almost useless for such uploads (they are useful in case of connection problems, though).
Now I can only think of external retrying by manual reopening / re-seeking of the file.
Is there any way to make requests to retry it 'right'?
Should this behavior be fixed in requests?