elasti-georgeg commented on Dec 29, 2016 â€¢
edited
our rails server send status_code 204 for some logout requests (a delete with some cookies), and hence the message has no body
however in a code I catch the following exception:
/usr/local/lib/python2.7/dist-packages/requests/api.pyc in request(method, url, **kwargs)
54 # cases, and look like a memory leak in others.
55 with sessions.Session() as session:
---> 56 return session.request(method=method, url=url, **kwargs)
57
58
/usr/local/lib/python2.7/dist-packages/requests/sessions.pyc in request(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)
486 }
487 send_kwargs.update(settings)
--> 488 resp = self.send(prep, **send_kwargs)
489
490 return resp
/usr/local/lib/python2.7/dist-packages/requests/sessions.pyc in send(self, request, **kwargs)
639
640 if not stream:
--> 641 r.content
642
643 return r
/usr/local/lib/python2.7/dist-packages/requests/models.pyc in content(self)
779 self._content = None
780 else:
--> 781 self._content = bytes().join(self.iter_content(CONTENT_CHUNK_SIZE)) or bytes()
782
783 self._content_consumed = True
/usr/local/lib/python2.7/dist-packages/requests/models.pyc in generate()
704 yield chunk
705 except ProtocolError as e:
--> 706 raise ChunkedEncodingError(e)
707 except DecodeError as e:
708 raise ContentDecodingError(e)
The problem is here: https://github.com/kennethreitz/requests/blob/master/requests/models.py#L778
for some reason the status code checks itself agains 0, and raw requests checks agains None
while raw request does contain all the headers it has no body and thus an iterator fails to iterate on an empty chunk.