adibalcan commented on Nov 20, 2015
    size = 0
    start = time.time()
    for chunk in r.iter_content(1024):
        if time.time() - start > max_time:
            r.reason = 'timeout riched'
            raise ValueError(r.reason)
        size += len(chunk)
        if size > max_size:
            r.reason = 'response too large'
            raise ValueError(r.reason)