j-christ commented on Nov 18, 2016
I noticed the following bug when running requests under jython 2.7 where I had not yet installed simplejson:
In requests/models.py, the method PreparedRequest.prepare_body has the following code:
        if not data and json is not None:
            # urllib3 requires a bytes-like body. Python 2's json.dumps
            # provides this natively, but Python 3 gives a Unicode string.
            content_type = 'application/json'
            body = complexjson.dumps(json)
            if not isinstance(body, bytes):
                body = body.encode('utf-8')
json in this case, is defined from the .compat file:
try:
    import simplejson as json
except (ImportError, SyntaxError):
    # simplejson does not support Python 3.2, it throws a SyntaxError
    # because of u'...' Unicode literals.
    import json
If simplejson is not installed under jython, the code in models.py throws an exception because dumps is not defined in the json module.