venkat2111987 commented on Nov 27, 2016
Hi,
We are developing a python application using tornado framework. The application consumes a REST end point exposed by splunk system to get some metrics data. A scheduled background process runs and populates our application local data-store. While tornado serves data to third party using the local data-store.
We are using Requests==2.9.1 to communicate with Splunk
Code snippet using which we are communicating to Splunk:
                  try:
                        resp = requests.get(splunkapi,params = params, verify = False, headers = header )
                        if resp.status_code == 200 and (resp.content not in ['""','"None"']) :
                            results = json.loads(resp.json())
                            with open("outfile.json" , 'w') as outfile:
                                json.dump(results, outfile,indent=4)
                        else:
                            with open("outfile.json" , 'w') as outfile:
                                json.dump(dict(), outfile,indent=4)
                  except Exception,e:
                        with open("outfile.json" as outfile:
                            json.dump(dict(), outfile,indent=4)
CLOSE_WAIT Issue:
Step 1: I bring up Tornado Application.
Step 2: I bring up splunk system.
Everything works fine
Step 3: For some reason, the sys admins have to reboot the machine where tornado application is running.
Lot of connections in CLOSE_WAIT status at splunk side.
Step 4: Restart Splunk.
Everything is cleaned up. The system continues to run smoothly.
Step 5: Reboot the system where tornado application is running.
Again same issue. Lot of CLOSE_WAIT connections at splunk side.
Are the CLOSE_WAIT connections a result of "Requests" not communicating properly with splunk?