terrycojones commented on Jun 27, 2012
Here's a Python 2.6 Requests 0.13.1 traceback. Looks like the call to netloc.encode('idna').decode('utf-8') needs a try/except.
File "/srv/import-service/lib/python2.6/site-packages/requests/api.py", line 76, in head
    return request('head', url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/safe_mode.py", line 37, in wrapped
    return function(method, url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/api.py", line 42, in request
    return s.request(method=method, url=url, **kwargs)
  File "/srv/import-service/lib/python2.6/site-packages/requests/sessions.py", line 230, in request
    r.send(prefetch=prefetch)
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 618, in send
    self._build_response(r)
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 305, in _build_response
    request.send()
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 474, in send
    url = self.full_url
  File "/srv/import-service/lib/python2.6/site-packages/requests/models.py", line 388, in full_url
    netloc = netloc.encode('idna').decode('utf-8')
  File "/srv/import-service/lib/python2.6/encodings/idna.py", line 164, in encode
    result.append(ToASCII(label))
  File "/srv/import-service/lib/python2.6/encodings/idna.py", line 73, in ToASCII
    raise UnicodeError("label empty or too long")
UnicodeError: label empty or too long