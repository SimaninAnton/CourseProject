mgdelmonte commented on May 16, 2016
Using v2.10.0 (but tested and get same behavior with 2.9.1), if we get a 302 redirect with a header like this (note the missing trailing slash after the domain):
Location: http://captrust.netxinvestor.com?custId=....
AND we're using a proxy (proxy in question is tinyproxy, but tested with other proxies and get same behavior)
AND allow_redirects=True
the proxy will fail with "cannot connect" because the domain in the Location url is improperly parsed.
Firefox and Chrome both properly handle the redirect. To be honest I haven't checked whether the Location URL does or does not violate the spec, but if the browsers handle it and it appears to be unambiguous I'd vote for requests handling it also. Seems like an easy patch, though I must also confess that I've stepped through the code and can't find where to handle it.
Oddly, if that exact URL is passed to requests as a GET, even via a proxy, it works fine -- so my guess is that it happens somewhere in the SessionRedirectMixin object.
Workaround right now is to request with allow_redirects=False and handle the redirect manually.