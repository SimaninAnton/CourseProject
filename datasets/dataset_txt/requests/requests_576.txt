joshmgrant commented on Jul 5, 2017 â€¢
edited
I'm running into an issue where calling .json() on a response with empty content is resulting in JSON errors.
Expected Result
Calling response.json() results in creating some object that can be used appropriately by other functions.
Actual Result
Calling response.json() results in a KeyError.
Reproduction Steps
session = requests.Session()
response = self.session.delete(
            "{}{}".format(self.url, "api/delete_entity/123"), 
            data=json.dumps(valid_data),
            headers=self.headers
        )
return response.json()
The response above looks like this:
response = {Response} <Response [204]>
 _content = {bytes} b''
 _content_consumed = {bool} True
 apparent_encoding = {NoneType} None
 connection = {HTTPAdapter} <requests.adapters.HTTPAdapter object at 0x104b71eb8>
 content = {bytes} b''
 cookies = {RequestsCookieJar} <RequestsCookieJar[<Cookie sessionid=XXX for 10.8.8.8/>]>
 elapsed = {timedelta} 0:00:00.080925
 encoding = {NoneType} None
 headers = {CaseInsensitiveDict} {'Content-Length': '0', 'Vary': 'Accept, Cookie', 'Allow': 'GET, PUT, PATCH, DELETE, HEAD, OPTIONS', 'Server': 'nginx/1.4.6 (Ubuntu)', 'Connection': 'keep-alive', 'Set-Cookie': 'sessionid=XXX; expires=Wed, 05-Jul-2017 02:54:47 
 history = {list} <class 'list'>: []
 is_permanent_redirect = {bool} False
 is_redirect = {bool} False
 links = {dict} {}
 ok = {bool} True
 raw = {HTTPResponse} <requests.packages.urllib3.response.HTTPResponse object at 0x104b632b0>
 reason = {str} 'No Content'
 request = {PreparedRequest} <PreparedRequest [DELETE]>
 status_code = {int} 204
 text = {str} ''
 url = {str} 'http://10.8.8.8:8888/api/delete_entity/123'
System Information
OS: MacOS Sierra 10.12.5
Python: 3.4.3 and Python 3.6.1
Requests: 2.18.1