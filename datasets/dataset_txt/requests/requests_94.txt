Contributor
hroncok commented on Apr 8, 2019
The tests are failing with pytest 4. The reason is https://docs.pytest.org/en/latest/deprecations.html#marks-in-pytest-mark-parametrize
Run tox -re py37 to reproduce.
Expected Result
Tests collect and pass.
Actual Result
Tests fail to collect:
platform linux -- Python 3.7.3, pytest-4.4.0, py-1.8.0, pluggy-0.9.0
...
ERROR collecting tests/test_utils.py 
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/hooks.py:289: in __call__
    return self._hookexec(self, self.get_hookimpls(), kwargs)
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/manager.py:68: in _hookexec
    return self._inner_hookexec(hook, methods, kwargs)
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/manager.py:62: in <lambda>
    firstresult=hook.spec.opts.get("firstresult") if hook.spec else False,
.eggs/pytest-4.4.0-py3.7.egg/_pytest/python.py:238: in pytest_pycollect_makeitem
    res = list(collector._genfunctions(name, obj))
.eggs/pytest-4.4.0-py3.7.egg/_pytest/python.py:414: in _genfunctions
    self.ihook.pytest_generate_tests(metafunc=metafunc)
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/hooks.py:289: in __call__
    return self._hookexec(self, self.get_hookimpls(), kwargs)
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/manager.py:68: in _hookexec
    return self._inner_hookexec(hook, methods, kwargs)
.eggs/pluggy-0.9.0-py3.7.egg/pluggy/manager.py:62: in <lambda>
    firstresult=hook.spec.opts.get("firstresult") if hook.spec else False,
.eggs/pytest-4.4.0-py3.7.egg/_pytest/python.py:141: in pytest_generate_tests
    metafunc.parametrize(*marker.args, **marker.kwargs)
.eggs/pytest-4.4.0-py3.7.egg/_pytest/python.py:1006: in parametrize
    function_definition=self.definition,
.eggs/pytest-4.4.0-py3.7.egg/_pytest/mark/structures.py:113: in _for_parametrize
    if len(param.values) != len(argnames):
E   TypeError: object of type 'MarkDecorator' has no len()
Reproduction Steps
$ tox -re py37
System Information
$ .tox/py37/bin/python -m requests.help
{
  "chardet": {
    "version": "3.0.4"
  },
  "cryptography": {
    "version": ""
  },
  "idna": {
    "version": "2.8"
  },
  "implementation": {
    "name": "CPython",
    "version": "3.7.3"
  },
  "platform": {
    "release": "5.0.5-300.fc30.x86_64",
    "system": "Linux"
  },
  "pyOpenSSL": {
    "openssl_version": "",
    "version": null
  },
  "requests": {
    "version": "2.21.0"
  },
  "system_ssl": {
    "version": "1010102f"
  },
  "urllib3": {
    "version": "1.24.1"
  },
  "using_pyopenssl": false
}