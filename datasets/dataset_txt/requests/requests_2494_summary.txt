new implementation for safe_mode?