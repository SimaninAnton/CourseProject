ghost commented on May 27, 2012
I was trying to use FB Graph API and notice a little problem.
Consider the following example:
destination = 'https://graph.facebook.com/me/feed/'
info = {'access_token': '1234567890', 'message': 'TEST', 'privacy': {'friends': 'NO_FRIENDS', 'value': 'CUSTOM'}}
requests.post(destination, data=info)
The above example will be rejected by FB Api (error400).
At first, I thought it was a content-type problem, because of the default application/x-www-form-urlencoded
that requests set as content-type when post data is not a string.
So, I just change the above example to force content-type header to be None:
...
headers = {'content-type':  None}
requests.post(destination, data=info, headers=headers)
But, since I'm not making info a string, requests keep trying to send a content-type=application/x-www-form-urlencoded
Recently, I've tried with success to mix urllib with requests and discover that
although I can't force a content-type header to be None (is this another issue?),
the problem with FB rejecting my Post is related with a wrong urlencoding of post data.
This is the example version which actually is working (and I'm using in my code):
import urllib
info = urllib.urlencode(info) 

requests.post(destination, data=info, headers=headers)  # profit
urllib.urlencode transform info into
'access_token=1234567890&message=TEST&privacy=%7B%27friends%27%3A+%27NO_FRIENDS%27%2C+%27value%27%3A+%27CUSTOM%27%7D'
and this string is correctly accepted as a post request by FB.