hopefulp commented on Nov 8, 2018
Description
two test errors of developing version in centOS: one is sklearn/manifold/tests/test_t_sne.py
and the other is sklearn/semi_supervised/tests/test_label_propagation.py
Steps/Code to Reproduce
Expected Results
No error (failure)
Actual Results
___________________ test_preserve_trustworthiness_approximately ____________________
def test_preserve_trustworthiness_approximately():
    # Nearest neighbors should be preserved approximately.
    random_state = check_random_state(0)
    n_components = 2
    methods = ['exact', 'barnes_hut']
    X = random_state.randn(50, n_components).astype(np.float32)
    for init in ('random', 'pca'):
        for method in methods:
            tsne = TSNE(n_components=n_components, init=init, random_state=0,
                        method=method)
            X_embedded = tsne.fit_transform(X)
            t = trustworthiness(X, X_embedded, n_neighbors=1)
            assert_greater(t, 0.85, msg='Trustworthiness={:0.3f} < 0.85 '
                                        'for method={} and '
                                      'init={}'.format(t, method, init))
sklearn/manifold/tests/test_t_sne.py:255:
../../anaconda3/lib/python3.6/unittest/case.py:1220: in assertGreater
self.fail(self._formatMessage(msg, standardMsg))
self = <sklearn.utils._unittest_backport.TestCase testMethod=init>
msg = '0.6487499999999999 not greater than 0.85 : Trustworthiness=0.649 < 0.85 for method=barnes_hut and init=pca'
def fail(self, msg=None):
    """Fail immediately, with the given message."""
  raise self.failureException(msg)
E AssertionError: 0.6487499999999999 not greater than 0.85 : Trustworthiness=0.649 < 0.85 for method=barnes_hut and init=pca
../../anaconda3/lib/python3.6/unittest/case.py:670: AssertionError
_____________________ test_convergence_warning ____________________
def test_convergence_warning():
    # This is a non-regression test for #5774
    X = np.array([[1., 0.], [0., 1.], [1., 2.5]])
    y = np.array([0, 1, -1])
    mdl = label_propagation.LabelSpreading(kernel='rbf', max_iter=1)
    assert_warns(ConvergenceWarning, mdl.fit, X, y)
    assert_equal(mdl.n_iter_, mdl.max_iter)

    mdl = label_propagation.LabelPropagation(kernel='rbf', max_iter=1)
    assert_warns(ConvergenceWarning, mdl.fit, X, y)
    assert_equal(mdl.n_iter_, mdl.max_iter)

    mdl = label_propagation.LabelSpreading(kernel='rbf', max_iter=500)
  assert_no_warnings(mdl.fit, X, y)
sklearn/semi_supervised/tests/test_label_propagation.py:154:
func = <bound method BaseLabelPropagation.fit of LabelSpreading(alpha=0.2, gamma=20, kernel='rbf', max_iter=500, n_jobs=None,
n_neighbors=7, tol=0.001)>
args = (array([[1. , 0. ],
[0. , 1. ],
[1. , 2.5]]), array([ 0, 1, -1])), kw = {}
w = [<warnings.WarningMessage object at 0x2b17ff372f60>]
result = LabelSpreading(alpha=0.2, gamma=20, kernel='rbf', max_iter=500, n_jobs=None,
n_neighbors=7, tol=0.001)
def assert_no_warnings(func, *args, **kw):
    """
    Parameters
    ----------
    func
    *args
    **kw
    """
    # very important to avoid uncontrolled state propagation
    clean_warning_registry()
    with warnings.catch_warnings(record=True) as w:
        warnings.simplefilter('always')

        result = func(*args, **kw)
        if hasattr(np, 'VisibleDeprecationWarning'):
            # Filter out numpy-specific warnings in numpy >= 1.9
            w = [e for e in w
                 if e.category is not np.VisibleDeprecationWarning]

        if len(w) > 0:
            raise AssertionError("Got warnings when calling %s: [%s]"
                                 % (func.__name__,
                                  ', '.join(str(warning) for warning in w)))
E AssertionError: Got warnings when calling fit: [{message : FutureWarning('Conversion of the second argument of issubdtype from int to np.signedinteger is deprecated. In future, it will be treated as np.int64 == np.dtype(int).type.',), category : 'FutureWarning', filename : '/home/joonho/anaconda3/lib/python3.6/site-packages/scipy/sparse/csgraph/_laplacian.py', lineno : 72, line : None}]
sklearn/utils/testing.py:277: AssertionError
Versions
System:
python: 3.6.3 |Anaconda, Inc.| (default, Oct 13 2017, 12:02:49) [GCC 7.2.0]
executable: /home/joonho/anaconda3/bin/python
machine: Linux-3.10.0-862.14.4.el7.x86_64-x86_64-with-centos-7.5.1804-Core
BLAS:
macros: SCIPY_MKL_H=None, HAVE_CBLAS=None
lib_dirs: /opt/intel/composer_xe_2011_sp1.13.367/mkl/lib/intel64
cblas_libs: mkl_rt, pthread
Python deps:
pip: 18.1
setuptools: 39.1.0
sklearn: 0.21.dev0
numpy: 1.14.5
scipy: 0.19.1
Cython: 0.26.1
pandas: 0.23.4