Contributor
webber26232 commented on Sep 4, 2017 â€¢
edited
Description
When fit same data set to RandomForest and ExtraTrees with same n_estimators, ExtraTrees consumed much more memory than RandomForest (about 2 times). This occurs in both regressor and classifier.
Steps/Code to Reproduce
import os, time, gc, psutil

import numpy as np

p = psutil.Process()

def sleep_and_print_mem(title, sleep=3):
    time.sleep(sleep)
    print("\n" + title + " : " +  "%0.2f MB" % (p.memory_info().rss / 1e6)
         + "   " + "=" * 49)

def model_mem_usage(estimator, X, y):
    sleep_and_print_mem("Initial memory")
    estimator = estimator.fit(X, y)
    gc.collect()
    sleep_and_print_mem('%s memory usage' % estimator.__class__.__name__)
    del estimator


X = np.random.normal(size=(20000, 12))
y = np.random.randint(-1, 3, size=(20000, ))

from sklearn.ensemble import RandomForestRegressor, ExtraTreesRegressor
model_mem_usage(RandomForestRegressor(n_estimators=500, criterion='mse', n_jobs=-1), X, y)
model_mem_usage(ExtraTreesRegressor(n_estimators=500, criterion='mse', n_jobs=-1), X, y)
Initial memory : 75.99 MB   =================================================
RandomForestRegressor memory usage : 423.70 MB =================================================

Initial memory : 77.81 MB   =================================================
ExtraTreesRegressor memory usage : 850.57 MB   =================================================
Then I applied the same experiment on DecisiontTree and ExtraTree, which are the base estimators of RandomForest and ExtraTrees, but didn't find any significant different memory usage.
from sklearn.tree import DecisionTreeRegressor, ExtraTreeRegressor
model_mem_usage(DecisionTreeRegressor(criterion='mse'), X, y)
model_mem_usage(ExtraTreeRegressor(criterion='mse'), X, y)
Initial memory : 75.69 MB   =================================================
DecisionTreeRegressor memory usage : 77.90 MB   =================================================

Initial memory : 76.57 MB   =================================================
ExtraTreeRegressor memory usage : 77.50 MB   =================================================
Not sure why this happened.
Expected Results
Actual Results
Versions
Windows-10-10.0.15063-SP0
Python 3.5.3 | packaged by conda-forge | (default, May 12 2017, 16:16:49) [MSC v.1900 64 bit (AMD64)]
NumPy 1.12.1
SciPy 0.19.0
Scikit-Learn 0.18.1
Same thing happens in my Ubuntu 14.04