LeiTong02 commented on May 3, 2018
Description
I am trying to build the sklearn.tree subpackage, which includes some Cython code.
The file setup.py contains distutils configuration with code such as config.add_extension("_tree", sources=["_tree.pyx"],...) So I expect that sources (this variable flops through a long stack of functions listed below) is a list of strings.
However, when trying to build the package, I recieve the output listed below. It implies that the source in functions in the build_src.py, an element of sources, is not a string but a list.
Steps/Code to Reproduce
import os
import numpy
from numpy.distutils.misc_util import Configuration
def configuration(parent_package="", top_path=None):
config = Configuration("tree", parent_package, top_path)
libraries = []
if os.name == 'posix':
libraries.append('m')
config.add_extension("_tree",
sources=["_tree.pyx"],
include_dirs=[numpy.get_include()],
libraries=libraries,
extra_compile_args=["-O3"])
config.add_extension("_splitter",
sources=["_splitter.pyx"],
include_dirs=[numpy.get_include()],
libraries=libraries,
extra_compile_args=["-O3"])
config.add_extension("_criterion",
sources=["_criterion.pyx"],
include_dirs=[numpy.get_include()],
libraries=libraries,
extra_compile_args=["-O3"])
config.add_extension("_utils",
sources=["_utils.pyx"],
include_dirs=[numpy.get_include()],
libraries=libraries,
extra_compile_args=["-O3"])
config.add_subpackage("tests")

return config
if name == "main":
from numpy.distutils.core import setup
setup(**configuration().todict())
Expected Results
Actual Results
non-existing path in '': '_tree.pyx'
non-existing path in '': '_splitter.pyx'
non-existing path in '': '_criterion.pyx'
non-existing path in '': '_utils.pyx'
Appending tree.tests configuration to tree
Ignoring attempt to set 'name' (from 'tree' to 'tree.tests')
running build
running config_cc
unifing config_cc, config, build_clib, build_ext, build commands --compiler options
running config_fc
unifing config_fc, config, build_clib, build_ext, build commands --fcompiler options
running build_src
build_src
building extension "tree._tree" sources
Warning: Assuming default configuration (tests/{setup_tests,setup}.py was not found)Traceback (most recent call last):
File "setup.py", line 39, in
setup(**configuration().todict())
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/core.py", line 169, in setup
return old_setup(**new_attr)
File "/home/lt228/anaconda3/lib/python3.6/distutils/core.py", line 148, in setup
dist.run_commands()
File "/home/lt228/anaconda3/lib/python3.6/distutils/dist.py", line 955, in run_commands
self.run_command(cmd)
File "/home/lt228/anaconda3/lib/python3.6/distutils/dist.py", line 974, in run_command
cmd_obj.run()
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build.py", line 47, in run
old_build.run(self)
File "/home/lt228/anaconda3/lib/python3.6/distutils/command/build.py", line 135, in run
self.run_command(cmd_name)
File "/home/lt228/anaconda3/lib/python3.6/distutils/cmd.py", line 313, in run_command
self.distribution.run_command(command)
File "/home/lt228/anaconda3/lib/python3.6/distutils/dist.py", line 974, in run_command
cmd_obj.run()
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build_src.py", line 148, in run
self.build_sources()
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build_src.py", line 165, in build_sources
self.build_extension_sources(ext)
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build_src.py", line 330, in build_extension_sources
sources, py_files = self.filter_py_files(sources)
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build_src.py", line 390, in filter_py_files
return self.filter_files(sources, ['.py'])
File "/home/lt228/anaconda3/lib/python3.6/site-packages/numpy/distutils/command/build_src.py", line 399, in filter_files
(base, ext) = os.path.splitext(source)
File "/home/lt228/anaconda3/lib/python3.6/posixpath.py", line 120, in splitext
p = os.fspath(p)
TypeError: expected str, bytes or os.PathLike object, not list
Versions
Linux-4.4.0-121-generic-x86_64-with-debian-stretch-sid
Python 3.6.4 |Anaconda, Inc.| (default, Jan 16 2018, 18:10:19)
[GCC 7.2.0]
NumPy 1.14.3
SciPy 1.0.1
Scikit-Learn 0.19.1