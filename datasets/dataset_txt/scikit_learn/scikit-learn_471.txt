edu-gp commented on Jun 10, 2019 â€¢
edited
Description
OneHotEncoder not remembering it's been fitted when used inside ColumnTransformer. See code to reproduce:
Steps/Code to Reproduce
First, we can check that OneHotEncoder works:
from sklearn.preprocessing import OneHotEncoder
enc = OneHotEncoder(handle_unknown='ignore')
X = [['Male'], ['Female'], ['Female']]
enc.fit_transform(X)
enc.get_feature_names()
Output:
array(['x0_Female', 'x0_Male'], dtype=object)
Next, we can see that when we wrap OneHotEncoder inside a ColumnTransformer, it doesn't remember it's been fitted:
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import OneHotEncoder
import pandas as pd

# Create sample data
X = [['Male'], ['Female'], ['Female']]
X = pd.DataFrame(X, columns=['gender'])

# Build a simple trasnformer pipeline
cat_transformers = Pipeline(steps=[
            ('onehot', OneHotEncoder(handle_unknown='ignore'))])
cat_features = ['gender']
data_process = ColumnTransformer([('categorical', cat_transformers, cat_features)])

# Fit the transformer pipeline
data_process.fit(X)

# Get the feature names for the OneHotEncoder
data_process.transformers[0][1].steps[0][1].get_feature_names()
output:
---------------------------------------------------------------------------
NotFittedError                            Traceback (most recent call last)
<ipython-input-3-bdcf2848952a> in <module>
     18 
     19 # Get the feature names for the OneHotEncoder
---> 20 data_process.transformers[0][1].steps[0][1].get_feature_names()

/anaconda3/envs/myproject/lib/python3.6/site-packages/sklearn/preprocessing/_encoders.py in get_feature_names(self, input_features)
    835 
    836         """
--> 837         check_is_fitted(self, 'categories_')
    838         cats = self.categories_
    839         if input_features is None:

/anaconda3/envs/myproject/lib/python3.6/site-packages/sklearn/utils/validation.py in check_is_fitted(estimator, attributes, msg, all_or_any)
    912 
    913     if not all_or_any([hasattr(estimator, attr) for attr in attributes]):
--> 914         raise NotFittedError(msg % {'name': type(estimator).__name__})
    915 
    916 

NotFittedError: This OneHotEncoder instance is not fitted yet. Call 'fit' with appropriate arguments before using this method.
Versions
python 3.6.8
sklearn 0.21.2
pandas 0.24.2