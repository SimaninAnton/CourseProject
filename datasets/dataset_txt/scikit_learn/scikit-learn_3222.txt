ivannz commented on Feb 3, 2016
In my line of research I require to be able to fit neighbours.NearestNeighbours on subsamples of the train dataset and query for nearest neighbors on the held out dataset. The caveat is that I require not just the Euclidean distance, but the Mahalanobis distance with the covariance matrix reestimated on each subsample. In order to speed up my experimentation I use joblib.Parallel.
I can successfully fit each NN estimator with empirical covariance estimate on bootstrapped train dataset in parallel and collect all estimated objects in a list. However when trying to call kneighbors(..) with a test dataset in a simple loop over the estimators, I immediately get the following error:
ValueError: Mahalanobis dist: size of V does not match
I get this error unless I set n_jobs=1. I tried both sklearn.externals.joblib and a standalone joblib but to no avail.
The NN estimators are fit on the train/test datasets obtained from a single source dataset without dimensionality changes.
With this report I enclose the frozen list of installed packages, a copy of the traceback and a minimally sufficient example to reproduce the unexpected behavior.
Here is the python greeting string:
Python 2.7.10 (default, Sep 22 2015, 12:25:13) 
[GCC 4.2.1 Compatible Apple LLVM 7.0.0 (clang-700.0.72)] on darwin
mahalanobis_value_error.zip