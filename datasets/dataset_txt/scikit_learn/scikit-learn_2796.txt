fbrundu commented on Aug 31, 2016
Hi all,
I am using model_selection.cross_val_predict() from the last version (from git) but I am receiving an exception.
Description
Using version 0.17.1 I was able to run cross_validation.cross_val_predict() using a Random Forest estimator, with a matrix X and an array y as classification truth.
After upgrading to 0.18.0 the code is no longer working. Unfortunately, I cannot disclose the data and part of the code I'm working on.
Steps/Code to Reproduce
from sklearn.model_selection import cross_val_predict, cross_val_score

pred = cross_val_predict(estimator=RandomForestClassifier(), X=X, y=y)
Expected Results
My expected result is to obtain the prediction in the pred array.
Actual Results
I got the following exception:
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-912e58b4ee71> in <module>()
----> 1 clf.best_gcv._cv_pred()

lib.py in _cv_pred(self)
    625         pred = cross_val_predict(estimator=RandomForestClassifier(),
    626                                  X=X,
--> 627                                  y=y)
    628         proba = cross_val_predict(estimator=RandomForestClassifier(),
    629                                   X=X,

/usr/local/lib/python3.5/site-packages/sklearn/cross_validation.py in cross_val_predict(estimator, X, y, cv, n_jobs, verbose, fit_params, pre_dispatch)
   1285                                                       train, test, verbose,
   1286                                                       fit_params)
-> 1287                             for train, test in cv)
   1288 
   1289     preds = [p for p, _ in preds_blocks]

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in __call__(self, iterable)
    756             # was dispatched. In particular this covers the edge
    757             # case of Parallel used with an exhausted iterator.
--> 758             while self.dispatch_one_batch(iterator):
    759                 self._iterating = True
    760             else:

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in dispatch_one_batch(self, iterator)
    606                 return False
    607             else:
--> 608                 self._dispatch(tasks)
    609                 return True
    610 

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in _dispatch(self, batch)
    569         dispatch_timestamp = time.time()
    570         cb = BatchCompletionCallBack(dispatch_timestamp, len(batch), self)
--> 571         job = self._backend.apply_async(batch, callback=cb)
    572         self._jobs.append(job)
    573 

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/_parallel_backends.py in apply_async(self, func, callback)
    107     def apply_async(self, func, callback=None):
    108         """Schedule a func to be run"""
--> 109         result = ImmediateResult(func)
    110         if callback:
    111             callback(result)

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/_parallel_backends.py in __init__(self, batch)
    320         # Don't delay the application, to avoid keeping the input
    321         # arguments in memory
--> 322         self.results = batch()
    323 
    324     def get(self):

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in __call__(self)
    129 
    130     def __call__(self):
--> 131         return [func(*args, **kwargs) for func, args, kwargs in self.items]
    132 
    133     def __len__(self):

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in <listcomp>(.0)
    129 
    130     def __call__(self):
--> 131         return [func(*args, **kwargs) for func, args, kwargs in self.items]
    132 
    133     def __len__(self):

/usr/local/lib/python3.5/site-packages/sklearn/cross_validation.py in _fit_and_predict(estimator, X, y, train, test, verbose, fit_params)
   1350         estimator.fit(X_train, **fit_params)
   1351     else:
-> 1352         estimator.fit(X_train, y_train, **fit_params)
   1353     preds = estimator.predict(X_test)
   1354     return preds, test

/usr/local/lib/python3.5/site-packages/sklearn/ensemble/forest.py in fit(self, X, y, sample_weight)
    318                     t, self, X, y, sample_weight, i, len(trees),
    319                     verbose=self.verbose, class_weight=self.class_weight)
--> 320                 for i, t in enumerate(trees))
    321 
    322             # Collect newly grown trees

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in __call__(self, iterable)
    756             # was dispatched. In particular this covers the edge
    757             # case of Parallel used with an exhausted iterator.
--> 758             while self.dispatch_one_batch(iterator):
    759                 self._iterating = True
    760             else:

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in dispatch_one_batch(self, iterator)
    606                 return False
    607             else:
--> 608                 self._dispatch(tasks)
    609                 return True
    610 

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in _dispatch(self, batch)
    569         dispatch_timestamp = time.time()
    570         cb = BatchCompletionCallBack(dispatch_timestamp, len(batch), self)
--> 571         job = self._backend.apply_async(batch, callback=cb)
    572         self._jobs.append(job)
    573 

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/_parallel_backends.py in apply_async(self, func, callback)
    107     def apply_async(self, func, callback=None):
    108         """Schedule a func to be run"""
--> 109         result = ImmediateResult(func)
    110         if callback:
    111             callback(result)

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/_parallel_backends.py in __init__(self, batch)
    320         # Don't delay the application, to avoid keeping the input
    321         # arguments in memory
--> 322         self.results = batch()
    323 
    324     def get(self):

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in __call__(self)
    129 
    130     def __call__(self):
--> 131         return [func(*args, **kwargs) for func, args, kwargs in self.items]
    132 
    133     def __len__(self):

/usr/local/lib/python3.5/site-packages/sklearn/externals/joblib/parallel.py in <listcomp>(.0)
    129 
    130     def __call__(self):
--> 131         return [func(*args, **kwargs) for func, args, kwargs in self.items]
    132 
    133     def __len__(self):

/usr/local/lib/python3.5/site-packages/sklearn/ensemble/forest.py in _parallel_build_trees(tree, forest, X, y, sample_weight, tree_idx, n_trees, verbose, class_weight)
    115             curr_sample_weight *= compute_sample_weight('balanced', y, indices)
    116 
--> 117         tree.fit(X, y, sample_weight=curr_sample_weight, check_input=False)
    118     else:
    119         tree.fit(X, y, sample_weight=sample_weight, check_input=False)

/usr/local/lib/python3.5/site-packages/sklearn/tree/tree.py in fit(self, X, y, sample_weight, check_input, X_idx_sorted)
    308             min_weight_leaf = 0.
    309 
--> 310         if self.min_impurity_split < 0.:
    311             raise ValueError("min_impurity_split must be greater than or equal "
    312                              "to 0")

TypeError: unorderable types: NoneType() < float()
Versions
import platform; print(platform.platform())
Darwin-15.6.0-x86_64-i386-64bit

import sys; print("Python", sys.version)
Python 3.5.2 (default, Jul 28 2016, 21:28:00) 
[GCC 4.2.1 Compatible Apple LLVM 7.3.0 (clang-703.0.31)]
import numpy; print("NumPy", numpy.__version__)

import scipy; print("SciPy", scipy.__version__)
SciPy 0.18.0

import sklearn; print("Scikit-Learn", sklearn.__version__)
Scikit-Learn 0.18.dev0