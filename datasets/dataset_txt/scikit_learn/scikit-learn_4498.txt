Member
ogrisel commented on Feb 26, 2014
It seems that we have a memory leak when running MinibatchKMeans on sparse data:
import os, psutil
from sklearn.datasets import fetch_20newsgroups
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import MiniBatchKMeans

def make_text_data(**kwargs):
    twenty = fetch_20newsgroups()
    return TfidfVectorizer(**kwargs).fit_transform(twenty.data)
text_data = make_text_data(min_df=3, max_df=0.5)

p = psutil.Process(os.getpid())

for i in range(5):
    MiniBatchKMeans(n_clusters=100).fit(text_data)
    print(p.get_memory_info().rss / 1e6)
here is the output:
347.856896
441.024512
534.257664
627.48672
720.715776