gui-miotto commented on Nov 15, 2019
Description
Calling the fit_transform of a ColumnTransformer generates a Segmentation fault (core dumped) when X is a CSR or CSC sparse matrix. It seems to work as expected with DOK matrices, though.
Steps/Code to Reproduce
from scipy.sparse import random
from sklearn.compose import ColumnTransformer

def mwe(sparse_format):
    n_cols = 20
    CT = ColumnTransformer([('passthrough', 'passthrough', n_cols * [True])])

    X = random(100, n_cols, density=0.2, format=sparse_format)
    CT.fit_transform(X)

if __name__ == '__main__':
    print('dok')
    for i in range(100):
        mwe('dok')

    print('csc')
    for i in range(100):
        mwe('csc')

    print('csr')
    for i in range(100):
        mwe('csr')

    print('end')
Expected Results
dok
csc
csr
end
Actual Results
dok
csc
Segmentation fault (core dumped)
Versions
Linux-4.16.3-041603-generic-x86_64-with-debian-buster-sid
Python 3.7.3 (default, Mar 27 2019, 22:11:17)
[GCC 7.3.0]
NumPy 1.16.3
SciPy 1.3.0
Scikit-Learn 0.21.3