VolkerH commented on Aug 24, 2012
Dear all,
There appears to be a bug in gmm.py where under certain circumstances (specifically log_likelihood[-1] > max_log_prob never true during the EM iterations) best_params doesn't get assigned but is referenced later on.
I am using version scikit_learn-0.11-py2.7-win32.egg.
Here is an Ipython session that shows what's going on:
In [9]: im
Out[9]:
array([[ 5,  5,  5, ..., 16, 13, 11],
       [ 5,  5,  6, ..., 10, 12, 10],
       [ 5,  5,  6, ..., 10,  7,  6],
       ...,
       [ 6,  7,  6, ...,  5,  6,  7],
       [ 5,  6,  6, ...,  6,  6,  6],
       [ 6,  7,  9, ...,  6,  6,  5]], dtype=uint8)

In [10]: from sklearn.mixture import GMM

In [11]: classif = GMM(n_components=2)

In [12]: classif.fit(im.reshape((im.size, 1)))
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

C:\Documents and Settings\Administrator\My Documents\Dropbox\readstacks_python.p
y in <module>()
----> 1
      2
      3
      4
      5

C:\Python27\lib\site-packages\scikit_learn-0.11-py2.7-win32.egg\sklearn\mixture\
gmm.pyc in fit(self, X, **kwargs)
    519                                    'covars': self.covars_}
    520         if self.n_iter:
--> 521             self.covars_ = best_params['covars']
    522             self.means_ = best_params['means']
    523             self.weights_ = best_params['weights']

UnboundLocalError: local variable 'best_params' referenced before assignment

In [13]:

In [14]: %debug
> c:\python27\lib\site-packages\scikit_learn-0.11-py2.7-win32.egg\sklearn\mixtur
e\gmm.py(521)fit()
    520         if self.n_iter:
--> 521             self.covars_ = best_params['covars']
    522             self.means_ = best_params['means']

ipdb> best_params
*** NameError: name 'best_params' is not defined
ipdb> self.n_iter
100
ipdb> log_likelihood
[-20135.341019560929, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan
, nan, nan, nan, nan, nan, nan, nan]
ipdb>