Contributor
guiniol commented on Mar 16, 2017
Description
as_float_array converts int16 and smaller to float64
in sklearn/utils/validation.py, line 97, we can see:
return X.astype(np.float32 if X.dtype == np.int32 else np.float64)
This means that anything not int32 will be converted to float64. This is a problem for types smaller than int32, especially if they were chosen because an int64 would not fit in memory.
Steps/Code to Reproduce
Example:
import numpy as np
import sklearn.utils.validation

a = np.zeros((3,3), dtype=np.int16)
b = sklearn.utils.validation.as_float_array(a)
np.result_type(b)
Expected Results
dtype('float16')
As I expect people choose smaller int because of memory constraints, this is a problem as the converted data may not fit in memory anymore. I think as_float_type should try to keep as close to the original size as possible.
Actual Results
dtype('float64')
Which mean that an int16 array will take 4 times its size when converted to float, and an int8 8 times its size.
Versions
Linux-4.10.3-1-ck-haswell-x86_64-with-arch
Python 3.6.0 (default, Jan 16 2017, 12:12:55)
[GCC 6.3.1 20170109]
NumPy 1.12.0
SciPy 0.18.1
Scikit-Learn 0.18.1