Bug: premature checks in safe_split