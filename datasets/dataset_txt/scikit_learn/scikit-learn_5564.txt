Member
robertlayton commented on Sep 5, 2011
tl;dr nose doesn't give a package name for .pyx files, so ball_tree.so fails when printing out results of doctests. Recommend moving doctests to specific test module instead.
Long version
When running the tests with from sklearn import test; test(verbose=3), the test run great, but when printing out the results, I get an error on this line in nose/plugins/doctests.py:
 def id(self):
        name = self._dt_test.name
        filename = self._dt_test.filename
        if filename is not None:
            pk = getpackage(filename)
            if not name.startswith(pk):
                name = "%s.%s" % (pk, name)
        return name
If I print pk, filename just above the second if statement, I find out the error happens when dealing with printing out the doctest error for nose/plugins/doctests.py:
None /usr/local/lib/python2.7/dist-packages/scikit_learn-0.9_git-py2.7-linux-i686.egg/sklearn/ball_tree.so
So the error is basically, that ball_tree.so has doctests, but no package name. This is because on line 273 in nose/util.py, there is a line:
if not src_file.endswith('.py') and not ispackage(src_file):
        return None
In other words, if its not a .py file, it won't have a package name. I checked the latest source for nose, and this is still there, so my version of nose is not out of date.
If nobody else is getting these, its probably because these tests fail on my computer, and hence nose needs to print out the details. However showing failed tests is important, so these should probably be moved to a specific test module so that they do print out when they fail.
thoughts?