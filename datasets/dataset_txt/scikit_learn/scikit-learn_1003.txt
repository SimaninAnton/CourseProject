wiltswong commented on Oct 12, 2018
Description
Using multiprocessing.Process(...) and calling LinearRegression.fit(...) in the child process. If skimage.io is also imported, the child process crash. Original code is quite complex, but I narrow it down to reprocess the error with the following code snippet.
Steps/Code to Reproduce
from sklearn import linear_model
import multiprocessing as mp
import numpy as np
import os
import time
# import skimage.io             # uncomment this line and the child process will crash

def worker():
    print("process {}".format(os.getpid()))
    lreg = linear_model.LinearRegression(fit_intercept=False)
    L=100000
    X=np.random.rand(L,49)
    Y=np.random.rand(L, 4)
    for k in range(10):
        print("running the {} iteration".format(k))
        lreg.fit(X, Y)
        print(lreg.coef_.shape)

if __name__=="__main__":
    p = mp.Process(target=worker)
    p.start()
    while True:
        time.sleep(1)
    pass
The code above run with the 10 iterations finished successfully. If the line "import skimage.io" is uncommented, the the child process crash in the first iteration, right at "lreg.fit(X, Y)"
Expected Results
The child process should finish the 10 fits and print lreg.coef_.shape in each iteration.
Actual Results
Child process crash
Versions
Darwin-18.0.0-x86_64-i386-64bit
Python 3.6.5 (default, Mar 29 2018, 15:37:32)
[GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.39.2)]
NumPy 1.14.5
SciPy 1.1.0
Scikit-Learn 0.19.1