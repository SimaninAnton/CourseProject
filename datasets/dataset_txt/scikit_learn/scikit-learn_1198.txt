louisabraham commented on Jul 31, 2018 ‚Ä¢
edited
Description
On some machines, the code below can output a nonzero value.
Steps/Code to Reproduce
import numpy as np
from sklearn.metrics.pairwise import pairwise_distances

np.random.seed(42)

# l = np.array(np.random.rand(9, 10000))
l = np.array(np.random.rand(9, 10000), dtype=np.float32)
m1 = pairwise_distances(l)
m2 = pairwise_distances(l[:4])

# print(m1[0, 1])
# print(m2[0, 1])
print(m2[0, 1] - m1[0, 1])
The bug also exists with the cosine distance but not the cityblock.
Expected Results
0.0
Actual Results
1.1444092e-05
Versions
Darwin-16.7.0-x86_64-i386-64bit
Python 3.6.4 |Anaconda, Inc.| (default, Mar 12 2018, 20:05:31) 
[GCC 4.2.1 Compatible Clang 4.0.1 (tags/RELEASE_401/final)]
NumPy 1.15.0
SciPy 1.1.0
Scikit-Learn 0.19.1
On this config, the bug doesn't exist:
Linux-4.4.0-130-generic-x86_64-with-debian-stretch-sid
Python 3.6.4 |Anaconda custom (64-bit)| (default, Jan 16 2018, 18:10:19) 
[GCC 7.2.0]
NumPy 1.15.0
SciPy 1.1.0
Scikit-Learn 0.19.1
The problem might come from another component.
üëç 3