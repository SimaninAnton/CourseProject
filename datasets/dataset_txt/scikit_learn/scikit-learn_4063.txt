wizeman commented on Jan 20, 2015
While building scikit-learn 0.15.2 with python 2.7.9, I have experienced the following test failure:
FAIL: sklearn.externals.joblib.test.test_disk.test_disk_used
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/nix/store/pq6rm5aj8n0z6ahlgglnjbj7kxby2mh1-python2.7-nose-1.3.4/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/tmp/nix-build-python2.7-scikit-learn-0.15.2.drv-0/scikit-learn-0.15.2/sklearn/externals/joblib/test/test_disk.py", line 40, in test_disk_used
    nose.tools.assert_true(disk_used(cachedir) >= target_size)
AssertionError: False is not true
    'False is not true' = self._formatMessage('False is not true', "%s is not true" % safe_repr(False))
>>  raise self.failureException('False is not true')


----------------------------------------------------------------------
Ran 3496 tests in 150.553s

FAILED (SKIP=18, failures=1)
Looking into the test and at the disk_used() function, I am guessing that the most likely reason for the failure is that the test doesn't take into account if the filesystem is compressing the data.
Since I am using the ZFS filesystem and I have enabled compression by default, it will cause the on-disk size of the file(s) to become smaller than the size of the written data (unless the written data was random).