markcutajar commented on Jun 29, 2018
I am running a job to train models which then saves them in a directory on an API server.
Then, when the API endpoint is called these are loaded using sklearn.externals.joblib, the features used and the prediction returned back the the sender.
However, since upgrading from scikit-learn 0.18.1 to 0.19.1, the API was timing out on loading a 132KB gradient regressor model from the pickle. If an untrained model is just saved and so the size is small (1KB) this is loaded no problem, but when trained there was problems by the API loading it and stalling.
model = joblib.load("/path/to/modelpickle.pkl")  #stalls

f = open("/path/to/modelpickle.pkl", "rb")  #works
model = joblib.load(f)  #stalls
When instead of joblib i attempt the use the standard pickle package, the issue is also present.
When loading the model outside of the flask envirnoment (not in the endpoint logic) everything works well as expected.
Smaller models load no problem (tested just initialized models and the model.fit not run)
Loading large files with a list saved as pkl which were dumped and reloaded using joblib worked with no problems
This only seems to happen with some distributions. As on Ubuntu 14.04.5 LTS this issue couldn't be replicated. However, this version was only run on local and not on a server using Apache.
Packages:
scikit-learn==0.19.1
scipy==1.0.0
Flask-Caching==1.4.0
Flask-Cors==3.0.4
Flask-HTTPAuth==3.2.3
Flask-Migrate==2.1.1
Flask-RESTful==0.3.6
Flask-Script==2.0.6
Flask-SQLAlchemy==2.3.2
Python version: 2.7.5
Distribution and server information:
Operating System linux
Linux Distribution CentOS Linux 7 (Core)
Kernel Version 3.10.0-862.3.2.el7.x86_64
CPU Count 4
System Memory 8,202 MB
under Apache/2.4.6