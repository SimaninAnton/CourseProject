labodyn commented on May 25, 2018
Description
My unittests fail because RandomForestRegressor wont reproduce when n_jobs=-1 even if random_state is set.
Steps/Code to Reproduce
Example:
import numpy as np
from sklearn.ensemble.forest import RandomForestRegressor

np.random.seed(42)
x_train = np.random.rand(10000, 10)
y_train = np.random.rand(10000)
x_test = np.random.rand(10000, 10)

for i in range(10):
    model1 = RandomForestRegressor(random_state=42, n_jobs=-1)
    model2 = RandomForestRegressor(random_state=42, n_jobs=-1)
    model1.fit(x_train, y_train)
    model2.fit(x_train, y_train)
    print(np.abs(model1.predict(x_test) - model2.predict(x_test)).sum())
Expected Results
Prints all zeros. As it does correctly when setting n_jobs=1.
Actual Results
Sometimes zeros, usually small differences, sometimes larges differences.
Versions
Linux-4.13.0-41-generic-x86_64-with-debian-stretch-sid
Python 3.6.3 |Anaconda, Inc.| (default, Nov 20 2017, 20:41:42)
[GCC 7.2.0]
NumPy 1.13.3
SciPy 1.0.0
Scikit-Learn 0.19.1