weibocc commented on Jul 19, 2016 â€¢
edited by lesteve
Description
Steps/Code to Reproduce
Expected Results
Actual Results
Versions
Hi,
I have a problem when using make_scorer with "needs_proba=True".
I think the following code should be added after line 117 (same as that in class _ThresholdScorer):
                if y_type == "binary":
                    y_pred = y_pred[:, 1]
                elif isinstance(y_pred, list):
                    y_pred = np.vstack([p[:, -1] for p in y_pred]).T
Please have a check.
Many thanks.
PS: the error message is as follows:
scores = cross_val_score(classifier, X, y, scoring=scorer, cv=cv)
  File "/usr/local/lib/python2.7/site-packages/sklearn/cross_validation.py", line 1433, in cross_val_score
    for train, test in cv)
  File "/usr/local/lib/python2.7/site-packages/sklearn/externals/joblib/parallel.py", line 800, in __call__
    while self.dispatch_one_batch(iterator):
  File "/usr/local/lib/python2.7/site-packages/sklearn/externals/joblib/parallel.py", line 658, in dispatch_one_batch
    self._dispatch(tasks)
  File "/usr/local/lib/python2.7/site-packages/sklearn/externals/joblib/parallel.py", line 566, in _dispatch
    job = ImmediateComputeBatch(batch)
  File "/usr/local/lib/python2.7/site-packages/sklearn/externals/joblib/parallel.py", line 180, in __init__
    self.results = batch()
  File "/usr/local/lib/python2.7/site-packages/sklearn/externals/joblib/parallel.py", line 72, in __call__
    return [func(*args, **kwargs) for func, args, kwargs in self.items]
  File "/usr/local/lib/python2.7/site-packages/sklearn/cross_validation.py", line 1550, in _fit_and_score
    test_score = _score(estimator, X_test, y_test, scorer)
  File "/usr/local/lib/python2.7/site-packages/sklearn/cross_validation.py", line 1606, in _score
    score = scorer(estimator, X_test, y_test)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/scorer.py", line 124, in __call__
    return self._sign * self._score_func(y, y_pred, **self._kwargs)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/ranking.py", line 182, in average_precision_score
    average, sample_weight=sample_weight)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/base.py", line 79, in _average_binary_score
    return binary_metric(y_true, y_score, sample_weight=sample_weight)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/ranking.py", line 178, in _binary_average_precision
    y_true, y_score, sample_weight=sample_weight)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/ranking.py", line 409, in precision_recall_curve
    sample_weight=sample_weight)
  File "/usr/local/lib/python2.7/site-packages/sklearn/metrics/ranking.py", line 296, in _binary_clf_curve
    y_score = column_or_1d(y_score)
  File "/usr/local/lib/python2.7/site-packages/sklearn/utils/validation.py", line 551, in column_or_1d
    raise ValueError("bad input shape {0}".format(shape))
ValueError: bad input shape (10142, 2)