gioelelm commented on May 18, 2016 â€¢
edited by TomDLT
When calling LogisticRegressionCV fit method after setting class_weight as 'balanced', I get the following error:
/Users/admin/anaconda/lib/python2.7/site-packages/sklearn/linear_model/logistic.py in logistic_regression_path(X, y, pos_class, Cs, fit_intercept, max_iter, tol, verbose, solver, coef, copy, class_weight, dual, penalty, intercept_scaling, multi_class, random_state, check_input, max_squared_sum, sample_weight)
606 class_weight = temp.copy()
607 else:
--> 608 raise ValueError("In LogisticRegressionCV the lib linear "
609 "solver cannot handle multiclass with "
610 "class_weight of type dict. Use the lbfgs, "
ValueError: In LogisticRegressionCV the liblinear solver cannot handle multiclass with class_weight of type dict. Use the lbfgs, newton-cg or sag solvers or set class_weight='balanced'
The code below should replicate the issue:
LR = LogisticRegressionCV( solver='liblinear', multi_class='ovr',class_weight='balanced',)
LR.fit(np.random.normal(0,1,(1000,2000)), np.random.randint(0,5,1000))
A quick look at the source suggests me that the problem is that the class_weight get passed to logistic_regression_path after being transformed into a dictionary, therefore the line 600 at logistic.py will always evaluate as True:
if isinstance(class_weight, dict) or multi_class == 'multinomial':
However making minor changes (e.g passing self.class_weight instead of class_weight) to the code did not fix the issue and resulted in other errors so I pass the issue to the experts.