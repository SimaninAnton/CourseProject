Member
TomDLT commented on Oct 18, 2018 ‚Ä¢
edited
Minimal example:
import numpy as np
from sklearn.model_selection import cross_val_score, GridSearchCV
from sklearn.base import ClassifierMixin, BaseEstimator

class Dummy(ClassifierMixin, BaseEstimator):
    def __init__(self, answer=1):
        self.answer = answer

    def fit(self, X, y=None):
        return self

    def predict(self, X):
        return np.ones(X.shape[0], dtype='int') * self.answer

n_samples, n_features = 500, 8
X = np.random.randn(n_samples, n_features)
y = np.random.randint(0, 2, n_samples)

dummy = Dummy()
gcv = GridSearchCV(dummy, {'answer': [0, 1]}, cv=5, iid=False, n_jobs=1)
cross_val_score(gcv, X, y, cv=5, n_jobs=5)

# BrokenProcessPool: A task has failed to un-serialize.
# Please ensure that the arguments of the function are all picklable.
Full traceback in details.
Interestingly, it does not fail when:
calling cross_val_score with n_jobs=1.
calling cross_val_score directly on dummy, without GridSearchCV.
using a imported classifier, as LogisticRegression, or even the same Dummy custom classifier but imported from another file.
This is a joblib 0.12 issue, different from #12289 or #12389. @ogrisel @tomMoral
üëç 4