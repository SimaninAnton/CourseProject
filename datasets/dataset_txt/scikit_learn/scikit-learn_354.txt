zwep commented on Aug 7, 2019
Description
Extracting 2d patches from image throws an error when feeding a complex valued array.
Steps/Code to Reproduce
import numpy as np
import sklearn.feature_extraction.image as skfeature

patch_size = (5, 5)
temp_img_1 = np.random.rand(100, 100)
temp_img_2 = np.random.rand(100, 100) + 1j * np.random.rand(100, 100)

# Runs fine
temp_patches = skfeature.extract_patches_2d(temp_img_1, patch_size=patch_size)

# Gives an error
temp_patches = skfeature.extract_patches_2d(temp_img_2, patch_size=patch_size)
Expected Results
I would expect, since we are merely extracting values from an array, that this operation should run fine.
I am convinced that the sklearn.utils.validation.check_array function is too strict in this case. Having run the code without this functionality, I obtain the desired results. Of course, one case does not mean it is justified to change the function. But after inspecting the functionality of extracting 2d patches, I see nowhere a case of casting the dtype, or transforming it in such a way that a complex value will be mapped to real values (which is undesirable of course).
Actual Results
Here is the produced error
Traceback (most recent call last):
  File "<input>", line 1, in <module>
  File "~\venv\lib\site-packages\sklearn\feature_extraction\image.py", line 373, in extract_patches_2d
    image = check_array(image, allow_nd=True)
  File "~\venv\lib\site-packages\sklearn\utils\validation.py", line 505, in check_array
    _ensure_no_complex_data(array)
  File "~\venv\lib\site-packages\sklearn\utils\validation.py", line 329, in _ensure_no_complex_data
    "{}\n".format(array))
ValueError: Complex data not supported
Versions
System:
python: 3.7.4 (tags/v3.7.4:e09359112e, Jul 8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)]
executable: ~\venv\Scripts\python.exe
machine: Windows-10-10.0.17134-SP0
BLAS:
macros:
lib_dirs:
cblas_libs: cblas
Python deps:
pip: 19.2.1
setuptools: 41.0.1
sklearn: 0.21.2
numpy: 1.16.4
scipy: 1.3.0
Cython: None
pandas: 0.24.2