Contributor
GuillemGSubies commented on Jul 17, 2019 â€¢
edited
Description
Here target_idx gets overwritten no matter what. So if we are in a multiclass problem, the field target is ignored.
Steps/Code to Reproduce
from sklearn.datasets import load_iris
from sklearn.ensemble import RandomForestClassifier
from sklearn.inspection import partial_dependence
from sklearn.inspection import plot_partial_dependence

feature_names = load_iris().feature_names
target_names = load_iris().target_names
X, y = load_iris(return_X_y=True)

model = RandomForestClassifier(n_jobs=-1)
model.fit(X, y)
averaged_predictions, _ = partial_dependence(model, X, features=0)
averaged_predictions # here we see that depending on the target, the output is different
plot_partial_dependence(model, X, features=[0], target=0, feature_names=feature_names, n_jobs=-1)
plot_partial_dependence(model, X, features=[0], target=1, feature_names=feature_names, n_jobs=-1)
plot_partial_dependence(model, X, features=[0], target=2, feature_names=feature_names, n_jobs=-1)
Expected Results
I expect it to plot different things for different targets.
Actual Results
It plots the same thing always.
I could try to make a PR if you agree, however it would be my first one and I might need some help.