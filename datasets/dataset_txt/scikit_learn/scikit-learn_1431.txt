modw commented on Apr 11, 2018
Description
MemoryError is thrown by feature_extraction.image.extract_patches_2d when input array is too large. Note that feature_extraction.image.extract_patches performs as expected (creates a view into the image array). Ran into this while working with @deskinsjt.
Steps/Code to Reproduce
import numpy as np
from sklearn.feature_extraction import image

n = 2000
patch_size = 100

arr = np.arange(n**2).reshape(n,n)
patches = image.extract_patches_2d(arr, (patch_size,patch_size))
Expected Results
We expect no error to be thrown; a view should be made into arr instead.
Actual Results
---------------------------------------------------------------------------
MemoryError                               Traceback (most recent call last)
<ipython-input-69-2ecd041ab4f2> in <module>()
----> 1 patches = image.extract_patches_2d(arr, (100,100))

~/anaconda3/envs/up/lib/python3.6/site-packages/sklearn/feature_extraction/image.py in extract_patches_2d(image, patch_size, max_patches, random_state)
    385         patches = extracted_patches
    386 
--> 387     patches = patches.reshape(-1, p_h, p_w, n_colors)
    388     # remove the color dimension if useless
    389     if patches.shape[-1] == 1:

MemoryError: 
Versions
Linux-4.13.0-38-generic-x86_64-with-debian-stretch-sid
Python 3.6.4 |Anaconda custom (64-bit)| (default, Jan 16 2018, 18:10:19) 
[GCC 7.2.0]
NumPy 1.14.0
SciPy 1.0.0
Scikit-Learn 0.19.1
üëç 2