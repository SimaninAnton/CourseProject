How to limit the number of threads?