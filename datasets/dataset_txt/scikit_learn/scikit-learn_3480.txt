Member
ogrisel commented on Oct 30, 2015
Under OS X 10.11:
======================================================================
FAIL: sklearn.linear_model.tests.test_logistic.test_logistic_regression_class_weights
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/ogrisel/venvs/py35/lib/python3.5/site-packages/nose/case.py", line 198, in runTest
    self.test(*self.arg)
  File "/Users/ogrisel/code/scikit-learn/sklearn/linear_model/tests/test_logistic.py", line 674, in test_logistic_regression_class_weights
    assert_array_almost_equal(clf1.coef_, clf2.coef_, decimal=6)
  File "/Users/ogrisel/venvs/py35/lib/python3.5/site-packages/numpy/testing/utils.py", line 842, in assert_array_almost_equal
    precision=decimal)
  File "/Users/ogrisel/venvs/py35/lib/python3.5/site-packages/numpy/testing/utils.py", line 665, in assert_array_compare
    raise AssertionError(msg)
AssertionError:
Arrays are not almost equal to 6 decimals

(mismatch 50.0%)
 x: array([[-0.454107,  0.830293, -2.263768, -0.966612],
       [ 0.474448, -0.33929 , -0.168293, -0.797186],
       [-0.02034 , -0.491003,  2.432062,  1.763798]])
 y: array([[-0.454113,  0.83029 , -2.26377 , -0.96661 ],
       [ 0.474451, -0.339288, -0.168292, -0.797188],
       [-0.020338, -0.491002,  2.432062,  1.763798]])
>>  raise AssertionError('\nArrays are not almost equal to 6 decimals\n\n(mismatch 50.0%)\n x: array([[-0.454107,  0.830293, -2.263768, -0.966612],\n       [ 0.474448, -0.33929 , -0.168293, -0.797186],\n       [-0.02034 , -0.491003,  2.432062,  1.763798]])\n y: array([[-0.454113,  0.83029 , -2.26377 , -0.96661 ],\n       [ 0.474451, -0.339288, -0.168292, -0.797188],\n       [-0.020338, -0.491002,  2.432062,  1.763798]])')
I can make them pass by changing the decimals precision to 4:
diff --git a/sklearn/linear_model/tests/test_logistic.py b/sklearn/linear_model/tests/test_logistic.py
index 13e5527..da19d80 100644
--- a/sklearn/linear_model/tests/test_logistic.py
+++ b/sklearn/linear_model/tests/test_logistic.py
@@ -671,7 +671,7 @@ def test_logistic_regression_class_weights():
                                   class_weight=class_weight_dict)
         clf1.fit(X, y)
         clf2.fit(X, y)
-        assert_array_almost_equal(clf1.coef_, clf2.coef_, decimal=6)
+        assert_array_almost_equal(clf1.coef_, clf2.coef_, decimal=4)

     # Binary case: remove 90% of class 0 and 100% of class 2
     X = iris.data[45:100, :]
Will open a PR.