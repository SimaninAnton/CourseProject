Member
ogrisel commented on Dec 17, 2019 â€¢
edited
This is an issue to track the resolution of failure on one of the Windows CI worker on Azure Pipelines that is causing the following exception to be raised in the test_import_is_deprecated tests that rely on assert_run_python_script:
E                   AssertionError: Error in atexit._run_exitfuncs:
E                   Traceback (most recent call last):
E                     File "c:\miniconda\envs\testvenv\lib\ntpath.py", line 562, in relpath
E                       path_drive, start_drive))
E                   ValueError: path is on mount 'D:', start on mount 'c:'

cmd        = ['c:\\miniconda\\envs\\testvenv\\python.exe', 'C:\\Users\\VSSADM~1\\AppData\\Local\\Temp\\tmp32ajt78f_src_test_sklearn.py']
coverage_rc = None
cwd        = 'c:\\miniconda\\envs\\testvenv\\lib\\site-packages'
env        = {'AGENT.JOBSTATUS': 'Succeeded', 'AGENT_BUILDDIRECTORY': 'D:\\a\\1', 'AGENT_DISABLELOGPLUGIN_TESTFILEPUBLISHERPLUGIN': 'true', 'AGENT_DISABLELOGPLUGIN_TESTRESULTLOGPLUGIN': 'false', ...}
f          = <_io.BufferedWriter name='C:\\Users\\VSSADM~1\\AppData\\Local\\Temp\\tmp32ajt78f_src_test_sklearn.py'>
fd         = 17
kwargs     = {'cwd': 'c:\\miniconda\\envs\\testvenv\\lib\\site-packages', 'env': {'AGENT.JOBSTATUS': 'Succeeded', 'AGENT_BUILDDIREC...FILEPUBLISHERPLUGIN': 'true', 'AGENT_DISABLELOGPLUGIN_TESTRESULTLOGPLUGIN': 'false', ...}, 'stderr': -2, 'timeout': 60}
out        = b'Error in atexit._run_exitfuncs:\r\nTraceback (most recent call last):\r\n  File "c:\\miniconda\\envs\\testvenv\\lib\...ine 562, in relpath\r\n    path_drive, start_drive))\r\nValueError: path is on mount \'D:\', start on mount \'c:\'\r\n'
source_code = '\nimport pytest\n\nwith pytest.warns(FutureWarning,\n                  match="The sklearn.feature_selection.from_mode...ted from .* is now part of the private API."):\n    from sklearn.feature_selection.from_model import SelectFromModel\n'
source_file = 'C:\\Users\\VSSADM~1\\AppData\\Local\\Temp\\tmp32ajt78f_src_test_sklearn.py'
timeout    = 60
According to https://bugs.python.org/issue7195 this is caused by trying to compute a relpath between 2 windows paths from different drives, one of which depends on the current working directory. However the CI log do not report the full error message. I will try to open a PR to get the full message.