Contributor
aditya1702 commented on May 3, 2019
Description
I am not able to build sklearn from source on my Macbook pro with MacOS Mojave. I have set SKLEARN_NO_OPENMP to False and I get the following error when I run pip install --editable .
(sklearn-dev) nbp-119-105:scikit-learn adityavyas$ pip install --editable .
Obtaining file:///Users/adityavyas/Desk/scikit-learn
Requirement already satisfied: numpy>=1.11.0 in /Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages (from scikit-learn==0.21.dev0)
Requirement already satisfied: scipy>=0.17.0 in /Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages (from scikit-learn==0.21.dev0)
Requirement already satisfied: joblib>=0.11 in /Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages (from scikit-learn==0.21.dev0)
Installing collected packages: scikit-learn
  Found existing installation: scikit-learn 0.21.dev0
    Can't uninstall 'scikit-learn'. No files were found to uninstall.
  Running setup.py develop for scikit-learn
    Complete output from command /Users/adityavyas/anaconda/envs/sklearn-dev/bin/python -c "import setuptools, tokenize;__file__='/Users/adityavyas/Desk/scikit-learn/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" develop --no-deps:
    blas_opt_info:
    blas_mkl_info:
    customize UnixCCompiler
      FOUND:
        libraries = ['mkl_rt', 'pthread']
        library_dirs = ['/Users/adityavyas/anaconda/envs/sklearn-dev/lib']
        define_macros = [('SCIPY_MKL_H', None), ('HAVE_CBLAS', None)]
        include_dirs = ['/usr/local/include', '/usr/include', '/opt/local/include', '/Users/adityavyas/anaconda/envs/sklearn-dev/include']

      FOUND:
        libraries = ['mkl_rt', 'pthread']
        library_dirs = ['/Users/adityavyas/anaconda/envs/sklearn-dev/lib']
        define_macros = [('SCIPY_MKL_H', None), ('HAVE_CBLAS', None)]
        include_dirs = ['/usr/local/include', '/usr/include', '/opt/local/include', '/Users/adityavyas/anaconda/envs/sklearn-dev/include']

    Partial import of sklearn during the build process.
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/Users/adityavyas/Desk/scikit-learn/setup.py", line 280, in <module>
        setup_package()
      File "/Users/adityavyas/Desk/scikit-learn/setup.py", line 276, in setup_package
        setup(**metadata)
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/numpy/distutils/core.py", line 137, in setup
        config = configuration()
      File "/Users/adityavyas/Desk/scikit-learn/setup.py", line 171, in configuration
        config.add_subpackage('sklearn')
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 1036, in add_subpackage
        caller_level = 2)
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 1005, in get_subpackage
        caller_level = caller_level + 1)
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 942, in _get_configuration_from_setup_py
        config = setup_module.configuration(*args)
      File "sklearn/setup.py", line 74, in configuration
        maybe_cythonize_extensions(top_path, config)
      File "/Users/adityavyas/Desk/scikit-learn/sklearn/_build_utils/__init__.py", line 92, in maybe_cythonize_extensions
        compiler_directives={'language_level': 3})
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Build/Dependencies.py", line 958, in cythonize
        ctx = c_options.create_context()
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Compiler/Main.py", line 595, in create_context
        self.cplus, self.language_level, options=self)
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Compiler/Main.py", line 78, in __init__
        from . import Builtin, CythonScope
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Compiler/CythonScope.py", line 5, in <module>
        from .UtilityCode import CythonUtilityCode
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Compiler/UtilityCode.py", line 3, in <module>
        from .TreeFragment import parse_from_strings, StringParseContext
      File "/Users/adityavyas/anaconda/envs/sklearn-dev/lib/python3.6/site-packages/Cython/Compiler/TreeFragment.py", line 21, in <module>
        from . import Parsing
      File "Cython/Compiler/Scanning.pxd", line 18, in init Cython.Compiler.Parsing (/Users/ilan/minonda/conda-bld/cython_1482522032589/work/Cython-0.25.2/Cython/Compiler/Parsing.c:67386)
    ValueError: Cython.Compiler.Scanning.CompileTimeScope has the wrong size, try recompiling. Expected 32, got 40

    ----------------------------------------
  Can't roll back scikit-learn; was not uninstalled
Command "/Users/adityavyas/anaconda/envs/sklearn-dev/bin/python -c "import setuptools, tokenize;__file__='/Users/adityavyas/Desk/scikit-learn/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" develop --no-deps" failed with error code 1 in /Users/adityavyas/Desk/scikit-learn/
Could someone help me please?