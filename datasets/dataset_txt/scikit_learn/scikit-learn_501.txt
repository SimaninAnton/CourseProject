keng000 commented on May 24, 2019
Description
The installation failed when I tried to install scikit-learn==0.21.2 into my macbook. However, version 0.21.1 installation get successed in the same environment.
Steps/Code to Reproduce
python -m venv venv && source venv/bin/activate 
pip install cython 
pip install scikit-learn==0.21.2
My environment is bellow.
Mac OS 10.14.3
python 3.6.8
Expected Results
install succession.
Actual Results
[name@user:/tmp/workdir]$ python -m venv venv && source venv/bin/activate 
(venv) [name@user:/tmp/workdir]$ pip install cython 
~~
(venv) [name@user:/tmp/workdir]$ pip install scikit-learn==0.21.2
Collecting scikit-learn==0.21.2
  Using cached https://files.pythonhosted.org/packages/57/5c/133b464c8d0be7ac8c9414b6ff2ae848808a35ce03b146fc2c43777e51f9/scikit-learn-0.21.2.tar.gz
Requirement already satisfied: numpy>=1.11.0 in ./venv/lib/python3.6/site-packages (from scikit-learn==0.21.2) (1.16.3)
Requirement already satisfied: scipy>=0.17.0 in ./venv/lib/python3.6/site-packages (from scikit-learn==0.21.2) (1.3.0)
Requirement already satisfied: joblib>=0.11 in ./venv/lib/python3.6/site-packages (from scikit-learn==0.21.2) (0.13.2)
Installing collected packages: scikit-learn
  Found existing installation: scikit-learn 0.21.1
    Uninstalling scikit-learn-0.21.1:
      Successfully uninstalled scikit-learn-0.21.1
  Running setup.py install for scikit-learn ... error
    Complete output from command /private/tmp/workdir/venv/bin/python -u -c "import setuptools, tokenize;__file__='/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" install --record /private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-record-m74dgw2t/install-record.txt --single-version-externally-managed --compile --install-headers /private/tmp/workdir/venv/include/site/python3.6/scikit-learn:
    Partial import of sklearn during the build process.
    blas_opt_info:
    blas_mkl_info:
    customize UnixCCompiler
      libraries mkl_rt not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    blis_info:
    customize UnixCCompiler
      libraries blis not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    openblas_info:
    customize UnixCCompiler
    customize UnixCCompiler
      libraries openblas not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    atlas_3_10_blas_threads_info:
    Setting PTATLAS=ATLAS
    customize UnixCCompiler
      libraries tatlas not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    atlas_3_10_blas_info:
    customize UnixCCompiler
      libraries satlas not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    atlas_blas_threads_info:
    Setting PTATLAS=ATLAS
    customize UnixCCompiler
      libraries ptf77blas,ptcblas,atlas not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    atlas_blas_info:
    customize UnixCCompiler
      libraries f77blas,cblas,atlas not found in ['/private/tmp/workdir/venv/lib', '/usr/local/lib', '/usr/lib', '/opt/local/lib']
      NOT AVAILABLE
    
    accelerate_info:
      FOUND:
        extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']
        extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']
        define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]
    
      FOUND:
        extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']
        extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']
        define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]
    
    C compiler: clang -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall
    
    compile options: '-c'
    extra options: '-fopenmp'
    clang: test_openmp.c
    clang: error: unsupported option '-fopenmp'
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/setup.py", line 290, in <module>
        setup_package()
      File "/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/setup.py", line 286, in setup_package
        setup(**metadata)
      File "/private/tmp/workdir/venv/lib/python3.6/site-packages/numpy/distutils/core.py", line 137, in setup
        config = configuration()
      File "/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/setup.py", line 174, in configuration
        config.add_subpackage('sklearn')
      File "/private/tmp/workdir/venv/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 1036, in add_subpackage
        caller_level = 2)
      File "/private/tmp/workdir/venv/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 1005, in get_subpackage
        caller_level = caller_level + 1)
      File "/private/tmp/workdir/venv/lib/python3.6/site-packages/numpy/distutils/misc_util.py", line 942, in _get_configuration_from_setup_py
        config = setup_module.configuration(*args)
      File "sklearn/setup.py", line 80, in configuration
        maybe_cythonize_extensions(top_path, config)
      File "/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/sklearn/_build_utils/__init__.py", line 68, in maybe_cythonize_extensions
        with_openmp = check_openmp_support()
      File "/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/sklearn/_build_utils/openmp_helpers.py", line 140, in check_openmp_support
        raise CompileError(err_message)
    distutils.errors.CompileError:
                        ***
    
    It seems that scikit-learn cannot be built with OpenMP support.
    
    - Make sure you have followed the installation instructions:
    
        https://scikit-learn.org/dev/developers/advanced_installation.html
    
    - If your compiler supports OpenMP but the build still fails, please
      submit a bug report at:
    
        https://github.com/scikit-learn/scikit-learn/issues
    
    - If you want to build scikit-learn without OpenMP support, you can set
      the environment variable SKLEARN_NO_OPENMP and rerun the build
      command. Note however that some estimators will run in sequential
      mode and their `n_jobs` parameter will have no effect anymore.
    
                        ***
    
    
    ----------------------------------------
  Rolling back uninstall of scikit-learn
Command "/private/tmp/workdir/venv/bin/python -u -c "import setuptools, tokenize;__file__='/private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" install --record /private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-record-m74dgw2t/install-record.txt --single-version-externally-managed --compile --install-headers /private/tmp/workdir/venv/include/site/python3.6/scikit-learn" failed with error code 1 in /private/var/folders/96/n8z7qsnd0v56h86w5s0bknhw0000gn/T/pip-install-9l557yll/scikit-learn/
Versions
scikit-learn==0.21.2
Cython==0.29.7