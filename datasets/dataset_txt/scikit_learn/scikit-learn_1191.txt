gutouyu commented on Aug 3, 2018
Description
roc_auc_score don't work properly.
ValueError: Only one class present in y_true. ROC AUC score is not defined in that case.
but my y_true is really has 2 values: 0, 1.
Steps/Code to Reproduce
import numpy as np
np.unique(y_val)
the result is array([0, 1]), which is correct.
but when i run the follows code, got the error
from sklearn.metrics import roc_auc_score
roc_auc_score(y_true=y_val, y_score=y_val_pred_prob, average='macro')
Expected Results
the auc score
Actual Results
ValueErrorTraceback (most recent call last)
<ipython-input-36-3a74026c0dbe> in <module>()
      1 from sklearn.metrics import roc_auc_score
----> 2 roc_auc_score(y_true=y_val, y_score=y_val_pred_prob, average='macro')

~/anaconda3/envs/py3/lib/python3.5/site-packages/sklearn/metrics/ranking.py in roc_auc_score(y_true, y_score, average, sample_weight)
    275     return _average_binary_score(
    276         _binary_roc_auc_score, y_true, y_score, average,
--> 277         sample_weight=sample_weight)
    278 
    279 

~/anaconda3/envs/py3/lib/python3.5/site-packages/sklearn/metrics/base.py in _average_binary_score(binary_metric, y_true, y_score, average, sample_weight)
    116         y_score_c = y_score.take([c], axis=not_average_axis).ravel()
    117         score[c] = binary_metric(y_true_c, y_score_c,
--> 118                                  sample_weight=score_weight)
    119 
    120     # Average the results

~/anaconda3/envs/py3/lib/python3.5/site-packages/sklearn/metrics/ranking.py in _binary_roc_auc_score(y_true, y_score, sample_weight)
    266     def _binary_roc_auc_score(y_true, y_score, sample_weight=None):
    267         if len(np.unique(y_true)) != 2:
--> 268             raise ValueError("Only one class present in y_true. ROC AUC score "
    269                              "is not defined in that case.")
    270 

ValueError: Only one class present in y_true. ROC AUC score is not defined in that case.
Versions
Linux-3.10.0-327.ali2010.rc7.alios7.x86_64-x86_64-with-redhat-7.2-Paladin
Python 3.5.4 |Anaconda, Inc.| (default, Nov 3 2017, 20:01:27)
[GCC 7.2.0]
NumPy 1.15.0
SciPy 1.1.0
Scikit-Learn 0.19.2
I think there maybe some bugs, or I'm using the wrong code ?