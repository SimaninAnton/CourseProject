jpauwels commented on Oct 18, 2016 â€¢
edited
Description
StratifiedKFold does not work together with one-hot labels created by LabelBinarizer.
Steps/Code to Reproduce
from sklearn.datasets import make_classification
from sklearn.model_selection import cross_val_score, KFold, StratifiedKFold
from sklearn.preprocessing import label_binarize
from sklearn.multiclass import OneVsRestClassifier
from sklearn.svm import LinearSVC

X, y = make_classification(n_classes=5, n_informative=4)
onehot = label_binarize(y, classes=range(5))

model = OneVsRestClassifier(LinearSVC())
print(model.fit(X, onehot))
print(cross_val_score(model, X, onehot))
print(cross_val_score(model, X, onehot, cv=KFold()))
print(cross_val_score(model, X, onehot, cv=StratifiedKFold())) # error
for train, test in StratifiedKFold().split(X, onehot): # alternative way to induce error
    print(train, test)
Expected Results
Stratified train & test folds
Actual Results
Traceback (most recent call last):
  File "~/stratifiedtest.py", line 15, in <module>
    for train, test in StratifiedKFold().split(X, onehot):
  File "~/Library/Python/2.7/lib/python/site-packages/sklearn/model_selection/_split.py", line 321, in split
    for train, test in super(_BaseKFold, self).split(X, y, groups):
  File "~/Library/Python/2.7/lib/python/site-packages/sklearn/model_selection/_split.py", line 90, in split
    for test_index in self._iter_test_masks(X, y, groups):
  File "~/Library/Python/2.7/lib/python/site-packages/sklearn/model_selection/_split.py", line 608, in _iter_test_masks
    test_folds = self._make_test_folds(X, y)
  File "~/Library/Python/2.7/lib/python/site-packages/sklearn/model_selection/_split.py", line 595, in _make_test_folds
    cls_test_folds = test_folds[y == cls]
IndexError: too many indices for array
Versions
Darwin-16.0.0-x86_64-i386-64bit
('Python', '2.7.10 (default, Jul 30 2016, 18:31:42) \n[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.34)]')
('NumPy', '1.11.1')
('SciPy', '0.18.0')
('Scikit-Learn', '0.18')