Member
ogrisel commented on Jan 23, 2014
Here is a reproduction script. I used a random tree to make it run much faster but I think this impacts all tree implementations. I used a very large output dimension to make the leak more visible:
import gc
import os
import psutil
import numpy as np
from sklearn.tree import ExtraTreeRegressor

X = np.random.normal(size=(100, 50))
Y = np.random.normal(size=(100, int(5e4)))

p = psutil.Process(os.getpid())

def print_mem():
    print("{:.0f}MB".format(p.get_memory_info().rss / 1e6))

print_mem()

for i in range(3):
    et = ExtraTreeRegressor(max_features=1).fit(X, Y)
    del et
    gc.collect()
    print_mem()
Here is the output on the current master:
86MB
171MB
251MB
331MB
The output on sklearn 0.14.1:
74MB
74MB
74MB
74MB