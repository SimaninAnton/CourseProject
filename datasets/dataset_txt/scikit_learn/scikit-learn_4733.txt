Member
jakevdp commented on Jul 26, 2013
This is an explicit issue to track the discussion from #1732.
Problem
Short summary: the new BallTree/KDTree code uses typed memoryviews. These work only with numpy arrays that have the buffer interface (see PEP 3118). The buffer interface is available in numpy 1.5+, but not in numpy 1.3-1.4, so something like the following would fail:
# cython: foo.pyx
def int foo(double[::1] X):
    return X.shape[0]
import numpy as np
from foo import foo
X = np.zeros(10)
N = foo(X)  # <-- fails if buffer interface is unavailable
This sort of function construct is used throughout the new nearest-neighbors code.
Solution Possibilities
One potential solution is to revert to the old numpy ndarray syntax:
# cython: foo2.pyx
cimport numpy as np

def foo(np.ndarray[double, ndim=1, order='c'] X):
    return X.shape[0]
but this presents some complications and performance hits in the neighbors code.