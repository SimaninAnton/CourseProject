Member
ogrisel commented on Mar 29, 2014
The covertype dataset loader test tries to load previously fetched data compressed with joblib / zlib.
If this is fetched with a different major version of python (e.g. 2.7 and 3.4), this runs into the following compatibility issue in the zlib compressed data:
======================================================================
ERROR: sklearn.datasets.tests.test_covtype.test_fetch
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/ogrisel/code/scikit-learn/sklearn/datasets/covtype.py", line 81, in fetch_covtype
    X, y
UnboundLocalError: local variable 'X' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ogrisel/venvs/py34/lib/python3.4/site-packages/nose/case.py", line 198, in runTest
    self.test(*self.arg)
  File "/Users/ogrisel/code/scikit-learn/sklearn/datasets/tests/test_covtype.py", line 17, in test_fetch
    data1 = fetch(shuffle=True, random_state=42)
  File "/Users/ogrisel/code/scikit-learn/sklearn/datasets/tests/test_covtype.py", line 12, in fetch
    return fetch_covtype(*args, download_if_missing=False, **kwargs)
  File "/Users/ogrisel/code/scikit-learn/sklearn/datasets/covtype.py", line 83, in fetch_covtype
    X = joblib.load(samples_path)
  File "/Users/ogrisel/code/scikit-learn/sklearn/externals/joblib/numpy_pickle.py", line 421, in load
    unpickler = ZipNumpyUnpickler(filename, file_handle=file_handle)
  File "/Users/ogrisel/code/scikit-learn/sklearn/externals/joblib/numpy_pickle.py", line 310, in __init__
    mmap_mode=None)
  File "/Users/ogrisel/code/scikit-learn/sklearn/externals/joblib/numpy_pickle.py", line 268, in __init__
    self.file_handle = self._open_pickle(file_handle)
  File "/Users/ogrisel/code/scikit-learn/sklearn/externals/joblib/numpy_pickle.py", line 313, in _open_pickle
    return BytesIO(read_zfile(file_handle))
  File "/Users/ogrisel/code/scikit-learn/sklearn/externals/joblib/numpy_pickle.py", line 68, in read_zfile
    data = zlib.decompress(file_handle.read(), 15, length)
zlib.error: Error -3 while decompressing data: incorrect header check