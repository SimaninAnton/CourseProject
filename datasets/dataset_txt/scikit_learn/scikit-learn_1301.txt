pgdr commented on Jun 19, 2018
Description
Unable to pip install(compile error: PyThreadState has no member ...) with Python 3.7rc1.
My apologies if this has been reported, but I couldn't find it in the issues (closed/open) nor any pull request for it.
There have been similar issues with pyyaml (yaml/pyyaml#126), numpy (numpy/numpy#10500), cython (cython/cython#1978), and pygame (pygame/pygame#382).
Steps/Code to Reproduce
Install Python 3.7rc1.
pip install scikit-learn
Expected Results
pip succeeds.
Actual Results
Compilation errors:
...
sklearn/cluster/_dbscan_inner.cpp: In function ‚Äòint
__Pyx__GetException(PyThreadState*, PyObject**, PyObject**, PyObject**)‚Äô:

sklearn/cluster/_dbscan_inner.cpp:6029:24: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_type‚Äô
     tmp_type = tstate->exc_type;
                        ^
sklearn/cluster/_dbscan_inner.cpp:6030:25: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_value‚Äô
     tmp_value = tstate->exc_value;
                         ^
sklearn/cluster/_dbscan_inner.cpp:6031:22: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_traceback‚Äô
     tmp_tb = tstate->exc_traceback;
                      ^
sklearn/cluster/_dbscan_inner.cpp:6032:13: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_type‚Äô
     tstate->exc_type = local_type;
             ^
sklearn/cluster/_dbscan_inner.cpp:6033:13: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_value‚Äô
     tstate->exc_value = local_value;
             ^
sklearn/cluster/_dbscan_inner.cpp:6034:13: error: ‚ÄòPyThreadState‚Äô has no member named ‚Äòexc_traceback‚Äô
     tstate->exc_traceback = local_tb;
             ^
error: Command "g++ -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g
-fwrapv -O3 -Wall -fPIC
-I/data/install/lib/python3.7/site-packages/numpy/core/include
-I/data/install/lib/python3.7/site-packages/numpy/core/include
-I/data/install/include/python3.7m -c sklearn/cluster/_dbscan_inner.cpp -o
build/temp.linux-x86_64-3.7/sklearn/cluster/_dbscan_inner.o -MMD -MF
build/temp.linux-x86_64-3.7/sklearn/cluster/_dbscan_inner.o.d" failed with exit
status 1
Versions
Linux-3.10.0-862.el7.x86_64-x86_64-with-redhat-7.5-Maipo
Python 3.7.0rc1 (default, Jun 19 2018, 10:54:58) 
[GCC 4.8.5 20150623 (Red Hat 4.8.5-28)]
NumPy 1.14.5
SciPy 1.1.0
üëç 9