Member
ndawe commented on May 27, 2014
I'm trying to add a new decision tree stopping criterion: min_fraction_leaf that requires a minimum weighted fraction of the input samples to be present in all leaf nodes. This criterion is more appropriate than min_samples_leaf when you have weighted samples and many more samples of one class than another (samples of each class are first weighted such that the weighted sum of each class is the same).
But I cannot figure out how to add this in the Cython code now that the GIL is released.
cython sklearn/tree/_tree.pyx

Error compiling Cython file:
------------------------------------------------------------
...
        cdef DTYPE_t* Xf = self.feature_values
        cdef SIZE_t X_sample_stride = self.X_sample_stride
        cdef SIZE_t X_fx_stride = self.X_fx_stride
        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1055:43: Coercion from Python not allowed without the GIL

Error compiling Cython file:
------------------------------------------------------------
...
        cdef DTYPE_t* Xf = self.feature_values
        cdef SIZE_t X_sample_stride = self.X_sample_stride
        cdef SIZE_t X_fx_stride = self.X_fx_stride
        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1055:43: Accessing Python attribute not allowed without gil

Error compiling Cython file:
------------------------------------------------------------
...
        cdef DTYPE_t* Xf = self.feature_values
        cdef SIZE_t X_sample_stride = self.X_sample_stride
        cdef SIZE_t X_fx_stride = self.X_fx_stride
        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1373:43: Coercion from Python not allowed without the GIL

Error compiling Cython file:
------------------------------------------------------------
...
        cdef DTYPE_t* Xf = self.feature_values
        cdef SIZE_t X_sample_stride = self.X_sample_stride
        cdef SIZE_t X_fx_stride = self.X_fx_stride
        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1373:43: Accessing Python attribute not allowed without gil

Error compiling Cython file:
------------------------------------------------------------
...
        cdef SIZE_t n_total_samples = self.n_total_samples
        cdef unsigned char* sample_mask = self.sample_mask

        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1643:43: Coercion from Python not allowed without the GIL

Error compiling Cython file:
------------------------------------------------------------
...
        cdef SIZE_t n_total_samples = self.n_total_samples
        cdef unsigned char* sample_mask = self.sample_mask

        cdef SIZE_t max_features = self.max_features
        cdef SIZE_t min_samples_leaf = self.min_samples_leaf
        cdef float min_fraction_leaf = self.min_fraction_leaf
                                          ^
------------------------------------------------------------

sklearn/tree/_tree.pyx:1643:43: Accessing Python attribute not allowed without gil
This is in my min_fraction_leaf branch:
https://github.com/ndawe/scikit-learn/tree/min_fraction_leaf
@glouppe any ideas?