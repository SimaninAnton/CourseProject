Contributor
rlamy commented on Apr 23, 2018
Description
sklearn.externals.funcsigs.signature() doesn't work (i.e. raises a ValueError) with user-defined classes on PyPy3. This is the source of most of the test failures seen in #11010.
The external project funcsigs seems unmaintained and doesn't appear to have a publicly accessible repo containing the last released version, so I'm not sure how to proceed with testing and fixing this issue.
Steps/Code to Reproduce
from sklearn.externals.funcsigs import signature

class Foo:
    def __init__(self, x):
        pass

sig = signature(Foo)
print(sig.parameters)
Expected Results
On CPython 3.5:
OrderedDict([('x', <Parameter at 0x7ff90116f0e8 'x'>)])
(but note that you get a ValueError for classes that don't define __init__)
Actual Results
On pypy3.5:
Traceback (most recent call last):
  File "xx.py", line 7, in <module>
    sig = signature(Foo)
  File "/home/ronan/dev/scikit-learn/sklearn/externals/funcsigs.py", line 173, in signature
    raise ValueError('callable {0!r} is not supported by signature'.format(obj))
ValueError: callable <class '__main__.Foo'> is not supported by signature