Avoid using isinstance(memory, Memory) to allow for alternative Memory implementations