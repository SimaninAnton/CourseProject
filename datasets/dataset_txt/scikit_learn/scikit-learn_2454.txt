ryanpeach commented on Jan 30, 2017 â€¢
edited
Abstract
Currently pandas to_dict function and scikit-learn's sklearn.feature_extraction.DictVectorizer don't get along. I provide a simple script to make these compatible.
Description
Panda's current to_dict function returns a dictionary of the format:
dict[column_name] <- (dict[index] <- val)
Scikit-learn's DictVectorizer requires a list of dicts of the format:
list[index] <- (dict[column_name] <- val)
If scikit-learn could recognize panda's dataframes, and run this provided script on them, this issue of compatibility could be resolved, making scikit-learn more user friendly with common python libraries.
if isinstance(data, pd.DataFrame): data = pandas_to_dict(data)
Gist Code
https://gist.github.com/ryanpeach/af3e7b217aa2fd5c98a262acce828da6
def pandas_to_dict(df):
    """ A to_dict method for pandas DataFrames that converts frames to a format
        compatible with sklearn.feature_extraction.DictVectorizer
        REF: http://scikit-learn.org/stable/modules/feature_extraction.html#dict-feature-extraction
        
        Parameters:
            df: DataFrame
            
        Returns:
            out_list: list indexed by df index, containing dicts indexed by column name referencing row value.
    """"
    # Get Index
    out_list = []
    for i in range(len(df)):
        index = df.iloc[i]
        
        # Get Column
        out_dict = {}
        for c in df.columns:
            out_dict[c] = index[c]
    
        # Add Column to the List
        out_list.append(out_dict)
        
    return out_list
Use it if you'd like, I wrote it for my own use and just wanted to make the community aware.
I will post this on pandas as well.