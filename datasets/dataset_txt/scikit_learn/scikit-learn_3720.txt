andrewww commented on Jul 16, 2015
I apologize for not debugging this further, but I do not and cannot have a development environment on my machine. In trying to figure out [this StackOverflow question][http://stackoverflow.com/questions/31337217/scikit-learn-minibatch-kmeans-sparse-vs-dense-matrix-clustering/31456290#31456290]. I determined that (at least on my/our platforms) assign_rows_csr is zeroing the output matrix before copying rows, i.e., it successfully copies the new rows. This code replicates the error.
I am on Win7 64, Anaconda 2.1.0, Python 2.7, with sklearn 0.15.2 (but so far as I can tell the subject function has not been modified since then) and numpy 1.9.0.
from sklearn.utils.sparsefuncs_fast import assign_rows_csr
from scipy.sparse import csr_matrix
import numpy as np


a = np.ones( [5,5] )
d = a.copy()
print a
b = np.zeros( [10,5] )
b[ 5,: ] = 2
c = csr_matrix( b )
print c
assign_rows_csr( c, np.array([5]).astype(np.intp), np.array([3]).astype(np.intp), a )
print a

d[3,:] = b[5,:]
print d
assert np.all( d==a )
Output
[[ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]]
  (5, 0)        2.0
  (5, 1)        2.0
  (5, 2)        2.0
  (5, 3)        2.0
  (5, 4)        2.0
[[ 0.  0.  0.  0.  0.]
 [ 0.  0.  0.  0.  0.]
 [ 0.  0.  0.  0.  0.]
 [ 2.  2.  2.  2.  2.]
 [ 0.  0.  0.  0.  0.]]
[[ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]
 [ 1.  1.  1.  1.  1.]
 [ 2.  2.  2.  2.  2.]
 [ 1.  1.  1.  1.  1.]]
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
.... in <module>()
     17 print d
     18
---> 19 assert np.all( d==a )

AssertionError: