Contributor
zhaofeng-shu33 commented on May 7, 2019
Description
sklearn.cluster.AffinityPropagation doesn't support sparse affinity matrix.
A similar question is at #4051. It focuses on default affinity.
Steps/Code to Reproduce
from sklearn.cluster import AffinityPropagation
from scipy.sparse import csr
affinity_matrix = csr.csr_matrix((3,3))
AffinityPropagation(affinity='precomputed').fit(affinity_matrix)
Expected Results
no error raised since it works for dense matrix.
Actual Results
Traceback (most recent call last):
File "", line 1, in
File "D:\Miniconda\lib\site-packages\sklearn\cluster\affinity_propagation_.py", line 381, in fit
copy=self.copy, verbose=self.verbose, return_n_iter=True)
File "D:\Miniconda\lib\site-packages\sklearn\cluster\affinity_propagation_.py", line 115, in affinity_propagation
preference = np.median(S)
File "D:\Miniconda\lib\site-packages\numpy\lib\function_base.py", line 3336, in median
overwrite_input=overwrite_input)
File "D:\Miniconda\lib\site-packages\numpy\lib\function_base.py", line 3250, in _ureduce
r = func(a, **kwargs)
File "D:\Miniconda\lib\site-packages\numpy\lib\function_base.py", line 3395, in _median
return mean(part[indexer], axis=axis, out=out)
File "D:\Miniconda\lib\site-packages\numpy\core\fromnumeric.py", line 2920, in mean
out=out, **kwargs)
File "D:\Miniconda\lib\site-packages\numpy\core_methods.py", line 85, in _mean
ret = ret.dtype.type(ret / rcount)
ValueError: setting an array element with a sequence.
Versions
System:
python: 3.6.7 |Anaconda, Inc.| (default, Oct 28 2018, 19:44:12) [MSC v.1915 64 bit (AMD64)]
executable: D:\Miniconda\python.exe
machine: Windows-7-6.1.7601-SP1
BLAS:
macros: SCIPY_MKL_H=None, HAVE_CBLAS=None
lib_dirs: D:/Miniconda\Library\lib
cblas_libs: mkl_rt
Python deps:
pip: 18.1
setuptools: 40.6.2
sklearn: 0.20.1
numpy: 1.15.4
scipy: 1.1.0
Cython: None
pandas: 0.23.4