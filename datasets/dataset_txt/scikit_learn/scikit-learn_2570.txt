CSchoel commented on Nov 18, 2016
Description
sklearn.linear_model.RANSACRegressor throws a ValueError if no inliers can be found for one of the models generated from random subsets of the input data. However, due to the randomness of the approach, it could well be that further iterations of the algorithm do find a subset that gives a valid model. I therefore (based on my limited understanding of RANSAC) believe that instead of raising an error we should simply continue with the next iteration.
Steps/Code to Reproduce
from sklearn.linear_model import RANSACRegressor, LinearRegression
from sklearn.preprocessing import PolynomialFeatures
import numpy as np

x = np.array([1, 2, 3, 4, 5, 6])
y = np.array([1, 2, 3, 4, 100, 6])
# PolynomialFeatures(1) does not make much sense, but this example
# comes from a piece of code where i want to fit polynomials of
# arbitrary degree
polyx = PolynomialFeatures(1).fit_transform(x.reshape(-1, 1))

model = RANSACRegressor(LinearRegression(), max_trials=100)
nerror = 0
for i in range(100):
  try:
    model.fit(polyx, y)
  except ValueError:
    nerror += 1
print(nerror)
# We get the error about 40% of the time.
Expected Results
The call to model.fit should only fail, if ALL the iterations fail to generate a valid model.
Actual Results
The call fails if ONE of the iterations produces a model that has no inliers.
Versions
Windows-7-6.1.7601-SP1
Python 3.4.4 |Anaconda 4.0.0 (64-bit)| (default, Feb 16 2016, 09:54:04) [MSC v.1600 64 bit (AMD64)]
NumPy 1.11.1
SciPy 0.17.0
Scikit-Learn 0.17.1