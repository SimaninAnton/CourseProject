Gerenuk commented on Aug 15, 2018
It happened to me that sklearn.utils.stats._weighted_percentile (called from the sklearn GBRT; sklearn 0.19.1) choked on calculating an array index which went beyond the array bound. Unfortunately I do not have access to the data and I cannot create a reproducible example, but I could imagine that it is a rare error coming from floating point calculations and someone could see a way that floating point could go wrong here.
The error occurred in the return statement of
def _weighted_percentile(array, sample_weight, percentile=50):
 """
 Compute the weighted ``percentile`` of ``array`` with ``sample_weight``.
 """
 sorted_idx = np.argsort(array)

 # Find index of median prediction for each sample
 weight_cdf = stable_cumsum(sample_weight[sorted_idx])
 percentile_idx = np.searchsorted(
  weight_cdf, (percentile / 100.) * weight_cdf[-1])
 return array[sorted_idx[percentile_idx]]      # <- IndexError
Where index 166 was accessed when the array was 166 long.