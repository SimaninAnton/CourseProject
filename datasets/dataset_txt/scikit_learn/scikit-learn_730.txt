galenwilkerson commented on Feb 14, 2019 â€¢
edited
Description
GridSearchCV.fit() throws AttributeError when running on LSTM model
I'm trying to use GridSearchCV to parallelize hyper-parameter tuning.
(I will also try pyspark.GridSearchCV, but want to get this working first.)
thanks!
Steps/Code to Reproduce
Example:
from keras.wrappers.scikit_learn import KerasRegressor
from sklearn.model_selection import GridSearchCV

def build_LSTM_simple (num_features=1,  # the number of features
                          look_back=50,  # time window size
                          loss='mean_squared_error',
                          optimizer='adam',
                          dropout_rate=0):

        model = Sequential()
        model.add(LSTM(5,
                       input_shape=(look_back, num_features),
                       dropout=dropout_rate,
                       recurrent_dropout=dropout_rate))
        model.add(Dense(50))

        model.compile(loss=loss, optimizer=optimizer)

        return(model)

model = KerasRegressor(build_fn=build_LSTM_simple)

# define the grid search parameters
batch_size = [10]#, 20, 40, 60, 80, 100]
epochs = [10]#, 50, 100]
param_grid = dict(batch_size=batch_size, epochs=epochs)

grid = GridSearchCV(estimator=model, param_grid=param_grid, n_jobs=-1)

grid_result = grid.fit(X, y)
AttributeError Traceback (most recent call last)
in ()
----> 1 grid_result = grid.fit(X, y)
2 # summarize results
3 print("Best: %f using %s" % (grid_result.best_score_, grid_result.best_params_))
4 means = grid_result.cv_results_['mean_test_score']
5 stds = grid_result.cv_results_['std_test_score']
~/anaconda3/lib/python3.6/site-packages/sklearn/model_selection/_search.py in fit(self, X, y, groups, **fit_params)
638 error_score=self.error_score)
639 for parameters, (train, test) in product(candidate_params,
--> 640 cv.split(X, y, groups)))
641
642 # if one choose to see train score, "out" will contain train score info
~/anaconda3/lib/python3.6/site-packages/sklearn/externals/joblib/parallel.py in call(self, iterable)
787 # consumption.
788 self._iterating = False
--> 789 self.retrieve()
790 # Make sure that we get a last message telling us we are done
791 elapsed_time = time.time() - self._start_time
~/anaconda3/lib/python3.6/site-packages/sklearn/externals/joblib/parallel.py in retrieve(self)
697 try:
698 if getattr(self._backend, 'supports_timeout', False):
--> 699 self._output.extend(job.get(timeout=self.timeout))
700 else:
701 self._output.extend(job.get())
~/anaconda3/lib/python3.6/multiprocessing/pool.py in get(self, timeout)
642 return self._value
643 else:
--> 644 raise self._value
645
646 def _set(self, i, obj):
~/anaconda3/lib/python3.6/multiprocessing/pool.py in _handle_tasks(taskqueue, put, outqueue, pool, cache)
422 break
423 try:
--> 424 put(task)
425 except Exception as e:
426 job, idx = task[:2]
~/anaconda3/lib/python3.6/site-packages/sklearn/externals/joblib/pool.py in send(obj)
369 def send(obj):
370 buffer = BytesIO()
--> 371 CustomizablePickler(buffer, self._reducers).dump(obj)
372 self._writer.send_bytes(buffer.getvalue())
373 self._send = send
~/anaconda3/lib/python3.6/site-packages/statsmodels/graphics/functional.py in _pickle_method(m)
30 def _pickle_method(m):
31 """Handle pickling issues with class instance."""
---> 32 if m.im_self is None:
33 return getattr, (m.im_class, m.im_func.func_name)
34 else:
AttributeError: 'function' object has no attribute 'im_self'
Versions
Linux-4.15.0-45-generic-x86_64-with-debian-buster-sid
Python 3.6.5 |Anaconda, Inc.| (default, Apr 29 2018, 16:14:56)
[GCC 7.2.0]
NumPy 1.16.1
SciPy 1.1.0
Scikit-Learn 0.19.2
Keras 2.2.4