y0ast commented on May 20, 2015
When using the ExtraTreesClassifier (and likely other classes that are derived from BaseTreeClassifier), there is a problem when using sparsematrices: ValueError: X should be in csr_matrix format, got <class 'scipy.sparse.csc.csc_matrix'>.
I tracked the issue down to the following lines:
On line 195 of forest.py the sparse matrix is changed to a csc matrix:
X = check_array(X, dtype=DTYPE, accept_sparse="csc")
However on line 369 of forest.py, the following is call is made with check_input=false:
p_estimator = estimator.predict_proba(X[mask_indices, :], check_input=False)
This leads to a ValueError in predict ValueError: X should be in csr_matrix format, got <class 'scipy.sparse.csc.csc_matrix'>.
Changing check_input to True seems to fix the issue. It's probably best to also include a test case for this problem, I just made a quick PR with only the False -> True fix.