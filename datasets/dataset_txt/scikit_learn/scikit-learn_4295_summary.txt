Make catch_warnings blocks in tests more robust