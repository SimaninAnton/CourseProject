Member
fabianp commented on Jun 16, 2011
Source no longer compiles under python 3.1, 2to3 fails with the (cryptic) error
Traceback (most recent call last):
  File "setup.py", line 64, in <module>
    res = lib2to3.main.main("lib2to3.fixes", ['-w'] + [local_path])
  File "/usr/lib/python3.1/lib2to3/main.py", line 172, in main
    options.processes)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 620, in refactor
    items, write, doctests_only)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 273, in refactor
    self.refactor_dir(dir_or_file, write, doctests_only)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 292, in refactor_dir
    self.refactor_file(fullname, write, doctests_only)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 661, in refactor_file
    *args, **kwargs)
  File "/home/fabian/envs/p31/lib/python3.1/site-packages/lib2to3cache-0.1-py3.1.egg/lib2to3cache.py", line 135, in new_refactor_file
    return old_refactor_file(self, filename, write, doctests_only)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 327, in refactor_file
    tree = self.refactor_string(input, filename)
  File "/home/fabian/envs/p31/lib/python3.1/site-packages/lib2to3cache-0.1-py3.1.egg/lib2to3cache.py", line 113, in new_refactor_string
    tree = old_refactor_string(self, input, name)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 359, in refactor_string
    self.refactor_tree(tree, name)
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 393, in refactor_tree
    self.traverse_by(self.post_order_heads, tree.post_order())
  File "/usr/lib/python3.1/lib2to3/refactor.py", line 417, in traverse_by
    new = fixer.transform(node, results)
  File "/usr/lib/python3.1/lib2to3/fixes/fix_reduce.py", line 32, in transform
    touch_import('functools', 'reduce', node)
  File "/usr/lib/python3.1/lib2to3/fixer_util.py", line 301, in touch_import
    root = find_root(node)
  File "/usr/lib/python3.1/lib2to3/fixer_util.py", line 277, in find_root
    assert node.parent, "Tree is insane! root found before "\
AssertionError: Tree is insane! root found before file_input node was found.
make: *** [inplace] Error 1