klamann commented on Oct 10, 2016
Description
I can't use certain transformers like SelectPercentile or SelectKBest in combination with multi-label classification problems.
Steps/Code to Reproduce
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.feature_selection import SelectPercentile
from sklearn.feature_selection import chi2
from sklearn.multiclass import OneVsRestClassifier
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import MultiLabelBinarizer
from sklearn.svm import SVC

X = ['foo', 'bar', 'foobar']
y_multi = [[1], [2], [1,2]]
y = MultiLabelBinarizer().fit_transform(y_multi)
print(y)
pipeline = Pipeline([
    ('vec', CountVectorizer()),
    ('sel', SelectPercentile(score_func=chi2, percentile=50)),
    ('svc', OneVsRestClassifier(SVC(probability=True)))
])
pipeline.fit(X, y)
print(pipeline.predict(['foo']))
If you remove the second step from the pipeline, the code runs just fine.
Random guess about the issue
Now here's the fun part: if you run this code in a debugger, open sklearn.utils.validation and break at line 522. If you change the value of multi_output to True, everything works as expected. However, there is no way to specify the multi_output parameter from SelectPercentile, which makes this setting unreachable from outside.
Is this a bug or am I just doing something wrong?