fhssn1 commented on Mar 22, 2014
I tried pip install scikit-learn on a Python 3.4.0 pyvenv setup (Ubuntu 12.04) and it failed with the following message close to the end of the build output:
error: Command "gcc -pthread -Wno-unused-result -Werror=declaration-after-statement -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -DNO_ATLAS_INFO=1 -Isklearn/src/cblas -I/home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include -I/home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include -I/home/fhssn1/python3VEs/ss340vanilla/include -I/home/fhssn1/opt/python-3.4.0/include/python3.4m -c sklearn/cluster/_k_means.c -o build/temp.linux-x86_64-3.4/sklearn/cluster/_k_means.o" failed with exit status 1

In file included from /home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include/numpy/ndarraytypes.h:1760:0,

                 from /home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include/numpy/ndarrayobject.h:17,

                 from /home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include/numpy/arrayobject.h:4,

                 from sklearn/cluster/_k_means.c:315:

/home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning "Using deprecated NumPy API, disable it by " "#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]

sklearn/cluster/_k_means.c: In function ‘__Pyx_TraceSetupAndCall’:

sklearn/cluster/_k_means.c:7955:17: error: ‘PyFrameObject’ has no member named ‘f_tstate’

sklearn/cluster/_k_means.c: At top level:

/home/fhssn1/python3VEs/ss340vanilla/lib/python3.4/site-packages/numpy/core/include/numpy/__ufunc_api.h:241:1: warning: ‘_import_umath’ defined but not used [-Wunused-function]

----------------------------------------
Cleaning up...
Command /home/fhssn1/python3VEs/ss340vanilla/bin/python3.4 -c "import setuptools,tokenize;__file__='/home/fhssn1/python3VEs/ss340vanilla/build/scikit-learn/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\\r\\n', '\\n'), __file__, 'exec'))" install --record /tmp/pip-bq90tbz5-record/install-record.txt --single-version-externally-managed --compile --install-headers /home/fhssn1/python3VEs/ss340vanilla/include/site/python3.4 failed with error code 1 in /home/fhssn1/python3VEs/ss340vanilla/build/scikit-learn
Storing debug log for failure in /home/fhssn1/.pip/pip.log
A similar error has occurred in statsmodels and the issue is discussed here. Some of the fixes they suggested have not worked in my case for scikit-learn, as follows:
If I download the pip package and run python setup.py clean before python setup.py install, it still fails. Apparently, it doesn't clean/delete the Cython C files, at least not sklearn/cluster/_k_means.c.
If I try pip install git+https://github.com/scikit-learn/scikit-learn.git@0.14.X, it fails too.
Finally the command that works is pip install git+https://github.com/scikit-learn/scikit-learn.git. Note that by this time I had already installed Cython through pip. Since this command refers to master, I'm not sure if this method should be used in production (I'm not familiar with this project's branching policy). Just giving a heads up.
A minor issue, probably with Python not with scikit-learn: The pip output on gnome-terminal displays gcc errors with invalid looking characters, e.g., in place of single-quotes around PyFrameObject and f_tstate keywords mentioned above.