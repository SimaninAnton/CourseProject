hmaarrfk commented on Dec 8, 2019
=================================== FAILURES ===================================
_ test_warm_start_yields_identical_results[HistGradientBoostingRegressor-X1-y1] _
[gw1] linux -- Python 3.6.7 $PREFIX/bin/python

GradientBoosting = <class 'sklearn.ensemble._hist_gradient_boosting.gradient_boosting.HistGradientBoostingRegressor'>
X = array([[-1.5415874 ,  0.22739278, -1.35338886, ...,  0.86727663,
         0.40520408, -0.06964158],
       [-1.0212540...985, -0.67832984],
       [ 1.83708069, -0.00296475,  1.80144921, ...,  0.11230769,
         0.33109242,  1.51848293]])
y = array([ 5.89981499e+01, -1.51472301e+02,  3.92774675e+00,  1.30275835e+02,
        2.04728060e+00,  1.01587138e+02, -1...4499e+02,  1.17344962e+02,  5.81688314e+01,
       -7.85896400e+01,  1.59876618e+01, -2.50470392e+02, -2.19074129e+02])

    @pytest.mark.parametrize('GradientBoosting, X, y', [
        (HistGradientBoostingClassifier, X_classification, y_classification),
        (HistGradientBoostingRegressor, X_regression, y_regression)
    ])
    def test_warm_start_yields_identical_results(GradientBoosting, X, y):
        # Make sure that fitting 50 iterations and then 25 with warm start is
        # equivalent to fitting 75 iterations.
    
        rng = 42
        gb_warm_start = GradientBoosting(
            n_iter_no_change=100, max_iter=50, random_state=rng, warm_start=True
        )
        gb_warm_start.fit(X, y).set_params(max_iter=75).fit(X, y)
    
        gb_no_warm_start = GradientBoosting(
            n_iter_no_change=100, max_iter=75, random_state=rng, warm_start=False
        )
>       gb_no_warm_start.fit(X, y)

../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/tests/test_warm_start.py:66: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py:362: in fit
    X_binned_val, y_val,
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py:443: in _check_early_stopping_scorer
    self.scorer_(self, X_binned_val, y_val)
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/metrics/_scorer.py:371: in _passthrough_scorer
    return estimator.score(*args, **kwargs)
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/base.py:422: in score
    y_pred = self.predict(X)
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py:813: in predict
    return self._raw_predict(X).ravel()
../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/gradient_boosting.py:594: in _raw_predict
    raw_predictions[k, :] += predict(X)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sklearn.ensemble._hist_gradient_boosting.predictor.TreePredictor object at 0xffff8e8a25c0>
X = array([[49, 61,  6, 31, 62, 42,  3,  3, 80,  6, 27, 33, 89, 71, 20, 86,
        59, 19, 86, 13, 79, 59, 56, 45, 47, 60... 57, 56,
        36, 54, 49, 47, 75, 72, 46, 68, 14,  8, 74, 23, 44, 30, 74, 74,
        87, 75,  9, 78]], dtype=uint8)
missing_values_bin_idx = 255

    def predict_binned(self, X, missing_values_bin_idx):
        """Predict raw values for binned data.
    
        Parameters
        ----------
        X : ndarray, shape (n_samples, n_features)
            The input samples.
        missing_values_bin_idx : uint8
            Index of the bin that is used for missing values. This is the
            index of the last bin and is always equal to max_bins (as passed
            to the GBDT classes), or equivalently to n_bins - 1.
    
        Returns
        -------
        y : ndarray, shape (n_samples,)
            The raw predicted values.
        """
        out = np.empty(X.shape[0], dtype=Y_DTYPE)
>       _predict_from_binned_data(self.nodes, X, missing_values_bin_idx, out)
E       Failed: Timeout >300.0s

../_test_env_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold_placehold/lib/python3.6/site-packages/sklearn/ensemble/_hist_gradient_boosting/predictor.py:68: Failed
----------------------------- Captured stderr call -----------------------------

+++++++++++++++++++++++++++++++++++ Timeout ++++++++++++++++++++++++++++++++++++

~~~~~~~~~~~~~~~~~ Stack of QueueFeederThread (281473064370688) ~~~~~~~~~~~~~~~~~
  File "$PREFIX/lib/python3.6/threading.py", line 884, in _bootstrap
    self._bootstrap_inner()
  File "$PREFIX/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "$PREFIX/lib/python3.6/threading.py", line 864, in run
    self._target(*self._args, **self._kwargs)
  File "$PREFIX/lib/python3.6/site-packages/joblib/externals/loky/backend/queues.py", line 138, in _feed
    nwait()
  File "$PREFIX/lib/python3.6/threading.py", line 295, in wait
    waiter.acquire()

~~~~~~~~~~~~~~~~ Stack of QueueManagerThread (281473072763392) ~~~~~~~~~~~~~~~~~
  File "$PREFIX/lib/python3.6/threading.py", line 884, in _bootstrap
    self._bootstrap_inner()
  File "$PREFIX/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "$PREFIX/lib/python3.6/threading.py", line 864, in run
    self._target(*self._args, **self._kwargs)
  File "$PREFIX/lib/python3.6/site-packages/joblib/externals/loky/process_executor.py", line 615, in _queue_management_worker
    ready = wait(readers + worker_sentinels)
  File "$PREFIX/lib/python3.6/multiprocessing/connection.py", line 911, in wait
    ready = selector.select(timeout)
  File "$PREFIX/lib/python3.6/selectors.py", line 376, in select
    fd_event_list = self._poll.poll(timeout)

~~~~~~~~~~~~~~~~~~~~~ Stack of <unknown> (281473358590464) ~~~~~~~~~~~~~~~~~~~~~
  File "$PREFIX/lib/python3.6/site-packages/execnet/gateway_base.py", line 285, in _perform_spawn
    reply.run()
  File "$PREFIX/lib/python3.6/site-packages/execnet/gateway_base.py", line 220, in run
    self._result = func(*args, **kwargs)
  File "$PREFIX/lib/python3.6/site-packages/execnet/gateway_base.py", line 967, in _thread_receiver
    msg = Message.from_io(io)
  File "$PREFIX/lib/python3.6/site-packages/execnet/gateway_base.py", line 432, in from_io
    header = io.read(9)  # type 1, channel 4, payload 4
  File "$PREFIX/lib/python3.6/site-packages/execnet/gateway_base.py", line 400, in read
    data = self._read(numbytes - len(buf))

+++++++++++++++++++++++++++++++++++ Timeout ++++++++++++++++++++++++++++++++++++
=============================== warnings summary ===============================
The following NEW packages will be INSTALLED:

    apipkg:             1.5-py_0               conda-forge
    attrs:              19.3.0-py_0            conda-forge
    ca-certificates:    2019.11.28-hecc5488_0  conda-forge
    certifi:            2019.11.28-py36_0      conda-forge
    cython:             0.29.14-py36he1b5a44_0 conda-forge
    execnet:            1.7.1-py_0             conda-forge
    importlib_metadata: 1.2.0-py36_0           conda-forge
    joblib:             0.14.0-py_0            conda-forge
    libblas:            3.8.0-14_openblas      conda-forge
    libcblas:           3.8.0-14_openblas      conda-forge
    libffi:             3.2.1-h4c5d2ac_1006    conda-forge
    libgcc-ng:          7.3.0-h5c90dd9_0       c4aarch64  
    libgfortran-ng:     7.3.0-h6bc79d0_0       c4aarch64  
    liblapack:          3.8.0-14_openblas      conda-forge
    libopenblas:        0.3.7-h5ec1e0e_4       conda-forge
    libstdcxx-ng:       7.3.0-h5c90dd9_0       c4aarch64  
    more-itertools:     8.0.2-py_0             conda-forge
    ncurses:            6.1-hf484d3e_1002      conda-forge
    numpy:              1.17.3-py36h91f3968_0  conda-forge
    openssl:            1.1.1d-h516909a_0      conda-forge
    packaging:          19.2-py_0              conda-forge
    pluggy:             0.12.0-py_0            conda-forge
    py:                 1.8.0-py_0             conda-forge
    pyparsing:          2.4.5-py_0             conda-forge
    pytest:             5.3.1-py36_0           conda-forge
    pytest-forked:      1.1.2-py_0             conda-forge
    pytest-timeout:     1.3.3-py_0             conda-forge
    pytest-xdist:       1.30.0-py_0            conda-forge
    python:             3.6.7-h357f687_1006    conda-forge
    readline:           8.0-h75b48e3_0         conda-forge
    scikit-learn:       0.22-py36h1971d64_0    local      
    scipy:              1.3.2-py36hb5cb654_0   conda-forge
    setuptools:         42.0.2-py36_0          conda-forge
    six:                1.13.0-py36_0          conda-forge
    sqlite:             3.30.1-h283c62a_0      conda-forge
    tk:                 8.6.10-hed695b0_0      conda-forge
    wcwidth:            0.1.7-py_1             conda-forge
    xz:                 5.2.4-hda93590_1001    conda-forge
    zipp:               0.6.0-py_0             conda-forge
    zlib:               1.2.11-h516909a_1006   conda-forge
Logs will likely get deleted
https://cloud.drone.io/conda-forge/scikit-learn-feedstock/40/1/2
conda-forge/scikit-learn-feedstock#113