xoffey commented on Oct 6, 2017 â€¢
edited by TomDLT
Description
Each time I run cross_val_predict from a cold start, it gives different results. I generally run from within Spyder. Running it multiple times within Spdyer, I do get the same results. But, ewhen quitting spyder and running again, I then get different results. I even tried putting np.random.seed( 101 ) at the beginning of my calling program.
Steps/Code to Reproduce
def crossValSgd( X_train, y_train, nFolds, lossFuncName, modelName='SGD' ):
    # lossFuncName:  'log' for logistic, 'hinge' for SVM, "modified_huber" for smoothed SVM
    logger.info( 'validating SGD %s', modelName )
    np.random.seed( 101 )
    # could set ngram_range=(1, 2) for vectorizer
    pipeline = Pipeline([('vect', CountVectorizer(stop_words='english', ngram_range=(1, 1))),
                         ('tfidf', TfidfTransformer()),
                         ('clf', SGDClassifier(loss=lossFuncName, penalty='l2',
                                               alpha=1e-3, random_state=42,
                                               max_iter=5, tol=None)),
                        ])
    cvx = model_selection.StratifiedKFold(n_splits=nFolds, shuffle=False, random_state=0)
    #cvx = model_selection.KFold(n_splits=nFolds, shuffle=False, random_state=0)
    predicted = cross_val_predict( pipeline, X_train, y_train, cv=cvx, n_jobs=-1)
    #predicted = cross_val_predict( pipeline, X_train, y_train, cv=nFolds, n_jobs=-1)
    y_test = y_train
    logger.info( '%s accuracy %.4f', modelName, np.mean(predicted == y_test) )
Expected Results
Should print the same result every time.
Actual Results
Prints slightly different results each time
2017/10/05 12:48:52 INFO analyzeNewsContent crossValSgd Huber accuracy 0.8390
2017/10/05 12:52:26 INFO analyzeNewsContent crossValSgd Huber accuracy 0.8302
2017/10/05 13:15:03 INFO analyzeNewsContent crossValSgd Huber accuracy 0.8060
2017/10/05 13:43:52 INFO analyzeNewsContent crossValSgd Huber accuracy 0.8205
Versions
Windows-10-10.0.15063-SP0
Python 3.5.2 |Anaconda custom (64-bit)| (default, Jul 5 2016, 11:41:13) [MSC v.1900 64 bit (AMD64)]
NumPy 1.13.1
SciPy 0.19.1
Scikit-Learn 0.19.0