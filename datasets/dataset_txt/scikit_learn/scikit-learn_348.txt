UgoM commented on Aug 8, 2019
Description
When using GridSearchCV with refit=True and cv not covering up the full dataset, GridSearchCV fits the best estimator on the full dataset regardless of what was given in cv param.
If cv splits don't cover the full index range, GridSearchCV should only fit the best_estimator on indexes seen in cv param.
Here is an example on dummy data. I fit a GridSearchCV on 3 folds where none of them contains the last data point.
Steps/Code to Reproduce
from sklearn.model_selection import GridSearchCV
from sklearn.linear_model import LinearRegression
from matplotlib import pyplot as plt
import numpy as np


X = np.asarray([1, 2, 3, 10]).reshape(-1, 1)
y = [1, 2, 3, 4]

splits = [
    ([1, 2], [3]),
    ([1, 3], [2]),
    ([2, 3], [1]),
]
gs = GridSearchCV(LinearRegression(), {'fit_intercept': [True]}, cv=splits, refit=True)
gs.fit(X, y)

slope, intercept = gs.best_estimator_.coef_, gs.best_estimator_.intercept_
expected_slope, expected_intercept = 1, 0

plt.plot(X[:, 0], y, 'x', label='data')
plt.xlabel('Feature')
plt.ylabel('Label')

plt.plot([0, 10], np.array([0, 10]) * slope + intercept, label='Actual behavior')
plt.plot([0, 10], np.array([0, 10]) * expected_slope + expected_intercept, label='Expected behavior')
plt.title('GridSearchCV best_estimator when fitting only on the first 3 data points')
plt.legend()
plt.show()
Expected/Actual Results
Versions
System:
python: 3.7.4 (default, Jul 16 2019, 07:12:58) [GCC 9.1.0]
executable: /home//.virtualenvs//bin/python
machine: Linux-5.2.2-arch1-1-ARCH-x86_64-with-arch
BLAS:
macros: NO_ATLAS_INFO=1
lib_dirs: /usr/lib64
cblas_libs: cblas
Python deps:
pip: 19.1.1
setuptools: 41.0.1
sklearn: 0.20.2
numpy: 1.16.2
scipy: 1.2.1
Cython: 0.29.6
pandas: 0.25.0
üëç 1