Contributor
DaGuich commented on Nov 16, 2016
Description
An error is thrown when a formerly created joblib dump is loaded on a different CPU architecture.
I'm currently training a IsolationForest classifier on my x86_64 machine, after that I'm pickling the classifier with the recommended method (http://scikit-learn.org/stable/modules/model_persistence.html#persistence-example). The classifier should run on a embedded linux system with an ARM-CPU (armv7l) but the program aborts while loading the classifier.
Steps/Code to Reproduce
Create classifier (on x86): https://gist.github.com/DaGuich/6d6caee1a9ecf7760d4bcdcd8c50fc53
from sklearn.datasets.samples_generator import make_blobs
from sklearn.ensemble import IsolationForest
from sklearn.externals import joblib

X, y = make_blobs(n_samples=1000, centers=1, n_features=5)

cassifier = IsolationForest()
classifier.fit(X)

joblib.dump(classifier, 'classifier.save')
Read classifier (on armv7): https://gist.github.com/DaGuich/b113d2539f1dfb57c2482189dff20a42
from sklearn.ensemble import IsolationForest
from sklearn.externals import joblib

classifier = joblib.load('classifier.save')
Expected Results
No output
Actual Results
(<class 'ValueError'>, ValueError("Buffer dtype mismatch, expected 'SIZE_t' but got 'long long'",), <traceback object at 0xb2be9698>)
<class 'sklearn.tree._tree.Tree'> (5, array([1], dtype=int64), 1)
Traceback (most recent call last):
  File "read_classifier.py", line 4, in <module>
    classifier = joblib.load('classifier.save')
  File "/usr/local/lib/python3.4/dist-packages/sklearn/externals/joblib/numpy_pickle.py", line 575, in load
    obj = _unpickle(fobj, filename, mmap_mode)
  File "/usr/local/lib/python3.4/dist-packages/sklearn/externals/joblib/numpy_pickle.py", line 507, in _unpickle
    obj = unpickler.load()
  File "/usr/lib/python3.4/pickle.py", line 1038, in load
    dispatch[key[0]](self)
  File "/usr/lib/python3.4/pickle.py", line 1384, in load_reduce
    value = func(*args)
  File "sklearn/tree/_tree.pyx", line 585, in sklearn.tree._tree.Tree.__cinit__ (sklearn/tree/_tree.c:7278)
ValueError: Buffer dtype mismatch, expected 'SIZE_t' but got 'long long' 
Versions
PC
Linux-4.4.0-47-generic-x86_64-with-debian-stretch-sid
Python 3.4.3 (default, Nov 16 2016, 14:20:40)
[GCC 5.4.0 20160609]
NumPy 1.11.2
SciPy 0.18.1
Scikit-Learn 0.18
System to deploy
Linux-4.1.0-00150-g60fd5d4-armv7l-with-Ubuntu-15.04-vivid
Python 3.4.3 (default, Mar 26 2015, 23:09:09)
[GCC 4.9.2]
NumPy 1.11.2
SciPy 0.18.1
Scikit-Learn 0.18