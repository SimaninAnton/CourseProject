aldur commented on Aug 23, 2017
First of all, thanks for Scikit, it's an amazing project.
The version I am using is the following:
Darwin-16.7.0-x86_64-i386-64bit
Python 3.6.2 (default, Jul 17 2017, 16:44:45)
[GCC 4.2.1 Compatible Apple LLVM 8.1.0 (clang-802.0.42)]
NumPy 1.13.1
SciPy 0.19.1
Scikit-Learn 0.19.0
The issue is that multiple invocations of a DecisionTreeClassifier on the same pickled input produce, sometimes, different results.
As an example, the following snippet produces two different results on consecutive invocations:
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import numpy as np

import sklearn.datasets
import sklearn.tree
import sklearn.model_selection
import sklearn.pipeline
from sklearn.externals import joblib


RANDOM_STATE = 48
K_CV = sklearn.model_selection.StratifiedKFold(n_splits=10, shuffle=True, random_state=RANDOM_STATE)

def main():
    df = joblib.load('pickled_df.pickle')
    y = df['class']
    X = df.drop('class', axis=1)

    # I cannot reproduce it with make_classification
    # X, y = sklearn.datasets.make_classification(51, 22, n_informative=10, n_classes=5, random_state=RANDOM_STATE)

    pipe_lr = sklearn.pipeline.Pipeline([
        ('clf', sklearn.tree.DecisionTreeClassifier(
            criterion='entropy', max_depth=5, random_state=RANDOM_STATE, presort=True))
    ])
    print(np.mean(sklearn.model_selection.cross_val_score(
        estimator=pipe_lr, X=X, y=y, cv=K_CV, n_jobs=-1)))

main()
Invocation #1:
0.412619047619

Invocation #2:
0.369285714286
To the best of my knowledge I am fixing all the seeds (for the classifier and the cross validation).
However, if I try using make_classification instead of my pickled dataframe, I get consistent results. Unfortunately I cannot provide (at least publicly) the pickled dataframe that I am using.