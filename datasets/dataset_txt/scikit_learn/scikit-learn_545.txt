DanChaltiel commented on May 4, 2019
Hi everyone !
I've stumbled to some unexpecter ZeroDivisionError and I've been advised to post here in my stackoverflow question.
Thanks for help.
Description
When you try to cross-validate a BaggingClassifier with BernoulliNB, you get a very unexpected ZeroDivisionError coming from parallel.py (even if n_jobs=None).
I've tried to change all the parameters I know and to reboot python but nothing worked.
Reproducible example with a binary-modified iris dataset
#%% run
import numpy as np

from sklearn.model_selection import GridSearchCV
from sklearn.ensemble import BaggingClassifier
from sklearn.naive_bayes import BernoulliNB
from sklearn.datasets import load_iris

data = load_iris()
data.targetbin = (data.target!=0).astype("int")

param_grid2={'max_samples' : np.linspace(0.5,1.0,3),
            'base_estimator__alpha':np.linspace(0.1,1,3),
            'base_estimator__binarize':[*np.linspace(0.0,1,3)],
            'base_estimator__fit_prior':[True,False]}

param_grid2={'max_samples' :[0.7]}

clf = GridSearchCV(
        BaggingClassifier(
                BernoulliNB(),
                n_estimators = 10, max_features = 0.5),
        param_grid2,
        scoring = "accuracy",
        verbose=-1)

clf.fit(data.data, data.targetbin)
Stacktrace of the error
[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers. Traceback (most recent call last):
File "", line 33, in clf.fit(data.data, data.targetbin)
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\model_selection_search.py", line 722, in fit self._run_search(evaluate_candidates)
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\model_selection_search.py", line 1191, in _run_search evaluate_candidates(ParameterGrid(self.param_grid))
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\model_selection_search.py", line 711, in evaluate_candidates cv.split(X, y, groups)))
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib\parallel.py", line 917, in call if self.dispatch_one_batch(iterator):
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib\parallel.py", line 759, in dispatch_one_batch self._dispatch(tasks)
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib\parallel.py", line 716, in _dispatch job = self._backend.apply_async(batch, callback=cb)
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib_parallel_backends.py", line 184, in apply_async callback(result)
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib\parallel.py", line 306, in call self.parallel.print_progress()
File "C:\Users\Dan\Anaconda3\lib\site-packages\sklearn\externals\joblib\parallel.py", line 806, in print_progress if (is_last_item or cursor % frequency):
ZeroDivisionError: integer division or modulo by zero
Versions
System:
python: 3.6.8 |Anaconda, Inc.| (default, Feb 21 2019, 18:30:04) [MSC v.1916 64 bit (AMD64)]
executable: C:\Users\Dan\Anaconda3\pythonw.exe
machine: Windows-10-10.0.17134-SP0
BLAS:
macros:
lib_dirs:
cblas_libs: cblas
Python deps:
pip: 19.0.3
setuptools: 41.0.0
sklearn: 0.20.3
numpy: 1.16.2
scipy: 1.2.1
Cython: 0.29.7
pandas: 0.24.2