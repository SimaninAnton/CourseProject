laleph commented on Sep 27, 2018
Description
GridSearchCV fails to work when the kernel is 'tophat' and the data has more than two features, but KernelDensity handles multivariate data.
Steps/Code to Reproduce
import numpy as np
from sklearn.model_selection import GridSearchCV
from sklearn.neighbors import KernelDensity
from sklearn.datasets import make_blobs

data = make_blobs(n_samples=1000, n_features=3, centers=4, cluster_std=0.5, random_state=0)[0]
data.shape

# tophat for KernelDensity works
kde = KernelDensity(kernel='tophat', bandwidth=0.1).fit(data)
kde

# fails if kernel == tophat and n_features > 2
params = {'bandwidth': np.logspace(-1., 1., 20), 'kernel': ['tophat']}
grid = GridSearchCV(KernelDensity(), params, n_jobs=-1)
grid.fit(data)
print("best bandwidth: {0}".format(grid.best_estimator_.bandwidth))
Expected Results
This should return the best bandwidth as is the case when the kernel is set to gaussian.
Actual Results
It returns "a" bandwidth and the following error code:
/home/USER/anaconda3/lib/python3.6/site-packages/sklearn/model_selection/_search.py:675: RuntimeWarning: invalid value encountered in subtract
  array_means[:, np.newaxis]) ** 2,
Versions
Linux-4.18.9-arch1-1-ARCH-x86_64-with-arch
Python 3.6.5 |Anaconda custom (64-bit)| (default, Apr 29 2018, 16:14:56)
[GCC 7.2.0]
NumPy 1.14.3
SciPy 1.1.0
Scikit-Learn 0.19.1