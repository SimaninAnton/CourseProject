Vibnitz commented on Oct 16, 2013
I am finding LassoCV too slow with sparse matrices. For the datasets I am working with (100,000 events and 200 features) LassoCV with dense matrix takes less than 3 minutes while LassoCV with sparse matrix does not seem to finish even after an hour (I am using scipy.sparse.csc_matrix as the source code converts any other sparse matrix to csc_matrix; also the data set is highly sparse, with about 5 nonzero entries per row of the feature matrix).
Below is a sample code to reproduce the problem (modified from http://scikit-learn.org/stable/auto_examples/linear_model/lasso_dense_vs_sparse_data.html). The code results in the following output. Notice the warning with sparse matrix, 7 times higher time for sparse LassoCV, and a slight difference in the value of optimal alpha. Is this behavior expected?
Matrix density : 0.619 %
/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/sklearn/linear_model/coordinate_descent.py:666: UserWarning: precompute is ignored for sparse data
warnings.warn("precompute is ignored for sparse data")
Sparse LassoCV alpha = 0.839763641507
Sparse LassoCV done in 5.182035s
Dense LassoCV alpha = 0.792436751906
Dense LassoCV done in 0.835537s
from time import time
from scipy import sparse
from sklearn.datasets.samples_generator import make_regression
from sklearn.linear_model import LassoCV
def sparse_lasso_cv(X, y):
sparse_lasso = LassoCV(max_iter=5000, cv = 10)
sparse_lasso.fit(X, y)
print 'Sparse LassoCV alpha = ', sparse_lasso.alpha_
def dense_lasso_cv(X, y):
dense_lasso = LassoCV(max_iter=5000, cv = 10)
dense_lasso.fit(X, y)
print 'Dense LassoCV alpha = ', dense_lasso.alpha_
X, y = make_regression(n_samples=2000, n_features=50, random_state=0)
Xs = X.copy()
Xs[Xs < 2.5] = 0.0
Xs = sparse.coo_matrix(Xs)
Xs = Xs.tocsc()
Xd = Xs.todense()
print("Matrix density : %s %%" % (Xs.nnz / float(X.size) * 100))
t0 = time()
sparse_lasso_cv(Xs, y)
print("Sparse LassoCV done in %fs" % (time() - t0))
t0 = time()
dense_lasso_cv(Xd, y)
print("Dense LassoCV done in %fs" % (time() - t0))