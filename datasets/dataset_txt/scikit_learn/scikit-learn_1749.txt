ghost commented on Nov 14, 2017
Description
After loading a big corpus with many words I have this error message: ValueError: The condensed distance matrix must contain only finite values.
I am receiving the below error while I try to process a big corpus with many words, using for this 'cosine' affinity. i want to compare with some other kind of linkages to see which is better:
for union in ['ward', 'average', 'complete']:
    if union in 'ward':
        affinity = ['euclidean']
    else:
        affinity = ['cosine']
    for index, afinidad in enumerate(affinity):
        clustering = AgglomerativeClustering(n_clusters=numCluster, affinity=afinidad,
                                    linkage=union).fit_predict(matrizDist.toarray())
It gives the error when the affinity is cosine, it is, in the average and complete linkages. I am not sure this could be a bug of sklearn function. Could you give me any idea?
My steps in the code are:
I calculate the TF IDF matrix using this function:
vectorizerTfidf = TfidfVectorizer(tokenizer=self.tokenizaTraduce, max_features=maxFeatures, smooth_idf=True)
matriz = vectorizerTfidf.fit_transform(texto) ---> This is raw text.
with this matrix, I calculate the agglomerative clustering.
Current Output:
After making the processing of the data in the corpus, it gave the error showed before.
Steps/Code to Reproduce
`from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.cluster import AgglomerativeClustering
class words():
def calculaMatrizTfidf(self,texto,numFeatures):
maxFeatures = 2*numFeatures
vectorizerTfidf = TfidfVectorizer(tokenizer=self.tokenizaTraduce, max_features=maxFeatures, smooth_idf=True)
return matriz
class hierarchicalCluster():
def realizaCluster(self, matrizDist, numFicheros):
numCluster = ceil(log2(numFicheros)) + 1
for union in ['ward', 'average', 'complete']:
if union in 'ward':
affinity = ['euclidean']
else:
affinity = ['cosine']
for index, afinidad in enumerate(affinity):
clustering = AgglomerativeClustering(n_clusters=numCluster, affinity=afinidad,
linkage=union).fit_predict(matrizDist.toarray())`
Expected Results
I expect to calculate the Agglomerative Clustering successfully, giving one valid number of cluster. it is making it fine using euclidean linkage.
Actual Results
Traceback (most recent call last):
File "C:/Proyecto/WePNaD/proyecto.py", line 16, in
main()
File "C:/Proyecto/WePNaD/proyecto.py", line 12, in main
hierarchicalClust.realizaCluster(matrizTfidf,datosFichEntrada.contFicheros)
File "C:\Proyecto\WePNaD\cluster.py", line 78, in realizaCluster
linkage=union).fit_predict(matrizDist.toarray())
File "C:...\Anaconda3\lib\site-packages\sklearn\base.py", line 410, in fit_predict
self.fit(X)
File "C:....\Anaconda3\lib\site-packages\sklearn\cluster\hierarchical.py", line 734, in fit
**kwargs)
File "C:...\Anaconda3\lib\site-packages\sklearn\externals\joblib\memory.py", line 283, in call
return self.func(*args, **kwargs)
File "C:...\Anaconda3\lib\site-packages\sklearn\cluster\hierarchical.py", line 524, in _average_linkage
return linkage_tree(*args, **kwargs)
File "C:...\Anaconda3\lib\site-packages\sklearn\cluster\hierarchical.py", line 410, in linkage_tree
out = hierarchy.linkage(X, method=linkage, metric=affinity)
File "C:..\Anaconda3\lib\site-packages\scipy\cluster\hierarchy.py.", line 676, in linkage
raise ValueError("The condensed distance matrix must contain only finite values.")
ValueError: The condensed distance matrix must contain only finite values.
Versions
Windows-10-10.0.15063-SP0
Python 3.6.1 |Anaconda custom (64-bit)| (default, May 11 2017, 13:25:24) [MSC v.1900 64 bit (AMD64)]
NumPy 1.12.1
SciPy 0.19.0
Scikit-Learn 0.18.1