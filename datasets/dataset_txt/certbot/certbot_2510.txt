JohnDenker commented on 24 Jan 2016
Observed text:
At https://letsencrypt.org/howitworks/#renewing-a-certificate it says:
To renew a certificate, simply run letsencrypt again providing the same values when prompted. In almost all circumstances, renewal should be performed with the certonly subcommand
BUG: In that passage, the second sentence contradicts the first.
Also it is not nearly as detailed as it should be.
Suggested improved text:
Except as noted below, the process of renewing a certificate is closely parallel to the process you used for generating the certificate initially. Some exceptions and related observations are:
The main exception is that if you initially used letsencrypt in run mode (which is the default), you should use certonly mode for the renewal. This will add the new certificate into the /etc/letsencrypt/archive/$NAME/ directory, and update the symlinks in /etc/letsencrypt/live/$NAME/.
The web server (and anything else that references only the symlinks) should work without further effort.
On the other hand, any postprocessing or customization you performed initially may have to be repeated.
For example, if you added custom DH parameters to the end of the cert.pem file, you will have to repeat this.
Similarly, if you copied the *.pem files somewhere else so they could be used by your SMTP server (not just your web server), you will have to repeat this.
If you initially used the certonly mode, you should use certonly mode for the renewal.
Any postprocessing or customization may have to be repeated, as discussed above.
If your certificate covers multiple domain names, bear in mind that the certificate files are named after the first domain mentioned on the command line, as discussed in item #1376. Therefore you should make sure the renewal mentions the same domain first; otherwise letsencrypt will think you are asking for a new, unrelated certificate.
It is possible to renew the certificate using different parameters on the command line. If the differences are not too extreme, the new certificate will function as a replacement for the old.
For example, if your server has multiple domain names, you can mention more or fewer aliases in the renewal. Letsencrypt will warn about this (unless you specify the --expand option).
If you don't remember what domain names you specified initially, you can figure it out by examining the old certificate.
One way to do this is by using a browser. Visit your site, then click on the padlock icon next to the URL.
Another way is to use a command like this:
:;  :| openssl s_client -CApath /etc/ssl/certs -connect $NAME:443 \
        | openssl x509 -text -noout  |& egrep -C1 'Subject:|Name:|After.:'
# or you can read the certificate file directly:
:;  cat /etc/letsencrypt/live/$NAME/cert.pem \
        | openssl x509 -text -noout  |& egrep -C1 'Subject:|Name:|After.:'
If you have multiple certificates with the same first name, the renewal process is ambiguous. The best way to deal with this is ???????????? (FIXME).
1