Contributor
osirisinferi commented on 7 Aug 2016
Recently, I updated my certbot to the latest Github master branch (Gentoo makes this very easy). Unfortunately, certbot stopped working. I confirmed the error on a separate Gentoo box in VirtualBox, which is as clean as it can be, so I'm doubting some weird setting I'm having on my "production" server causes the error.
Root logging level set at 0
Saving debug log to /var/log/letsencrypt/letsencrypt.log
certbot version: 0.9.0.dev0
Arguments: ['-debug', '-tvv', '-i', 'apache', '-a', 'webroot', '-d', 'le-test-12.example.com', '-w', '/var/www/vhosts/le-test-12.example.com/htdocs/', '--staging']
Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#webroot,PluginEntryPoint#null,PluginEntryPoint#manual,PluginEntryPoint#standalone)
Requested authenticator webroot and installer apache
Exiting abnormally:
Traceback (most recent call last):
  File "/usr/lib/python-exec/python2.7/certbot", line 9, in <module>
    load_entry_point('certbot==0.9.0.dev0', 'console_scripts', 'certbot')()
  File "/usr/lib64/python2.7/site-packages/certbot/main.py", line 770, in main
    return config.func(config, plugins)
  File "/usr/lib64/python2.7/site-packages/certbot/main.py", line 504, in run
    installer, authenticator = plug_sel.choose_configurator_plugins(config, plugins, "run")
  File "/usr/lib64/python2.7/site-packages/certbot/plugins/selection.py", line 187, in choose_configurator_plugins
    installer = pick_installer(config, req_inst, plugins)
  File "/usr/lib64/python2.7/site-packages/certbot/plugins/selection.py", line 31, in pick_installer
    config, default, plugins, question, (interfaces.IInstaller,))
  File "/usr/lib64/python2.7/site-packages/certbot/plugins/selection.py", line 76, in pick_plugin
    verified.prepare()
  File "/usr/lib64/python2.7/site-packages/certbot/plugins/disco.py", line 220, in prepare
    return [plugin_ep.prepare() for plugin_ep in six.itervalues(self._plugins)]
  File "/usr/lib64/python2.7/site-packages/certbot/plugins/disco.py", line 106, in prepare
    self._initialized.prepare()
  File "/usr/lib64/python2.7/site-packages/certbot_apache/configurator.py", line 191, in prepare
    self.vhosts = self.get_virtual_hosts()
  File "/usr/lib64/python2.7/site-packages/certbot_apache/configurator.py", line 573, in get_virtual_hosts
    new_vhost = self._create_vhost(path)
  File "/usr/lib64/python2.7/site-packages/certbot_apache/configurator.py", line 540, in _create_vhost
    filename = get_file_path(self.aug.get("/augeas/files%s/path" % get_file_path(path)))
  File "/usr/lib64/python2.7/site-packages/certbot_apache/configurator.py", line 1805, in get_file_path
    avail_fp = vhost_path[6:]
TypeError: 'NoneType' object has no attribute '__getitem__'

An unexpected error occurred:
TypeError: 'NoneType' object has no attribute '__getitem__'
Please see the logfiles in /var/log/letsencrypt for more details.
Unfortunately, I've got no real clue how to debug this.. When using ipdb at multiple sites in configurator.py, I'm not getting anywhere.
Is this a Gentoo thing or can other people confirm this error?