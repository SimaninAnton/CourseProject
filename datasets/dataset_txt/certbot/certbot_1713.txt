SamMousa commented on 20 Oct 2016
From the docs:
  --expand              If an existing cert covers some subset of the
                        requested names, always expand and replace it with the
                        additional names. (default: False)
Existing certificate has: example.com and www.example.com.
Works:
letsencrypt-auto --expand --force-renewal certonly -d example.com -d test.example.com -d www.example.com
Doesn't work:
letsencrypt-auto --expand certonly -d example.com -d test.example.com
Note that there are 2 differences between these commands:
--force-renewal, I replicated what I used to get it to work; but this is a prod server so I'm hesitant to retry and risk getting rate limited.
We are not listing all existing domains on the existing certificate.
The issue is that 2 should not be a problem according to docs. Even more so, expanding should always expand if any certificate exists. "If an existing certificate covers some subset of the requested names...", the empty subset is always covered and requested. Also what if an existing certificate covers a superset of the requested names ("covers" to me suggests that would be fine)? It should then expand and add the newly requested domains.
In conclusion:
Does --expand work without --force-renewal?
Can I match an existing certificate by just specifying a subset of covered domains?