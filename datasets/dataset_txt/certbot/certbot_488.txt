TimoZikeli commented on 28 Jun 2018 â€¢
edited
If you're having trouble using Certbot and aren't sure you've found a bug or
request for a new feature, please first try asking for help at
https://community.letsencrypt.org/. There is a much larger community there of
people familiar with the project who will be able to more quickly answer your
questions.
My operating system is (include version):
Ubuntu 16.04
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
apt install certbot
I ran this command and it produced this output:
~# certbot renew
Saving debug log to /var/log/letsencrypt/letsencrypt.log

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/impressum.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator standalone, Installer apache

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/domain2.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for domain2.com
tls-sni-01 challenge for www.domain2.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (domain2.com) from /etc/letsencrypt/renewal/domain2.com.conf produced an unexpected error: Failed authorization procedure. domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure, www.domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure. Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/javadoc.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator standalone, Installer apache

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/pfa.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer apache

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/growth.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer None

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/1a.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer apache

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/mail.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for mail.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (mail.domain1.com) from /etc/letsencrypt/renewal/mail.domain1.com.conf produced an unexpected error: Failed authorization procedure. mail.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested e95169bcec0a861f1456af7870c94e48.71bcd14ae6c73bad8c9a3d525034da55.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/tickets.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for tickets.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (tickets.domain1.com) from /etc/letsencrypt/renewal/tickets.domain1.com.conf produced an unexpected error: Failed authorization procedure. tickets.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 01a2dbf4052a1a289e16fb2ad8e331c0.c82dc079f1712e9b68ff602a7d5f58d9.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/domain1.com-0001.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Could not choose appropriate plugin for updaters: The manual plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('An authentication script must be provided with --manual-auth-hook when using the manual plugin non-interactively.',)

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/paste.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for paste.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (paste.domain1.com) from /etc/letsencrypt/renewal/paste.domain1.com.conf produced an unexpected error: Failed authorization procedure. paste.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 958c94f3f2e1dbcf20f787e928acfafe.d46588d85513b5df0b631bee4ce66120.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/jenkins.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer None
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for jenkins.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (jenkins.domain1.com) from /etc/letsencrypt/renewal/jenkins.domain1.com.conf produced an unexpected error: Failed authorization procedure. jenkins.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 9f5658a3c65f1dc26849cbca1c10a313.645b9bed1a60f096b7f524aa68051c03.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/miriam.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer None

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/api.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for api.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (api.domain1.com) from /etc/letsencrypt/renewal/api.domain1.com.conf produced an unexpected error: Failed authorization procedure. api.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 710658a41dea0453da124fb6481c34b2.c8acdbf6bd759d0fe20072a69dd4c1f6.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/privacy.domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer None

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/domain1.com.conf
-------------------------------------------------------------------------------
Cert not yet due for renewal
Plugins selected: Authenticator apache, Installer apache

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/cloud.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for cloud.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (cloud.domain1.com) from /etc/letsencrypt/renewal/cloud.domain1.com.conf produced an unexpected error: Failed authorization procedure. cloud.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 70da42a2b1262ec1dcf33707cbb00cb6.3589435c22cadab95078f60c10da5e3b.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/maven.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer None
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for maven.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (maven.domain1.com) from /etc/letsencrypt/renewal/maven.domain1.com.conf produced an unexpected error: Failed authorization procedure. maven.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 7aa6ee8198ae2ce93a31767d66959b23.295978166ae542ee81fcc72e9d4efbec.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/images.domain1.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for images.domain1.com
Waiting for verification...
Cleaning up challenges
Attempting to renew cert (images.domain1.com) from /etc/letsencrypt/renewal/images.domain1.com.conf produced an unexpected error: Failed authorization procedure. images.domain1.com (tls-sni-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Incorrect validation certificate for tls-sni-01 challenge. Requested 5ccca1724434320d71f8665888521858.a54d12872feec31b1d7d9000c1b98935.acme.invalid from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first certificate had names "1a.domain1.com". Skipping.
All renewal attempts failed. The following certs could not be renewed:
  /etc/letsencrypt/live/domain2.com/fullchain.pem (failure)
  /etc/letsencrypt/live/mail.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/tickets.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/paste.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/jenkins.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/api.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/cloud.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/maven.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/images.domain1.com/fullchain.pem (failure)

-------------------------------------------------------------------------------

The following certs are not due for renewal yet:
  /etc/letsencrypt/live/impressum.domain1.com/fullchain.pem expires on 2018-09-26 (skipped)
  /etc/letsencrypt/live/javadoc.domain1.com/fullchain.pem expires on 2018-09-26 (skipped)
  /etc/letsencrypt/live/pfa.domain1.com/fullchain.pem expires on 2018-07-29 (skipped)
  /etc/letsencrypt/live/growth.domain1.com/fullchain.pem expires on 2018-08-23 (skipped)
  /etc/letsencrypt/live/1a.domain1.com/fullchain.pem expires on 2018-07-29 (skipped)
  /etc/letsencrypt/live/domain1.com-0001/fullchain.pem expires on 2018-08-31 (skipped)
  /etc/letsencrypt/live/miriam.domain1.com/fullchain.pem expires on 2018-09-04 (skipped)
  /etc/letsencrypt/live/privacy.domain1.com/fullchain.pem expires on 2018-08-26 (skipped)
  /etc/letsencrypt/live/domain1.com/fullchain.pem expires on 2018-08-31 (skipped)
All renewal attempts failed. The following certs could not be renewed:
  /etc/letsencrypt/live/domain2.com/fullchain.pem (failure)
  /etc/letsencrypt/live/mail.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/tickets.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/paste.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/jenkins.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/api.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/cloud.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/maven.domain1.com/fullchain.pem (failure)
  /etc/letsencrypt/live/images.domain1.com/fullchain.pem (failure)
-------------------------------------------------------------------------------
9 renew failure(s), 0 parse failure(s)

IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: domain2.com
   Type:   tls
   Detail: remote error: tls: handshake failure

   Domain: www.domain2.com
   Type:   tls
   Detail: remote error: tls: handshake failure

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address. Additionally, please check that
   you have an up-to-date TLS configuration that allows the server to
   communicate with the Certbot client.
 - The following errors were reported by the server:

   Domain: api.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   710658a41dea0453da124fb6481c34b2.c8acdbf6bd759d0fe20072a69dd4c1f6.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: cloud.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   70da42a2b1262ec1dcf33707cbb00cb6.3589435c22cadab95078f60c10da5e3b.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: images.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   5ccca1724434320d71f8665888521858.a54d12872feec31b1d7d9000c1b98935.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: jenkins.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   9f5658a3c65f1dc26849cbca1c10a313.645b9bed1a60f096b7f524aa68051c03.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: mail.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   e95169bcec0a861f1456af7870c94e48.71bcd14ae6c73bad8c9a3d525034da55.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: maven.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   7aa6ee8198ae2ce93a31767d66959b23.295978166ae542ee81fcc72e9d4efbec.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: paste.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   958c94f3f2e1dbcf20f787e928acfafe.d46588d85513b5df0b631bee4ce66120.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
 - The following errors were reported by the server:

   Domain: tickets.domain1.com
   Type:   unauthorized
   Detail: Incorrect validation certificate for tls-sni-01 challenge.
   Requested
   01a2dbf4052a1a289e16fb2ad8e331c0.c82dc079f1712e9b68ff602a7d5f58d9.acme.invalid
   from [MY_IP_ADDRESS]:443. Received 2 certificate(s), first
   certificate had names "1a.domain1.com"

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.
Certbot's behavior differed from what I expected because:
It seems that certbot somehow has an error when interacting with apache, since apache redirects the authorization requests to 1a.domain1.com, which is the first in the alphabet. I have no idea why apache does that. It always used to work, but since a week or so it did not work anymore.
I have the newest version of Apache, Certbot, ... .
When I try "certbot renew --standalone" after stopping Apache, though, 1 certificate is successfully renewed. Then, a ghost process called apache keeps running on port 443 (normal apache is not running), and I have to stop it with "kill ...". Hence, the other renewals fail because port 443 is blocked.
Here is a Certbot log showing the issue (if available):
###### Logs are stored in `/var/log/letsencrypt` by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2018-06-28 11:36:00,853:INFO:certbot.main:Renewing an existing certificate
2018-06-28 11:36:00,924:DEBUG:certbot.crypto_util:Generating key (2048 bits): /etc/letsencrypt/keys/0335_key-certbot.pem
2018-06-28 11:36:00,928:DEBUG:certbot.crypto_util:Creating CSR: /etc/letsencrypt/csr/0335_csr-certbot.pem
2018-06-28 11:36:00,928:DEBUG:acme.client:Requesting fresh nonce
2018-06-28 11:36:00,928:DEBUG:acme.client:Sending HEAD request to https://acme-v01.api.letsencrypt.org/acme/new-authz.
2018-06-28 11:36:01,173:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "HEAD /acme/new-authz HTTP/1.1" 405 0
2018-06-28 11:36:01,174:DEBUG:acme.client:Received response:
HTTP 405
Server: nginx
Content-Type: application/problem+json
Content-Length: 91
Allow: POST
Replay-Nonce: WSLPeHSmAS6Xgelt5sANJE2OfBS69gUu63Kj8UeTUN0
Expires: Thu, 28 Jun 2018 15:36:01 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:01 GMT
Connection: keep-alive


2018-06-28 11:36:01,174:DEBUG:acme.client:Storing nonce: WSLPeHSmAS6Xgelt5sANJE2OfBS69gUu63Kj8UeTUN0
2018-06-28 11:36:01,175:DEBUG:acme.client:JWS payload:
b'{\n  "identifier": {\n    "value": "domain2.com",\n    "type": "dns"\n  },\n  "resource": "new-authz"\n}'
2018-06-28 11:36:01,178:DEBUG:acme.client:Sending POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz:
{
  "payload": "ewogICJpZGVudGlmaWVyIjogewogICAgInZhbHVlIjogImFuZ2VsYS1jc29rYS5jb20iLAogICAgInR5cGUiOiAiZG5zIgogIH0sCiAgInJlc291cmNlIjogIm5ldy1hdXRoeiIKfQ",
  "signature": "GBPYo5tJkFE7ensCqk6cIS-3icyxMd2gz7aR8TfSSWyYI8tQoMlYRFZltTOAjtbwKV0XGy7IhJqcyk4zfcMwizL5MriL5BTkVuuTkyj95kpOCT2i_SS099SVnx-1sTXH16RaMZMhhWETkPba_mVO3QEHC7pwIsDNv_RjdQVTVPt4JXp3zmRX_hfBlD_KeGe2qg4UAQAtHIi1PK-jPL9p944UP-svs0a_D3oi_L_jGfyYGyntcBrl4ruNyqNN1YA_QU7SEXUfOgyr48F-buvCp8xaBBxkbQVOzOIlfggjeZAJmSorzkYnhkitbI17bMvHA5gir7e9DjJyARi5AI4Lrw",
  "protected": "eyJub25jZSI6ICJXU0xQZUhTbUFTNlhnZWx0NXNBTkpFMk9mQlM2OWdVdTYzS2o4VWVUVU4wIiwgImFsZyI6ICJSUzI1NiIsICJqd2siOiB7Im4iOiAiczZvZVBEczdtUlRrQVBXZmRhZ1gwcHhXcHBVdzhRSGl3M19KNkY5M0ZGNElsUExmTjVRQ2ZRUkZNMTAzbjliNVVqTVh5cno5VHNvOGpMVTRzXzROcUpUVXhjTy1fNWpQQTY1TzNTNjJLZFEyaFZlTGtQbTBUckVKUzYyWndra2tqeklfejhXMWFVdkMzSGhfOTlPVUdyUnBmU0NmaXNBeTZxZTczUGRmcGEzaVZXZHhacms5cGFMUlM5Mml5cERrN1h6OFBoMHp0YS1pbDlTSkNvQW53Q0hJck1naFBQeHpIT3k3ZjJhbXdaczlvVlJ1c0JFMXFHNndPMmFnNzdCTVVkbW00VlhERVA3c18xOWwxempiNmZxQzVLM1VFLVRhVG1LcThnOGhfZThTRk94aGUzVUVHU08zVXZCWGdvaVp4UU1BQ085Y0FmNElNRlpPWkpnQk53IiwgImUiOiAiQVFBQiIsICJrdHkiOiAiUlNBIn19"
}
2018-06-28 11:36:01,505:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "POST /acme/new-authz HTTP/1.1" 201 994
2018-06-28 11:36:01,505:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 994
Boulder-Requester: 33386020
Link: <https://acme-v01.api.letsencrypt.org/acme/new-cert>;rel="next"
Location: https://acme-v01.api.letsencrypt.org/acme/authz/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk
Replay-Nonce: PLN04-2BTHMPJnyy1x3ODtPMkdDzSEeHBc_cEFXnawM
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 28 Jun 2018 15:36:01 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:01 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "domain2.com"
  },
  "status": "pending",
  "expires": "2018-07-05T15:30:42Z",
  "challenges": [
    {
      "type": "tls-sni-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910",
      "token": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041911",
      "token": "oNamBBsZi9TFANerrY2Do6vtXubBsjIVyC3i0-Z67J4"
    },
    {
      "type": "http-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041912",
      "token": "l3F02vWytveb5Cb3yrOsaoDBDcrr-lyuTXYyrpYEBTU"
    }
  ],
  "combinations": [
    [
      1
    ],
    [
      2
    ],
    [
      0
    ]
  ]
}
2018-06-28 11:36:01,506:DEBUG:acme.client:Storing nonce: PLN04-2BTHMPJnyy1x3ODtPMkdDzSEeHBc_cEFXnawM
2018-06-28 11:36:01,507:DEBUG:acme.client:JWS payload:
b'{\n  "identifier": {\n    "value": "www.domain2.com",\n    "type": "dns"\n  },\n  "resource": "new-authz"\n}'
2018-06-28 11:36:01,509:DEBUG:acme.client:Sending POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz:
{
  "payload": "ewogICJpZGVudGlmaWVyIjogewogICAgInZhbHVlIjogInd3dy5hbmdlbGEtY3Nva2EuY29tIiwKICAgICJ0eXBlIjogImRucyIKICB9LAogICJyZXNvdXJjZSI6ICJuZXctYXV0aHoiCn0",
  "signature": "p7g6YO46WsQmxBaOozaJc39ln0fmvLuBtg-tUBFLkB3y9N0gKWDTcpFxcr0IylM0JA9k_NXNdWCg37lxnkoOTwwwaASTs0JarcayrYIeO9jnCUA5-aY7TYm2sZPlAxAm0EztOSRmUB28KCN3ZgMcZ_e8kvPKV8zjwF0qkMyYk2fyy4ge-YwjMdfVmcQ1G6sOAU4ywm3WBpi7b3WZte8A2FCGzC7O05pDXpUoEE4KNhP0zmK1BqM1NEUy-rlvD2NEpS5QtToH118CiNuglkFs79uzHM-eFylaeyT5KbWWlI9LmrPILeUu8MKhXoNQMDVJniOjrL_LBbJaa8fVTpha5w",
  "protected": "eyJub25jZSI6ICJQTE4wNC0yQlRITVBKbnl5MXgzT0R0UE1rZER6U0VlSEJjX2NFRlhuYXdNIiwgImFsZyI6ICJSUzI1NiIsICJqd2siOiB7Im4iOiAiczZvZVBEczdtUlRrQVBXZmRhZ1gwcHhXcHBVdzhRSGl3M19KNkY5M0ZGNElsUExmTjVRQ2ZRUkZNMTAzbjliNVVqTVh5cno5VHNvOGpMVTRzXzROcUpUVXhjTy1fNWpQQTY1TzNTNjJLZFEyaFZlTGtQbTBUckVKUzYyWndra2tqeklfejhXMWFVdkMzSGhfOTlPVUdyUnBmU0NmaXNBeTZxZTczUGRmcGEzaVZXZHhacms5cGFMUlM5Mml5cERrN1h6OFBoMHp0YS1pbDlTSkNvQW53Q0hJck1naFBQeHpIT3k3ZjJhbXdaczlvVlJ1c0JFMXFHNndPMmFnNzdCTVVkbW00VlhERVA3c18xOWwxempiNmZxQzVLM1VFLVRhVG1LcThnOGhfZThTRk94aGUzVUVHU08zVXZCWGdvaVp4UU1BQ085Y0FmNElNRlpPWkpnQk53IiwgImUiOiAiQVFBQiIsICJrdHkiOiAiUlNBIn19"
}
2018-06-28 11:36:01,824:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "POST /acme/new-authz HTTP/1.1" 201 998
2018-06-28 11:36:01,825:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 998
Boulder-Requester: 33386020
Link: <https://acme-v01.api.letsencrypt.org/acme/new-cert>;rel="next"
Location: https://acme-v01.api.letsencrypt.org/acme/authz/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY
Replay-Nonce: xRbuZNTBWVnPklRIqsk1b8li13b1f0OKS6aOqOPC5iA
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 28 Jun 2018 15:36:01 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:01 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "www.domain2.com"
  },
  "status": "pending",
  "expires": "2018-07-05T15:30:43Z",
  "challenges": [
    {
      "type": "http-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041967",
      "token": "Mvz6s53kJnfcFrqOAGHyaYRc1NSSJECheu7R6Q972OE"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041968",
      "token": "7aHjFBFlTFg3hVwQL4q3LUZcRS2DiSM6PDuZfi_oQ6o"
    },
    {
      "type": "tls-sni-01",
      "status": "pending",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969",
      "token": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU"
    }
  ],
  "combinations": [
    [
      2
    ],
    [
      0
    ],
    [
      1
    ]
  ]
}
2018-06-28 11:36:01,825:DEBUG:acme.client:Storing nonce: xRbuZNTBWVnPklRIqsk1b8li13b1f0OKS6aOqOPC5iA
2018-06-28 11:36:01,825:INFO:certbot.auth_handler:Performing the following challenges:
2018-06-28 11:36:01,826:INFO:certbot.auth_handler:tls-sni-01 challenge for domain2.com
2018-06-28 11:36:01,826:INFO:certbot.auth_handler:tls-sni-01 challenge for www.domain2.com
2018-06-28 11:36:02,130:DEBUG:certbot_apache.parser:Adding Include /etc/apache2/le_tls_sni_01_cert_challenge.conf to /files/etc/apache2/apache2.conf
2018-06-28 11:36:02,131:DEBUG:certbot_apache.tls_sni_01:writing a config file with text:
 <IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName fd264b12ec05f43020a80bf2bfe521c4.a4d401c306408c94c7a7a53499e3f993.acme.invalid
    UseCanonicalName on
    SSLStrictSNIVHostCheck on

    LimitRequestBody 1048576

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /var/lib/letsencrypt/pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ.crt
    SSLCertificateKeyFile /var/lib/letsencrypt/pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ.pem

    DocumentRoot /var/lib/letsencrypt/tls_sni_01_page/
</VirtualHost>

<VirtualHost *:443>
    ServerName e95ff9b9d115967c1dc9c034573197dd.078ae469261f06a03c9eb5a114989bab.acme.invalid
    UseCanonicalName on
    SSLStrictSNIVHostCheck on

    LimitRequestBody 1048576

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /var/lib/letsencrypt/UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU.crt
    SSLCertificateKeyFile /var/lib/letsencrypt/UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU.pem

    DocumentRoot /var/lib/letsencrypt/tls_sni_01_page/
</VirtualHost>

</IfModule>

2018-06-28 11:36:02,144:DEBUG:certbot.reverter:Creating backup of /etc/apache2/apache2.conf
2018-06-28 11:36:05,309:INFO:certbot.auth_handler:Waiting for verification...
2018-06-28 11:36:05,310:DEBUG:acme.client:JWS payload:
b'{\n  "type": "tls-sni-01",\n  "keyAuthorization": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE",\n  "resource": "challenge"\n}'
2018-06-28 11:36:05,313:DEBUG:acme.client:Sending POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910:
{
  "payload": "ewogICJ0eXBlIjogInRscy1zbmktMDEiLAogICJrZXlBdXRob3JpemF0aW9uIjogInBSWHB1X1gxSm5fWlJYdkx0WXljMGhlRXRoeFV1aVpFZV9mdHpBZWJlWVEub2xGN2xKb0NfbHhhdVdFdTY3RFpKb096Z3RIX3V3amdvMmoyTm9wOGZ2RSIsCiAgInJlc291cmNlIjogImNoYWxsZW5nZSIKfQ",
  "signature": "CWZDOljGw65SZjrTiWG49eNErWs8VznbuW_hZl2fqJJjw_Kty6b6yXe8NRgcmd78oiOjMwssrxfyWIelmFcYX-4xbnXXFn7-T4Eq8O16Hzi-N4zdjdVG0Xh4nDWLpKQwuBC73YKcIxvhwNw485C0srC5EWt7FXa5Juefr_ih1w7Jro10fV1RKRmIqYTSkRkuscnby8RkMf4ew6UYBYkmNTOKKLBfSNAZfV33950cvtqypIGCFEb5Qb7B83ZM1d71m-q3LhncFc7uSJoB5QDAoTQ1nk_Jc-7yTGAovbKN9rUWOvPyTI0shC_P3rhcrIYC3uiQWNWaTBk5pDLD51d6xw",
  "protected": "eyJub25jZSI6ICJ4UmJ1Wk5UQldWblBrbFJJcXNrMWI4bGkxM2IxZjBPS1M2YU9xT1BDNWlBIiwgImFsZyI6ICJSUzI1NiIsICJqd2siOiB7Im4iOiAiczZvZVBEczdtUlRrQVBXZmRhZ1gwcHhXcHBVdzhRSGl3M19KNkY5M0ZGNElsUExmTjVRQ2ZRUkZNMTAzbjliNVVqTVh5cno5VHNvOGpMVTRzXzROcUpUVXhjTy1fNWpQQTY1TzNTNjJLZFEyaFZlTGtQbTBUckVKUzYyWndra2tqeklfejhXMWFVdkMzSGhfOTlPVUdyUnBmU0NmaXNBeTZxZTczUGRmcGEzaVZXZHhacms5cGFMUlM5Mml5cERrN1h6OFBoMHp0YS1pbDlTSkNvQW53Q0hJck1naFBQeHpIT3k3ZjJhbXdaczlvVlJ1c0JFMXFHNndPMmFnNzdCTVVkbW00VlhERVA3c18xOWwxempiNmZxQzVLM1VFLVRhVG1LcThnOGhfZThTRk94aGUzVUVHU08zVXZCWGdvaVp4UU1BQ085Y0FmNElNRlpPWkpnQk53IiwgImUiOiAiQVFBQiIsICJrdHkiOiAiUlNBIn19"
}
2018-06-28 11:36:05,638:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "POST /acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910 HTTP/1.1" 202 339
2018-06-28 11:36:05,639:DEBUG:acme.client:Received response:
HTTP 202
Server: nginx
Content-Type: application/json
Content-Length: 339
Boulder-Requester: 33386020
Link: <https://acme-v01.api.letsencrypt.org/acme/authz/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk>;rel="up"
Location: https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910
Replay-Nonce: FdZXB4mRwkt3dN7nrcJ-E57ar2wiyEcckWWUYwj09pQ
Expires: Thu, 28 Jun 2018 15:36:05 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:05 GMT
Connection: keep-alive

{
  "type": "tls-sni-01",
  "status": "pending",
  "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910",
  "token": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ",
  "keyAuthorization": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE"
}
2018-06-28 11:36:05,639:DEBUG:acme.client:Storing nonce: FdZXB4mRwkt3dN7nrcJ-E57ar2wiyEcckWWUYwj09pQ
2018-06-28 11:36:05,640:DEBUG:acme.client:JWS payload:
b'{\n  "type": "tls-sni-01",\n  "keyAuthorization": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE",\n  "resource": "challenge"\n}'
2018-06-28 11:36:05,643:DEBUG:acme.client:Sending POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969:
{
  "payload": "ewogICJ0eXBlIjogInRscy1zbmktMDEiLAogICJrZXlBdXRob3JpemF0aW9uIjogIlVXbkVKRGhOTkpKaFNpNVVDMlQwVXptQVllYkFtbGpLcW16UTU1RFJRSFUub2xGN2xKb0NfbHhhdVdFdTY3RFpKb096Z3RIX3V3amdvMmoyTm9wOGZ2RSIsCiAgInJlc291cmNlIjogImNoYWxsZW5nZSIKfQ",
  "signature": "GRGwyw73uPuCClaWQl-FCrMge42lPlgL5v_AL5Q2JqO4lI_j6pxiEYRy4xrXEiLaO--exWPu81QXlRIGpNpI_c4EuHPjG-dv7wtpiKfWVfVel95-8qsgidcsMYNRXWyGy2NiE5eV9syVezyM5UNPd-Vj0eI-GQwMNo0umV2Ikpg0e8Kw5lmC_N-WVtLmNtxMUfGNNscLsRfTWxCtjZP61R-xV1QCl9WHFJ5DL3k6MACbzIS3lzTB5PaH7SD15gyC3bPQIAY89UdRXDvpbyTZyswpjZw1NDnlhPR3aS_0jpKB_MGnNoBFwHJxxuiO8gv5IllztSqLAk86ZoWSGxMAkg",
  "protected": "eyJub25jZSI6ICJGZFpYQjRtUndrdDNkTjducmNKLUU1N2FyMndpeUVjY2tXV1VZd2owOXBRIiwgImFsZyI6ICJSUzI1NiIsICJqd2siOiB7Im4iOiAiczZvZVBEczdtUlRrQVBXZmRhZ1gwcHhXcHBVdzhRSGl3M19KNkY5M0ZGNElsUExmTjVRQ2ZRUkZNMTAzbjliNVVqTVh5cno5VHNvOGpMVTRzXzROcUpUVXhjTy1fNWpQQTY1TzNTNjJLZFEyaFZlTGtQbTBUckVKUzYyWndra2tqeklfejhXMWFVdkMzSGhfOTlPVUdyUnBmU0NmaXNBeTZxZTczUGRmcGEzaVZXZHhacms5cGFMUlM5Mml5cERrN1h6OFBoMHp0YS1pbDlTSkNvQW53Q0hJck1naFBQeHpIT3k3ZjJhbXdaczlvVlJ1c0JFMXFHNndPMmFnNzdCTVVkbW00VlhERVA3c18xOWwxempiNmZxQzVLM1VFLVRhVG1LcThnOGhfZThTRk94aGUzVUVHU08zVXZCWGdvaVp4UU1BQ085Y0FmNElNRlpPWkpnQk53IiwgImUiOiAiQVFBQiIsICJrdHkiOiAiUlNBIn19"
}
2018-06-28 11:36:05,970:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "POST /acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969 HTTP/1.1" 202 339
2018-06-28 11:36:05,971:DEBUG:acme.client:Received response:
HTTP 202
Server: nginx
Content-Type: application/json
Content-Length: 339
Boulder-Requester: 33386020
Link: <https://acme-v01.api.letsencrypt.org/acme/authz/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY>;rel="up"
Location: https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969
Replay-Nonce: N8_GYt46hQjOp_boZbHy1to2rT9ucfqR32RAyyXsqF8
Expires: Thu, 28 Jun 2018 15:36:05 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:05 GMT
Connection: keep-alive

{
  "type": "tls-sni-01",
  "status": "pending",
  "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969",
  "token": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU",
  "keyAuthorization": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE"
}
2018-06-28 11:36:05,971:DEBUG:acme.client:Storing nonce: N8_GYt46hQjOp_boZbHy1to2rT9ucfqR32RAyyXsqF8
2018-06-28 11:36:08,974:DEBUG:acme.client:Sending GET request to https://acme-v01.api.letsencrypt.org/acme/authz/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk.
2018-06-28 11:36:09,234:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "GET /acme/authz/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk HTTP/1.1" 200 1697
2018-06-28 11:36:09,235:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1697
Link: <https://acme-v01.api.letsencrypt.org/acme/new-cert>;rel="next"
Replay-Nonce: KV3UqacB2SIrcKPMTaZQ_Br-uUxDpAH7nfKJD2gzkMA
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 28 Jun 2018 15:36:09 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:09 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "domain2.com"
  },
  "status": "invalid",
  "expires": "2018-07-05T15:30:42Z",
  "challenges": [
    {
      "type": "tls-sni-01",
      "status": "invalid",
      "error": {
        "type": "urn:acme:error:tls",
        "detail": "remote error: tls: handshake failure",
        "status": 400
      },
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041910",
      "token": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ",
      "keyAuthorization": "pRXpu_X1Jn_ZRXvLtYyc0heEthxUuiZEe_ftzAebeYQ.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE",
      "validationRecord": [
        {
          "hostname": "domain2.com",
          "port": "443",
          "addressesResolved": [
            "104.27.178.160",
            "104.27.179.160",
            "2400:cb00:2048:1::681b:b2a0",
            "2400:cb00:2048:1::681b:b3a0"
          ],
          "addressUsed": "104.27.178.160",
          "addressesTried": [
            "2400:cb00:2048:1::681b:b2a0"
          ]
        }
      ]
    },
    {
      "type": "dns-01",
      "status": "invalid",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041911",
      "token": "oNamBBsZi9TFANerrY2Do6vtXubBsjIVyC3i0-Z67J4"
    },
    {
      "type": "http-01",
      "status": "invalid",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/KqkXTCgmhnv7zGYkvmR05P-XJMeCuHH4VKZ1P7nrVhk/5350041912",
      "token": "l3F02vWytveb5Cb3yrOsaoDBDcrr-lyuTXYyrpYEBTU"
    }
  ],
  "combinations": [
    [
      1
    ],
    [
      2
    ],
    [
      0
    ]
  ]
}
2018-06-28 11:36:09,236:DEBUG:acme.client:Sending GET request to https://acme-v01.api.letsencrypt.org/acme/authz/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY.
2018-06-28 11:36:09,501:DEBUG:urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "GET /acme/authz/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY HTTP/1.1" 200 1705
2018-06-28 11:36:09,502:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1705
Link: <https://acme-v01.api.letsencrypt.org/acme/new-cert>;rel="next"
Replay-Nonce: lohHTR0DS0MZCU72oqZv-FR9V24_Hr7uCY1vCd0R104
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 28 Jun 2018 15:36:09 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 28 Jun 2018 15:36:09 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "www.domain2.com"
  },
  "status": "invalid",
  "expires": "2018-07-05T15:30:43Z",
  "challenges": [
    {
      "type": "http-01",
      "status": "invalid",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041967",
      "token": "Mvz6s53kJnfcFrqOAGHyaYRc1NSSJECheu7R6Q972OE"
    },
    {
      "type": "dns-01",
      "status": "invalid",
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041968",
      "token": "7aHjFBFlTFg3hVwQL4q3LUZcRS2DiSM6PDuZfi_oQ6o"
    },
    {
      "type": "tls-sni-01",
      "status": "invalid",
      "error": {
        "type": "urn:acme:error:tls",
        "detail": "remote error: tls: handshake failure",
        "status": 400
      },
      "uri": "https://acme-v01.api.letsencrypt.org/acme/challenge/2bi1O5Mj8N03tM9bpnGSUEUnZOgMGJugzzLjXP_R1KY/5350041969",
      "token": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU",
      "keyAuthorization": "UWnEJDhNNJJhSi5UC2T0UzmAYebAmljKqmzQ55DRQHU.olF7lJoC_lxauWEu67DZJoOzgtH_uwjgo2j2Nop8fvE",
      "validationRecord": [
        {
          "hostname": "www.domain2.com",
          "port": "443",
          "addressesResolved": [
            "104.27.178.160",
            "104.27.179.160",
            "2400:cb00:2048:1::681b:b3a0",
            "2400:cb00:2048:1::681b:b2a0"
          ],
          "addressUsed": "104.27.178.160",
          "addressesTried": [
            "2400:cb00:2048:1::681b:b3a0"
          ]
        }
      ]
    }
  ],
  "combinations": [
    [
      2
    ],
    [
      0
    ],
    [
      1
    ]
  ]
}
2018-06-28 11:36:09,503:DEBUG:certbot.reporter:Reporting to user: The following errors were reported by the server:

Domain: domain2.com
Type:   tls
Detail: remote error: tls: handshake failure

Domain: www.domain2.com
Type:   tls
Detail: remote error: tls: handshake failure

To fix these errors, please make sure that your domain name was entered correctly and the DNS A/AAAA record(s) for that domain contain(s) the right IP address. Additionally, please check that you have an up-to-date TLS configuration that allows the server to communicate with the Certbot client.
2018-06-28 11:36:09,503:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 82, in handle_authorizations
    self._respond(aauthzrs, resp, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 155, in _respond
    self._poll_challenges(aauthzrs, chall_update, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 226, in _poll_challenges
    raise errors.FailedChallenges(all_failed_achalls)
certbot.errors.FailedChallenges: Failed authorization procedure. domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure, www.domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure

2018-06-28 11:36:09,503:DEBUG:certbot.error_handler:Calling registered functions
2018-06-28 11:36:09,504:INFO:certbot.auth_handler:Cleaning up challenges
2018-06-28 11:36:09,762:WARNING:certbot.renewal:Attempting to renew cert (domain2.com) from /etc/letsencrypt/renewal/domain2.com.conf produced an unexpected error: Failed authorization procedure. domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure, www.domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure. Skipping.
2018-06-28 11:36:09,763:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 429, in handle_renewal_request
    main.renew_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1156, in renew_cert
    renewed_lineage = _get_and_save_cert(le_client, config, lineage=lineage)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 115, in _get_and_save_cert
    renewal.renew_cert(config, domains, le_client, lineage)
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 304, in renew_cert
    new_cert, new_chain, new_key, _ = le_client.obtain_certificate(domains, new_key)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 326, in obtain_certificate
    orderr = self._get_order_and_authorizations(csr.data, self.config.allow_subset_of_names)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 362, in _get_order_and_authorizations
    authzr = self.auth_handler.handle_authorizations(orderr, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 82, in handle_authorizations
    self._respond(aauthzrs, resp, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 155, in _respond
    self._poll_challenges(aauthzrs, chall_update, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 226, in _poll_challenges
    raise errors.FailedChallenges(all_failed_achalls)
certbot.errors.FailedChallenges: Failed authorization procedure. domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure, www.domain2.com (tls-sni-01): urn:acme:error:tls :: The server experienced a TLS error during domain verification :: remote error: tls: handshake failure

2018-06-28 11:36:09,769:INFO:certbot.renewal:Cert not yet due for renewal
2018-06-28 11:36:09,770:DEBUG:certbot.plugins.selection:Requested authenticator standalone and installer apache
2018-06-28 11:36:09,847:DEBUG:certbot_apache.configurator:Apache version is 2.4.18
2018-06-28 11:36:10,241:DEBUG:certbot.plugins.selection:Single candidate plugin: * apache
Description: Apache Web Server plugin - Beta
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: apache = certbot_apache.entrypoint:ENTRYPOINT
Initialized: <certbot_apache.override_debian.DebianConfigurator object at 0x7f5c1e60c550>
Prep: True
2018-06-28 11:36:10,291:ERROR:certbot.log:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/certbot", line 11, in <module>
    load_entry_point('certbot==0.25.0', 'console_scripts', 'certbot')()
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1323, in main
    return config.func(config, plugins)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1235, in renew
    renewal.handle_renewal_request(config)
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 438, in handle_renewal_request
    plugins)
  File "/usr/lib/python3/dist-packages/certbot/updater.py", line 31, in run_generic_updaters
    installer, _ = plug_sel.choose_configurator_plugins(config, plugins, "certonly")
  File "/usr/lib/python3/dist-packages/certbot/plugins/selection.py", line 200, in choose_configurator_plugins
    authenticator = pick_authenticator(config, req_auth, plugins)
  File "/usr/lib/python3/dist-packages/certbot/plugins/selection.py", line 40, in pick_authenticator
    config, default, plugins, question, (interfaces.IAuthenticator,))
  File "/usr/lib/python3/dist-packages/certbot/plugins/selection.py", line 75, in pick_plugin
    filtered.init(config)
  File "/usr/lib/python3/dist-packages/certbot/plugins/disco.py", line 224, in init
    in six.itervalues(self._plugins)]
  File "/usr/lib/python3/dist-packages/certbot/plugins/disco.py", line 223, in <listcomp>
    return [plugin_ep.init(config) for plugin_ep
  File "/usr/lib/python3/dist-packages/certbot/plugins/disco.py", line 98, in init
    self._initialized = self.plugin_cls(config, self.name)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 192, in __init__
    self.key.generate_key(OpenSSL.crypto.TYPE_RSA, 2048)
  File "/usr/lib/python3/dist-packages/OpenSSL/crypto.py", line 250, in generate_key
    result = _lib.RSA_generate_key_ex(rsa, bits, exponent, _ffi.NULL)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
I use an Apache macro for all of my domains: (I use it with "Use ssl domain.com")
<Macro ssl $host>
  <VirtualHost *:80>

    ServerName $host
    ServerAlias www.$host

        RedirectMatch permanent ^(.*)$ https://$host$1
        ErrorLog ${APACHE_LOG_DIR}/$host-error.log
        CustomLog ${APACHE_LOG_DIR}/$host-access.log combined

  </VirtualHost>

<VirtualHost *:443>

        ServerName $host
        ServerAlias www.$host

        SSLEngine on
        SSLCertificateFile /etc/letsencrypt/live/$host/cert.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/$host/privkey.pem
        SSLCertificateChainFile /etc/letsencrypt/live/$host/chain.pem

        DocumentRoot /var/www/$host/

        <IfModule mod_headers.c>
          Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains"
        </IfModule>
</VirtualHost>

</Macro>
Thanks for your help!