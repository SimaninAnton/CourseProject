adriankirchner commented on 28 May 2018
My operating system is (include version):
Ubuntu 16.04.1 LTS
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto 0.24.0
I ran this command and it produced this output:
$ certbot-auto --no-self-upgrade renew
[..]
-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/wc.domain.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator standalone, Installer None
Renewing an existing certificate
Performing the following challenges:
Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.
Attempting to renew cert (wc.domain.com) from /etc/letsencrypt/renewal/wc.domain.com.conf produced an unexpected error: Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.. Skipping.
Certbot's behavior differed from what I expected because:
I expect certbot-auto to renew the cert via dns-01 (cloudflare-plugin)
Here is a Certbot log showing the issue (if available):
2018-05-28 09:26:55,503:DEBUG:certbot.main:certbot version: 0.24.0
2018-05-28 09:26:55,504:DEBUG:certbot.main:Arguments: []
2018-05-28 09:26:55,504:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#dns-cloudflare,PluginEntryPoint#manual,PluginEntryPoint#nginx,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2018-05-28 09:26:55,517:WARNING:certbot.plugins.standalone:The standalone specific supported challenges flag is deprecated. Please use the --preferred-challenges flag instead.
2018-05-28 09:26:55,577:DEBUG:certbot.log:Root logging level set at 20
2018-05-28 09:26:55,579:INFO:certbot.log:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2018-05-28 09:26:55,580:DEBUG:certbot.main:Expected interfaces: None
2018-05-28 09:26:55,582:DEBUG:certbot.main:Filtered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#dns-cloudflare,PluginEntryPoint#nginx,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
Here is the relevant renewal config and futher information
The initial config file
# This is a Certbot configfile for certificate requests
# run with:
# certbot-auto certonly -c </path/to/this/file>

cert-name = wc.domain.com

domains = *.domain.com, domain.com

authenticator = dns-cloudflare
dns-cloudflare-credentials = *REDACTED*
server = https://acme-v02.api.letsencrypt.org/directory
The renewal config file
# renew_before_expiry = 30 days
version = 0.22.2
archive_dir = /etc/letsencrypt/archive/wc.domain.com
cert = /etc/letsencrypt/live/wc.domain.com/cert.pem
privkey = /etc/letsencrypt/live/wc.domain.com/privkey.pem
chain = /etc/letsencrypt/live/wc.domain.com/chain.pem
fullchain = /etc/letsencrypt/live/wc.domain.com/fullchain.pem

# Options used in the renewal process
[renewalparams]
standalone_supported_challenges = http-01
account = *REDACTED*
dns_cloudflare_credentials = *REDACTED*
server = https://acme-v02.api.letsencrypt.org/directory
authenticator = dns-cloudflare
installer = None
installed plugins:
-------------------------------------------------------------------------------
* apache
Description: Apache Web Server plugin - Beta
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: apache = certbot_apache.entrypoint:ENTRYPOINT

* dns-cloudflare
Description: Obtain certificates using a DNS TXT record (if you are using
Cloudflare for DNS).
Interfaces: IAuthenticator, IPlugin
Entry point: dns-cloudflare =
certbot_dns_cloudflare.dns_cloudflare:Authenticator

* nginx
Description: Nginx Web Server plugin - Alpha
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: nginx = certbot_nginx.configurator:NginxConfigurator

* standalone
Description: Spin up a temporary webserver
Interfaces: IAuthenticator, IPlugin
Entry point: standalone = certbot.plugins.standalone:Authenticator

* webroot
Description: Place files in webroot directory
Interfaces: IAuthenticator, IPlugin
Entry point: webroot = certbot.plugins.webroot:Authenticator
-------------------------------------------------------------------------------