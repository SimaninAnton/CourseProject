tuxbox commented on 5 Feb 2018 â€¢
edited
My operating system is (include version):
FreeBSD 11.1
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
pkg
I ran this command and it produced this output:
certbot renew --dry-run
-------------------------------------------------------------------------------
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates below have not been saved.)

All renewal attempts failed. The following certs could not be renewed:
  /usr/local/etc/letsencrypt/live/***.blog/fullchain.pem (failure)
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates above have not been saved.)
-------------------------------------------------------------------------------
1 renew failure(s), 0 parse failure(s)

IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: ****.blog
   Type:   connection
   Detail: Fetching
   https:///.well-known/acme-challenge/BMC4pOW_mdL616V8LnZdbkcxiQZ5-eSHYh-5iT6PXCI:
   Error getting validation data

   Domain: www.***.blog
   Type:   connection
   Detail: Fetching
   https:///.well-known/acme-challenge/zU0GTBM6EpVSihUgFftZl4YLE266iEmH-91SrRT6ank:
   Error getting validation data

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address. Additionally, please check that
   your computer has a publicly routable IP address and that no
   firewalls are preventing the server from communicating with the
   client. If you're using the webroot plugin, you should also verify
   that you are serving files from the webroot path you provided.

This happens also without --dry-run flag and e.g. certbot certonly
Certbot's behavior differed from what I expected because:
verification should succeed and the hostname should be part of the request, meaning:
https:///.well-known/acme-challenge/BMC4pOW_mdL616V8LnZdbkcxiQZ5-eSHYh-5iT6PXCI
should actually be
https://***.blog/.well-known/acme-challenge/BMC4pOW_mdL616V8LnZdbkcxiQZ5-eSHYh-5iT6PXCI
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
nginx
location ^~ /.well-known/acme-challenge/ {

    # Set correct content type. According to this:
    # https://community.letsencrypt.org/t/using-the-webroot-domain-verification-method/1445/29
    # Current specification requires "text/plain" or no content header at all.
    # It seems that "text/plain" is a safe option.
    default_type "text/plain";

    # This directory must be the same as in /etc/letsencrypt/cli.ini
    # as "webroot-path" parameter. Also don't forget to set "authenticator" parameter
    # there to "webroot".
    # Do NOT use alias, use root! Target directory is located here:
    # /var/www/common/letsencrypt/.well-known/acme-challenge/
    root         /usr/local/www/certbot/;

}

location = /.well-known/acme-challenge/ {
    return 404;
}