ViolentVotan commented on 17 Dec 2015
Hey,
All my domains to a permanent redirect from http to https as configured in my nginx.
When I try to run:
 letsencrypt-auto certonly --webroot -w /home/www/letsenc/ -d www.example.com -d example.com
I get the error:
Failed authorization procedure. www.example.com (http-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Could not connect to http://www.example.com/.well-known/acme-challenge/QXmRnQA8BASBEF-2lsFp5wvm...
I am running nginx, and here is a snippet from the conf file for one of the domains where it fails:
server {
    listen 80;
    listen [::]:80;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name example.com *.example.com;

    ssl_certificate     /home/www/certs/example.crt;
    ssl_certificate_key /home/www/certs/example.key;

    log_not_found off;
    access_log off;

    return 301 https://www.example.com$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name www.example.com;
    access_log  off;

    root   /home/www/example.com;
    index  index.php index.html index.htm;
    ...
The idea being that every request to the domain is being redirected to www.example.com using https.
Now I see why it might fail it it strictly wants an http as it should be redirected.
My question is, is this a bug that it doesn't follow the redirect? Is this intended? Could a paramter be introduced to used https domains instead of http? Wouldn't it make sense to follow https domains as this is supposed to be automated with --renew-by-default ?