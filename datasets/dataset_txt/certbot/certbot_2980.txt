iamacarpet commented on 12 Nov 2015
Hello,
I've been looking at enrolling some of our company websites for LetEncrypt certificates as part of the BETA and we had a slight special use case.
We have compliance requirements which mean we:
Can't allow the LetsEncrypt software to run on the reverse proxy nodes.
Can't run anything on port 80/443 other than nginx serving our sites, availability is quite important.
Need replication to a group of servers before validation, it could pick any one of them.
My solution was to combine the manual and webroot plugins, gist of my change to webroot.py here: https://gist.github.com/iamacarpet/fb4a8f424390c0352e93
To use, you simply:
Run letsencrypt with the webroot plugin.
It'll tell you when it's written the files and ask you to install them.
Copy from the local webroot folder to your remote server(s).
Make sure web server is configured - will include nginx config below.
Hit enter back at the letencrypt script & it will validate.
Install certs to remote server(s) as required.
nginx config:
location /.well-known/acme-challenge {
    alias /var/data/letsencrypt/.well-known/acme-challenge;
    location ~ /.well-known/acme-challenge/(.*) {
        add_header Content-Type text/plain;
    }
}
Borrowed from here: https://community.letsencrypt.org/t/using-the-webroot-domain-verification-method/1445/6
I feel it would be good as it's own plugin as editing the webroot plugin isn't great, but I'm afraid we don't have the time to complete at the moment, so thought I'd share in it's current state :).
Regards,
IAmACarpet