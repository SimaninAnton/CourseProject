Artiom-M commented on 3 May 2019
I have installed latest cerbot using PIP and getting an error with just certonly action:
File "/3.6/lib/python3.6/site-packages/certbot/storage.py", line 1021, in new_lineage
    os.symlink(_relpath_from_file(archive_target[kind], target[kind]), target[kind])
FileNotFoundError: [Errno 2] No such file or directory: '../../archive/xxx.xxx-0009/cert1.pem' -> '/home/user/python/certbot/etc/live/xxx.xxx-0009/cert.pem'
Looking at the new_lineage function I have discovered that it first creates symlinks then writes file. ??? WHY ???
I rearranged the order of commands and it works now:
        with open(archive_target["cert"], "wb") as f:
            logger.debug("Writing certificate to %s.", target["cert"])
            f.write(cert)
        with util.safe_open(archive_target["privkey"], "wb", chmod=BASE_PRIVKEY_MODE) as f:
            logger.debug("Writing private key to %s.", target["privkey"])
            f.write(privkey)
            # XXX: Let's make sure to get the file permissions right here
        with open(archive_target["chain"], "wb") as f:
            logger.debug("Writing chain to %s.", target["chain"])
            f.write(chain)
        with open(archive_target["fullchain"], "wb") as f:
            # assumes that OpenSSL.crypto.dump_certificate includes
            # ending newline character
            logger.debug("Writing full chain to %s.", target["fullchain"])
            f.write(cert + chain)
        for kind in ALL_FOUR:
            logger.debug("Symlink %s to %s.",_relpath_from_file(archive_target[kind], target[kind]), target[kind])
            os.symlink(_relpath_from_file(archive_target[kind], target[kind]), target[kind])