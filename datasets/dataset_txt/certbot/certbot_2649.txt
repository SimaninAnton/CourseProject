isignin commented on 26 Dec 2015
I created 2 certificates for 2 domain names, for example domain1.com and domain2.com.
Certificate 1 is for domain1.com and www.domain1.com, while certificate 2 is for domain2.com and www.domain2.com
For some reason when I access https://domain1.com , it was linked with the certificate for domain2.com and hence error "Your connection is not private" because the domain name and certificate do not match. However if I access https://www.domain1.com, there was no issue and it showed the right certificate for domain1.com.
The one possibility that could be the cause of this strange behavior was that I initially created all the domain names, ie domain1.com, www.domain1.com, domain2.com, www.domain2.com, under one certificate. And that certificate was created under /etc/letsencrypt/live/domain1.com.
Then I decided that I should split them into 2 certificates since they are unrelated domain names. In which case I created the 2nd and 3rd certificates, separately for domain1.com and domain2.com in this sequence, first domain2.com and then domain1.com. This time domain1.com was created as /etc/letsencrypt/live/domain1.com-0001
My latest nginx config is as follows:
server_name domain1.com, www.domain1.com;
ssl_certificate /etc/letsencrypt/live/domain1.com-0001/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/domain1.com-0001/privkey.pem;
and
server_name domain2.com, www.domain2.com;
ssl_certificate /etc/letsencrypt/live/domain2.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/domain2.com/privkey.pem;
After this, I could not get the right certificate associated with domain1.com, although it works for www.domain1.com.
I tried revoking the certificate for domain1.com and recreating the certificate. But it is still giving the same issue. Is there a way to wipe out everything and begin fresh?