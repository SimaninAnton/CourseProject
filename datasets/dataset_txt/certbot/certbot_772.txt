Palethorn commented on 26 Jan 2018 â€¢
edited
My operating system is (include version):
Debian 9
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
Using git
I ran this command and it produced this output:
./certbot-auto --revoke --cert-path /etc/letsencrypt/archive/domain/certN.pem
Certbot revoked my certificate as expected
Asked me if I want to delete the referenced certificate [Y (recommended)/N]
Answered Y
Certbot deleted all my certs under /etc/letsencrypt/archive/domain including the live one
Certbot's behavior differed from what I expected because:
I wanted to revoke the old cert which differs from my new live one. Certbot completely cleaned up every cert ever associated with that domain, which was not expected, and I hardly think that's the recommended option.
Here is a Certbot log showing the issue (if available):
Not available
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
Nginx server block
File: /etc/nginx/sites/domain.conf
...
include /etc/nginx/conf/domain.ssl;
...
File: /etc/nginx/conf/domain.ssl
...
ssl on;
ssl_certificate /etc/letsencrypt/live/domain/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/domain/privkey.pem;
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_prefer_server_ciphers on;
ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
ssl_ecdh_curve secp384r1;
ssl_session_tickets off;
ssl_stapling on;
ssl_stapling_verify on;
add_header Strict-Transport-Security "max-age=63072000; includeSubdomains";
add_header X-Frame-Options DENY;
add_header X-Content-Type-Options nosniff;
...