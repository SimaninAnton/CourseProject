wh211212 commented on 2 May 2018 â€¢
edited
If you're having trouble using Certbot and aren't sure you've found a bug or
request for a new feature, please first try asking for help at
https://community.letsencrypt.org/. There is a much larger community there of
people familiar with the project who will be able to more quickly answer your
questions.
My operating system is (include version):
CentOS Linux release 7.4.1708 (Core)
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
sudo certbot --nginx
I ran this command and it produced this output:
[root@ecs-07 ~]# sudo certbot --nginx
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org

Which names would you like to activate HTTPS for?
-------------------------------------------------------------------------------
1: jumpserver.aniu.so
-------------------------------------------------------------------------------
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): 1
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for jumpserver.aniu.so
Cleaning up challenges
An unexpected error occurred:
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe5 in position 2: ordinal not in range(128)
Please see the logfiles in /var/log/letsencrypt for more details.
[root@ecs-07 ~]# cat /etc/redhat-release 
CentOS Linux release 7.4.1708 (Core)
Certbot's behavior differed from what I expected because:
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2018-05-02 19:13:34,822:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 73, in handle_authorizations
resp = self._solve_challenges(aauthzrs)
File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 124, in _solve_challenges
resp = self.auth.perform(all_achalls)
File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 1033, in perform
http_response = http_doer.perform()
File "/usr/lib/python2.7/site-packages/certbot_nginx/http_01.py", line 61, in perform
self.configurator.save("HTTP Challenge", True)
File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 963, in save
self.parser.filedump(ext='')
File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 242, in filedump
out = nginxparser.dumps(tree)
File "/usr/lib/python2.7/site-packages/certbot_nginx/nginxparser.py", line 134, in dumps
return str(RawNginxDumper(blocks.spaced))
File "/usr/lib/python2.7/site-packages/certbot_nginx/nginxparser.py", line 98, in str
return ''.join(self)
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe5 in position 2: ordinal not in range(128)
2018-05-02 19:13:34,822:DEBUG:certbot.error_handler:Calling registered functions
2018-05-02 19:13:34,823:INFO:certbot.auth_handler:Cleaning up challenges
2018-05-02 19:13:36,388:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
File "/bin/certbot", line 9, in
load_entry_point('certbot==0.23.0', 'console_scripts', 'certbot')()
File "/usr/lib/python2.7/site-packages/certbot/main.py", line 1266, in main
return config.func(config, plugins)
File "/usr/lib/python2.7/site-packages/certbot/main.py", line 1031, in run
certname, lineage)
File "/usr/lib/python2.7/site-packages/certbot/main.py", line 118, in _get_and_save_cert
lineage = le_client.obtain_and_enroll_certificate(domains, certname)
File "/usr/lib/python2.7/site-packages/certbot/client.py", line 350, in obtain_and_enroll_certificate
cert, chain, key, _ = self.obtain_certificate(domains)
File "/usr/lib/python2.7/site-packages/certbot/client.py", line 294, in obtain_certificate
orderr = self._get_order_and_authorizations(csr.data, self.config.allow_subset_of_names)
File "/usr/lib/python2.7/site-packages/certbot/client.py", line 330, in _get_order_and_authorizations
authzr = self.auth_handler.handle_authorizations(orderr, best_effort)
File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 73, in handle_authorizations
resp = self._solve_challenges(aauthzrs)
File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 124, in _solve_challenges
resp = self.auth.perform(all_achalls)
File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 1033, in perform
http_response = http_doer.perform()
File "/usr/lib/python2.7/site-packages/certbot_nginx/http_01.py", line 61, in perform
self.configurator.save("HTTP Challenge", True)
File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 963, in save
self.parser.filedump(ext='')
File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 242, in filedump
out = nginxparser.dumps(tree)
File "/usr/lib/python2.7/site-packages/certbot_nginx/nginxparser.py", line 134, in dumps
return str(RawNginxDumper(blocks.spaced))
File "/usr/lib/python2.7/site-packages/certbot_nginx/nginxparser.py", line 98, in str
return ''.join(self)
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe5 in position 2: ordinal not in range(128)
2018-05-02 19:13:36,393:ERROR:certbot.log:An unexpected error occurred:
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring: