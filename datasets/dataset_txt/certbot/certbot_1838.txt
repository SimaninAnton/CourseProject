dxgldotorg commented on 23 Aug 2016
I would like to see a system where Certbot manages a pool of keys for HPKP deployment, as well as outputting config snippets to be "include"'ed into the main server config.
How I would think it should work:
On first run, the client should first display a warning regarding the risks of "bricking" a site due to poor HSTS deployment.
Upon agreement to the warning, the client should generate 3 RSA and/or EC keys, 1 to be deployed and 2 stand-by keys.
The client should obtain a certificate for the first "deployment" key and output the certificate set plus a configuration snippet for Apache and/or nginx to be "include"'ed into the server configuration, that will output public key pinnings for the deployed key and the two standby keys.
This should be per-domain, of course, like the certificate files.
On re-invocation of certbot, the client should consume one of the stand-by keys, converting it into a deployment key, and generate another stand-by key. Along with the certificates output, should be a replacement set of HPKP header config files.
Perhaps a good starting point for the HPKP duration would be 90 days.
The number of stand-by keys and the HPKP duration should ideally be configurable, once again with the caveat that YMMV.