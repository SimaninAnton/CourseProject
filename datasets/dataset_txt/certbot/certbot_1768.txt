Contributor
ohemorange commented on 30 Sep 2016
Got the following feedback from someone who had tried to use certbot, but couldn't due to complications:
there's nothing specifically wrong with let's encrypt, it's more of a function of our infrastructure. in order to validate our domain with let's encrypt, we need to periodically (every ~3 months) pass an acme challenge by hosting a file they give us. this is relatively harder when using kubernetes, or any other container orchestration framework, because containers are scheduled across a variety of nodes depending on their resource constraints. each container usually does only performs a single role (e.g. run the web service, run nginx, run a single background job, etc.), so it's not as easy as just adding a cron job like the documentation says
one option is to spin up another container whose job it is to update the cert periodically, serve the acme challenge on some local server, link it to the nginx container, and have nginx proxy for that local server
or share a filesystem mount between the two containers, but that could be problematic because containers are separated across hosts (though kubernetes specifically does have a good abstraction for this)
another option is to directly integrate with nginx or haproxy by using their scripting extensions. for instance, nginx has the lua open resty module that lets you dynamically request certs and cache them within nginx, which is super nice because it doesn't involve any additional coordination between containers or host mounts
but there's no standard open resty image that does that for you easily. I spent a good few days writing and configuring one for my personal websites, and got it working, but imo it's not worth the effort right now
and that's really the ultimate issue with all of this - it's definitely possible, but it takes a good amount of time, and the other option is clicking a few buttons and getting a cert for 1 year or longer
so to let us focus on development and not ssl configuration, just buying a cert at this stage for 1 or more years makes more sense imo
questions:
does the plugin automatically request and renew certs for virtual hosts? will they be providing a docker image that has that functionality built it? does nginx need to be compiled with certain extensions (e.g. lua) to work with that functionality? how does it persist the certs? will the certs get cycled every time containers are restarted or rescheduled?