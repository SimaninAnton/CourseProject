mexon commented on 21 May 2017 â€¢
edited
My operating system is (include version): Ubuntu Trusty
I installed Certbot with (certbot-auto, OS package manager, pip, etc): OS package manager (ppa)
I ran this command and it produced this output: sudo certbot --apache
The following errors were reported by the server:
Domain: qa1.zaomengshe.com
Type: connection
Detail: DNS problem: SERVFAIL looking up A for qa1.zaomengshe.com
There seem to be similar problems reported in #1610, but that appeared to be closed inconclusively. The problems are to do with the server being in mainland China, and using DNSpod as a DNS provider.
This is the latest of several attempts I've made to use certbot. The server concerned is a test website, but is under the TLD zaomengshe.com same as the live site. The live site has a Comodo certificate. The test server runs ten different domains and I like to add new ones, so using commercial cert providers is more trouble than it's worth.
I've been irregularly trying to set up LetsEncrypt on this domain for about a year. Every time there have been DNS problems. Clearly the suggestions from certbot are not the problem: the site is up and running.
Rather, previously the problem has always been the DNS provider and the fact that both the DNS provider and the server are in mainland China behind the GFW. Switching to a DNS provider outside mainland China fixes the problem. However, 99% of our users are inside mainland China. I can't take the risk of using a non-Chinese DNS provider.
Perhaps certbot just doesn't work for sites in the Chinese mainland? That wouldn't surprise me.
I have no idea what is happening behind the scenes. When it says "The server could not connect to the client to verify the domain", I have no idea who is the server and who is the client, or what sort of connection it's trying to make. I suspect that there's something wrong with LetsEncrypt's own servers that makes them unable to contact sites registered with DNSpod. If someone can point me to documentation explaining what's really happening, that would help as well.
Thanks!