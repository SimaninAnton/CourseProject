Improve rename testing and error checking