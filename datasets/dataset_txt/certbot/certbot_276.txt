SaltyCybernaut commented on 23 Jan 2019 â€¢
edited
My operating system is (include version):
Ubuntu 18.04
$ uname -a
Linux 4.15.0-33-generic #36-Ubuntu SMP Wed Aug 15 16:00:05 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
OS package manager
$apt install certbot
I ran this command and it produced this output:
$certbot -q renew
Certbot's behavior differed from what I expected because:
I did no receive a warning about this change or anything in the logs
Here is a Certbot log NOT showing an error or warning about the deprecation of tls-sni01:
...
2019-01-11 12:15:05,785:DEBUG:certbot.main:certbot version: 0.28.0
2019-01-11 12:15:05,786:DEBUG:certbot.main:Arguments: ['-q']
2019-01-11 12:15:05,787:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#manual,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2019-01-11 12:15:05,797:DEBUG:certbot.log:Root logging level set at 30
2019-01-11 12:15:05,798:INFO:certbot.log:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2019-01-11 12:15:05,820:DEBUG:certbot.plugins.selection:Requested authenticator <certbot.cli._Default object at 0x7f10fb074358> and installer <certbot.cli._Default object at 0x7f10fb074358>
2019-01-11 12:15:05,830:INFO:certbot.renewal:Cert not yet due for renewal
2019-01-11 12:15:05,831:DEBUG:certbot.plugins.selection:Requested authenticator standalone and installer None
2019-01-11 12:15:05,831:DEBUG:certbot.renewal:no renewal failures
2019-01-12 06:54:30,691:DEBUG:certbot.main:certbot version: 0.28.0
2019-01-12 06:54:30,692:DEBUG:certbot.main:Arguments: ['-q']
2019-01-12 06:54:30,692:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#manual,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2019-01-12 06:54:30,713:DEBUG:certbot.log:Root logging level set at 30
2019-01-12 06:54:30,714:INFO:certbot.log:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2019-01-12 06:54:30,763:DEBUG:certbot.plugins.selection:Requested authenticator <certbot.cli._Default object at 0x7f1b71766358> and installer <certbot.cli._Default object at 0x7f1b71766358>
2019-01-12 06:54:30,781:DEBUG:certbot.storage:Should renew, less than 30 days before certificate expiry 2019-02-11 06:32:41 UTC.
2019-01-12 06:54:30,781:INFO:certbot.renewal:Cert is due for renewal, auto-renewing...
2019-01-12 06:54:30,782:DEBUG:certbot.plugins.selection:Requested authenticator standalone and installer None
2019-01-12 06:54:30,804:DEBUG:certbot.plugins.selection:Single candidate plugin: * standalone
Description: Spin up a temporary webserver
Interfaces: IAuthenticator, IPlugin
Entry point: standalone = certbot.plugins.standalone:Authenticator
Initialized: <certbot.plugins.standalone.Authenticator object at 0x7f1b717a6748>
Prep: True
2019-01-12 06:54:30,805:DEBUG:certbot.plugins.selection:Selected authenticator <certbot.plugins.standalone.Authenticator object at 0x7f1b717a6748> and installer None
2019-01-12 06:54:30,805:INFO:certbot.plugins.selection:Plugins selected: Authenticator standalone, Installer None
2019-01-12 06:54:31,104:DEBUG:certbot.main:Picked account: <Account(RegistrationResource(body=Registration(key=JWKRSA(key=<ComparableRSAKey(<cryptography.hazmat.backends.openssl.rsa._RSAPublicKey object at 0x7f1b7175c160>)>), contact=('mailto:briansaia+LE_2468@protonmail.ch',), agreement='https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf', status='valid', terms_of_service_agreed=None, only_return_existing=None), uri='https://acme-v01.api.letsencrypt.org/acme/reg/35023266', new_authzr_uri='https://acme-v01.api.letsencrypt.org/acme/new-authz', terms_of_service='https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf'), 2eeaea34dae55a708aa0dbdc0bf18a4a, Meta(creation_dt=datetime.datetime(2018, 5, 16, 1, 14, 56, tzinfo=<UTC>), creation_host='<DOMAIN REDACTED>'))>
2019-01-12 06:54:31,106:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/directory.
2019-01-12 06:54:31,108:DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): acme-v02.api.letsencrypt.org
2019-01-12 06:54:31,607:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /directory HTTP/1.1" 200 658
2019-01-12 06:54:31,607:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 658
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:31 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:31 GMT
Connection: keep-alive

{
  "keyChange": "https://acme-v02.api.letsencrypt.org/acme/key-change",
  "lCVRgUjEhlM": "https://community.letsencrypt.org/t/adding-random-entries-to-the-directory/33417",
  "meta": {
    "caaIdentities": [
      "letsencrypt.org"
    ],
    "termsOfService": "https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf",
    "website": "https://letsencrypt.org"
  },
  "newAccount": "https://acme-v02.api.letsencrypt.org/acme/new-acct",
  "newNonce": "https://acme-v02.api.letsencrypt.org/acme/new-nonce",
  "newOrder": "https://acme-v02.api.letsencrypt.org/acme/new-order",
  "revokeCert": "https://acme-v02.api.letsencrypt.org/acme/revoke-cert"
}
2019-01-12 06:54:31,610:INFO:certbot.main:Renewing an existing certificate
2019-01-12 06:54:32,005:DEBUG:certbot.crypto_util:Generating key (4096 bits): /etc/letsencrypt/keys/0004_key-certbot.pem
2019-01-12 06:54:32,014:DEBUG:certbot.crypto_util:Creating CSR: /etc/letsencrypt/csr/0004_csr-certbot.pem
2019-01-12 06:54:32,014:DEBUG:acme.client:Requesting fresh nonce
2019-01-12 06:54:32,014:DEBUG:acme.client:Sending HEAD request to https://acme-v02.api.letsencrypt.org/acme/new-nonce.
2019-01-12 06:54:32,117:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "HEAD /acme/new-nonce HTTP/1.1" 204 0
2019-01-12 06:54:32,117:DEBUG:acme.client:Received response:
HTTP 204
Server: nginx
Replay-Nonce: S2TV0NvoWd20J0WnTtr0uLlz7fZjsfWQIhax1qT-HLg
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:32 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:32 GMT
Connection: keep-alive


2019-01-12 06:54:32,118:DEBUG:acme.client:Storing nonce: S2TV0NvoWd20J0WnTtr0uLlz7fZjsfWQIhax1qT-HLg
2019-01-12 06:54:32,118:DEBUG:acme.client:JWS payload:
b'{\n  "identifiers": [\n    {\n      "type": "dns",\n      "value": "<DOMAIN REDACTED>"\n    }\n  ]\n}'
2019-01-12 06:54:32,125:DEBUG:acme.client:Sending POST request to https://acme-v02.api.letsencrypt.org/acme/new-order:
{
  "protected": "eyJhbGciOiAiUlMyNTYiLCAia2lkIjogImh0dHBzOi8vYWNtZS12MDEuYXBpLmxldHNlbmNyeXB0Lm9yZy9hY21lL3JlZy8zNTAyMzI2NiIsICJub25jZSI6ICJTMlRWME52b1dkMjBKMFduVHRyMHVMbHo3Zlpqc2ZXUUloYXgxcVQtSExnIiwgInVybCI6ICJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9uZXctb3JkZXIifQ",
  "signature": "ogO84pcyC-rPjlpf4v1S4Ss8yRCbyvRqH75fc3eBisQVgEe9BsJiz410iPnqF5DeicQA6HTRVby1rb38rwtwYIlRQDA0sVSoaprYK_8-O_CbAsLYhnf3t72WUAHq5SDDrvGyxTe0hFrEjQN1n6tEqcaDgXxE7iaQ_phgFhNX0JMEz6Xt_nqDSNPbmOfajKVm9yd5_UOE2sAH8vX9K_HMmRxSgJwpW4WeBMSkKxYynDrwcj3lY1uncgU_UtLoxIC-RB7vBPEmrZvuhSyqkhR_NOk6yzFwHkSkAMGT-QbOlYladZfkROLAcDY5i8HR45Uru_XZric-y0KtbmCXyxUKXkaQHIW73G-djDKcUR_vAgjQ31UoTpuXgiFl_feai8Es-nTjclUpG58PmnFPWMz_unModcnjEbHFjka_IY9YzdXeJcprVntlrIp4SAN0SVJKn3ZluEUFDjU_pMi79Qk-RvAqTWLxd3MudqoabOGO3eM7X1B3--9-RR9kHf-xU9rExo11DaL1TE_VJRgNIIXPZilEOaobpzq0v9HpDDx4S9yeoeoyaDospRUpKTpX1do5Eq7AKZQXE7lMofbbkcs__uJ1dRwGzkeRb1hNXypSnei57Sb2F9Kr8ohHWx66lXxVXnTCJhSar9pEdtrl5upRD6A2aIAUgJ9_LpDZ3awMogs",
  "payload": "ewogICJpZGVudGlmaWVycyI6IFsKICAgIHsKICAgICAgInR5cGUiOiAiZG5zIiwKICAgICAgInZhbHVlIjogInZwcy5zYWx0eWN5YmVybmF1dC5uZXQiCiAgICB9CiAgXQp9"
}
2019-01-12 06:54:32,347:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "POST /acme/new-order HTTP/1.1" 201 381
2019-01-12 06:54:32,348:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 381
Boulder-Requester: 35023266
Location: https://acme-v02.api.letsencrypt.org/acme/order/35023266/268208468
Replay-Nonce: DA9Ir1MJ06koKhdTsBKl6ZVNMGi2UNjZfNRzbLLm1dQ
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:32 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:32 GMT
Connection: keep-alive

{
  "status": "pending",
  "expires": "2019-01-19T14:54:32.286429096Z",
  "identifiers": [
    {
      "type": "dns",
      "value": "<DOMAIN REDACTED>"
    }
  ],
  "authorizations": [
    "https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8"
  ],
  "finalize": "https://acme-v02.api.letsencrypt.org/acme/finalize/35023266/268208468"
}
2019-01-12 06:54:32,348:DEBUG:acme.client:Storing nonce: DA9Ir1MJ06koKhdTsBKl6ZVNMGi2UNjZfNRzbLLm1dQ
2019-01-12 06:54:32,348:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8.
2019-01-12 06:54:32,436:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8 HTTP/1.1" 200 1170
2019-01-12 06:54:32,437:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1170
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:32 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:32 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "<DOMAIN REDACTED>"
  },
  "status": "pending",
  "expires": "2019-01-19T14:54:32Z",
  "challenges": [
    {
      "type": "tls-alpn-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290539",
      "token": "E1BLU6G-tTTf98wyN8gmMPmQy878LPwIHIs197IAmHY"
    },
    {
      "type": "tls-sni-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290540",
      "token": "skQX8KTcubGxUwc68Dse36hx0S6p-RUKOs9yGw38vwk"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290541",
      "token": "WFXTAdmDExsxJHUUM_KJvBeoDrFW858WPxyBYydCTAc"
    },
    {
      "type": "http-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
      "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs"
    }
  ]
}
2019-01-12 06:54:32,437:INFO:certbot.auth_handler:Performing the following challenges:
2019-01-12 06:54:32,438:INFO:certbot.auth_handler:http-01 challenge for <DOMAIN REDACTED>
2019-01-12 06:54:32,438:DEBUG:acme.standalone:Successfully bound to :80 using IPv6
2019-01-12 06:54:32,438:DEBUG:acme.standalone:Certbot wasn't able to bind to :80 using IPv4, this is often expected due to the dual stack nature of IPv6 socket implementations.
2019-01-12 06:54:32,444:INFO:certbot.auth_handler:Waiting for verification...
2019-01-12 06:54:32,444:DEBUG:acme.client:JWS payload:
b'{\n  "resource": "challenge",\n  "keyAuthorization": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs.O7A9QqdSNclf1pkP7eTaQLQRc5fvaMMFSCmCS_H3zQg",\n  "type": "http-01"\n}'
2019-01-12 06:54:32,451:DEBUG:acme.client:Sending POST request to https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542:
{
  "protected": "eyJhbGciOiAiUlMyNTYiLCAia2lkIjogImh0dHBzOi8vYWNtZS12MDEuYXBpLmxldHNlbmNyeXB0Lm9yZy9hY21lL3JlZy8zNTAyMzI2NiIsICJub25jZSI6ICJEQTlJcjFNSjA2a29LaGRUc0JLbDZaVk5NR2kyVU5qWmZOUnpiTExtMWRRIiwgInVybCI6ICJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9jaGFsbGVuZ2UvMmZ5VWR2S3Y1VngxdzlpbW9iQURXQ2QyRWVmVjVjTXN4SGRTcTBNMVZIOC8xMTM4NTI5MDU0MiJ9",
  "signature": "Ehy-2C-ibHOlpr0LcQrUZAraJldzQwDwqj4WXcCpG6KfYl7Kl9ra9hKmzn61sg9lzRUTJ0UwEjaF-gUM05LD5XnMCxsNMfghGO14QNB2z8B9xeUaxEiX1fLIkFMLIitQr-PmKbl6kl5ZSNMRqXQfBgwm-IfL23t0zGsEggCuRLbuPWVJ1VppcP3pdrgwuCfmlHs03nJYMygu4n-lwAd14nX19Lx4KUdUycVUlMAvAkRXOqLLEQtIqUv4sZypuTqj4e5gVgleXUkYd9Z3ZjD90WoE76dRoOkUaUd1df5zNmYBgFGnQuvOgX-h0u_IOCKTpr2F2eQnpo_xP0BZt6kkZIhXGQz6tL6aT0uF3mYxznvBljalQhs02A78xAafNIQZ67nlpBlCV7Oipo3VZLEqsX961aCtQXzAQRQu22wp6D0snGd6Rp2NXv37hGc1eeoHBAlyhAwnTTmGQ857yNg77b2YQVVs0PtgER0rrSOklhhZbovk24kEPXivd1Tn2nslHQA_Vq7VKaX9QothRm6ceOb0BYQScOqYYY8OBeFVpVd4jvSIQ50Ngg1jAOJYx0--qPNhcwmlggU6ldM2aIKhSRsauggIa3-vaQ8yp0EgIM8FiAhRvXHr3cncGOUdiZlTQPNRH5rT2KR467qcj_d3l8dZlPvmtHtzRdIzNQUMztE",
  "payload": "ewogICJyZXNvdXJjZSI6ICJjaGFsbGVuZ2UiLAogICJrZXlBdXRob3JpemF0aW9uIjogIkZWZzNmY1lKbVBMbVI4LU5IajBOQVg1Mm0tak5XRjNLMkpHeDUwUEp4UnMuTzdBOVFxZFNOY2xmMXBrUDdlVGFRTFFSYzVmdmFNTUZTQ21DU19IM3pRZyIsCiAgInR5cGUiOiAiaHR0cC0wMSIKfQ"
}
2019-01-12 06:54:32,571:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "POST /acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542 HTTP/1.1" 200 224
2019-01-12 06:54:32,571:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 224
Boulder-Requester: 35023266
Link: <https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8>;rel="up"
Location: https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542
Replay-Nonce: kg2ytIuHcVyqU9OGz7XefLKHIIomMTuciUhZu25IBk4
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:32 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:32 GMT
Connection: keep-alive

{
  "type": "http-01",
  "status": "pending",
  "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
  "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs"
}
2019-01-12 06:54:32,572:DEBUG:acme.client:Storing nonce: kg2ytIuHcVyqU9OGz7XefLKHIIomMTuciUhZu25IBk4
2019-01-12 06:54:35,574:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8.
2019-01-12 06:54:35,741:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8 HTTP/1.1" 200 1170
2019-01-12 06:54:35,742:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1170
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:35 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:35 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "<DOMAIN REDACTED>"
  },
  "status": "pending",
  "expires": "2019-01-19T14:54:32Z",
  "challenges": [
    {
      "type": "tls-alpn-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290539",
      "token": "E1BLU6G-tTTf98wyN8gmMPmQy878LPwIHIs197IAmHY"
    },
    {
      "type": "tls-sni-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290540",
      "token": "skQX8KTcubGxUwc68Dse36hx0S6p-RUKOs9yGw38vwk"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290541",
      "token": "WFXTAdmDExsxJHUUM_KJvBeoDrFW858WPxyBYydCTAc"
    },
    {
      "type": "http-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
      "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs"
    }
  ]
}
2019-01-12 06:54:38,746:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8.
2019-01-12 06:54:38,855:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8 HTTP/1.1" 200 1170
2019-01-12 06:54:38,856:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1170
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:38 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:38 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "<DOMAIN REDACTED>"
  },
  "status": "pending",
  "expires": "2019-01-19T14:54:32Z",
  "challenges": [
    {
      "type": "tls-alpn-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290539",
      "token": "E1BLU6G-tTTf98wyN8gmMPmQy878LPwIHIs197IAmHY"
    },
    {
      "type": "tls-sni-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290540",
      "token": "skQX8KTcubGxUwc68Dse36hx0S6p-RUKOs9yGw38vwk"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290541",
      "token": "WFXTAdmDExsxJHUUM_KJvBeoDrFW858WPxyBYydCTAc"
    },
    {
      "type": "http-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
      "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs"
    }
  ]
}
2019-01-12 06:54:41,858:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8.
2019-01-12 06:54:41,947:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8 HTTP/1.1" 200 1170
2019-01-12 06:54:41,947:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1170
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:41 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:41 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "<DOMAIN REDACTED>"
  },
  "status": "pending",
  "expires": "2019-01-19T14:54:32Z",
  "challenges": [
    {
      "type": "tls-alpn-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290539",
      "token": "E1BLU6G-tTTf98wyN8gmMPmQy878LPwIHIs197IAmHY"
    },
    {
      "type": "tls-sni-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290540",
      "token": "skQX8KTcubGxUwc68Dse36hx0S6p-RUKOs9yGw38vwk"
    },
    {
      "type": "dns-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290541",
      "token": "WFXTAdmDExsxJHUUM_KJvBeoDrFW858WPxyBYydCTAc"
    },
    {
      "type": "http-01",
      "status": "pending",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
      "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs"
    }
  ]
}
2019-01-12 06:54:44,951:DEBUG:acme.client:Sending GET request to https://acme-v02.api.letsencrypt.org/acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8.
2019-01-12 06:54:45,032:DEBUG:urllib3.connectionpool:https://acme-v02.api.letsencrypt.org:443 "GET /acme/authz/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8 HTTP/1.1" 200 1823
2019-01-12 06:54:45,033:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 1823
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Sat, 12 Jan 2019 14:54:45 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Sat, 12 Jan 2019 14:54:45 GMT
Connection: keep-alive

{
  "identifier": {
    "type": "dns",
    "value": "<DOMAIN REDACTED>"
  },
  "status": "invalid",
  "expires": "2019-01-19T14:54:32Z",
  "challenges": [
    {
      "type": "tls-alpn-01",
      "status": "invalid",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290539",
      "token": "E1BLU6G-tTTf98wyN8gmMPmQy878LPwIHIs197IAmHY"
    },
    {
      "type": "tls-sni-01",
      "status": "invalid",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290540",
      "token": "skQX8KTcubGxUwc68Dse36hx0S6p-RUKOs9yGw38vwk"
    },
    {
      "type": "dns-01",
      "status": "invalid",
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290541",
      "token": "WFXTAdmDExsxJHUUM_KJvBeoDrFW858WPxyBYydCTAc"
    },
    {
      "type": "http-01",
      "status": "invalid",
      "error": {
        "type": "urn:ietf:params:acme:error:connection",
        "detail": "Fetching http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs: Timeout during connect (likely firewall problem)",
        "status": 400
      },
      "url": "https://acme-v02.api.letsencrypt.org/acme/challenge/2fyUdvKv5Vx1w9imobADWCd2EefV5cMsxHdSq0M1VH8/11385290542",
      "token": "FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs",
      "validationRecord": [
        {
          "url": "http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs",
          "hostname": "<DOMAIN REDACTED>",
          "port": "80",
          "addressesResolved": [
            "<IP REDACTED>"
          ],
          "addressUsed": "<IP REDACTED>"
        }
      ]
    }
  ]
}
2019-01-12 06:54:45,034:DEBUG:certbot.reporter:Reporting to user: The following errors were reported by the server:

Domain: <DOMAIN REDACTED>
Type:   connection
Detail: Fetching http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs: Timeout during connect (likely firewall problem)

To fix these errors, please make sure that your domain name was entered correctly and the DNS A/AAAA record(s) for that domain contain(s) the right IP address. Additionally, please check that your computer has a publicly routable IP address and that no firewalls are preventing the server from communicating with the client. If you're using the webroot plugin, you should also verify that you are serving files from the webroot path you provided.
2019-01-12 06:54:45,035:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 82, in handle_authorizations
    self._respond(aauthzrs, resp, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 161, in _respond
    self._poll_challenges(aauthzrs, chall_update, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 232, in _poll_challenges
    raise errors.FailedChallenges(all_failed_achalls)
certbot.errors.FailedChallenges: Failed authorization procedure. <DOMAIN REDACTED> (http-01): urn:ietf:params:acme:error:connection :: The server could not connect to the client to verify the domain :: Fetching http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs: Timeout during connect (likely firewall problem)

2019-01-12 06:54:45,035:DEBUG:certbot.error_handler:Calling registered functions
2019-01-12 06:54:45,035:INFO:certbot.auth_handler:Cleaning up challenges
2019-01-12 06:54:45,036:DEBUG:certbot.plugins.standalone:Stopping server at :::80...
2019-01-12 06:54:45,457:WARNING:certbot.renewal:Attempting to renew cert (<DOMAIN REDACTED>) from /etc/letsencrypt/renewal/<DOMAIN REDACTED>.conf produced an unexpected error: Failed authorization procedure. <DOMAIN REDACTED> (http-01): urn:ietf:params:acme:error:connection :: The server could not connect to the client to verify the domain :: Fetching http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs: Timeout during connect (likely firewall problem). Skipping.
2019-01-12 06:54:45,463:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 430, in handle_renewal_request
    main.renew_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1168, in renew_cert
    renewed_lineage = _get_and_save_cert(le_client, config, lineage=lineage)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 116, in _get_and_save_cert
    renewal.renew_cert(config, domains, le_client, lineage)
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 305, in renew_cert
    new_cert, new_chain, new_key, _ = le_client.obtain_certificate(domains, new_key)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 335, in obtain_certificate
    orderr = self._get_order_and_authorizations(csr.data, self.config.allow_subset_of_names)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 371, in _get_order_and_authorizations
    authzr = self.auth_handler.handle_authorizations(orderr, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 82, in handle_authorizations
    self._respond(aauthzrs, resp, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 161, in _respond
    self._poll_challenges(aauthzrs, chall_update, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 232, in _poll_challenges
    raise errors.FailedChallenges(all_failed_achalls)
certbot.errors.FailedChallenges: Failed authorization procedure. <DOMAIN REDACTED> (http-01): urn:ietf:params:acme:error:connection :: The server could not connect to the client to verify the domain :: Fetching http://<DOMAIN REDACTED>/.well-known/acme-challenge/FVg3fcYJmPLmR8-NHj0NAX52m-jNWF3K2JGx50PJxRs: Timeout during connect (likely firewall problem)

2019-01-12 06:54:45,464:ERROR:certbot.renewal:All renewal attempts failed. The following certs could not be renewed:
2019-01-12 06:54:45,466:ERROR:certbot.renewal:  /etc/letsencrypt/live/<DOMAIN REDACTED>/fullchain.pem (failure)
2019-01-12 06:54:45,467:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/certbot", line 11, in <module>
    load_entry_point('certbot==0.28.0', 'console_scripts', 'certbot')()
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1340, in main
    return config.func(config, plugins)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1247, in renew
    renewal.handle_renewal_request(config)
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 455, in handle_renewal_request
    len(renew_failures), len(parse_failures)))
certbot.errors.Error: 1 renew failure(s), 0 parse failure(s)
Here are the two relevant lines from the log above for the first time certbot switched from tls-sni-01 to http-01:
...
2019-01-12 06:54:32,437:INFO:certbot.auth_handler:Performing the following challenges:
2019-01-12 06:54:32,438:INFO:certbot.auth_handler:http-01 challenge for <DOMAIN REDACTED>
...
There needs to be some sort of notification for this change. Hours were spent trying to diagnose why the renewal process suddenly failed.