d3xt3r01 commented on 29 Dec 2016
So, today it seems that I have an issue connecting to acme-v01.api.letsencrypt.org via ipv6 ...
$ curl https://acme-v01.api.letsencrypt.org -6 -v
* Rebuilt URL to: https://acme-v01.api.letsencrypt.org/
*   Trying 2a02:26f0:c000:182::3d5...
* TCP_NODELAY set
 
$ sudo mtr -n -6 -c1 --report acme-v01.api.letsencrypt.org
Start: Thu Dec 29 01:22:16 2016
HOST: d3xbucharest                Loss%   Snt   Last   Avg  Best  Wrst StDev
  1.|-- 2001:470:1f1b:1cb::3       0.0%     1    0.7   0.7   0.7   0.7   0.0
  2.|-- 2001:470:1f1a:1cb::1       0.0%     1   15.5  15.5  15.5  15.5   0.0
  3.|-- 2001:470:0:2ba::1          0.0%     1   15.1  15.1  15.1  15.1   0.0
  4.|-- 2001:470:0:2b3::1          0.0%     1   24.6  24.6  24.6  24.6   0.0
  5.|-- 2001:470:0:1b4::1          0.0%     1   36.8  36.8  36.8  36.8   0.0
  6.|-- 2001:470:0:213::1          0.0%     1   34.8  34.8  34.8  34.8   0.0
  7.|-- 2001:7f8::cb9:0:1          0.0%     1   42.8  42.8  42.8  42.8   0.0
  8.|-- ???                       100.0     1    0.0   0.0   0.0   0.0   0.0
Not sure exactly where the issue is .. other sites work just fine on v6.
Anyhow, I thought about using ipv4 .. but it seems to lack a param for that.
So, I hacked /usr/lib64/python2.7/site-packages/acme/client.py and added this
# At the top
from requests_toolbelt.adapters.source import SourceAddressAdapter

# At line 513
self.session.mount('http://', SourceAddressAdapter('localip'))
self.session.mount('https://', SourceAddressAdapter('localip'))