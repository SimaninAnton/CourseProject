RichardNeill commented on 12 Sep 2016
I have multiple websites on a single Apache server, each with separate config files, and each with a DocumentRoot, ServerName and multiple ServerAliases.
To illustrate this, lets assume my server contains 3 completely unrelated websites, dedicated to selling fruit, tools, and travel:
(A) Fruit:
/etc/apache/sites-enabled/fruit-conf contains:
ServerName apples.com
ServerAlias www.apples.com
ServerAlias oranges.com
ServerAlias www.oranges.com
ServerAlias kiwis.com
ServerAlias www.kiwis.com
DocumentRoot /var/www/fruits/
(B) tools:
/etc/apache/sites-enabled/tools-conf contains:
ServerName spanners.com
ServerAlias www.spanners.com
ServerAlias hammers.com
ServerAlias www.hammers.com
DocumentRoot /var/www/tools/
(C) Travel:
/etc/apache/sites-enabled/fruit-conf contains:
ServerName visit-usa.com
ServerAlias www.visit-usa.com
ServerAlias seefrance.com
ServerAlias www.seefrance.com
DocumentRoot /var/www/travel/
I then use certbot-auto, and follow the prompts. It asks me whether I want to obtain certificates for:
1: apples.com
2: www.oranges.com
3: www.apples.com
...
14: seefrance.com
This is partially correct, in that I want to https-enable my entire server.
However, it is misleading in that I don't want a single cert that covers both hammers and oranges! I actually want one cert for all the fruity-domains, one cert for all the travel domains, and one cert for all the tools-domains.
Problem 1: Misleading interface - it is unclear from the prompt what will happen (am I being prompted to enable a single cert covering all domains, or am I being prompted to get certs for everything?)
Problem 2: The certs should (by default, imho?) group according to the virtual-hosts. If they don't this is at best confusing to the user, and at worst a possible information leak (a cert for https://hammers.com is allowed to contain a reference to spanners.com, but not to some-unrelated-possibly-private-domain-hosted-on-the-same-ip.com).
Problem 3: A minor one, but the list of domains is not sorted in a sensible way. I think it should sort first by all domains in the same vhost, and then it should order the "www." variant of the url to be listed straight after the unprefixed version.
Workaround: invoke certbot-auto N times, manually select the appropriate domains from the list to group together. This alternative is much more time-consuming and error-prone.
Thanks for your consideration, and your work on a great product.