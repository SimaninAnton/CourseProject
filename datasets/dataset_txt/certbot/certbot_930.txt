hozza commented on 20 Oct 2017
If anyone can shed some light on this problem I'd be forever grateful! Long-time Linux, first time certbot sys-admin. - doing by best to follow the issue template prompts here too...
Ubuntu 16.04
Installed certbox with apt-get (suggested in Digital Ocean docs)
How I'm running certbot
certbot auto renew is setup on a cron-job at 03:10 everyday to check (and potentially renew the certificates) using the apache plugin
Certbot's behavior differed from what I expected because:
the letsencrypt logs show at 3am and then again at 12 noon and also midnight - why is that?
and my apache server is being gracefully restarted (assuming by the apache plugin, as I've not manually configured it to) at 06:25 on the dot everyday.
I've looked through the certbot apache plugin code here on github and it does execute a graceful restart (as it needs to), but there is no mention of a specific time...? Why would the server restart at 06.25 (only) everyday when certbot is firing at 03.10 (I would guess a varying delay in restart, based on how long certbot took this time, maybe couple mins, but that doesn't match up with 06.25) - and no idea why certbot is also showing logs checking certificates at the other times... :S
I've looked through the crontab, nothing in there - also checked the cron directories and no mention of letsencrypt/certbot or anything that would restart apache at 06.25.
Here is a Certbot log showing the issue (if available):
My (only) cron:
10 3 * * * /usr/bin/certbot renew --quiet
apcache logs showing restart time...
[Fri Oct 20 06:25:03.814934 2017] [mpm_prefork:notice] [pid 21054] AH00171: Graceful restart requested, doing restart
AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1. Set the 'ServerName' directive globally to suppress this message
and in the next apache log file...
[Fri Oct 20 06:25:04.493316 2017] [mpm_prefork:notice] [pid 21054] AH00163: Apache/2.4.18 (Ubuntu) OpenSSL/1.0.2g configured -- resuming normal operations
[Fri Oct 20 06:25:04.493387 2017] [core:notice] [pid 21054] AH00094: Command line: '/usr/sbin/apache2'
lets encrypt / certbot log from 03.10 (the correct time from cron... assumed graceful restart would happen a couple mins later?)
2017-10-20 03:10:01,703:DEBUG:certbot.main:certbot version: 0.14.2
2017-10-20 03:10:01,704:DEBUG:certbot.main:Arguments: ['--quiet']
2017-10-20 03:10:01,704:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#manual,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
lets encrypt / certbot log from 12 noon and 00:00 midnight (have no idea why it's firing then...)
2017-10-20 00:22:21,051:DEBUG:certbot.main:certbot version: 0.14.2
2017-10-20 00:22:21,051:DEBUG:certbot.main:Arguments: ['-q']
2017-10-20 00:22:21,051:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#manual,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2017-10-20 12:54:23,070:DEBUG:certbot.main:certbot version: 0.14.2
2017-10-20 12:54:23,071:DEBUG:certbot.main:Arguments: ['-q']
2017-10-20 12:54:23,071:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#manual,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
I've only shown logs for 2017-10-20 but it happens every day, and I've only shown the first few lines of logs, if more are needed to help - let me know...