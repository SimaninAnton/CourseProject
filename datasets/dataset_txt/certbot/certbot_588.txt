nero120 commented on 25 Apr 2018
I'm running the following command via root's crontab on Ubuntu 16.04.4 LTS and using certbot [0.22.2-1+ubuntu16.04.1+certbot+1] installed via apt-get:
certbot renew --dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/dnscloudflare.ini
I get the following error:
certbot: error: unrecognized arguments: --dns-cloudflare-credentials /etc/letsencrypt/dnscloudflare.ini
However running the same command as root (either via sudo or su) completes successfully. I installed the certbot-dns-cloudflare plugin by (running as root) cloning the certbot repo and running the /certbot-dns-cloudflare/setup.py script using the command python setup.py install. To confirm it's installation, running certbot plugins as root returns:
-------------------------------------------------------------------------------
* dns-cloudflare
Description: Obtain certificates using a DNS TXT record (if you are using
Cloudflare for DNS).
Interfaces: IAuthenticator, IPlugin
Entry point: dns-cloudflare =
certbot_dns_cloudflare.dns_cloudflare:Authenticator

* standalone
Description: Spin up a temporary webserver
Interfaces: IAuthenticator, IPlugin
Entry point: standalone = certbot.plugins.standalone:Authenticator

* webroot
Description: Place files in webroot directory
Interfaces: IAuthenticator, IPlugin
Entry point: webroot = certbot.plugins.webroot:Authenticator
-------------------------------------------------------------------------------
However running certbot plugins in the root crontab:
-------------------------------------------------------------------------------
* nginx
Description: Nginx Web Server plugin - Alpha
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: nginx = certbot_nginx.configurator:NginxConfigurator

* standalone
Description: Spin up a temporary webserver
Interfaces: IAuthenticator, IPlugin
Entry point: standalone = certbot.plugins.standalone:Authenticator

* webroot
Description: Place files in webroot directory
Interfaces: IAuthenticator, IPlugin
Entry point: webroot = certbot.plugins.webroot:Authenticator
-------------------------------------------------------------------------------
Clearly crontab is not recognising that the cloudflare plugin has been installed. It's possible I've misunderstood the plugin installation process as I couldn't find much helpful documentation on the process, any ideas?