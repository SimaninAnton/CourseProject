stylersnico commented on 1 Aug 2016 â€¢
edited
Hi everyone,
Renewal fail if I use a HTTP to HTTPS redirection like this:
        if ($http_host = abyssproject.net){
            return 303 https://www.abyssproject.net$request_uri;
        }
        if ($scheme != "https") {
            rewrite ^ https://$http_host$request_uri? permanent;
        }
root@webhost:/etc/letsencrypt/live-ecdsa/abyssproject.net/letmp# /etc/letsencrypt/letsencrypt-auto certonly -a webroot --email contact@nsweb.solutions --webroot-path /var/www/abyssproject.net/web/ --csr /etc/letsencrypt/live-ecdsa/abyssproject.net/csr-p384.der --renew-by-default --agree-tos
Failed authorization procedure. www.abyssproject.net (http-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Could not connect to http://www.abyssproject.net/.well-known/acme-challenge/wx6qmXvRpYLuhy6zvuGdA0J9NRCmgrWCxYjRdxD1YCo, abyssproject.net (http-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Could not connect to http://abyssproject.net/.well-known/acme-challenge/0z-LBu09KKMA1Rmv2loakculeGNnMk057LG7YRaZzGI

IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: www.abyssproject.net
   Type:   connection
   Detail: Could not connect to
   http://www.abyssproject.net/.well-known/acme-challenge/wx6qmXvRpYLuhy6zvuGdA0J9NRCmgrWCxYjRdxD1YCo

   Domain: abyssproject.net
   Type:   connection
   Detail: Could not connect to
   http://abyssproject.net/.well-known/acme-challenge/0z-LBu09KKMA1Rmv2loakculeGNnMk057LG7YRaZzGI

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A record(s) for that domain
   contain(s) the right IP address. Additionally, please check that
   your computer has a publicly routable IP address and that no
   firewalls are preventing the server from communicating with the
   client. If you're using the webroot plugin, you should also verify
   that you are serving files from the webroot path you provided.
I can access http://abyssproject.net/.well-known/acme-challenge/test perfectly from HTTPS (or HTTP) but the client fail every time.
And it works everytime with the --dry-run option, no error ...
How can I solve that?
(I use P-384 ECDSA certs)
Thanks
3