tomwassenberg commented on 9 Jan 2018 â€¢
edited
My operating system is (include version):
Ubuntu 16.04
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
Certbot 0.19.0 from the PPA
I ran this command and it produced this output:
I ran the following commands consecutively:
tom@tom-vps:/etc/letsencrypt$ sudo -H certbot certonly --manual \
> --manual-public-ip-logging-ok --preferred-challenges dns -d router.tomwassenberg.nl
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator manual, Installer None
Obtaining a new certificate
Performing the following challenges:
dns-01 challenge for router.tomwassenberg.nl

-------------------------------------------------------------------------------
Please deploy a DNS TXT record under the name
_acme-challenge.router.tomwassenberg.nl with the following value:

h5Nnrver4yeJSta884lEkZuD24ndlh0SC1Or0UbLUc8

Before continuing, verify the record is deployed.
-------------------------------------------------------------------------------
Press Enter to Continue
Waiting for verification...
Cleaning up challenges
archive directory exists for router.tomwassenberg.nl
tom@tom-vps:/etc/letsencrypt$ sudo ls -l live/router.tomwassenberg.nl/cert.pem
lrwxrwxrwx 1 root root  47 Oct 31 09:15 cert.pem -> ../../archive/router.tomwassenberg.nl/cert1.pem
tom@tom-vps:/etc/letsencrypt$ sudo -H certbot certificates --cert-name router.tomwassenberg.nl
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Renewal configuration file /etc/letsencrypt/renewal/router.tomwassenberg.nl.conf produced an unexpected error: renewal config file {} is missing a required file reference. Skipping.

-------------------------------------------------------------------------------
Found the following matching certs:

The following renewal configuration files were invalid:
  /etc/letsencrypt/renewal/router.tomwassenberg.nl.conf
-------------------------------------------------------------------------------
tom@tom-vps:/etc/letsencrypt$ ls -l renewal/router.tomwassenberg.nl.conf
ls -l renewal/router.tomwassenberg.nl.conf
-rw-r--r-- 1 root root 0 Jan  9 12:42 renewal/router.tomwassenberg.nl.conf
Certbot's behavior differed from what I expected because:
I tried to renew a certificate for which I deleted the renewal configuration earlier, because it was using a DNS-01 plugin I couldn't get working any more. So I wanted to renew the certificate by performing the DNS-01 challenge manually.
I expected the certificate to be issued, and for the symlinks in /etc/letsencrypt/live/router.tomwassenberg.nl to be updated to the new files. Instead, Certbot exited without a clear message that indicated success or failure. Also I can't find the certificate anywhere, although it seems to be issued.
Afterwards, I ran the same command (the first one in the output above) again, and then it created a new lineage (router.tomwassenberg.nl-0001) with a valid certificate.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Log
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
Not relevant, using DNS-01.