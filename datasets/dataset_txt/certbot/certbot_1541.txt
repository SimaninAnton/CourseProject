Member
pde commented on 23 Dec 2016 â€¢
edited
Encountered while trying to move a config directory into our tree to make test farm tests with it:
certbot certificates --config-dir $PWD/tests/letstest/testdata/sample-config/

3 00:04:06,256:DEBUG:certbot.main:Root logging level set at 20
2016-12-23 00:04:06,257:INFO:certbot.main:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2016-12-23 00:04:06,257:DEBUG:certbot.main:certbot version: 0.10.0.dev0
2016-12-23 00:04:06,257:DEBUG:certbot.main:Arguments: ['--config-dir', '/home/pde/certbot/certbot/tests/letstest/testdata/sample-config/']
2016-12-23 00:04:06,258:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#script,PluginEntryPoint#standalone,PluginEntryPoint#manual,PluginEntryPoint#webroot,PluginEntryPoint#nginx,PluginEntryPoint#apache,PluginEntryPoint#null)
2016-12-23 00:04:06,259:WARNING:certbot.cert_manager:Renewal configuration file /home/pde/certbot/certbot/tests/letstest/testdata/sample-config/renewal/isnot.org.conf produced an unexpected error: expected /tmp/sample-config/live/isnot.org/cert.pem to be a symlink. Skipping.
2016-12-23 00:04:06,259:DEBUG:certbot.cert_manager:Traceback was:
Traceback (most recent call last):
  File "/home/pde/certbot/certbot/certbot/cert_manager.py", line 75, in certificates
    renewal_candidate = storage.RenewableCert(renewal_file, config)
  File "/home/pde/certbot/certbot/certbot/storage.py", line 392, in __init__
    self._check_symlinks()
  File "/home/pde/certbot/certbot/certbot/storage.py", line 431, in _check_symlinks
    "expected {0} to be a symlink".format(link))
CertStorageError: expected /tmp/sample-config/live/isnot.org/cert.pem to be a symlink

2016-12-23 00:04:06,260:WARNING:certbot.cert_manager:Renewal configuration file /home/pde/certbot/certbot/tests/letstest/testdata/sample-config/renewal/is.isnot.org.conf produced an unexpected error: expected /tmp/sample-config/live/is.isnot.org/cert.pem to be a symlink. Skipping.
2016-12-23 00:04:06,260:DEBUG:certbot.cert_manager:Traceback was:
Traceback (most recent call last):
  File "/home/pde/certbot/certbot/certbot/cert_manager.py", line 75, in certificates
    renewal_candidate = storage.RenewableCert(renewal_file, config)
  File "/home/pde/certbot/certbot/certbot/storage.py", line 392, in __init__
    self._check_symlinks()
  File "/home/pde/certbot/certbot/certbot/storage.py", line 431, in _check_symlinks
    "expected {0} to be a symlink".format(link))
CertStorageError: expected /tmp/sample-config/live/is.isnot.org/cert.pem to be a symlink
The problem is this:
cat tests/letstest/testdata/sample-config/renewal/isnot.org.conf
# renew_before_expiry = 30 days
version = 0.10.0.dev0
archive_dir = /tmp/sample-config/archive/isnot.org
cert = /tmp/sample-config/live/isnot.org/cert.pem
privkey = /tmp/sample-config/live/isnot.org/privkey.pem
chain = /tmp/sample-config/live/isnot.org/chain.pem
fullchain = /tmp/sample-config/live/isnot.org/fullchain.pem

# Options used in the renewal process
[renewalparams]
authenticator = apache
installer = apache
account = 7938300b2c3f1793e9f494c2be6918a5
config_dir = /tmp/sample-config
This config dir was created below /tmp/ on one machine, and is unhappy being moved elsewhere.