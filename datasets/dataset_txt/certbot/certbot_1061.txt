Contributor
jsoref commented on 13 Jul 2017
(see also #4927)
My operating system is (include version):
RHEL6
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto
I ran this command and it produced this output:
./certbot-auto
...
Which names would you like to activate HTTPS for?
-------------------------------------------------------------------------------
{7 domains listed}
-------------------------------------------------------------------------------
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): 3
Obtaining a new certificate
Performing the following challenges:
...
Deploying Certificate for ... to VirtualHost /etc/httpd/conf.d/001-test-ssl.conf
...
Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
-------------------------------------------------------------------------------
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
-------------------------------------------------------------------------------
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Redirecting vhost in /etc/httpd/conf.d/001-test.conf to ssl vhost in /etc/httpd/conf.d/001-test-ssl.conf
Certbot's behavior differed from what I expected because:
It broke my SAN certificate (which held 2 of the 7 domains) and was used by the vhost that it was editing
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
(Available if necessary)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
<VirtualHost *:80>
        Servername test.example.com
        ServerAlias example.example.org
        ServerAlias test
        ServerAlias example
</VirtualHost>
What I did was really naive and lazy (and didn't work).
What I wanted was a way to get certbot to just write out the redirects it would have written had I properly guessed the certificates for the vhost. It'd be great if there was a command that could do just that to save people like me from messing up our apache (or nginx) configurations.