Contributor
mgedmin commented on 23 Jan 2019
If you have pip 19, pip install certbot-apache fails with
Exception:
Traceback (most recent call last):
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/cli/base_command.py", line 176, in main
    status = self.run(options, args)
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/commands/install.py", line 393, in run
    use_user_site=options.use_user_site,
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/req/__init__.py", line 57, in install_given_reqs
    **kwargs
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/req/req_install.py", line 919, in install
    use_user_site=use_user_site, pycompile=pycompile,
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/req/req_install.py", line 445, in move_wheel_files
    warn_script_location=warn_script_location,
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/wheel.py", line 583, in move_wheel_files
    outrows = get_csv_rows_for_installed(reader)
  File "/tmp/py3/lib/python3.6/site-packages/pip/_internal/wheel.py", line 565, in get_csv_rows_for_installed
    for fpath, digest, length in old_csv_rows:
ValueError: too many values to unpack (expected 3)
which is pypa/pip#6165, but really caused by pypa/wheel#280.
I've seen this ValueError in one of the comments in #6682, but certbot-auto is not the only affected use-case (although I understand that users who create virtualenvs by hand and pip install certbot-apace in there are not officially supported).
I'm filing this issue here because certbot-apache could avoid this issue if it renamed two test files
./certbot-apache/certbot_apache/tests/testdata/debian_apache_2_4/augeas_vhosts/apache2/sites-enabled/old,default.conf
./certbot-apache/certbot_apache/tests/testdata/debian_apache_2_4/augeas_vhosts/apache2/sites-available/old,default.conf
to something that doesn't have a comma in the filename.
4