Talkless commented on 11 Apr 2017
My operating system is (include version):
Debian 8 amd64
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
# wget -q -O certbot-auto https://dl.eff.org/certbot-auto
# chmod a+x certbot-auto 
# mv certbot-auto /usr/local/bin/certbot
I ran this command and it produced this output:
I create initial certificates like this:
certbot certonly --non-interactive --agree-tos --no-self-upgrade --email info@domain.com --apache -d my.domain.com
Certbot creates /root/.local/share/letsencrytfile tree:
# tree -a /root/.local/ | head
/root/.local/
└── share
    └── letsencrypt
        ├── bin
        │   ├── activate
        │   ├── activate.csh
        │   ├── activate.fish
        │   ├── activate_this.py
        │   ├── certbot
        │   ├── easy_install
BUT,
After declaring systemd unit file /etc/systemd/system/certbot.service (to be usde by certbot.timer) like this:
[Unit]
Description=Certbot

[Service]
Type=oneshot
ExecStart=/usr/local/bin/certbot --no-self-upgrade -q renew
PrivateTmp=true
And execute systemctl start certbot.service (or by setting up certbot.timer), Certbot creates different configuration file tree in system root, in ~ directory:
# tree -a /~/ | head                                                                                                                                     
/~/
└── .local
    └── share
        └── letsencrypt
            ├── bin
            │   ├── activate
            │   ├── activate.csh
            │   ├── activate.fish
            │   ├── activate_this.py
            │   ├── certbot
Certbot's behavior differed from what I expected because:
Certbot duplicates .local/share/letsencrypt in different path when executed as systemd service, compared to execution interactively in terminal. Seems like "~/" is not resolved when running as systemd service.
Here is a Certbot log showing the issue (if available):
There is no relevant log entries.