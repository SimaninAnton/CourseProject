unioncos commented on 16 Feb 2019
open or re-open ?? See #6322
I think certbot with the rfc 2136 authenticator option being used does not send the equivalent of a "rndc sync" command to cause the .jnl file with the TXT entries to write to the zone file - and it fails without a manual restart while the 60 sec period is waiting.
Then on cleanup does not send the equivalent of a "rndc sync -clean" to remove the entries and delete the journal file
On 2/14/2019 10:40 AM, Sydney wrote:
Hello! I'm not currently working on Certbot; could you open an issue on
GitHub? that way the team can track your request & problem ^_^ I'm happy
to hop on and provide more context in the GH issue thread if you'd like!
On 2/14/19 9:52 AM, Wilbur Union wrote:
I have the rfc2136 authenticator working with a cname setup for
letsencrypt wildcard ssl certificate dns-01 authentication renewal
During the 60 second delay wait for propagation I have to MANUALLY
restart BIND or the .jnl file with the TXT records sits uncommitted to
the zone
I have written about this before
I looked at the authenticator code but I am not a python programmer
Does the code issue a "rndc sync" command - because this is NEEDED to
flush the ..jnl file changes into the zone file so the authenticator can
"see" them
rndc sync -clean is needed to cleanup the TXT line entries
The problem is as you said in a previous email - certbot and the rfc
2136 authenticator command line option does not properly use actually
nsupdate. It uses API calls using dns-python
Also since the freeze - thaw commands are obsoleted by sync in BIND 9.9
could this be an issue ?? See
ftp://ftp.isc.org/isc/bind9/9.9.0/RELEASE-NOTES-BIND-9.9.0.txt at NEW
FEATURES
" "rndc sync" command dumps pending changes in a dynamic zone
to disk without a freeze/thaw cycle. "rndc sync -clean" removes
the journal file after syncing. "rndc freeze" no longer removes
journal files. [RT #22473]"
The other way to dump the changes is to restart BIND or stop it and
start it which is my workaround to flush the changes
The fastest way for me is to use Webnmin and hit the recycle BIND icon.
Is it possible the rfc 2136 authenticator needs to be re-written to
issue a sync command before the propagation wait of 60 seconds