santoshkumar92 commented on 9 Aug 2017
My operating system is (include version):
Ubuntu 16.04
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
sudo certbot --nginx
I ran this command and it produced this output:
sudo certbot --nginx
`2017-08-09 05:50:07,519:DEBUG:certbot.main:certbot version: 0.14.2
2017-08-09 05:50:07,519:DEBUG:certbot.main:Arguments: ['--nginx']
2017-08-09 05:50:07,519:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#manual,PluginEntryPoint#nginx,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2017-08-09 05:50:07,537:DEBUG:certbot.plugins.selection:Requested authenticator nginx and installer nginx
2017-08-09 05:50:07,537:DEBUG:certbot.cli:Default Detector is Namespace(account=<certbot.cli._Default object at 0x7f22c5137310>, agree_dev_preview=None, allow_subset_of_names=<certbot.cli._Default object at 0x7f22c5137710>, apache=<certbot.cli._Default object at 0x7f22c50e1250>, authenticator='nginx', break_my_certs=<certbot.cli._Default object at 0x7f22c514ab10>, cert_path=<certbot.cli._Default object at 0x7f22c515d710>, certname=<certbot.cli._Default object at 0x7f22c513e890>, chain_path=<certbot.cli._Default object at 0x7f22c515da10>, checkpoints=<certbot.cli._Default object at 0x7f22c515d210>, config_dir=<certbot.cli._Default object at 0x7f22c515db10>, config_file=None, configurator=<certbot.cli._Default object at 0x7f22c515df10>, csr=<certbot.cli._Default object at 0x7f22c5156fd0>, debug=<certbot.cli._Default object at 0x7f22c514a810>, debug_challenges=<certbot.cli._Default object at 0x7f22c514a610>, dialog=None, domains=<certbot.cli._Default object at 0x7f22c513ea10>, dry_run=<certbot.cli._Default object at 0x7f22c513e710>, duplicate=<certbot.cli._Default object at 0x7f22c5137190>, eff_email=<certbot.cli._Default object at 0x7f22c513e110>, email=<certbot.cli._Default object at 0x7f22c513e290>, expand=<certbot.cli._Default object at 0x7f22c5137c50>, force_interactive=<certbot.cli._Default object at 0x7f22c513eb90>, fullchain_path=<certbot.cli._Default object at 0x7f22c515d910>, func=<function run at 0x7f22c546d1b8>, hsts=<certbot.cli._Default object at 0x7f22c5156050>, http01_port=<certbot.cli._Default object at 0x7f22c514a190>, ifaces=<certbot.cli._Default object at 0x7f22c515d510>, init=<certbot.cli._Default object at 0x7f22c515d310>, installer='nginx', key_path=<certbot.cli._Default object at 0x7f22c515d810>, logs_dir=<certbot.cli._Default object at 0x7f22c515dd10>, manual=<certbot.cli._Default object at 0x7f22c515da90>, manual_auth_hook=<certbot.cli._Default object at 0x7f22c515d6d0>, manual_cleanup_hook=<certbot.cli._Default object at 0x7f22c515d390>, manual_public_ip_logging_ok=<certbot.cli._Default object at 0x7f22c515d190>, must_staple=<certbot.cli._Default object at 0x7f22c514ad10>, nginx=True, nginx_ctl=<certbot.cli._Default object at 0x7f22c5156d90>, nginx_server_root=<certbot.cli._Default object at 0x7f22c515d690>, no_bootstrap=<certbot.cli._Default object at 0x7f22c5129e50>, no_self_upgrade=<certbot.cli._Default object at 0x7f22c5129f50>, no_verify_ssl=<certbot.cli._Default object at 0x7f22c514a490>, noninteractive_mode=<certbot.cli._Default object at 0x7f22c513ed10>, num=<certbot.cli._Default object at 0x7f22c5156dd0>, os_packages_only=<certbot.cli._Default object at 0x7f22c5137050>, post_hook=<certbot.cli._Default object at 0x7f22c5156950>, pre_hook=<certbot.cli._Default object at 0x7f22c5156850>, pref_challs=<certbot.cli._Default object at 0x7f22c5156750>, prepare=<certbot.cli._Default object at 0x7f22c515d410>, quiet=<certbot.cli._Default object at 0x7f22c5129e10>, reason=<certbot.cli._Default object at 0x7f22c515d110>, redirect=<certbot.cli._Default object at 0x7f22c514ae10>, register_unsafely_without_email=<certbot.cli._Default object at 0x7f22c513e590>, reinstall=<certbot.cli._Default object at 0x7f22c5137dd0>, renew_by_default=<certbot.cli._Default object at 0x7f22c5137a50>, renew_hook=<certbot.cli._Default object at 0x7f22c5156a50>, renew_with_new_domains=<certbot.cli._Default object at 0x7f22c5137890>, rsa_key_size=<certbot.cli._Default object at 0x7f22c514ac10>, server=<certbot.cli._Default object at 0x7f22c515de10>, staging=<certbot.cli._Default object at 0x7f22c514a9d0>, standalone=<certbot.cli._Default object at 0x7f22c515dc90>, standalone_supported_challenges=<certbot.cli._Default object at 0x7f22c5156c10>, staple=<certbot.cli._Default object at 0x7f22c5156450>, strict_permissions=<certbot.cli._Default object at 0x7f22c5156650>, text_mode=<certbot.cli._Default object at 0x7f22c513ee90>, tls_sni_01_port=<certbot.cli._Default object at 0x7f22c514a310>, tos=<certbot.cli._Default object at 0x7f22c5137490>, uir=<certbot.cli._Default object at 0x7f22c5156250>, update_registration=<certbot.cli._Default object at 0x7f22c513e410>, user_agent=<certbot.cli._Default object at 0x7f22c5156ed0>, validate_hooks=<certbot.cli._Default object at 0x7f22c5156b50>, verb='run', verbose_count=<certbot.cli._Default object at 0x7f22c5144050>, webroot=<certbot.cli._Default object at 0x7f22c515d890>, webroot_map=<certbot.cli._Default object at 0x7f22c5156810>, webroot_path=<certbot.cli._Default object at 0x7f22c5156f90>, work_dir=<certbot.cli._Default object at 0x7f22c515dc10>)
2017-08-09 05:50:07,550:DEBUG:certbot.log:Root logging level set at 20
2017-08-09 05:50:07,551:INFO:certbot.log:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2017-08-09 05:50:07,552:DEBUG:certbot.plugins.selection:Requested authenticator nginx and installer nginx
2017-08-09 05:50:07,756:DEBUG:certbot.plugins.selection:Single candidate plugin: * nginx
Description: Nginx Web Server plugin - Alpha
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: nginx = certbot_nginx.configurator:NginxConfigurator
Initialized: <certbot_nginx.configurator.NginxConfigurator object at 0x7f22c8bf6410>
Prep: True
2017-08-09 05:50:07,758:DEBUG:certbot.plugins.selection:Selected authenticator <certbot_nginx.configurator.NginxConfigurator object at 0x7f22c8bf6410> and installer <certbot_nginx.configurator.NginxConfigurator object at 0x7f22c8bf6410>
2017-08-09 05:50:10,275:DEBUG:acme.client:Sending GET request to https://acme-v01.api.letsencrypt.org/directory.
2017-08-09 05:50:10,317:DEBUG:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
2017-08-09 05:50:10,736:DEBUG:requests.packages.urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "GET /directory HTTP/1.1" 200 460
2017-08-09 05:50:10,737:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 460
Boulder-Request-Id: oeQiaC8E6Ksw39ej9coxV8GokhIIZT0UhW1tuJJUa5w
Replay-Nonce: 3yOv3ni4aNR9dr_idP44b3__VPIQsemJMZCWQh7kNTs
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Wed, 09 Aug 2017 05:50:10 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Wed, 09 Aug 2017 05:50:10 GMT
Connection: keep-alive
{
"key-change": "https://acme-v01.api.letsencrypt.org/acme/key-change",
"meta": {
"terms-of-service": "https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf"
},
"new-authz": "https://acme-v01.api.letsencrypt.org/acme/new-authz",
"new-cert": "https://acme-v01.api.letsencrypt.org/acme/new-cert",
"new-reg": "https://acme-v01.api.letsencrypt.org/acme/new-reg",
"revoke-cert": "https://acme-v01.api.letsencrypt.org/acme/revoke-cert"
}
2017-08-09 05:50:10,738:DEBUG:acme.client:Requesting fresh nonce
2017-08-09 05:50:10,738:DEBUG:acme.client:Sending HEAD request to https://acme-v01.api.letsencrypt.org/acme/new-reg.
2017-08-09 05:50:10,945:DEBUG:requests.packages.urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "HEAD /acme/new-reg HTTP/1.1" 405 0
2017-08-09 05:50:10,946:DEBUG:acme.client:Received response:
HTTP 405
Server: nginx
Content-Type: application/problem+json
Content-Length: 91
Allow: POST
Boulder-Request-Id: EfYD0qOR8mzWWx8GB_WOmjq-DMZmR1nDtcu557LaqI0
Replay-Nonce: xEZLxXn9hCdQw5MpB7jc2JiouNMDyY7BDt9nDKvCgak
Expires: Wed, 09 Aug 2017 05:50:10 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Wed, 09 Aug 2017 05:50:10 GMT
Connection: keep-alive
2017-08-09 05:50:10,946:DEBUG:acme.client:Storing nonce: xEZLxXn9hCdQw5MpB7jc2JiouNMDyY7BDt9nDKvCgak
2017-08-09 05:50:10,947:DEBUG:acme.client:JWS payload:
{
"contact": [
"mailto:santosh.kumar1992@outlook.com"
],
"resource": "new-reg"
}
2017-08-09 05:50:10,954:DEBUG:acme.client:Sending POST request to https://acme-v01.api.letsencrypt.org/acme/new-reg:
{
"header": {
"alg": "RS256",
"jwk": {
"e": "AQAB",
"kty": "RSA",
"n": "0fEZ7W-L5K2J53GitfKavxsabzovTUchO8y2oilO8hsKDFf7FAP_EBzYzFQB55aZke-XbkWo5_cgc4XboDgRiwhxVk7Py9gP8xe7Hd0zLCFByVZywHEUWfj4Wk7M6714I9oT_pcoWsiqK-G7DNgppdDlw_KJyQA-R7wXlySZLmAE-jETND0LNeaeJKUXCr6PjVVbVglPS5A0i7XbXPmGzDD2lv48Jg5EumtZtF2bHRzb6TJHEcCK9I9nT8_RpLj-3zFLw_e7v_LynNx47UaDXCI9iFgz9w88-RRWDcVI5bhvzoIafY3Ufltjps6TJg-8DeW3rfmADC5858q8C9_eHQ"
}
},
"protected": "eyJub25jZSI6ICJ4RVpMeFhuOWhDZFF3NU1wQjdqYzJKaW91Tk1EeVk3QkR0OW5ES3ZDZ2FrIn0",
"payload": "ewogICJjb250YWN0IjogWwogICAgIm1haWx0bzpzYW50b3NoLmt1bWFyMTk5MkBvdXRsb29rLmNvbSIKICBdLCAKICAicmVzb3VyY2UiOiAibmV3LXJlZyIKfQ",
"signature": "DNsE1O_vJbPQHGUOl4JeU8A-pABGNeSqwCTep0D1GX8DQU0P92tb8KaJwlmzW3npZIlQQXcXdTO4Clh4VT3YWPc6grnYMda85eudxlxp8ElwN47QjVD3EDcxLb48xPyLkDP5R-f7rOjsxcyxLMmgd0I32TIkPAdbJz1kkTHOO7KruRbtlU4jEl7Bxk6NLzNjeDhHeR1bAhHYUxXG_c2D53rIs8tXA_A5PrCQQvkArm3KXLMm_KaXgHF0kYlCsDjdWC4tSwB-5aewLwYzVkwbcENbyN0i-YVHWd_n8Tb-xP4Wbgt4oz5iKf_O63Hnw6ECZDGqYHHq6bJerE_kDv1xrg"
}
2017-08-09 05:50:42,174:DEBUG:requests.packages.urllib3.connectionpool:https://acme-v01.api.letsencrypt.org:443 "POST /acme/new-reg HTTP/1.1" 500 109
2017-08-09 05:50:42,175:DEBUG:acme.client:Received response:
HTTP 500
Server: nginx
Content-Type: application/problem+json
Content-Length: 109
Boulder-Request-Id: zQYBr7WKiu2OrugqgnyHDHFMOm4eA5_YDO3HvQ1JFqI
Replay-Nonce: miV57mLqQeEZCBz9tzb3Xe20E1sxkOiYyLADhHP3UMQ
Expires: Wed, 09 Aug 2017 05:50:42 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Wed, 09 Aug 2017 05:50:42 GMT
Connection: close
{
"type": "urn:acme:error:serverInternal",
"detail": "Error creating new registration",
"status": 500
}
2017-08-09 05:50:42,175:DEBUG:acme.client:Storing nonce: miV57mLqQeEZCBz9tzb3Xe20E1sxkOiYyLADhHP3UMQ
2017-08-09 05:50:42,176:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
File "/usr/bin/certbot", line 11, in
load_entry_point('certbot==0.14.2', 'console_scripts', 'certbot')()
File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 742, in main
return config.func(config, plugins)
File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 589, in run
le_client = _init_le_client(config, authenticator, installer)
File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 382, in _init_le_client
acc, acme = _determine_account(config)
File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 367, in _determine_account
config, account_storage, tos_cb=_tos_cb)
File "/usr/lib/python2.7/dist-packages/certbot/client.py", line 160, in register
regr = perform_registration(acme, config)
File "/usr/lib/python2.7/dist-packages/certbot/client.py", line 190, in perform_registration
return acme.register(messages.NewRegistration.from_data(email=config.email))
File "/usr/lib/python2.7/dist-packages/acme/client.py", line 97, in register
response = self.net.post(self.directory[new_reg], new_reg)
File "/usr/lib/python2.7/dist-packages/acme/client.py", line 674, in post
return self._post_once(*args, **kwargs)
File "/usr/lib/python2.7/dist-packages/acme/client.py", line 687, in _post_once
return self._check_response(response, content_type=content_type)
File "/usr/lib/python2.7/dist-packages/acme/client.py", line 574, in _check_response
raise messages.Error.from_json(jobj)
Error: urn:acme:error:serverInternal :: The server experienced an internal error :: Error creating new registration
`
Some Time it fails after 2nd Step where we Accept T&C.
Domain Name : http://preparationadda.in/
Certbot's behavior differed from what I expected because:
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring: