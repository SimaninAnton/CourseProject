Contributor
jsha commented on 11 Oct 2015
Right now Nginx's parser has an add_server_directives method, with a replace parameter. If replace is true, the directive must already exist in the config, and it will be replaced. If replace is false, the directive is added regardless of what exists in the config.
Since most directives are not allowed repeatedly, what we want in many cases is an add_or_set_server_directives, which will replace a directive if it's present*, and add it if it's not present.
*To be really tidy, we should say: If the directive is present with the correct value, leave it alone, i.e. don't change its location in the config.