Member
joohoi commented on 13 May 2016
Original issue was: #2949
Apache plugin errors out when trying to read files with comma in the filename.
letest@letest:/etc/apache2/sites-available$ ls -la
total 48
drwxr-xr-x 2 root root 4096 May 13 11:35 .
drwxr-xr-x 8 root root 4096 May 13 11:29 ..
-rw-r--r-- 1 root root 1878 May 10 13:36 000-default-le-ssl.conf
-rw-r--r-- 1 root root 1472 May 10 00:30 000-default.conf
-rw-r--r-- 1 root root  255 May 10 13:51 1.conf,OLD.conf
Running letsencrypt --apache --staging results in:
letest@letest:~$ sudo letsencrypt --apache --staging
An unexpected error occurred:
RuntimeError: Error during match procedure!
Please see the logfiles in /var/log/letsencrypt for more details.
With stack trace in the log file:
2016-05-13 08:35:32,962:DEBUG:letsencrypt.main:Root logging level set at 30
2016-05-13 08:35:32,963:INFO:letsencrypt.main:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2016-05-13 08:35:32,963:DEBUG:letsencrypt.main:letsencrypt version: 0.5.0
2016-05-13 08:35:32,963:DEBUG:letsencrypt.main:Arguments: ['--apache', '--staging']
2016-05-13 08:35:32,964:DEBUG:letsencrypt.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#webroot,PluginEntryPoint#null,PluginEntryPoint#manual,PluginEntryPoint#standalone)
2016-05-13 08:35:32,967:DEBUG:letsencrypt.plugins.selection:Requested authenticator apache and installer apache
2016-05-13 08:35:33,292:DEBUG:letsencrypt.main:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/letsencrypt", line 9, in <module>
    load_entry_point('letsencrypt==0.5.0', 'console_scripts', 'letsencrypt')()
  File "/usr/lib/python2.7/dist-packages/letsencrypt/main.py", line 692, in main
    return config.func(config, plugins)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/main.py", line 448, in run
    installer, authenticator = plug_sel.choose_configurator_plugins(config, plugins, "run")
  File "/usr/lib/python2.7/dist-packages/letsencrypt/plugins/selection.py", line 184, in choose_configurator_plugins
    authenticator = installer = pick_configurator(config, req_inst, plugins)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/plugins/selection.py", line 24, in pick_configurator
    (interfaces.IAuthenticator, interfaces.IInstaller))
  File "/usr/lib/python2.7/dist-packages/letsencrypt/plugins/selection.py", line 76, in pick_plugin
    verified.prepare()
  File "/usr/lib/python2.7/dist-packages/letsencrypt/plugins/disco.py", line 214, in prepare
    return [plugin_ep.prepare() for plugin_ep in self._plugins.itervalues()]
  File "/usr/lib/python2.7/dist-packages/letsencrypt/plugins/disco.py", line 104, in prepare
    self._initialized.prepare()
  File "/usr/lib/python2.7/dist-packages/letsencrypt_apache/configurator.py", line 177, in prepare
    self.vhosts = self.get_virtual_hosts()
  File "/usr/lib/python2.7/dist-packages/letsencrypt_apache/configurator.py", line 552, in get_virtual_hosts
    new_vhost = self._create_vhost(path)
  File "/usr/lib/python2.7/dist-packages/letsencrypt_apache/configurator.py", line 505, in _create_vhost
    args = self.aug.match(path + "/arg")
  File "/usr/lib/python2.7/dist-packages/augeas.py", line 312, in match
    raise RuntimeError("Error during match procedure!")
RuntimeError: Error during match procedure!
This looks like a bug in Augeas, so pinging @domcleal