twiz718 commented on 17 Aug 2017 â€¢
edited by SwartzCr
My operating system is (include version):
Ubuntu 14.04.5 LTS
Kernel 4.9.15-x86_64
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
git clone
current version: 0.17.0
I ran this command and it produced this output:
root@superunknown:/opt/cerbot# ls -al /opt/cerbot/berzerk-renew-hook.sh
-rwxr-xr-x 1 root root 300 May 19 11:27 /opt/cerbot/berzerk-renew-hook.sh
cd /opt/cerbot
./certbot-auto renew --renew-hook /opt/cerbot/berzerk-renew-hook.sh
Processing /etc/letsencrypt/renewal/mail.berzerk.org.conf
The following certs are not due for renewal yet:
/etc/letsencrypt/live/mail.berzerk.org/fullchain.pem (skipped)
No renewals were attempted.
Not Before: May 19 15:10:00 2017 GMT
Not After : Aug 17 15:10:00 2017 GMT
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Cert is due for renewal, auto-renewing...
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for mail.berzerk.org
Waiting for verification...
Cleaning up challenges
Processing /etc/letsencrypt/renewal/mail.berzerk.org.conf
new certificate deployed without reload, fullchain is
/etc/letsencrypt/live/mail.berzerk.org/fullchain.pem
Congratulations, all renewals succeeded. The following certs have been renewed:
/etc/letsencrypt/live/mail.berzerk.org/fullchain.pem (success)
Not Before: Jul 24 06:30:00 2017 GMT
Not After : Oct 22 06:30:00 2017 GMT
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Certbot's behavior differed from what I expected because:
I expected my hook to be run but it did not. My hook script is as follows:
root@superunknown:/opt/cerbot# cat berzerk-renew-hook.sh
!/bin/bash
echo "renew hook script"
# combine pems for courier
cat /etc/letsencrypt/live/mail.berzerk.org/privkey.pem /etc/letsencrypt/live/mail.berzerk.org/fullchain.pem > /etc/courier/letsencrypt.pem
# restart courier
service courier-imap-ssl restart
# restart postfix
service postfix restart
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring: