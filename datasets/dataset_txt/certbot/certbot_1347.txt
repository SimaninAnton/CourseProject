Contributor
jsha commented on 10 Mar 2017
In order to implement the current ACME spec, we're going to need to implement some breaking changes. Ideally I'd like to implement the new Python APIs on top of Boulder's old ACME version and offer the old APIs for a deprecation period while Boulder is still implementing the latest ACME spec. Once Boulder has implemented the latest spec, the deprecated acme module APIs would be supported only when using the old Boulder URLs. To use the new Boulder URLs, you would need to switch over to the new acme APIs. Then, at some point N months after deployment of the new Boulder URLs, the old Boulder URLs would stop working, and everyone using the acme module would need to be on the latest version by then and using the new APIs.
Alternately, we could make a hard breaking change, and say that anyone using acme and needing the old APIs should pin to an older version. Programs that are updated to use the newer acme APIs would pin a minimum acme version needed.
Here are the main things I can think of that need to change:
Authz's are now created by the server as a result of submitting a CSR. We should add a client method new_order(csr), which returns an Order object. The Order object will contain a number of authorization objects. Clients can fulfill those authorizations as normal. We would also add a new method poll_for_issuance(order) to be called once a client submitted answers to all the challenges.
Registrations are renamed to Accounts, and JWS bodies are now identified by the Account URL rather than the full key. This means that when instantiating a Client, we need to include not just a key, but also an account URL. Probably the best way to do this is to allow constructing a Client with no key, and provide a client.set_account(...) method that would take an AccountResource that includes a URI (because it would inherit from ResourceWithURI).
Terms of Service URL is now a property of the directory rather than the account. This means that we need a terms-of-service-agreed field in NewRegistration, and client.agree_to_tos(account) will become a no-op for new-style ACME. Clients will need to show the ToS from the directory before calling client.register.
Thoughts?