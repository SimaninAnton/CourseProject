Contributor
mnordhoff commented on 13 Mar 2018
My operating system is (include version):
Ubuntu 16.04 (amd64)
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto (0.22.0)
I ran this command and it produced this output:
$ sudo -H certbot certonly --manual --manual-auth-hook "/opt/certbot_dns/certbot_dns.py --auth --config /opt/certbot_dns/certbot_dns.ini --route-53" --manual-cleanup-hook "/opt/certbot_dns/certbot_dns.py --cleanup --config /opt/certbot_dns/certbot_dns.ini --route-53" --manual-public-ip-logging-ok --preferred-challenges dns-01 --server https://acme-staging-v02.api.letsencrypt.org/directory -d letsencrypt.mattnordhoff.info -d '*.letsencrypt.mattnordhoff.info'
That's my not-open-source manual auth plugin for Route 53 DNS validation.
The certificate was successfully issued.
$ sudo -H certbot renew --dry-run
Saving debug log to /var/log/letsencrypt/letsencrypt.log

[snip]

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/letsencrypt.mattnordhoff.info.conf
-------------------------------------------------------------------------------
Cert not due for renewal, but simulating renewal for dry run
Plugins selected: Authenticator manual, Installer None
Renewing an existing certificate
Attempting to renew cert (letsencrypt.mattnordhoff.info) from /etc/letsencrypt/renewal/letsencrypt.mattnordhoff.info.conf produced an unexpected error: The currently selected ACME CA endpoint does not support issuing wildcard certificates.. Skipping.

[snip]

The following certs could not be renewed:
  /etc/letsencrypt/live/letsencrypt.mattnordhoff.info/fullchain.pem (failure)
  /etc/letsencrypt/live/letsencrypt.mattnordhoff.net/fullchain.pem (failure)

-------------------------------------------------------------------------------
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates below have not been saved.)

The following certs were successfully renewed:
[snip]

The following certs could not be renewed:
  /etc/letsencrypt/live/letsencrypt.mattnordhoff.info/fullchain.pem (failure)
  /etc/letsencrypt/live/letsencrypt.mattnordhoff.net/fullchain.pem (failure)
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates above have not been saved.)
-------------------------------------------------------------------------------
2 renew failure(s), 0 parse failure(s)
(The letsencrypt.mattnordhoff.net certificate failed for the same reason.)
Certbot's behavior differed from what I expected because:
Certbot tries to renew an ACME v2 staging wildcard certificate using the ACME v1 server, and naturally fails.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
https://mn0.us/vPfhms7t_h2YLEaWk_AHaGK/letsencrypt.log (other certificates snipped)
I don't know if this is a known issue or expected behavior, but I didn't see anything.
1