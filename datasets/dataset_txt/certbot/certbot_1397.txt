met67 commented on 15 Feb 2017 â€¢
edited
I was trying to install a Let's encrypt certificate on a site which is hosted on Apache in a RedHat Enterprise Linux 6.8.
The server hosts several sites, each one with its IP, and Apache doesn't listen on port 80 or 443 by default.
Each site has its file in conf.d directory, which defines the Virtual Host and Listen on the right port:
site.conf
Listen w.x.y.z.:80
NameVirtualHost w.x.y.z:80
<VirtualHost w.x.y.z.:80>
...
</VirtualHost>
In this situation, the first run of certbot didn't modify the configuration to listen on port 443, so the verification failed.
Moreover, since certbot stores the challenge configuration file in conf.d, with RedHat standard file structure this is included twice, one in Include conf.d/*.conf in the middle of httpd.conf and the second in Include /etc/httpd/conf.d/le_tls_sni_01_cert_challenge.conf at the end as a result of certbot's modifications.