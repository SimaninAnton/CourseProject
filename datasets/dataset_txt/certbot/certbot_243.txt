Member
bmw commented on 4 Mar 2019
Over the weekend, our Apache coverage tests spuriously failed. See https://travis-ci.com/certbot/certbot/jobs/181789080.
The lines it failed on were:
certbot/certbot-apache/certbot_apache/configurator.py
Lines 876 to 887 in 6ff101d
 new_vhs = [] 
 for v in vhs: 
     if v.filep == file_paths[realpath]: 
         internal_paths[realpath].remove( 
             apache_util.get_internal_aug_path(v.path)) 
     else: 
         new_vhs.append(v) 
 vhs = new_vhs 
    file_paths[realpath] = realpath 
 internal_paths[realpath].add(internal_path) 
 vhs.append(new_vhost) 
I think depending on the order the vhost directives are found by Augeas, these lines might not be executed.
Running tests locally, we seem to only hit these lines during while running setUp during various other tests. I did not see a test explicitly try to test these lines directly.
I think we should add an explicit test for these lines in a way that doesn't depend on things like the order the vhosts are found.