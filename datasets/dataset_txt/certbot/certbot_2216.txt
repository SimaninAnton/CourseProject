barnumbirr commented on 11 Apr 2016
Hello everyone,
I've used letsencrypt with Nginx before and it worked great. I've now been given the task to setup letsencrypt on an Apache server an I'm running into some issues:
root@host:/opt/letsencrypt# ./letsencrypt-auto --apache -d example.lu -d www.example.lu -d lists.example.lu -d mail.example.lu -d mesa.example.lu
Checking for new version...
Requesting root privileges to run letsencrypt...
    /root/.local/share/letsencrypt/bin/letsencrypt --apache -d example.lu -d www.example.lu -d lists.example.lu -d mail.example.lu -d mesa.example.lu
Failed authorization procedure. example.lu (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Failed to connect to host for DVSNI challenge, mesa.example.lu (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Failed to connect to host for DVSNI challenge, mail.example.lu (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Failed to connect to host for DVSNI challenge, lists.example.lu (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Failed to connect to host for DVSNI challenge, www.example.lu (tls-sni-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: Failed to connect to host for DVSNI challenge

IMPORTANT NOTES:
 - The following errors were reported by the server:

    Domain: example.lu
    Type:   connection
    Detail: Failed to connect to host for DVSNI challenge

    Domain: mesa.example.lu
    Type:   connection
    Detail: Failed to connect to host for DVSNI challenge

    Domain: mail.example.lu
    Type:   connection
    Detail: Failed to connect to host for DVSNI challenge

    Domain: lists.example.lu
    Type:   connection
    Detail: Failed to connect to host for DVSNI challenge

    Domain: www.example.lu
    Type:   connection
    Detail: Failed to connect to host for DVSNI challenge

    To fix these errors, please make sure that your domain name was
    entered correctly and the DNS A record(s) for that domain
    contain(s) the right IP address. Additionally, please check that
    your computer has a publicly routable IP address and that no
    firewalls are preventing the server from communicating with the
    client. If you're using the webroot plugin, you should also verify
    that you are serving files from the webroot path you provided.
Using the verboseflag I get the following:
2016-04-11 14:15:14,457:DEBUG:root:Sending GET request to
    https://acme-v01.api.letsencrypt.org/acme/authz/I8N5QbUfldkTKVLdqTI3l2YNyKMVDVk2yLAs-9pPx_s.
    args: (), kwargs: {}
    2016-04-11
    14:15:14,460:INFO:requests.packages.urllib3.connectionpool:Starting new
    HTTPS connection (1): acme-v01.api.letsencrypt.org
    2016-04-11
    14:15:14,771:DEBUG:requests.packages.urllib3.connectionpool:"GET
    /acme/authz/I8N5QbUfldkTKVLdqTI3l2YNyKMVDVk2yLAs-9pPx_s HTTP/1.1" 200 1132
    2016-04-11 14:15:14,773:DEBUG:root:Received <Response [200]>. Headers:
    {'Content-Length': '1132', 'Expires': 'Mon, 11 Apr 2016 14:15:15 GMT',
    'Strict-Transport-Security': 'max-age=604800', 'Server': 'nginx',
    'Connection': 'keep-alive', 'Link':
    '<https://acme-v01.api.letsencrypt.org/acme/new-cert>;rel="next"',
    'Pragma': 'no-cache', 'Cache-Control': 'max-age=0, no-cache, no-store',
    'Date': 'Mon, 11 Apr 2016 14:15:15 GMT', 'X-Frame-Options': 'DENY',
    'Content-Type': 'application/json', 'Replay-Nonce':
    'emILAj0S1t1O6NaFq_omTARNL7hg1k_UYqlRWIH4l_I'}. Content:
    '{"identifier":{"type":"dns","value":"mail.example.lu"},"status":"invalid","expires":"2016-04-18T14:15:04Z","challenges":[{"type":"tls-sni-01","status":"invalid","error":{"type":"urn:acme:error:connection","detail":"Failed
    to connect to host for DVSNI
    challenge"},"uri":"https://acme-v01.api.letsencrypt.org/acme/challenge/I8N5QbUfldkTKVLdqTI3l2YNyKMVDVk2yLAs-9pPx_s/47393259","token":"jgBAGtS8ZTUvrsAVY5_JOngS-dNgGLtn4MppSptT17Q","keyAuthorization":"jgBAGtS8ZTUvrsAVY5_JOngS-dNgGLtn4MppSptT17Q.cTFBTEa_FcDvAUTr4w1tyenqaf57FNjHhehmsCXWyiQ","validationRecord":[{"hostname":"mail.example.lu","port":"443","addressesResolved":["31.22.124.145"],"addressUsed":"31.22.124.145"}]},{"type":"http-01","status":"pending","uri":"https://acme-v01.api.letsencrypt.org/acme/challenge/I8N5QbUfldkTKVLdqTI3l2YNyKMVDVk2yLAs-9pPx_s/47393260","token":"l7_nz2j7JkAcEfqKulYCrAyb2BEF2MZRDmdEcGB3A6U"},{"type":"dns-01","status":"pending","uri":"https://acme-v01.api.letsencrypt.org/acme/challenge/I8N5QbUfldkTKVLdqTI3l2YNyKMVDVk2yLAs-9pPx_s/47393261","token":"EdtQAi-J59stMF31Vs623EvebNoVRmglhn1ilS0q-xc"}],"combinations":[[0],[1],[2]]}'
Am I doing something wrong? Thank you for your help.
Cheers.