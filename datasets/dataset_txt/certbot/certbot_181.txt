jourji commented on 29 Apr 2019
I felt like leaving a few words on my experience. Maybe not so uncommon.
Anyway, as I'm moving like 20 domains by hand, it's quite tedious.
My operating system is Debian 9
I installed Certbot 0.28.0 with the OS package manager
## After recent changes of server IP, in a Bind9 setup that I manage,
I ran this command on new server and it produced this output:
certbot certonly --staging=true --domains=$DOM
==> OK
certbot certonly --domains=$DOM --force-renewal --break-my-certs
"detail": "Invalid response from https://$DOM/.well-known/acme-challenge/xxx **[OLD_IP_ADDRESS]**
Certbot's behavior differed from what I expected because:
Once the staging setup recognizes my new IP address, the production one still doesn't.
I can't tell how long to wait for the cache to expire. If I try too often, I run into quotas exceeded.
Sharing the same DNS cache would help here.
Maybe you could consider not using any cache since most production requests should be only every 2 months.
Maybe an option for full dns resolution on demand, though it could be over used.
Nota: Preparing for the change, I removed any secondary NS some days ago, so only up-to-date data could be obtained form the DNS, if ever asked for it.