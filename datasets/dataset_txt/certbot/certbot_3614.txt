Contributor
schoen commented on 24 Feb 2015
(This would be great to get @fmarier's and @pde's opinions on, among others! And @paravoid, if you're still following this project.)
We need to figure out mechanisms for renewing certificates automatically, if a user wants to do that. This will require creating a cron job and also keeping track of what certificates should (if any) should be autorenewed. This might interact a bit with operating system policies about the right way to create and manage automated recurring processes.
My current thought for Debian-like systems is this:
When we originally install, we should create a /etc/cron.monthly/letsencrypt-renewer script.
If the package is uninstalled, that script will be deleted.
The script will read a file called /etc/letsencrypt.conf or /etc/letsencrypt-renewer.conf or similar. The default action will be to do nothing and exit immediately. (So, no actual autorenewal attempts will take place merely as a result of having the package installed.)
If particular keys and certificates are identified in that file and a directive is enabled there to try to autorenew them, the script will attempt to do so (at an appropriate time prior to its expiry), and then try to deploy the resulting certificate.
At the time that a cert is originally issued, the user will be asked whether or not to enable automated renewal of that cert.
The user can manually edit the config file to change the policy with respect to any individual cert or with respect to this mechanism as a while.
How does this sound? Here are some additional questions:
Should we regenerate keys, or only certs?
How to notify the user when renewal was successful or unsuccessful?
How long before expiry to try to renew?
Do we need to explicitly check an external time source when deciding whether to make a renewal attempt, or can we believe the system clock?
How to structure the config file? What information belongs in it?
How to decide what installer to use in order to try to automatically deploy the reissued cert? What kind of API does the installer need for this?
Is it OK to spontaneously send a web server a graceful restart request in response to the deployment of a new cert, without prior human confirmation?
How to get the user to understand the possible need to back up key material or migrate it when moving a domain or server to new hardware? (Can we also provide a higher-security migration mechanism for people who are concerned about moving key material off of the system where it was generated?)
How does this work on non-Debian-like systems?