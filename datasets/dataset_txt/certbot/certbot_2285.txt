alexlauerman commented on 22 Mar 2016
Line 720 of letsencrypt_apache/configurator.py finds zero vhosts when it looks at /etc/apache2/apache2-le-ssl.conf (the file it creates by calling _copy_create_ssl_vhost_skeleton and passing in /etc/apache2/apache2.conf).
Here are the last few lines of my apache2.conf:
<VirtualHost *:80>
   ServerAdmin myfirstname@trustfoundry.net
   DocumentRoot /var/www
   ServerAlias trustfoundry.net
</VirtualHost>
The statement that gets entered, and error that gets output is on lines 723 through 725:
Error: should only be one vhost in /etc/apache2/apache2.conf 
Currently, we only support configurations with one vhost per file
I have confirmed that zero "VirtualHost" matches are found.
I have confirmed the file apache2-le-ssl.conf gets created.
I have also confirmed that it does correctly find one vhost if I pass in avail_fp as the file to search, which is /etc/apache2/apache2.conf.
I have also introduced a sleep to attempt to confirm it's not a race condition, and it did not fix the error.