ppKrauss commented on 1 Jun 2017 â€¢
edited
My NGINX script at /etc/nginx/nginx.conf is working fine (!) with all my certbot-certificates... But when I run certbot --nginx --cert-name domain1 return this error:
Cannot find a cert or key directive in /etc/nginx/nginx.conf for set(['domain1', 'www.domain1']). VirtualHost was not modified.
It is because all the lines marked as "managed by Certbot" was grouped in one included file, snippets/ssl-domain1.conf, that repeat all time.
... So snippets file reduce pollution, reduce parsing work, and not cause "Cannot find" error.
The scripts
File /etc/nginx/nginx.conf:
....
http {
   ....   
server {
        server_name domain1;
        location / {
                proxy_pass https://heroku.com;
        }
include snippets/ssl-domain1.conf

} # end server

} # end http
File /etc/nginx/snippets/ssl-domain1.conf, to be managed by Certbot!
##
# SSL configs managed by Certbot.
#
listen 80; 
listen 443 ssl; 
ssl_certificate /etc/letsencrypt/live/domain1/fullchain.pem; 
ssl_certificate_key /etc/letsencrypt/live/domain1/privkey.pem;
include /etc/letsencrypt/options-ssl-nginx.conf;

if ($scheme != "https") {
  return 301 https://$host$request_uri;
} 