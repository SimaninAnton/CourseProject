vindicatorr commented on 28 Jan 2017 â€¢
edited
...
    include servers-enabled/*;
}

2017-01-28 14:14:20,669:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 112, in _solve_challenges
    resp = self.auth.perform(self.achalls)
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 818, in perform
    self.restart()
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 603, in restart
    nginx_restart(self.conf('ctl'), self.nginx_conf)
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 865, in nginx_restart
    "nginx restart failed:\n%s\n%s" % (stdout, stderr))
MisconfigurationError: nginx restart failed:

2017/01/28 08:14:20 [emerg] 4619#4619: could not build server_names_hash, you should increase server_names_hash_bucket_
size: 64


2017-01-28 14:14:20,671:DEBUG:certbot.error_handler:Calling registered functions
2017-01-28 14:14:20,671:INFO:certbot.auth_handler:Cleaning up challenges
2017-01-28 14:14:25,210:DEBUG:certbot.main:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/certbot", line 11, in <module>
    load_entry_point('certbot==0.10.1', 'console_scripts', 'certbot')()
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 849, in main
    return config.func(config, plugins)
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 626, in obtain_cert
    action, _ = _auth_from_available(le_client, config, domains, certname, lineage)
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 107, in _auth_from_available
    lineage = le_client.obtain_and_enroll_certificate(domains, certname)
  File "/usr/lib/python2.7/site-packages/certbot/client.py", line 291, in obtain_and_enroll_certificate
    certr, chain, key, _ = self.obtain_certificate(domains)
  File "/usr/lib/python2.7/site-packages/certbot/client.py", line 262, in obtain_certificate
    self.config.allow_subset_of_names)
  File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 74, in get_authorizations
    resp = self._solve_challenges()
  File "/usr/lib/python2.7/site-packages/certbot/auth_handler.py", line 112, in _solve_challenges
    resp = self.auth.perform(self.achalls)
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 818, in perform
    self.restart()
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 603, in restart
    nginx_restart(self.conf('ctl'), self.nginx_conf)
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 865, in nginx_restart
    "nginx restart failed:\n%s\n%s" % (stdout, stderr))
MisconfigurationError: nginx restart failed:

2017/01/28 08:14:20 [emerg] 4619#4619: could not build server_names_hash, you should increase server_names_hash_bucket_size: 64
yet both "nginx -t" and "nginx -s reload" succeed.
EDIT: I should add that I had experienced the "server_names_hash" before and found that I missed a semi-colon at the end of my "server_name" line.
But in this case, I DID grep recursively through my nginx dir for "server_name" and made sure everything had a ';'