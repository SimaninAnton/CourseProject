jerwinrodriguez commented on 17 Jan 2018
My operating system is (include version):
CentOS Linux 7.3.1611
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto
I ran this command and it produced this output:
certbot --authenticator standalone --installer apache --pre-hook "apachectl -k stop" --post-hook "apachectl -k start"
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer apache
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
No names were found in your configuration files. Please enter in your domain
name(s) (comma and/or space separated) (Enter 'c' to cancel): my.domain.name
Running pre-hook command: apachectl -k stop
Output from apachectl:
Passing arguments to httpd using apachectl is no longer supported.
You can only start/stop/restart httpd using this script.
If you want to pass extra arguments to httpd, edit the
/etc/sysconfig/httpd config file.
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for my.domain.name
Waiting for verification...
Cleaning up challenges
Running post-hook command: apachectl -k start
Output from apachectl:
Passing arguments to httpd using apachectl is no longer supported.
You can only start/stop/restart httpd using this script.
If you want to pass extra arguments to httpd, edit the
/etc/sysconfig/httpd config file.
We were unable to find a vhost with a ServerName or Address of my.domain.name.
Which virtual host would you like to choose?
(note: conf files with multiple vhosts are not yet supported)
1: ssl.conf | | HTTPS | Enabled
Press 1 [enter] to confirm the selection (press 'c' to cancel): 1
Deploying Certificate for my.domain.name to VirtualHost /etc/httpd/conf.d/ssl.conf
Error while running apachectl graceful.
Job for httpd.service invalid.
Rolling back to previous server configuration...
Error while running apachectl graceful.
Job for httpd.service invalid.
Encountered exception during recovery
Error while running apachectl graceful.
Job for httpd.service invalid.
Traceback (most recent call last):
File "/usr/lib/python2.7/site-packages/certbot/error_handler.py", line 100, in _call_registered
self.funcs-1
File "/usr/lib/python2.7/site-packages/certbot/client.py", line 557, in _rollback_and_restart
self.installer.restart()
File "/usr/lib/python2.7/site-packages/certbot_apache/configurator.py", line 1793, in restart
self._reload()
File "/usr/lib/python2.7/site-packages/certbot_apache/configurator.py", line 1804, in _reload
raise errors.MisconfigurationError(str(err))
MisconfigurationError: Error while running apachectl graceful.
Job for httpd.service invalid.
Error while running apachectl graceful.
Job for httpd.service invalid.
IMPORTANT NOTES:
An error occurred and we failed to restore your config and restart
your server. Please submit a bug report to
https://github.com/letsencrypt/letsencrypt
Congratulations! Your certificate and chain have been saved at:
/etc/letsencrypt/live/my.domain.name/fullchain.pem
Your key file has been saved at:
/etc/letsencrypt/live/my.domain.name/privkey.pem
Your cert will expire on 2018-04-16. To obtain a new or tweaked
version of this certificate in the future, simply run certbot again
with the "certonly" option. To non-interactively renew all of
your certificates, run "certbot renew"
Certbot's behavior differed from what I expected because:
The apache is not working as it should be?
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
Not sure what this is but I use webmin.