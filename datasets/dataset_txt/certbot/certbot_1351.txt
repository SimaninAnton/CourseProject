brianjmurrell commented on 8 Mar 2017
My operating system is (include version):
CentOS 7.3
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
EPEL
I ran this command and it produced this output:
# certbot renew --post-hook "/root/bin/letsencrypt_renew_hook"
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Cert is due for renewal, auto-renewing...
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for mail.example.com
http-01 challenge for imap.example.com
http-01 challenge for smtp.example.com
Waiting for verification...
Cleaning up challenges
Generating key (2048 bits): /etc/letsencrypt/keys/0018_key-certbot.pem
Creating CSR: /etc/letsencrypt/csr/0018_csr-certbot.pem
Cert not yet due for renewal
Cert is due for renewal, auto-renewing...
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for owncloud.example.com
Waiting for verification...
Cleaning up challenges
Generating key (2048 bits): /etc/letsencrypt/keys/0019_key-certbot.pem
Creating CSR: /etc/letsencrypt/csr/0019_csr-certbot.pem
Cert not yet due for renewal
Cert is due for renewal, auto-renewing...
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for www.example.com
Waiting for verification...
Cleaning up challenges
Generating key (2048 bits): /etc/letsencrypt/keys/0020_key-certbot.pem
Creating CSR: /etc/letsencrypt/csr/0020_csr-certbot.pem
Running post-hook command: /root/bin/letsencrypt_renew_hook
Error output from letsencrypt_renew_hook:
+ env
XDG_SESSION_ID=31757
SHELL=/bin/sh
MAILTO=root
USER=root
COLUMNS=80
PATH=/sbin:/bin:/usr/sbin:/usr/bin
PWD=/
LANG=en_CA.UTF-8
LINES=24
HOME=/root
SHLVL=8
START_HOURS_RANGE=3
LOGNAME=root
XDG_RUNTIME_DIR=/run/user/0
RANDOM_DELAY=45
_=/bin/env
+ grep --quiet -e ' example.com' -e '^example.com'


-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/mail.example.com.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
new certificate deployed without reload, fullchain is
/etc/letsencrypt/live/mail.example.com/fullchain.pem
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/server.example.com.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/owncloud.example.com.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
new certificate deployed without reload, fullchain is
/etc/letsencrypt/live/owncloud.example.com/fullchain.pem
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/example.com.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/www.example.com.conf
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
new certificate deployed without reload, fullchain is
/etc/letsencrypt/live/www.example.com/fullchain.pem
-------------------------------------------------------------------------------

The following certs are not due for renewal yet:
  /etc/letsencrypt/live/server.example.com/fullchain.pem (skipped)
  /etc/letsencrypt/live/example.com/fullchain.pem (skipped)
Congratulations, all renewals succeeded. The following certs have been renewed:
  /etc/letsencrypt/live/mail.example.com/fullchain.pem (success)
  /etc/letsencrypt/live/owncloud.example.com/fullchain.pem (success)
  /etc/letsencrypt/live/www.example.com/fullchain.pem (success)
Certbot's behavior differed from what I expected because:
As you can see in the env output above, none of my http-01 challenged domains were in $RENEWED_DOMAINS
Here is a Certbot log showing the issue (if available):
I can provide this if you need it but it doesn't seem necessary at this point.