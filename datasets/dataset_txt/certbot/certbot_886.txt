bll123 commented on 29 Nov 2017 â€¢
edited by SwartzCr
My operating system is (include version):
CentOS 6.8
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto
It is version 0.19.0.
The same error was produced with python 2.6; I installed python 2.7 and still the same.
Also tried version 0.16.0 as it appeared one other person had success with that version,
but the same error.
I ran this command and it produced this output:
[root@shop ~]# ./certbot-auto renew
Saving debug log to /var/log/letsencrypt/letsencrypt.log

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/admin.goblanket.com.conf
-------------------------------------------------------------------------------
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator apache, Installer apache
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for admin.goblanket.com
tls-sni-01 challenge for shop.goblanket.com
Cleaning up challenges
Attempting to renew cert (admin.goblanket.com) from /etc/letsencrypt/renewal/admin.goblanket.com.conf produced an unexpected error: Attempting to overwrite challenge file - /etc/httpd/conf/httpd.conf. Skipping.
All renewal attempts failed. The following certs could not be renewed:
  /etc/letsencrypt/live/admin.goblanket.com/fullchain.pem (failure)

-------------------------------------------------------------------------------

All renewal attempts failed. The following certs could not be renewed:
  /etc/letsencrypt/live/admin.goblanket.com/fullchain.pem (failure)
-------------------------------------------------------------------------------
1 renew failure(s), 0 parse failure(s)
Certbot's behavior differed from what I expected because:
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
tail end of log file:
2017-11-28 20:45:55,461:DEBUG:certbot.reverter:Creating backup of /etc/httpd/conf/httpd.conf
2017-11-28 20:45:56,043:DEBUG:certbot_apache.configurator:Setting VirtualHost at 66.151.36.94:443 to be a name based virtual host
2017-11-28 20:45:56,046:DEBUG:certbot_apache.configurator:Setting 66.151.36.94:443 to be NameBasedVirtualHost
 Directive added to None

2017-11-28 20:45:56,621:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/auth_handler.py", line 115, in _solve_challenges
    resp = self.auth.perform(self.achalls)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 1919, in perform
    sni_response = chall_doer.perform()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/tls_sni_01.py", line 80, in perform
    self.configurator.make_addrs_sni_ready(addrs)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 821, in make_addrs_sni_ready
    if not self.is_name_vhost(addr):
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 675, in is_name_vhost
    self.parser.find_dir("NameVirtualHost", str(target_addr)))
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 358, in find_dir
    self._get_include_path(self.get_arg(match + "/arg")),
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 473, in _get_include_path
    self.parse_file(arg)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 526, in parse_file
    self.configurator.ensure_augeas_state()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/augeas_configurator.py", line 87, in ensure_augeas_state
    self.save()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/augeas_configurator.py", line 147, in save
    self.save_notes, temporary=temporary)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/plugins/common.py", line 135, in add_to_checkpoint
    raise errors.PluginError(str(err))
PluginError: Attempting to overwrite challenge file - /etc/httpd/conf/httpd.conf

2017-11-28 20:45:56,622:DEBUG:certbot.error_handler:Calling registered functions
2017-11-28 20:45:56,622:INFO:certbot.auth_handler:Cleaning up challenges
2017-11-28 20:45:57,622:WARNING:certbot.renewal:Attempting to renew cert (admin.goblanket.com) from /etc/letsencrypt/renewal/admin.goblanket.com.conf produced an unexpected error: Attempting to overwrite challenge file - /etc/httpd/conf/httpd.conf. Skipping.
2017-11-28 20:45:57,624:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/renewal.py", line 425, in handle_renewal_request
    main.renew_cert(lineage_config, plugins, renewal_candidate)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 743, in renew_cert
    _get_and_save_cert(le_client, config, lineage=lineage)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 80, in _get_and_save_cert
    renewal.renew_cert(config, domains, le_client, lineage)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/renewal.py", line 297, in renew_cert
    new_certr, new_chain, new_key, _ = le_client.obtain_certificate(domains)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/client.py", line 318, in obtain_certificate
    self.config.allow_subset_of_names)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/auth_handler.py", line 74, in get_authorizations
    resp = self._solve_challenges()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/auth_handler.py", line 115, in _solve_challenges
    resp = self.auth.perform(self.achalls)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 1919, in perform
    sni_response = chall_doer.perform()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/tls_sni_01.py", line 80, in perform
    self.configurator.make_addrs_sni_ready(addrs)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 821, in make_addrs_sni_ready
    if not self.is_name_vhost(addr):
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 675, in is_name_vhost
    self.parser.find_dir("NameVirtualHost", str(target_addr)))
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 358, in find_dir
    self._get_include_path(self.get_arg(match + "/arg")),
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 473, in _get_include_path
    self.parse_file(arg)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/parser.py", line 526, in parse_file
    self.configurator.ensure_augeas_state()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/augeas_configurator.py", line 87, in ensure_augeas_state
    self.save()
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/augeas_configurator.py", line 147, in save
    self.save_notes, temporary=temporary)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/plugins/common.py", line 135, in add_to_checkpoint
    raise errors.PluginError(str(err))
PluginError: Attempting to overwrite challenge file - /etc/httpd/conf/httpd.conf

2017-11-28 20:45:57,624:ERROR:certbot.renewal:All renewal attempts failed. The following certs could not be renewed:
2017-11-28 20:45:57,625:ERROR:certbot.renewal:  /etc/letsencrypt/live/admin.goblanket.com/fullchain.pem (failure)
2017-11-28 20:45:57,705:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
  File "/opt/eff.org/certbot/venv/bin/letsencrypt", line 11, in <module>
    sys.exit(main())
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 861, in main
    return config.func(config, plugins)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 797, in renew
    renewal.handle_renewal_request(config)
  File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/renewal.py", line 443, in handle_renewal_request
    len(renew_failures), len(parse_failures)))
Error: 1 renew failure(s), 0 parse failure(s)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
[root@shop httpd]# pwd
/etc/httpd
[root@shop httpd]# egrep '^Name' conf/httpd.conf
conf.d/ssl-eclogue.conf:
# shop.goblanket.com
<VirtualHost 66.151.36.94:443>
  DocumentRoot "/home/www/apache/htdocs"
  ServerName 66.151.36.94:443

...

  SSLCertificateFile /etc/letsencrypt/live/admin.goblanket.com/cert.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/admin.goblanket.com/privkey.pem
ServerAlias admin.goblanket.com
SSLCertificateChainFile /etc/letsencrypt/live/admin.goblanket.com/chain.pem
</VirtualHost>

# admin.goblanket.com
<VirtualHost 66.151.32.156:443>
  DocumentRoot "/home/www/apache/htdocs"
  ServerName 66.151.32.156:443

...

  SSLCertificateFile /etc/letsencrypt/live/admin.goblanket.com/cert.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/admin.goblanket.com/privkey.pem
  ServerAlias shop.goblanket.com
SSLCertificateChainFile /etc/letsencrypt/live/admin.goblanket.com/chain.pem
</VirtualHost>