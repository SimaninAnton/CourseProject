archon810 commented on 30 Dec 2016 â€¢
edited
I've run into this several times now on OpenSUSE 42.1, using apache 2.4. httpd.conf doesn't include Listen directives on its own but rather Include /etc/apache2/listen.conf.
What happens is that certbot, seemingly unaware of this, ends up adding this at the end of httpd.conf:
<IfModule mod_ssl.c>
Listen 0.0.0.0:443
Listen 0.0.0.0:443
</IfModule>
Note that it happens twice too (perhaps because I'm renewing a cert for 2 domains). Regardless, this breaks apache because it can't bind to port 443 more than once, so it doesn't start at all.
Sample command used:
certbot --test-cert --break-my-certs --webroot --installer apache --webroot-path /srv/www/htdocs/site.com -d dev.site.com -d dev2.site.com --post-hook "/usr/sbin/rcapache2 reload; /usr/sbin/rcnginx reload"
I believe this also happened in much simpler renewal commands too when I was testing, but, interestingly, not always - for example, it didn't happen during the initial certificate installation.