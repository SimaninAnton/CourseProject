Contributor
jsoref commented on 10 Aug 2017
My operating system is (include version):
debian 9.1
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot 0.17.0 (certbot-auto)
I ran this command and it produced this output:
# ~/bin/certbot-auto
Saving debug log to /var/log/letsencrypt/letsencrypt.log

Which names would you like to activate HTTPS for?
-------------------------------------------------------------------------------
1: unrelated.example.org
2: www.unrelated.example.org
3: a.example.com
4: b.example.com
5: c.example.com
6: build.example.com
7: e.example.com
8: e.example.com
9: f.example.com
10: g.example.com
11: h.example.com
12: i.example.com
13: j.example.com
14: zhost.example.com
15: l.example.com
16: m.example.com
17: n.example.com
18: o.example.com
19: atest.site.example.com
20: p.atest.site.example.com
21: q.atest.site.example.com
22: r.atest.site.example.com
23: s.atest.site.example.com
24: zhost.site.example.com
25: t.site.example.com
26: u.example.com
27: v.example.com
28: z.example
29: a.unrelated2.example.org
30: www.a.unrelated2.example.org
31: b.unrelated2.example.org
32: c.unrelated2.example.org
33: www.c.unrelated2.example.org
34: unrelated3.example.org
35: unrelated4.example.org
36: www.unrelated3.example.org
37: www.unrelated4.example.org
-------------------------------------------------------------------------------
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): 14 24 19
Obtaining a new certificate
Performing the following challenges:
tls-sni-01 challenge for zhost.site.example.com
tls-sni-01 challenge for atest.site.example.com
tls-sni-01 challenge for zhost.example.com
Waiting for verification...
Cleaning up challenges
Deploying Certificate for zhost.site.example.com to Virtualzhost /etc/apache2/sites-available/proxy-zhost-ssl.conf
Deploying Certificate for atest.site.example.com to Virtualzhost /etc/apache2/sites-available/proxy-zhost-ssl.conf
Deploying Certificate for zhost.example.com to Virtualzhost /etc/apache2/sites-available/proxy-zhost-ssl.conf
Certbot's behavior differed from what I expected because:
I expected the subject to be the one from the first domain listed (14, zhost.example.com)
Instead, it, for reasons I can't explain, picked the second domain (24, zhost.site.example.com)
Note: the real domains, if sorted alphabetically, would be ordered:
atest.site.example.com (this is alphabetically first)
zhost.example.com
zhost.site.example.com (this is alphabetically last)
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualzhost for the domain I am configuring:
<Virtualzhost *:443>
 ServerAdmin webmaster@localzhost
 DocumentRoot /var/www
        ServerName zhost.example.com
        ServerAlias zhost
        ServerAlias zhost.site.example.com
        ServerAlias atest
        ServerAlias atest.site.example.com
...
</Virtualzhost>