Collaborator
alexzorin commented on 28 Sep 2019
Originally reported on the forums.
My operating system is (include version):
Ubuntu Disco
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto
I ran this command and it produced this output:
I ran (50 domains):
certbot-auto certonly --dns-dnsmadeeasy --dns-dnsmadeeasy-credentials /etc/letsencrypt/dnsmadeeasy-creds.ini -d "certbot-dnsmadeeasy-test.ga" -d domain-1.certbot-dnsmadeeasy-test.ga -d domain-2.certbot-dnsmadeeasy-test.ga -d domain-3.certbot-dnsmadeeasy-test.ga -d domain-4.certbot-dnsmadeeasy-test.ga -d domain-5.certbot-dnsmadeeasy-test.ga -d domain-6.certbot-dnsmadeeasy-test.ga -d domain-7.certbot-dnsmadeeasy-test.ga -d domain-8.certbot-dnsmadeeasy-test.ga -d domain-9.certbot-dnsmadeeasy-test.ga -d domain-10.certbot-dnsmadeeasy-test.ga -d domain-11.certbot-dnsmadeeasy-test.ga -d domain-12.certbot-dnsmadeeasy-test.ga -d domain-13.certbot-dnsmadeeasy-test.ga -d domain-14.certbot-dnsmadeeasy-test.ga -d domain-15.certbot-dnsmadeeasy-test.ga -d domain-16.certbot-dnsmadeeasy-test.ga -d domain-17.certbot-dnsmadeeasy-test.ga -d domain-18.certbot-dnsmadeeasy-test.ga -d domain-19.certbot-dnsmadeeasy-test.ga -d domain-20.certbot-dnsmadeeasy-test.ga -d domain-21.certbot-dnsmadeeasy-test.ga -d domain-22.certbot-dnsmadeeasy-test.ga -d domain-23.certbot-dnsmadeeasy-test.ga -d domain-24.certbot-dnsmadeeasy-test.ga -d domain-25.certbot-dnsmadeeasy-test.ga -d domain-26.certbot-dnsmadeeasy-test.ga -d domain-27.certbot-dnsmadeeasy-test.ga -d domain-28.certbot-dnsmadeeasy-test.ga -d domain-29.certbot-dnsmadeeasy-test.ga -d domain-30.certbot-dnsmadeeasy-test.ga -d domain-31.certbot-dnsmadeeasy-test.ga -d domain-32.certbot-dnsmadeeasy-test.ga -d domain-33.certbot-dnsmadeeasy-test.ga -d domain-34.certbot-dnsmadeeasy-test.ga -d domain-35.certbot-dnsmadeeasy-test.ga -d domain-36.certbot-dnsmadeeasy-test.ga -d domain-37.certbot-dnsmadeeasy-test.ga -d domain-38.certbot-dnsmadeeasy-test.ga -d domain-39.certbot-dnsmadeeasy-test.ga -d domain-40.certbot-dnsmadeeasy-test.ga -d domain-41.certbot-dnsmadeeasy-test.ga -d domain-42.certbot-dnsmadeeasy-test.ga -d domain-43.certbot-dnsmadeeasy-test.ga -d domain-44.certbot-dnsmadeeasy-test.ga -d domain-45.certbot-dnsmadeeasy-test.ga -d domain-46.certbot-dnsmadeeasy-test.ga -d domain-47.certbot-dnsmadeeasy-test.ga -d domain-48.certbot-dnsmadeeasy-test.ga -d domain-49.certbot-dnsmadeeasy-test.ga -d domain-50.certbot-dnsmadeeasy-test.ga --dry-run
It produced:
Performing the following challenges:
dns-01 challenge for certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-1.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-10.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-11.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-12.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-13.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-14.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-15.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-16.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-17.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-18.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-19.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-2.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-20.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-21.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-22.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-23.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-24.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-25.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-26.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-27.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-28.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-29.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-3.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-30.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-31.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-32.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-33.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-34.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-35.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-36.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-37.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-38.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-39.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-4.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-40.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-41.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-42.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-43.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-44.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-45.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-46.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-47.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-48.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-49.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-5.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-50.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-6.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-7.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-8.certbot-dnsmadeeasy-test.ga
dns-01 challenge for domain-9.certbot-dnsmadeeasy-test.ga
Cleaning up challenges
Error determining zone identifier: 400 Client Error: Bad Request for url: https://api.sandbox.dnsmadeeasy.com/V2.0/dns/managed/name?domainname=certbot-dnsmadeeasy-test.ga.
Certbot's behavior differed from what I expected because:
Provider's published rate limits are as follows:
To prevent unwanted flooding of the API system, there is a maximum number of requests that can be sent in a given time period. This limit is 150 requests per 5 minute scrolling window
The pattern of requests generated by Certbot/Lexicon (3 requests per domain) means that having a reasonably high number of domains (50) will guarantee a fatal error during runtime, either during auth or cleanup. Math in my head tells me that 25 domains should be enough to trigger the problem.
The rate limit response is an HTTP 400 with a response body of:
{"error": ["Rate limit exceeded"]}
but the body isn't logged by Certbot or Lexicon, and is just reported as a generic 400.
Here is a Certbot log showing the issue (if available):
letsencrypt.log
2