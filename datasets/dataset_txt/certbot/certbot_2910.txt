ThomasLeister commented on 22 Nov 2015
Hi,
I just tried to fetch certificates via manual mode with the latest version of the LE Client (at commit ad3890d), but the process failed: "Self-verify of challenge failed, authorization abandoned."
My challenge files at .well-known/acme-challenge were set up correctly and my nginx webserver sent "text/plain" as content type. I verified that by entering the challenge URL into my Firefox web browser and analysing the headers with the integrated webdeveloper tools.
After some more research in the LE Client log I found out that the ACME server did not receive a "text/plain" header from my server, but "application/octet-stream, text/plain", which of course did not match "text/plain". Firefox only told my about "text/plain" but did not display the additional "application/octet-stream" content type. After I did this in my Nginx config:
location ~ /.well-known/acme-challenge/(.*) {
        default_type text/plain;
        # add_header Content-Type text/plain;
}
... it perfectly worked, because my Nginx just sent "text/plain" as a content type header. You might assume that adding "add_header Content-Type text/plain" to your Nginx config would do it - but it doesn't. You have to use "default_type" to get it working.
So this is my suggestion: Let the LE client check if there exists a "text/plain" anywhere in the Content-Type header string, not if the content type string is exactly text/plain. This would improve usability in my opinion and prevents users from going crazy ;)
What do you think about it?