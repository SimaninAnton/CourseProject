stertingen commented on 11 Dec 2016 â€¢
edited
Affects version certbot 0.10.0.dev0 and propaby below.
System: Arch linux.
Log output:
2016-12-11 13:18:22,545:DEBUG:certbot.main:Root logging level set at 20
2016-12-11 13:18:22,549:INFO:certbot.main:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2016-12-11 13:18:22,552:DEBUG:certbot.main:certbot version: 0.10.0.dev0
2016-12-11 13:18:22,552:DEBUG:certbot.main:Arguments: ['--nginx']
2016-12-11 13:18:22,555:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#script,PluginEntryPoint#standalone,PluginEntryPoint#manual,PluginEntryPoint#webroot,PluginEntryPoint#nginx,PluginEntryPoint#null)
2016-12-11 13:18:22,557:DEBUG:certbot.plugins.selection:Requested authenticator nginx and installer nginx
2016-12-11 13:18:25,558:DEBUG:certbot.plugins.selection:Single candidate plugin: * nginx
Description: Nginx Web Server plugin - Alpha
Interfaces: IAuthenticator, IInstaller, IPlugin
Entry point: nginx = certbot_nginx.configurator:NginxConfigurator
Initialized: <certbot_nginx.configurator.NginxConfigurator object at 0xb6931d8c>
Prep: True
2016-12-11 13:18:25,563:DEBUG:certbot.plugins.selection:Selected authenticator <certbot_nginx.configurator.NginxConfigurator object at 0xb6931d8c> and installer <certbot_nginx.configurator.NginxConfigurator object at 0xb6931d8c>
2016-12-11 13:18:25,658:DEBUG:certbot.main:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/certbot", line 11, in <module>
    load_entry_point('certbot==0.10.0.dev0', 'console_scripts', 'certbot')()
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 818, in main
    return config.func(config, plugins)
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 550, in run
    domains, certname = _find_domains_or_certname(config, installer)
  File "/usr/lib/python2.7/site-packages/certbot/main.py", line 288, in _find_domains_or_certname
    domains = display_ops.choose_names(installer)
  File "/usr/lib/python2.7/site-packages/certbot/display/ops.py", line 103, in choose_names
    domains = list(installer.get_all_names())
  File "/usr/lib/python2.7/site-packages/certbot_nginx/configurator.py", line 391, in get_all_names
    for vhost in self.parser.get_vhosts():
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 134, in get_vhosts
    servers = self._get_raw_servers()
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 114, in _get_raw_servers
    lambda x, y: srv.append((x[1], y)))
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 364, in _do_for_subarray
    _do_for_subarray(item, condition, func, path + [index])
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 364, in _do_for_subarray
    _do_for_subarray(item, condition, func, path + [index])
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 360, in _do_for_subarray
    if condition(entry):
  File "/usr/lib/python2.7/site-packages/certbot_nginx/parser.py", line 113, in <lambda>
    _do_for_subarray(tree, lambda x: x[0] == ['server'],
IndexError: list index out of range
nginx configuration
user http;
worker_processes  1;

error_log  /var/log/nginx/error.log;
error_log  /var/log/nginx/error.log  notice;
error_log  /var/log/nginx/error.log  info;

#pid        logs/nginx.pid;


events {
 worker_connections  1024;
}


http {
 include       mime.types;
 default_type  application/octet-stream;

 log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
  '$status $body_bytes_sent "$http_referer" '
  '"$http_user_agent" "$http_x_forwarded_for"';

 access_log  /var/log/nginx/access.log  main;

 sendfile        on;

 keepalive_timeout  120;

 server {
  listen 80;
  server_name subdomain.myserver.com;
 
  rewrite ^ https://$server_name$request_uri permanent;
 }

 server {
  listen 443 ssl;
  server_name subdomain.myserver.com;

  add_header Strict-Transport-Security "max-age=31536000" always;

  ssl_certificate      /etc/letsencrypt/live/subdomain.myserver.com/fullchain.pem;
  ssl_certificate_key  /etc/letsencrypt/live/subdomain.myserver.com/privkey.pem;

  ssl_session_cache    shared:SSL:1m;
  ssl_session_timeout  5m;

  ssl_ciphers  HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers  on;

  include sites-enabled/*;
 }

}
2