kiranmr commented on 10 Apr 2017 â€¢
edited
My operating system is (include version):
OS: Ubuntu 14.04.2 LTS, Trusty Tahr
certbot: 0.13.0
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto downloaded from https://dl.eff.org/certbot-auto
I ran this command and it produced this output:
Command: certbot-auto renew --pre-hook "docker ps -q -f name=web|xargs docker stop" from a cronjob
Output: Script got stuck in apt-get
 \_ /bin/sh /usr/local/sbin/certbot-auto renew --pre-hook docker stop Controller_contro
     \_ apt-get install --no-install-recommends python python-dev python-virtualenv gcc
apt-get is ran without -y option, so its stuck waiting for user input.
Certbot's behavior differed from what I expected because:
I expected cert-bot to install required packages non-interactively and continue. -auto suffix should have ensured that apt-get is called with -y option
Root cause
I analysed code of script https://github.com/certbot/certbot/blob/master/certbot-auto
ASSUME_YES flag is set only if script name is letsencrypt-auto
if [ $BASENAME = "letsencrypt-auto" ]; then
  # letsencrypt-auto does not respect --help or --yes for backwards compatibility
  ASSUME_YES=1
  HELP=0
fi
I think above code should be changed to include certbot-auto also.