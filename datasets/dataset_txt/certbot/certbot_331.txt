fdellwing commented on 21 Nov 2018
My operating system is (include version):
Ubuntu 16.04.5 LTS
Linux proxy 4.4.0-135-generic #161-Ubuntu SMP Mon Aug 27 10:45:01 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
sudo apt install certbot
I ran this command and it produced this output:
sudo certbot renew
Processing
/etc/letsencrypt/renewal/www.saarlaendisches-krankenhaus-verzeichnis.de.conf
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Cert is due for renewal, auto-renewing...
Plugins selected: Authenticator standalone, Installer None
Renewing an existing certificate
Performing the following challenges:
tls-sni-01 challenge for krsaar.live.promato.de
tls-sni-01 challenge for saarlaendisches-krankenhaus-verzeichnis.de
tls-sni-01 challenge for www.saarlaendisches-krankenhaus-verzeichnis.de
Cleaning up challenges
Attempting to renew cert (www.saarlaendisches-krankenhaus-verzeichnis.de) from /etc/letsencrypt/renewal/www.saarlaendisches-krankenhaus-verzeichnis.de.conf produced an unexpected error: Problem binding to port 443: Could not bind to IPv4 or IPv6.. Skipping.
Certbot's behavior differed from what I expected because:
cert did not get renewed
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2018-11-21 11:52:47,095:INFO:certbot.auth_handler:Performing the following challenges:
2018-11-21 11:52:47,096:INFO:certbot.auth_handler:tls-sni-01 challenge for krsaar.live.promato.de
2018-11-21 11:52:47,096:INFO:certbot.auth_handler:tls-sni-01 challenge for saarlaendisches-krankenhaus-verzeichnis.de
2018-11-21 11:52:47,097:INFO:certbot.auth_handler:tls-sni-01 challenge for www.saarlaendisches-krankenhaus-verzeichnis.de
2018-11-21 11:52:47,098:DEBUG:acme.standalone:Failed to bind to :443 using IPv6
2018-11-21 11:52:47,098:DEBUG:acme.standalone:Failed to bind to :443 using IPv4
2018-11-21 11:52:47,099:DEBUG:certbot.error_handler:Encountered exception:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 73, in run
    address, self.certs)  # type: acme_standalone.BaseDualNetworkedServers
  File "/usr/lib/python3/dist-packages/acme/standalone.py", line 147, in __init__
    BaseDualNetworkedServers.__init__(self, TLSSNI01Server, *args, **kwargs)
  File "/usr/lib/python3/dist-packages/acme/standalone.py", line 108, in __init__
    raise socket.error("Could not bind to IPv4 or IPv6.")
OSError: Could not bind to IPv4 or IPv6.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 75, in handle_authorizations
    resp = self._solve_challenges(aauthzrs)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 126, in _solve_challenges
    resp = self.auth.perform(all_achalls)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 234, in perform
    return [self._try_perform_single(achall) for achall in achalls]
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 234, in <listcomp>
    return [self._try_perform_single(achall) for achall in achalls]
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 241, in _try_perform_single
    _handle_perform_error(error)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 239, in _try_perform_single
    return self._perform_single(achall)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 247, in _perform_single
    servers, response = self._perform_tls_sni_01(achall)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 264, in _perform_tls_sni_01
    servers = self.servers.run(port, challenges.TLSSNI01, listenaddr=addr)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 78, in run
    raise errors.StandaloneBindError(error, port)
certbot.errors.StandaloneBindError: Problem binding to port 443: Could not bind to IPv4 or IPv6.

2018-11-21 11:52:47,099:DEBUG:certbot.error_handler:Calling registered functions
2018-11-21 11:52:47,100:INFO:certbot.auth_handler:Cleaning up challenges
2018-11-21 11:52:47,100:WARNING:certbot.renewal:Attempting to renew cert (www.saarlaendisches-krankenhaus-verzeichnis.de) from /etc/letsencrypt/renewal/www.saarlaendisches-krankenhaus-verzeichnis.de.conf produced an unexpected error: Problem binding to port 443: Could not bind to IPv4 or IPv6.. Skipping.
2018-11-21 11:52:47,102:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 73, in run
    address, self.certs)  # type: acme_standalone.BaseDualNetworkedServers
  File "/usr/lib/python3/dist-packages/acme/standalone.py", line 147, in __init__
    BaseDualNetworkedServers.__init__(self, TLSSNI01Server, *args, **kwargs)
  File "/usr/lib/python3/dist-packages/acme/standalone.py", line 108, in __init__
    raise socket.error("Could not bind to IPv4 or IPv6.")
OSError: Could not bind to IPv4 or IPv6.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 430, in handle_renewal_request
    main.renew_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 1197, in renew_cert
    renewed_lineage = _get_and_save_cert(le_client, config, lineage=lineage)
  File "/usr/lib/python3/dist-packages/certbot/main.py", line 115, in _get_and_save_cert
    renewal.renew_cert(config, domains, le_client, lineage)
  File "/usr/lib/python3/dist-packages/certbot/renewal.py", line 305, in renew_cert
    new_cert, new_chain, new_key, _ = le_client.obtain_certificate(domains, new_key)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 334, in obtain_certificate
    orderr = self._get_order_and_authorizations(csr.data, self.config.allow_subset_of_names)
  File "/usr/lib/python3/dist-packages/certbot/client.py", line 370, in _get_order_and_authorizations
    authzr = self.auth_handler.handle_authorizations(orderr, best_effort)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 75, in handle_authorizations
    resp = self._solve_challenges(aauthzrs)
  File "/usr/lib/python3/dist-packages/certbot/auth_handler.py", line 126, in _solve_challenges
    resp = self.auth.perform(all_achalls)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 234, in perform
    return [self._try_perform_single(achall) for achall in achalls]
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 234, in <listcomp>
    return [self._try_perform_single(achall) for achall in achalls]
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 241, in _try_perform_single
    _handle_perform_error(error)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 239, in _try_perform_single
    return self._perform_single(achall)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 247, in _perform_single
    servers, response = self._perform_tls_sni_01(achall)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 264, in _perform_tls_sni_01
    servers = self.servers.run(port, challenges.TLSSNI01, listenaddr=addr)
  File "/usr/lib/python3/dist-packages/certbot/plugins/standalone.py", line 78, in run
    raise errors.StandaloneBindError(error, port)
certbot.errors.StandaloneBindError: Problem binding to port 443: Could not bind to IPv4 or IPv6.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
Not relevant
Here is the relevant renewal config for the domain I am renewing:
# renew_before_expiry = 30 days
version = 0.26.1
archive_dir = /etc/letsencrypt/archive/www.saarlaendisches-krankenhaus-verzeichnis.de
cert = /etc/letsencrypt/live/www.saarlaendisches-krankenhaus-verzeichnis.de/cert.pem
privkey = /etc/letsencrypt/live/www.saarlaendisches-krankenhaus-verzeichnis.de/privkey.pem
chain = /etc/letsencrypt/live/www.saarlaendisches-krankenhaus-verzeichnis.de/chain.pem
fullchain = /etc/letsencrypt/live/www.saarlaendisches-krankenhaus-verzeichnis.de/fullchain.pem

# Options used in the renewal process
[renewalparams]
server = https://acme-v02.api.letsencrypt.org/directory
account = <redacted>
http01_port = 54321
authenticator = standalone