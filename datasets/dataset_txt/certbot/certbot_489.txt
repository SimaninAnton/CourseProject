Member
bmw commented on 28 Jun 2018
Create an ACMEv1 account by running:
sudo certbot register  --server https://acme-staging.api.letsencrypt.org/directory
Then try to delete (or update) the account when using the ACMEv2 server:
sudo certbot unregister --server https://acme-staging-v02.api.letsencrypt.org/directory
It will fail with an error message like:
The request message was malformed :: No JWK in JWS header
This happens without setting the server if you have an ACMEv1 prod account and checkout the acmev2-default branch.
This happens because in acme.client.BackwardsCompatibleClientV2 we're using the ACMEv2 client, but we POST to the URL taken from the registration on disk which is an ACMEv1 URL. This mismatch causes us to send the wrong values in the request causing this error.