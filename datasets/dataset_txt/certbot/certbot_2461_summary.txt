How atomic are the updates in storage.py?