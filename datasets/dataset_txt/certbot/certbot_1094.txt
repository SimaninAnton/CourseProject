lesliev commented on 20 Jun 2017
Certbot failed to renew our certificate and did not notify us via email.
I loaded up notify.py in the python console and tested that email sending does actually work (and it did):
https://github.com/certbot/certbot/blob/b1826d657ffc7c278041cc0c8e14dc2ba23f95e3/certbot/notify.py
So it appears Certbot didn't try to send an email.
My operating system is (include version):
Ubuntu 12.04.1 LTS
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto
I ran this command via crontab:
/opt/certbot-auto renew --quiet --no-self-upgrade --renew-hook "service nginx reload"
Certbot's behavior differed from what I expected because:
It did not email us about the error during renewal of the certificate.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2017-06-18 15:42:37,501:INFO:certbot.reporter:Reporting to user: The following errors were reported by the server:
Domain: media.nzonscreen.com
Type: connection
Detail: DNS problem: query timed out looking up A for media.nzonscreen.com
To fix these errors, please make sure that your domain name was entered correctly and the DNS A record(s) for that domain contain(s) the right IP address. Additionally, please check that your computer has a publicly routable IP address and that no firewalls are preventing the server from communicating with the client. If you're using the webroot plugin, you should also verify that you are serving files from the webroot path you provided.
2017-06-18 15:42:37,502:INFO:certbot.auth_handler:Cleaning up challenges
2017-06-18 15:42:37,503:WARNING:certbot.renewal:Attempting to renew cert from /etc/letsencrypt/renewal/media.nzonscreen.com.conf produced an unexpected error: Failed authorization procedure. media.nzonscreen.com (http-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: DNS problem: query timed out looking up A for media.nzonscreen.com. Skipping.
2017-06-18 15:42:37,506:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/renewal.py", line 342, in renew_all_lineages
main.obtain_cert(lineage_config, plugins, renewal_candidate)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/main.py", line 509, in obtain_cert
_, action = _auth_from_domains(le_client, config, domains, lineage)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/main.py", line 90, in _auth_from_domains
renewal.renew_cert(config, domains, le_client, lineage)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/renewal.py", line 236, in renew_cert
new_certr, new_chain, new_key, _ = le_client.obtain_certificate(domains)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/client.py", line 246, in obtain_certificate
self.config.allow_subset_of_names)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/auth_handler.py", line 74, in get_authorizations
self._respond(resp, best_effort)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/auth_handler.py", line 131, in _respond
self._poll_challenges(chall_update, best_effort)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/auth_handler.py", line 195, in _poll_challenges
raise errors.FailedChallenges(all_failed_achalls)
FailedChallenges: Failed authorization procedure. media.nzonscreen.com (http-01): urn:acme:error:connection :: The server could not connect to the client to verify the domain :: DNS problem: query timed out looking up A for media.nzonscreen.com
2017-06-18 15:42:37,507:DEBUG:certbot.main:Exiting abnormally:
Traceback (most recent call last):
File "/root/.local/share/letsencrypt/bin/letsencrypt", line 11, in
sys.exit(main())
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/main.py", line 693, in main
return config.func(config, plugins)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/main.py", line 538, in renew
renewal.renew_all_lineages(config)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/certbot/renewal.py", line 359, in renew_all_lineages
len(renew_failures), len(parse_failures)))
Error: 1 renew failure(s), 0 parse failure(s)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
N/A