Member
bmw commented on 20 Oct 2015
The experience of using the manual authenticator with multiple domain names is a bit awkward. For each name it gives you instructions like the following:
mkdir -p /tmp/letsencrypt/public_html/.well-known/acme-challenge
cd /tmp/letsencrypt/public_html
echo -n '{"header": {"alg": "RS256", "jwk": {"e": "AQAB", "kty": "RSA", "n": "qu4DgujbdbaWyDrhz_zrmna4NR5wzVTgX_9OPvc3zs6_lZwkHs5l-8ayfitKMAj-o59cwO1tVV25xRFlUvtrW830lMshedP7fpktq9Je49_mWi7Xr9VNirKOKCbVXvanWNNFIrPBu4MBXkFmCTKovsAwsZSJLdPj_pB3m3e_5jqwhQng7O38FxmNgmWJcJThBy9IMgTGzofJdV5so8y13BlroBFkEzP2tq8Eo-hZS48KQIYpDvquu95OhPgkhcLgw9-qyWqs60nrFw0s4icLRrFLkHOJSICdfWJnTrsbWNbHkzRj1BGy-KW-mlcBoiZlA19b_OZdSV2XyFAhbb17Uw"}}, "payload": "eyJ0bHMiOiBmYWxzZSwgInRva2VuIjogImEzeFpGakphZkctd3NaNUxiMm5Ja2lIZDBlWU5XQW9yNkxnd0ZGcWxnRUkiLCAidHlwZSI6ICJzaW1wbGVIdHRwIn0", "signature": "ASPBrTwQUexVuGcaSqycuH9hq5q-RM1YBV7GHV5ALBR14DrT79MS0CDYuQDjGQsRyCDEpSn8Qv31qWue6OPoUYX7iTtfUzovuh58sSnA2XrBkS-l_A6fvEYOV2JkXZDHIVgC2NKoKBmboBipKtrvCwELf5LeUJu5LGuJAJhbcBvpU6-RriPvxdERObe74jV0pdDjmQhwgzqYI1-IrCpJa9YMzQvCgvOoSn2I3Qi4xKCt_O5qY0-3M8Z-rc1IXCbaQ8f8b0wRVz9-ewrg4fszN2uOTfUN6Eft4NAb2jqJ_aMxwRzGS1tij8YX3j7Wq3pV7hFhMtsXkYkmTbho2qhBuA"}' > .well-known/acme-challenge/a3xZFjJafG-wsZ5Lb2nIkiHd0eYNWAor6LgwFFqlgEI
# run only once per server:
$(command -v python2 || command -v python2.7 || command -v python2.6) -c \
"import BaseHTTPServer, SimpleHTTPServer; \
SimpleHTTPServer.SimpleHTTPRequestHandler.extensions_map = {'': 'application/jose+json'}; \
s = BaseHTTPServer.HTTPServer(('', 80), SimpleHTTPServer.SimpleHTTPRequestHandler); \
s.serve_forever()"
The code then verifies that you are serving the file correctly before giving you instructions for the next name.
The suggested approach in the TODO item that prompted this issue is to use gethostbyname to see what domains are on the same server. This won't work for things like round robin DNS but in general I think is a pretty good approach.