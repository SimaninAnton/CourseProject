ophiocus commented on 13 Nov 2016 •
edited
This will cause the configuration to be written to the wrong conf file
if more than one vhost file has the same servername specified<<<
repro steps
in apache2 create 2 vhosts*80 files in sites-available, give theme the same server name, enable the one that is alpahabetiacally last� ( Avhost.conf and Bvhost.conf, enable Bvhost)
run certbot; (sudo letsencrypt --apache -d commonname.com -d www.commonname.com )
configurations will be written to the first conf, which is dissabled and the resulting -le-ssl conf file in sites enabled is name based off the dissabled configuration (Avhost.conf has redirect rules, and Avhost-le-ssl.conf is now created as a new vhost and enabled as a new site )
Potential fix-
only look for vhosts conf files present in sites-enabled when using the apache plugin unless otherwise specified
NOTE: i only noticed this because the force secure connection was not working, this led me to find the configuration for the redirect in Avhost which is a dissabled vhost