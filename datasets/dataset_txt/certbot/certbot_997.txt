JeffAbrahamson commented on 25 Aug 2017
My operating system is (include version):
ubuntu 16.04
Linux nantes-1 4.4.0-87-generic #110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
apt-get install
I ran this command (with my real domain name) and it produced this output:
╭╴ (master=)╶╮
╰ [T] jeff@nantes-1:p27 $ certbot --version
certbot 0.17.0
╭╴ (master=)╶╮
╰ [T] jeff@nantes-1:p27 $ 

╭╴ (master=)╶╮
╰ [T] jeff@nantes-1:p27 $ sudo certbot --nginx -d example.com -d www.example.com
Saving debug log to /var/log/letsencrypt/letsencrypt.log
2017/08/24 19:39:41 [emerg] 1313#1313: BIO_new_file("/etc/letsencrypt/live/example.com/fullchain.pem") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen('/etc/letsencrypt/live/example.com/fullchain.pem','r') error:2006D080:BIO routines:BIO_new_file:no such file)
Error while running nginx -c /etc/nginx/nginx.conf -t.

nginx: [emerg] BIO_new_file("/etc/letsencrypt/live/example.com/fullchain.pem") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen('/etc/letsencrypt/live/example.com/fullchain.pem','r') error:2006D080:BIO routines:BIO_new_file:no such file)
nginx: configuration file /etc/nginx/nginx.conf test failed

The nginx plugin is not working; there may be problems with your existing configuration.
The error was: MisconfigurationError('Error while running nginx -c /etc/nginx/nginx.conf -t.\n\nnginx: [emerg] BIO_new_file("/etc/letsencrypt/live/example.com/fullchain.pem") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen(\'/etc/letsencrypt/live/example.com/fullchain.pem\',\'r\') error:2006D080:BIO routines:BIO_new_file:no such file)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n',)
╭╴ (master=)╶╮
╰ 1,[T] jeff@nantes-1:p27 $ 
Note that the nginx site file already had a reference to the not-yet-existing certs.
Certbot's behavior differed from what I expected because:
I expected certbot to see that the certs didn't exist but that the paths were precisely the paths that certbot would have tried to create. And so I expected certbot to create the certs.
This comes up when re-installing a host, since I'd like the git-controlled site files to be the same as what lives in production. In other words, I've copied the certbot-modified site files to git.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring: