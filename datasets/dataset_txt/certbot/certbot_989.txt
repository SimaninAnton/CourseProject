Contributor
tchollingsworth commented on 28 Aug 2017
certbot doesn't seem to support third-party Apache installs on Debian, such as the installation provided by the popular bitnami cloud installer. This is because it expects various Debian modifications to the installation that are not present in such third-party installations.
Furthermore, some certbot options intended to help with the situation appear either not to work or don't go far enough.
bitnami@bitnami-lampstack-dm-4780:~$ certbot --version # installed from jessie-backports which drags in an unused apache2
certbot 0.10.2
bitnami@bitnami-lampstack-dm-4780:~$ sudo certbot --apache --apache-server-root=/opt/bitnami/apache2/ --apache-handle-sites=False --apache-handle-modules=False
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Directory '/opt/bitnami/apache2/sites-enabled' does not exist. Please ensure that the values for --apache-handle-sites and --apache-server-root are correct for your environment.
bitnami@bitnami-lampstack-dm-4780:~$ sudo ./certbot-auto --version # clean install, no Debian apache2 at all
certbot 0.17.0
bitnami@bitnami-lampstack-dm-4780:~$ sudo ./certbot-auto --apache
Saving debug log to /var/log/letsencrypt/letsencrypt.log                     
Failed to find executable apache2ctl in PATH: /opt/bitnami/git/bin:/opt/bitnami/varnish/bin:/opt/bitnami/sqlite/bin:/opt/bitnami/php/bin:/opt/bitnami/mysql/bin:/opt/bitnami/apache2/bin:/opt/bitnami/common/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apache2ctl',)
bitnami@bitnami-lampstack-dm-4780:~$ sudo ./certbot-auto --apache --apache-server-root=/opt/bitnami/apache2/ --apache-handle-sites=False --apache-handle-modules=False
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Failed to find executable apache2ctl in PATH: /opt/bitnami/git/bin:/opt/bitnami/varnish/bin:/opt/bitnami/sqlite/bin:/opt/bitnami/php/bin:/opt/bitnami/mysql/bin:/opt/bitnami/apache2/bin:/opt/bitnami/common/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apache2ctl',)
bitnami@bitnami-lampstack-dm-4780:~$ ls /opt/bitnami/apache2/bin
ab            envvars-std       htdigest.bin   logresolve.bin
ab.bin        fcgistarter       htpasswd       pagespeed_js_minify
apachectl     fcgistarter.bin   htpasswd.bin   pagespeed_js_minify.bin
apxs          htcacheclean      httpd          rotatelogs
checkgid      htcacheclean.bin  httpd.bin      rotatelogs.bin
checkgid.bin  htdbm             httxt2dbm
dbmmanage     htdbm.bin         httxt2dbm.bin
envvars       htdigest          logresolve
To resolve these issues, Certbot could disable Debian-specific logic if the --apache-server-root option is passed, or provide a new option to do so.