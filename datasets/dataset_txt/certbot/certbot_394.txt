billynoah commented on 14 Sep 2018 â€¢
edited
OS: 18.04.1 LTS
Server version: Apache/2.4.29 (Ubuntu)
certbot 0.26.1
For some reason the Apache conf files generated initially did not include the closing </IfModule> tag, causing auto renewal to fail.
The original conf file does lack a trailing newline as discussed here for a similar issue: #2267. Not sure if that's relevant but thought I would mention it just in case.
The generated conf file looks like this:
<IfModule mod_ssl.c>
<VirtualHost 12.34.56.78:443>
 ServerAdmin webmaster@example.com
 ServerName example.com
 DocumentRoot /var/www/example.com
 <Directory /var/www/example.com>
  Options -Indexes +FollowSymLinks +MultiViews
  AllowOverride All
  Require all granted
 </Directory>
 LogFormat "%V %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_alt_combined
 ErrorLog /var/log/apache2/example.com-error.log
 CustomLog /var/log/apache2/example.com-access.log vhost_alt_combined

Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
</VirtualHost>
Relevant Log line:
certbot.errors.PluginError: There has been an error in parsing the file /etc/apache2/sites-enabled/example-le-ssl.conf on line 19: Syntax error
I went ahead and added the closing </IfModule> tag, ran the renewal and everything worked fine. SO this is definitely something that went awry during the initial config file creation.