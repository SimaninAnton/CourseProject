paladox commented on 22 Nov 2018
If you're having trouble using Certbot and aren't sure you've found a bug or
request for a new feature, please first try asking for help at
https://community.letsencrypt.org/. There is a much larger community there of
people familiar with the project who will be able to more quickly answer your
questions.
My operating system is (include version):
Debian 9.5
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
OS package manager (apt)
I ran this command and it produced this output:
sudo certbot certonly -a webroot --webroot-path=/var/www/challenges -d karagash.info --no-verify-ssl
It produced:
certbot.errors.FailedChallenges: Failed authorization procedure. karagash.info (http-01): urn:ietf:params:acme:error:unauthorized :: The client lacks sufficient authorization :: Invalid response from http://karagash.info/.well-known/acme-challenge/Rdqz2r-GmPtAKYDw5ggiTKkSqJ8cK58Vu34yyKn0Vhg: "\r\n<title>404 Not Found</title>\r\n\r\n
404 Not Found
\r\n
nginx/1.15.6</ce"
Certbot's behavior differed from what I expected because:
I thought it would follow redirects. We redirect from http to https since we use varnish (so we redirect to https for the tls proxy)
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring: