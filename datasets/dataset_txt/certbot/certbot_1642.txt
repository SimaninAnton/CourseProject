tobiasherp commented on 11 Nov 2016
certbot 0.9.3 on CentOS Linux release 7.0.1406 (Core)
My Apache configuration contains macros which use variables; parsing lines like this:
IncludeOptional conf/snippets/$(NAME)/00-hd-*.inc
($(NAME) being a positional argument which is replaced when the macro is used) a RuntimeError occurs:
RuntimeError: ('Error during match procedure!', u"/files/etc/httpd/conf/snippets/$(NAME)/* [label()=~regexp('00\\-hd\\-.*\\.inc')]//*[self::directive=~regexp('([Ll][Oo][Aa][Dd][Mm][Oo][Dd][Uu][Ll][Ee])|([Ii][Nn][Cc][Ll][Uu][Dd][Ee])|([Ii][Nn][Cc][Ll][Uu][Dd][Ee][Oo][Pp][Tt][Ii][Oo][Nn][Aa][Ll])')]")
Ok, certbot doesn't understand Apache macros yet, but when executing certbot certonly -d my.domain you don't expect a show-stopping parsing error.
Suggestions:
Catch the RuntimeError and tell about the line;
if possible, proceed (certbot tolerates the usage of macros as well, despite not understanding them);
otherwise re-raise the exception
When I comment out my IncludeOptional lines mentioned above, certbot resumes parsing