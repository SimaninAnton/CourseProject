ivordurham commented on 13 Jul 2018
My operating system is (include version):
Fedora release 27
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
OS package manager (dnf)
I ran this command and it produced this output:
sudo certbot --apache
(normal output)
Certbot's behavior differed from what I expected because:
My Apache server is using mod_nss. The directives for the certificate etc. were added "normally". However this was not correct for my configuration because it has the following directives with the certificates in the "alias" database:
NSSNickname "MY_CERT_NAME"
NSSCertificateDatabase /etc/httpd/alias
I removed the certbot-added directives and added the certificate to the database using the following shell commands:
openssl pkcs12 -export -in live/HIDDEN.com/fullchain.pem -inkey live/HIDDEN.com/privkey.pem -out server.p12 -name "MY_CERT_NAME" -passout pass:foo
certutil -d /etc/httpd/alias -D -n 'MY_CERT_NAME'
pk12util pk12util -i server.p12 -d /etc/httpd/alias -W foo
After a restart Apache used the new certificate correctly.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
N/A
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
N/A