efelix1 commented on 13 Aug 2018
If you're having trouble using Certbot and aren't sure you've found a bug or
request for a new feature, please first try asking for help at
https://community.letsencrypt.org/. There is a much larger community there of
people familiar with the project who will be able to more quickly answer your
questions.
My operating system is (include version):
Centos 6
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
I ran this command and it produced this output:
./certbot-auto renew
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Processing /etc/letsencrypt/renewal/liferay7-develop.devops.pmw240.com.conf
Cert is due for renewal, auto-renewing...
Failed to find executable apachectl in expanded PATH: /opt/rh/python27/root/usr/bin:/usr/local/rvm/gems/ruby-2.1.0/bin:/usr/local/rvm/gems/ruby-2.1.0@global/bin:/usr/local/rvm/rubies/ruby-2.1.0/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/cuda/bin:/usr/local/rvm/bin:/usr/local/cuda/bin:/usr/local/bin:/usr/local/sbin
Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apachectl',)
Attempting to renew cert (liferay7-develop.devops.pmw240.com) from /etc/letsencrypt/renewal/liferay7-develop.devops.pmw240.com.conf produced an unexpected error: The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apachectl',). Skipping.
All renewal attempts failed. The following certs could not be renewed:
/etc/letsencrypt/live/liferay7-develop.devops.pmw240.com/fullchain.pem (failure)
All renewal attempts failed. The following certs could not be renewed:
/etc/letsencrypt/live/liferay7-develop.devops.pmw240.com/fullchain.pem (failure)
1 renew failure(s), 0 parse failure(s)
Certbot's behavior differed from what I expected because:
Certificate was created before, now it won't renew.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2018-08-13 14:01:40,987:DEBUG:certbot.plugins.selection:Requested authenticator apache and installer apache
2018-08-13 14:01:40,996:DEBUG:certbot.plugins.util:Can't find apachectl, attempting PATH mitigation by adding /usr/local/bin:/usr/local/sbin
2018-08-13 14:01:40,997:WARNING:certbot.plugins.util:Failed to find executable apachectl in expanded PATH: /opt/rh/python27/root/usr/bin:/usr/local/rvm/gems/ruby-2.1.0/bin:/usr/local/rvm/gems/ruby-2.1.0@global/bin:/usr/local/rvm/rubies/ruby-2.1.0/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/cuda/bin:/usr/local/rvm/bin:/usr/local/cuda/bin:/usr/local/bin:/usr/local/sbin
2018-08-13 14:01:40,997:DEBUG:certbot.plugins.disco:No installation (PluginEntryPoint#apache): Cannot find Apache control command apachectl
Traceback (most recent call last):
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/plugins/disco.py", line 132, in prepare
self._initialized.prepare()
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot_apache/configurator.py", line 209, in prepare
'Cannot find Apache control command {0}'.format(restart_cmd))
NoInstallationError: Cannot find Apache control command apachectl
2018-08-13 14:01:40,998:DEBUG:certbot.plugins.selection:No candidate plugin
2018-08-13 14:01:40,998:DEBUG:certbot.plugins.selection:No candidate plugin
2018-08-13 14:01:40,998:DEBUG:certbot.plugins.selection:Selected authenticator None and installer None
2018-08-13 14:01:40,998:INFO:certbot.main:Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apachectl',)
2018-08-13 14:01:40,999:WARNING:certbot.renewal:Attempting to renew cert (liferay7-develop.devops.pmw240.com) from /etc/letsencrypt/renewal/liferay7-develop.devops.pmw240.com.conf produced an unexpected error: The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apachectl',). Skipping.
2018-08-13 14:01:41,001:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/renewal.py", line 430, in handle_renewal_request
main.renew_cert(lineage_config, plugins, renewal_candidate)
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 1191, in renew_cert
installer, auth = plug_sel.choose_configurator_plugins(config, plugins, "certonly")
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/plugins/selection.py", line 237, in choose_configurator_plugins
diagnose_configurator_problem("authenticator", req_auth, plugins)
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/plugins/selection.py", line 341, in diagnose_configurator_problem
raise errors.PluginSelectionError(msg)
PluginSelectionError: The apache plugin is not working; there may be problems with your existing configuration.
The error was: NoInstallationError('Cannot find Apache control command apachectl',)
2018-08-13 14:01:41,001:ERROR:certbot.renewal:All renewal attempts failed. The following certs could not be renewed:
2018-08-13 14:01:41,001:ERROR:certbot.renewal: /etc/letsencrypt/live/liferay7-develop.devops.pmw240.com/fullchain.pem (failure)
2018-08-13 14:01:41,001:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
File "/opt/eff.org/certbot/venv/bin/letsencrypt", line 11, in
sys.exit(main())
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 1364, in main
return config.func(config, plugins)
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/main.py", line 1276, in renew
renewal.handle_renewal_request(config)
File "/opt/eff.org/certbot/venv/lib/python2.7/site-packages/certbot/renewal.py", line 455, in handle_renewal_request
len(renew_failures), len(parse_failures)))
Error: 1 renew failure(s), 0 parse failure(s)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
liferay 7