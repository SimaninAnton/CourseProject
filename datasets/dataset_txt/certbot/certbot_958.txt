Contributor
jsoref commented on 26 Sep 2017
My operating system is (include version):
debian 9.1
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-auto (certbot version: 0.18.2)
I ran this command and it produced this output:
(for my reference, this was apricot @ 2017-09-23 01:13:07,943)
certbot-auto -q renew (in a crontab)
Encountered vhost ambiguity but unable to ask for user guidance in non-interactive mode. Certbot may need vhosts to be explicitly labelled with ServerName or ServerAlias directives.
Falling back to default vhost *:443...
Certbot's behavior differed from what I expected because:
It doesn't indicate which domain is failing.
It should distinguish between "I found multiple vhosts that could be responsible for this domain", "I couldn't find any vhosts responsible for this domain", and "there used to be a vhost responsible for this domain, but it's missing/no longer covers this domain".
if a cron task produces no output, no email is sent. In general, a cron job should only produce output if an error has occurred.
certbot should probably conceptually queue console warnings like this one until it runs into an instance where it actually needed to ask and couldn't, as opposed to saying "well, I might, eventually, maybe, need some information, maybe, so why don't I bother the user needlessly now, because being eager is a really useful activity". In this case, no error occurred, and thus a warning like this is spurious and really frustrating.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2017-09-23 01:13:07,554:INFO:certbot.auth_handler:Performing the following challenges:
2017-09-23 01:13:07,554:INFO:certbot.auth_handler:tls-sni-01 challenge for example.com
2017-09-23 01:13:07,943:WARNING:certbot_apache.display_ops:Encountered vhost ambiguity but unable to ask for user guidance in non-interactive mode. Certbot may need vhosts to be explicitly labelled with ServerName or ServerAlias directives.
2017-09-23 01:13:07,943:WARNING:certbot_apache.tls_sni_01:Falling back to default vhost *:443...
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
There isn't a vhost for this domain at this time... I'm not sure why. Mostly this domain is only used for email, and certbot is responsible for getting the certificate/renewing it so that dovecot/whatever can serve it.
PS. It did manage to renew the certificate, so, mostly this warning is incredibly disturbing, but not remotely helpful. As someone who gets a lot of email from cron/logwatch, this is an email I really could have done without.