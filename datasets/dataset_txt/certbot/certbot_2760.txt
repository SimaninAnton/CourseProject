awekas commented on 8 Dec 2015
I have registered 3 domains (including subdomains) on my server. Because its a Apache 2.2 (known problems) i certifacate it with the -webroot method.
One of the subdomains will not work. i allways get the error:
Failed authorization procedure. subdomain.mydomain.at (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Error parsing key authorization file: Invalid key authorization: 264 parts
The Apache and DNS configuration is the same as the working subdomain. I have no idea where is the problem.
here is the Logfile:
(subdomain and domain was changed by security reason)
The key folder (.well-known) was generated at the root directory
2015-12-08 14:49:56,558:DEBUG:root:Sending POST request to .....
2015-12-08 14:49:56,558:INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
2015-12-08 14:49:56,825:DEBUG:requests.packages.urllib3.connectionpool:"POST /acme/challenge/9PBNYxWsLwbqIMZjJFJghsLD5qGpbvpOVeWxF_pDLXc/1307454 H$
2015-12-08 14:49:56,827:DEBUG:root:Received . Headers: {'Content-Length': '312', 'Expires': 'Tue, 08 Dec 2015 14:49:56 GMT', 'Serv$
2015-12-08 14:49:56,828:DEBUG:acme.client:Storing nonce: "<\xc7\x7f\x9df\xd2\xe5,\x1fV\x89'p\x86\xce\xee\xc7\x1b\xa7N\xd2\xabx\xa6\xe0\xb7\x88\xfe$
2015-12-08 14:49:56,828:DEBUG:acme.client:Received response (headers: {'Content-Length': '312', 'Expires': 'Tue, 08 Dec 2015 14:4$
2015-12-08 14:49:59,831:DEBUG:root:Sending GET request to .........
2015-12-08 14:49:59,832:INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
2015-12-08 14:50:00,149:DEBUG:requests.packages.urllib3.connectionpool:"GET /acme/authz/9PBNYxWsLwbqIMZjJFJghsLD5qGpbvpOVeWxF_pDLXc HTTP/1.1" 200 $
2015-12-08 14:50:00,151:DEBUG:root:Received . Headers: {'Content-Length': '1221', 'Expires': 'Tue, 08 Dec 2015 14:50:00 GMT', 'Str$
2015-12-08 14:50:00,152:DEBUG:acme.client:Received response (headers: {'Content-Length': '1221', 'Expires': 'Tue, 08 Dec 2015 14:$
2015-12-08 14:50:00,153:INFO:letsencrypt.reporter:Reporting to user: The following 'urn:acme:error:unauthorized' errors were reported by the serve$
Domains: subdomain.mydomain.at
Error: The client lacks sufficient authorization
2015-12-08 14:50:00,153:INFO:letsencrypt.auth_handler:Cleaning up challenges
2015-12-08 14:50:00,153:DEBUG:letsencrypt.plugins.webroot:Removing /var/www/wetter/xxx/xxx/.well-known/acme-challenge/jGmDinFf2mA1mj12b$
2015-12-08 14:50:00,154:DEBUG:letsencrypt.cli:Exiting abnormally:
Traceback (most recent call last):
File "/root/.local/share/letsencrypt/bin/letsencrypt", line 11, in
sys.exit(main())
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/cli.py", line 1283, in main
return args.func(args, config, plugins)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/cli.py", line 512, in obtain_cert
authfrom_domains(le_client, config, domains)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/cli.py", line 336, in authfrom_domains
lineage = le_client.obtain_and_enroll_certificate(domains)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/client.py", line 283, in obtain_and_enroll_certificate
certr, chain, key, _ = self.obtain_certificate(domains)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/client.py", line 266, in obtain_certificate
return self.obtaincertificate(domains, csr) + (key, csr)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/client.py", line 224, in obtaincertificate
authzr = self.auth_handler.get_authorizations(domains)
File "/root/.local/share/letsencrypt/local/lib/python2.7/site-packages/letsencrypt/auth_handler.py", line 84, in get_authorizations
Output in CLI:
./letsencrypt-auto certonly --webroot -w /var/www/wetter/path/path/ -d subdomain.mydomain.at
.......
Failed authorization procedure. subdomain.mydomain.at (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Error parsing key authorization file: Invalid key authorization: 264 parts
IMPORTANT NOTES:
The following 'urn:acme:error:unauthorized' errors were reported by
the server:
Domains: subdomain.mydomain.at
Error: The client lacks sufficient authorization
Thanks for your help!
Othmar