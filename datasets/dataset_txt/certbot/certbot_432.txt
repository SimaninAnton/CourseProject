Fabriceli commented on 12 Aug 2018
If you're having trouble using Certbot and aren't sure you've found a bug or
request for a new feature, please first try asking for help at
https://community.letsencrypt.org/. There is a much larger community there of
people familiar with the project who will be able to more quickly answer your
questions.
My operating system is (include version):
CENTOS 7 aliyun
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
yum install certbot
yum install python2-certbot-nginx
I ran this command and it produced this output:
All commands works
Certbot's behavior differed from what I expected because:
3 days ago, I installed certbot and it worked, and i could connect ma web with "https://my.domain.com" without vpn.
But now I have to run a vpn with my computer to connect my web.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Logs from letsencrypt.log:
2018-08-12 23:05:44,875:INFO:certbot_nginx.configurator:Redirecting all traffic on port 80 to ssl in /etc/nginx/nginx.conf
2018-08-12 23:05:44,884:INFO:certbot_nginx.configurator:Redirecting all traffic on port 80 to ssl in /etc/nginx/nginx.conf
2018-08-12 23:05:44,885:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-http-image-filter.conf
2018-08-12 23:05:44,885:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-http-geoip.conf
2018-08-12 23:05:44,885:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-stream.conf
2018-08-12 23:05:44,886:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-http-xslt-filter.conf
2018-08-12 23:05:44,886:DEBUG:certbot.reverter:Creating backup of /etc/nginx/mime.types
2018-08-12 23:05:44,886:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-mail.conf
2018-08-12 23:05:44,886:DEBUG:certbot.reverter:Creating backup of /etc/nginx/nginx.conf
2018-08-12 23:05:44,887:DEBUG:certbot.reverter:Creating backup of /usr/share/nginx/modules/mod-http-perl.conf
2018-08-12 23:05:44,890:DEBUG:certbot_nginx.parser:Writing nginx conf tree to /etc/nginx/nginx.conf:
For more information on configuration, see:
* Official English Documentation: http://nginx.org/en/docs/
* Official Russian Documentation: http://nginx.org/ru/docs/
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
http {
log_format main '$remote_addr - $remote_user [$time_local] "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
access_log  /var/log/nginx/access.log  main;

sendfile            on;
tcp_nopush          on;
tcp_nodelay         on;
keepalive_timeout   65;
types_hash_max_size 2048;

include             /etc/nginx/mime.types;
default_type        application/octet-stream;

# Load modular configuration files from the /etc/nginx/conf.d directory.
# See http://nginx.org/en/docs/ngx_core_module.html#include
# for more information.
include /etc/nginx/conf.d/*.conf;

server {
   server_name my server;
   charset     utf-8;
   access_log /var/logs/nginx_access.log;
   error_log /var/logs/nginx_error.log;
   client_max_body_size 75M;

   location /static {
      alias /myproject/static/;
   }

   location /dist {
      alias /myproject/dist/;
   }

   location / {
       proxy_pass http://unix:/tmp/myproject.socket;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header Host $host;
   }

listen 443 ssl; # managed by Certbot
ssl_certificate /etc/letsencrypt/live/my server/fullchain.pem; # managed by Certbot
ssl_certificate_key /etc/letsencrypt/live/my server/privkey.pem; # managed by Certbot
include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}