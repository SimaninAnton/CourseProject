ZachBacon commented on 25 Aug 2017
My operating system is (include version):
Archlinux
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
certbot-nginx
I ran this command and it produced this output:
sudo certbot renew --quiet --agree-tos
`Attempting to renew cert (thecanadianbacon.in) from /etc/letsencrypt/renewal/thecanadianbacon.in.conf produced an unexpected error: Failed authorization procedure. thecanadianbacon.in (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Invalid response from http://thecanadianbacon.in/.well-known/acme-challenge/IW3i1WCPnHZCLZjZgubEcwCt-sZXzbi7RgOh8-n1Uxk: "
<title>404 Not Found</title>
404 Not Found
". Skipping.
All renewal attempts failed. The following certs could not be renewed:
/etc/letsencrypt/live/thecanadianbacon.in/fullchain.pem (failure)
1 renew failure(s), 0 parse failure(s)
[thecanadianbacon@pchat ~]$ sudo certbot renew --dry-run
Saving debug log to /var/log/letsencrypt/letsencrypt.log`
Certbot's behavior differed from what I expected because:
The expected result would of been successful renewal of my cert.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2017-08-24 23:23:54,085:DEBUG:certbot.main:certbot version: 0.17.0
2017-08-24 23:23:54,086:DEBUG:certbot.main:Arguments: ['--dry-run']
2017-08-24 23:23:54,087:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#manual,PluginEntryPoint#nginx,PluginEntryPoint#null,PluginEntryPoint#standalone,PluginEntryPoint#webroot)
2017-08-24 23:23:54,105:DEBUG:certbot.log:Root logging level set at 20
2017-08-24 23:23:54,105:INFO:certbot.log:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2017-08-24 23:23:54,151:DEBUG:certbot.plugins.selection:Requested authenticator <certbot.cli._Default object at 0x7f8c81cc95f8> and installer <certbot.cli._Default object at 0x7f8c81cc95f8>
2017-08-24 23:23:54,152:DEBUG:certbot.cli:Default Detector is Namespace(account=<certbot.cli._Default object at 0x7f8c81bd09b0>, agree_dev_preview=None, allow_subset_of_names=<certbot.cli._Default object at 0x7f8c81bd0e48>, apache=<certbot.cli._Default object at 0x7f8c81bcb5c0>, authenti$
2017-08-24 23:23:54,163:DEBUG:certbot.storage:Should renew, less than 30 days before certificate expiry 2017-08-25 01:06:00 UTC.
2017-08-24 23:23:54,163:INFO:certbot.renewal:Cert is due for renewal, auto-renewing...
2017-08-24 23:23:54,187:DEBUG:certbot.plugins.selection:Requested authenticator webroot and installer None
2017-08-24 23:23:54,192:DEBUG:certbot.plugins.selection:Single candidate plugin: * webroot
Description: Place files in webroot directory
Interfaces: IAuthenticator, IPlugin
Entry point: webroot = certbot.plugins.webroot:Authenticator
Initialized: <certbot.plugins.webroot.Authenticator object at 0x7f8c81bb0940>
Prep: True
2017-08-24 23:23:54,193:DEBUG:certbot.plugins.selection:Selected authenticator <certbot.plugins.webroot.Authenticator object at 0x7f8c81bb0940> and installer None
2017-08-24 23:23:54,330:DEBUG:acme.client:Sending GET request to https://acme-staging.api.letsencrypt.org/directory.
2017-08-24 23:23:54,333:DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): acme-staging.api.letsencrypt.org
2017-08-24 23:23:54,619:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "GET /directory HTTP/1.1" 200 581
2017-08-24 23:23:54,620:DEBUG:acme.client:Received response:
HTTP 200
Server: nginx
Content-Type: application/json
Content-Length: 581
Boulder-Request-Id: py3IQ8AjGVRdECzvJeGar01Gun9GTI3fOIi3FbgIACA
Replay-Nonce: Rldg67DJPyJ38ICD61jW7q93cZSp1gG13WZrLm7VBSA
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 24 Aug 2017 23:23:54 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:54 GMT
Connection: keep-alive
b'{\n "d8WPCZwc2mc": "https://community.letsencrypt.org/t/adding-random-entries-to-the-directory/33417",\n "key-change": "https://acme-staging.api.letsencrypt.org/acme/key-change",\n "meta": {\n "terms-of-service": "https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf"\$
2017-08-24 23:23:54,621:DEBUG:acme.client:Requesting fresh nonce
2017-08-24 23:23:54,621:DEBUG:acme.client:Sending HEAD request to https://acme-staging.api.letsencrypt.org/acme/new-reg.
2017-08-24 23:23:54,752:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "HEAD /acme/new-reg HTTP/1.1" 405 0
2017-08-24 23:23:54,753:DEBUG:acme.client:Received response:
HTTP 405
Server: nginx
Content-Type: application/problem+json
Content-Length: 91
Allow: POST
Boulder-Request-Id: yLwsY0ZwlJ5PxxvZW4IQlD2B0KmBz66EhXGrGnYeY5M
Replay-Nonce: 7P9IZVRRXwEMAA49oTlfFaDv49c5SNPzb9O9ml4PLR0
Expires: Thu, 24 Aug 2017 23:23:54 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:54 GMT
Connection: keep-alive
b''
2017-08-24 23:23:54,753:DEBUG:acme.client:Storing nonce: 7P9IZVRRXwEMAA49oTlfFaDv49c5SNPzb9O9ml4PLR0
2017-08-24 23:23:54,754:DEBUG:acme.client:JWS payload:
b'{\n "resource": "new-reg"\n}'
2017-08-24 23:23:54,759:DEBUG:acme.client:Sending POST request to https://acme-staging.api.letsencrypt.org/acme/new-reg:
{
"protected": "eyJhbGciOiAiUlMyNTYiLCAiandrIjogeyJuIjogIms3Z3BGSkY5dWRDYmRjcm5DUmZCd2Itam93eTNaUE1uYzFFd2phUTVLODJWSHRLaW9vT2llN1VqS1VvRnk3NDZvV1hWaW44UWhwX3FXVFZ6eGxFaXFBRTdEYWFJYUQyQVItT3k3NjRrUHJmajNncGdjam40T1dGSDNaeEp4OXB3TXdxRno0RzEyb1pyM3dpWDVDNFRZalMzZzVSeGNsd0xjeG5KcTdFNjR6TUwy$
"signature": "JTjwVnpi_qjexo4nTnHDte56fioUeVD6HxeFTza81hFwYBT0G8rKeGG_CpqigXxx8ummh1TAcrP-Q9RRtsRpbHJ0HHqzYa0ncM7gvtgaPNMCV0SX_CsPQLgeWn7qurVUw4VXc8A0yC5Fp9u_k_0PpmXBycnlJO_EWKaORCCTFZkuQZFOgLlOHoVC3Cn_qbl975xjOF8RbYxTsm2xvBqSH2iRTGHeEJf5_MrYWSlhX1-FjV0W7jnNFaHk_G_1txfztxN2BKuiyMIteLUv$
"payload": "ewogICJyZXNvdXJjZSI6ICJuZXctcmVnIgp9"
}
2017-08-24 23:23:54,933:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "POST /acme/new-reg HTTP/1.1" 201 543
2017-08-24 23:23:54,934:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 543
Boulder-Request-Id: VdDKiCV_y2jB69WXUix1waUdI1fTdM5pzeRr3P7Ac5A
Boulder-Requester: 3684257
Link: https://acme-staging.api.letsencrypt.org/acme/new-authz;rel="next", https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf;rel="terms-of-service"
Location: https://acme-staging.api.letsencrypt.org/acme/reg/3684257
Replay-Nonce: GizOQ4rciNyqSRHCiZlmnVc046t6jxDs-DfKPgqIIXg
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 24 Aug 2017 23:23:54 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:54 GMT
Connection: keep-alive
b'{\n "id": 3684257,\n "key": {\n "kty": "RSA",\n "n": "k7gpFJF9udCbdcrnCRfBwb-jowy3ZPMnc1EwjaQ5K82VHtKiooOie7UjKUoFy746oWXVin8Qhp_qWTVzxlEiqAE7DaaIaD2AR-Oy764kPrfj3gpgcjn4OWFH3ZxJx9pwMwqFz4G12oZr3wiX5C4TYjS3g5RxclwLcxnJq7E64zML2Sq1-4Zdv2C5Vlf9-Tnplh6qN_DuKQtebv_nitG7FoAiQJK_fzgk$
2017-08-24 23:23:54,934:DEBUG:acme.client:Storing nonce: GizOQ4rciNyqSRHCiZlmnVc046t6jxDs-DfKPgqIIXg
2017-08-24 23:23:54,935:DEBUG:acme.client:JWS payload:
b'{\n "key": {\n "n": "k7gpFJF9udCbdcrnCRfBwb-jowy3ZPMnc1EwjaQ5K82VHtKiooOie7UjKUoFy746oWXVin8Qhp_qWTVzxlEiqAE7DaaIaD2AR-Oy764kPrfj3gpgcjn4OWFH3ZxJx9pwMwqFz4G12oZr3wiX5C4TYjS3g5RxclwLcxnJq7E64zML2Sq1-4Zdv2C5Vlf9-Tnplh6qN_DuKQtebv_nitG7FoAiQJK_fzgk9fPRsN_prlDN6YKryx6NqOAgBAG1TUKbsBPh9$
2017-08-24 23:23:54,939:DEBUG:acme.client:Sending POST request to https://acme-staging.api.letsencrypt.org/acme/reg/3684257:
{
"protected": "eyJhbGciOiAiUlMyNTYiLCAiandrIjogeyJuIjogIms3Z3BGSkY5dWRDYmRjcm5DUmZCd2Itam93eTNaUE1uYzFFd2phUTVLODJWSHRLaW9vT2llN1VqS1VvRnk3NDZvV1hWaW44UWhwX3FXVFZ6eGxFaXFBRTdEYWFJYUQyQVItT3k3NjRrUHJmajNncGdjam40T1dGSDNaeEp4OXB3TXdxRno0RzEyb1pyM3dpWDVDNFRZalMzZzVSeGNsd0xjeG5KcTdFNjR6TUwy$
"signature": "JTjwVnpi_qjexo4nTnHDte56fioUeVD6HxeFTza81hFwYBT0G8rKeGG_CpqigXxx8ummh1TAcrP-Q9RRtsRpbHJ0HHqzYa0ncM7gvtgaPNMCV0SX_CsPQLgeWn7qurVUw4VXc8A0yC5Fp9u_k_0PpmXBycnlJO_EWKaORCCTFZkuQZFOgLlOHoVC3Cn_qbl975xjOF8RbYxTsm2xvBqSH2iRTGHeEJf5_MrYWSlhX1-FjV0W7jnNFaHk_G_1txfztxN2BKuiyMIteLUv$
"payload": "ewogICJyZXNvdXJjZSI6ICJuZXctcmVnIgp9"
}
2017-08-24 23:23:54,933:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "POST /acme/new-reg HTTP/1.1" 201 543
2017-08-24 23:23:54,934:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 543
Boulder-Request-Id: VdDKiCV_y2jB69WXUix1waUdI1fTdM5pzeRr3P7Ac5A
Boulder-Requester: 3684257
Link: https://acme-staging.api.letsencrypt.org/acme/new-authz;rel="next", https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf;rel="terms-of-service"
Location: https://acme-staging.api.letsencrypt.org/acme/reg/3684257
Replay-Nonce: GizOQ4rciNyqSRHCiZlmnVc046t6jxDs-DfKPgqIIXg
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 24 Aug 2017 23:23:54 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:54 GMT
Connection: keep-alive
b'{\n "id": 3684257,\n "key": {\n "kty": "RSA",\n "n": "k7gpFJF9udCbdcrnCRfBwb-jowy3ZPMnc1EwjaQ5K82VHtKiooOie7UjKUoFy746oWXVin8Qhp_qWTVzxlEiqAE7DaaIaD2AR-Oy764kPrfj3gpgcjn4OWFH3ZxJx9pwMwqFz4G12oZr3wiX5C4TYjS3g5RxclwLcxnJq7E64zML2Sq1-4Zdv2C5Vlf9-Tnplh6qN_DuKQtebv_nitG7FoAiQJK_fzgk$
2017-08-24 23:23:54,934:DEBUG:acme.client:Storing nonce: GizOQ4rciNyqSRHCiZlmnVc046t6jxDs-DfKPgqIIXg
2017-08-24 23:23:54,935:DEBUG:acme.client:JWS payload:
b'{\n "key": {\n "n": "k7gpFJF9udCbdcrnCRfBwb-jowy3ZPMnc1EwjaQ5K82VHtKiooOie7UjKUoFy746oWXVin8Qhp_qWTVzxlEiqAE7DaaIaD2AR-Oy764kPrfj3gpgcjn4OWFH3ZxJx9pwMwqFz4G12oZr3wiX5C4TYjS3g5RxclwLcxnJq7E64zML2Sq1-4Zdv2C5Vlf9-Tnplh6qN_DuKQtebv_nitG7FoAiQJK_fzgk9fPRsN_prlDN6YKryx6NqOAgBAG1TUKbsBPh9$
2017-08-24 23:23:54,939:DEBUG:acme.client:Sending POST request to https://acme-staging.api.letsencrypt.org/acme/reg/3684257:
{
"protected": "eyJhbGciOiAiUlMyNTYiLCAiandrIjogeyJuIjogIms3Z3BGSkY5dWRDYmRjcm5DUmZCd2Itam93eTNaUE1uYzFFd2phUTVLODJWSHRLaW9vT2llN1VqS1VvRnk3NDZvV1hWaW44UWhwX3FXVFZ6eGxFaXFBRTdEYWFJYUQyQVItT3k3NjRrUHJmajNncGdjam40T1dGSDNaeEp4OXB3TXdxRno0RzEyb1pyM3dpWDVDNFRZalMzZzVSeGNsd0xjeG5KcTdFNjR6TUwy$
"signature": "MfQELB4w1D85JGLSobSQTjOxRXZbWr7cWv0_cDf2Rst_Xz9mKsstzQvvsRXPHeEkm2h-qOt5z7i8uShWgAqKH7ppQbCyt1d7FhfVxxriZtoIyus_FMj6U5oKGTvxgYbvyXto-b5ugOtk-tMkTFWZHQCi39Y0yetYNW_2fzO2ijzncizHyFRYTPFvup2_kOXQv4MSe8js_-8nGfDfhzjXBG_xcNTyeIZrPI9zaz7b8Kwf_WxE7hPPChUI1924OCsJkqRjT7Omb0_I5W8I$
"payload": "ewogICJrZXkiOiB7CiAgICAibiI6ICJrN2dwRkpGOXVkQ2JkY3JuQ1JmQndiLWpvd3kzWlBNbmMxRXdqYVE1SzgyVkh0S2lvb09pZTdVaktVb0Z5NzQ2b1dYVmluOFFocF9xV1RWenhsRWlxQUU3RGFhSWFEMkFSLU95NzY0a1ByZmozZ3BnY2puNE9XRkgzWnhKeDlwd013cUZ6NEcxMm9acjN3aVg1QzRUWWpTM2c1UnhjbHdMY3huSnE3RTY0ek1MMlNxMS00WmR2Mk$
}
2017-08-24 23:23:55,073:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "POST /acme/reg/3684257 HTTP/1.1" 202 617
2017-08-24 23:23:55,074:DEBUG:acme.client:Received response:
HTTP 202
Server: nginx
Content-Type: application/json
Content-Length: 617
Boulder-Request-Id: tcp1LNM9Xai4_o6e3yD1g_Uj4cTTQ-0Tu_0FmvkMgZI
Boulder-Requester: 3684257
Link: https://acme-staging.api.letsencrypt.org/acme/new-authz;rel="next", https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf;rel="terms-of-service"
Replay-Nonce: trn4-Jg1jLWpseQg-YWvFKZRGVrK7o5z0HJD5yUTNAQ
Expires: Thu, 24 Aug 2017 23:23:55 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:55 GMT
Connection: keep-alive
b'{\n "id": 3684257,\n "key": {\n "kty": "RSA",\n "n": "k7gpFJF9udCbdcrnCRfBwb-jowy3ZPMnc1EwjaQ5K82VHtKiooOie7UjKUoFy746oWXVin8Qhp_qWTVzxlEiqAE7DaaIaD2AR-Oy764kPrfj3gpgcjn4OWFH3ZxJx9pwMwqFz4G12oZr3wiX5C4TYjS3g5RxclwLcxnJq7E64zML2Sq1-4Zdv2C5Vlf9-Tnplh6qN_DuKQtebv_nitG7FoAiQJK_fzgk$
2017-08-24 23:23:55,075:DEBUG:acme.client:Storing nonce: trn4-Jg1jLWpseQg-YWvFKZRGVrK7o5z0HJD5yUTNAQ
2017-08-24 23:23:55,077:DEBUG:certbot.reporter:Reporting to user: Your account credentials have been saved in your Certbot configuration directory at /etc/letsencrypt. You should make a secure backup of this folder now. This configuration directory will also contain certificates and priv$
2017-08-24 23:23:55,080:DEBUG:certbot.main:Picked account: <Account(RegistrationResource(body=Registration(key=JWKRSA(key=<ComparableRSAKey(<cryptography.hazmat.backends.openssl.rsa._RSAPublicKey object at 0x7f8c81c15780>)>), contact=(), agreement='https://letsencrypt.org/documents/LE-SA$
2017-08-24 23:23:55,081:INFO:certbot.main:Renewing an existing certificate
2017-08-24 23:23:55,082:DEBUG:acme.client:JWS payload:
b'{\n "identifier": {\n "type": "dns",\n "value": "thecanadianbacon.in"\n },\n "resource": "new-authz"\n}'
2017-08-24 23:23:55,086:DEBUG:acme.client:Sending POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz:
{
"protected": "eyJhbGciOiAiUlMyNTYiLCAiandrIjogeyJuIjogIms3Z3BGSkY5dWRDYmRjcm5DUmZCd2Itam93eTNaUE1uYzFFd2phUTVLODJWSHRLaW9vT2llN1VqS1VvRnk3NDZvV1hWaW44UWhwX3FXVFZ6eGxFaXFBRTdEYWFJYUQyQVItT3k3NjRrUHJmajNncGdjam40T1dGSDNaeEp4OXB3TXdxRno0RzEyb1pyM3dpWDVDNFRZalMzZzVSeGNsd0xjeG5KcTdFNjR6TUwy$
"signature": "ML4HF5FgLhtg17EaWqdvTvezPMb18oECF6klahw-LLYEkiot57Bqg0s_PPoOJiNSbyrUly8wNguiw03amN1xE1iyqWbl166S5wcxUtNWl94LSvVc8_GhkjbbMqfxWCSnd2_FZIWa-Vg3C-kedtL-oUvYgDjQuWNuUEdpJHRz2v406To5syfxLyEZolRqOYxUUQXLEI-IR2dtgfwIipmgkgMCGu35ROoy2JSTnDQ0_DERxox0NpGpwCAvOTawRGPyuTxR32qSjLMn8fMd$
"payload": "ewogICJpZGVudGlmaWVyIjogewogICAgInR5cGUiOiAiZG5zIiwKICAgICJ2YWx1ZSI6ICJ0aGVjYW5hZGlhbmJhY29uLmluIgogIH0sCiAgInJlc291cmNlIjogIm5ldy1hdXRoeiIKfQ"
}
2017-08-24 23:23:55,268:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "POST /acme/new-authz HTTP/1.1" 201 1013
2017-08-24 23:23:55,269:DEBUG:acme.client:Received response:
HTTP 201
Server: nginx
Content-Type: application/json
Content-Length: 1013
Boulder-Request-Id: pMmxdukuSJ0rRndukiikYKYXQd9tt7SKBd3kuDh7-go
Boulder-Requester: 3684257
Link: https://acme-staging.api.letsencrypt.org/acme/new-cert;rel="next"
Location: https://acme-staging.api.letsencrypt.org/acme/authz/Yqb95EtOXTJUpImWhKM7yBGttWBi4Wi5rDEwPWgxLeY
Replay-Nonce: 9CxcNdzkohHzh8G-NacgSxXki9fAYOYIgvii9qnGojM
X-Frame-Options: DENY
Strict-Transport-Security: max-age=604800
Expires: Thu, 24 Aug 2017 23:23:55 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:55 GMT
Connection: keep-alive
b'{\n "identifier": {\n "type": "dns",\n "value": "thecanadianbacon.in"\n },\n "status": "pending",\n "expires": "2017-08-31T23:23:55.193070607Z",\n "challenges": [\n {\n "type": "dns-01",\n "status": "pending",\n "uri": "https://acme-staging.api.letsencrypt.$
2017-08-24 23:23:55,269:DEBUG:acme.client:Storing nonce: 9CxcNdzkohHzh8G-NacgSxXki9fAYOYIgvii9qnGojM
2017-08-24 23:23:55,270:INFO:certbot.auth_handler:Performing the following challenges:
2017-08-24 23:23:55,270:INFO:certbot.auth_handler:http-01 challenge for thecanadianbacon.in
2017-08-24 23:23:55,270:DEBUG:certbot.plugins.webroot:Creating root challenges validation dir at /srv/http/thecanadianbacon/.well-known/acme-challenge
2017-08-24 23:23:55,274:DEBUG:certbot.plugins.webroot:Attempting to save validation to /srv/http/thecanadianbacon/.well-known/acme-challenge/NA2bxkgCOYNvwLhFIBdTfz4Omb7rDiJGMl-QSJsco6o
2017-08-24 23:23:55,274:INFO:certbot.auth_handler:Waiting for verification...
2017-08-24 23:23:55,275:DEBUG:acme.client:JWS payload:
b'{\n "resource": "challenge",\n "keyAuthorization": "NA2bxkgCOYNvwLhFIBdTfz4Omb7rDiJGMl-QSJsco6o.D2YYsVEzaVa8RMWw0R03mQK-KeAAuXIkLtmdjrTPfU",\n "type": "http-01"\n}'
2017-08-24 23:23:55,278:DEBUG:acme.client:Sending POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/Yqb95EtOXTJUpImWhKM7yBGttWBi4Wi5rDEwPWgxLeY/55130404:
{
"protected": "eyJhbGciOiAiUlMyNTYiLCAiandrIjogeyJuIjogIms3Z3BGSkY5dWRDYmRjcm5DUmZCd2Itam93eTNaUE1uYzFFd2phUTVLODJWSHRLaW9vT2llN1VqS1VvRnk3NDZvV1hWaW44UWhwX3FXVFZ6eGxFaXFBRTdEYWFJYUQyQVItT3k3NjRrUHJmajNncGdjam40T1dGSDNaeEp4OXB3TXdxRno0RzEyb1pyM3dpWDVDNFRZalMzZzVSeGNsd0xjeG5KcTdFNjR6TUwy$
"signature": "C4WMLQOPeYkl8wvI7Lw7zAtgNnu3nmaEDZiatBz-sOnBO4LYaVgPfOKPwmoApzEkHrLrBau2eT5c0tehmymHya5ThcTTkJ4SeBr8EFZl-SQZ_JLcKS1Kzy50qPGW2hC-F8bXfQNdVqG4_76VB6mgUPfRGRjvwPv8dQcBh9AAnl4DLoHDJyQsdVIgvAxM1XDoNohpwlYmmiGW_ONEwfsg8AhWU08fvfagIsV444WFMUKuq1Zx76OMzAiVsE2Fd6MVmqzycvNAEWX6LL3k$
"payload": "ewogICJyZXNvdXJjZSI6ICJjaGFsbGVuZ2UiLAogICJrZXlBdXRob3JpemF0aW9uIjogIk5BMmJ4a2dDT1lOdndMaEZJQmRUZno0T21iN3JEaUpHTWwtUVNKc2NvNm8uX0QyWVlzVkV6YVZhOFJNV3cwUjAzbVFLLUtlQUF1WElrTHRtZGpyVFBmVSIsCiAgInR5cGUiOiAiaHR0cC0wMSIKfQ"
}
2017-08-24 23:23:55,487:DEBUG:urllib3.connectionpool:https://acme-staging.api.letsencrypt.org:443 "POST /acme/challenge/Yqb95EtOXTJUpImWhKM7yBGttWBi4Wi5rDEwPWgxLeY/55130404 HTTP/1.1" 202 338
2017-08-24 23:23:55,487:DEBUG:acme.client:Received response:
HTTP 202
Server: nginx
Content-Type: application/json
Content-Length: 338
Boulder-Request-Id: iBRFa-NRO8rtzbN5hh9tZrHP-rlP6hr7DyghqPx2Qw
Boulder-Requester: 3684257
Link: https://acme-staging.api.letsencrypt.org/acme/authz/Yqb95EtOXTJUpImWhKM7yBGttWBi4Wi5rDEwPWgxLeY;rel="up"
Location: https://acme-staging.api.letsencrypt.org/acme/challenge/Yqb95EtOXTJUpImWhKM7yBGttWBi4Wi5rDEwPWgxLeY/55130404
Replay-Nonce: Q5QZSgq5eheHfDNxKM8eVNopmORxeNPe2tbSnpn6EYA
Expires: Thu, 24 Aug 2017 23:23:55 GMT
Cache-Control: max-age=0, no-cache, no-store
Pragma: no-cache
Date: Thu, 24 Aug 2017 23:23:55 GMT
Connection: keep-alive
b'{\n "identifier": {\n "type": "dns",\n "value": "thecanadianbacon.in"\n },\n "status": "invalid",\n "expires": "2017-08-31T23:23:55Z",\n "challenges": [\n {\n "type": "dns-01",\n "status": "pending",\n "uri": "https://acme-staging.api.letsencrypt.org/acme/c$
2017-08-24 23:23:58,645:DEBUG:certbot.reporter:Reporting to user: The following errors were reported by the server:
Domain: thecanadianbacon.in
Type: unauthorized
Detail: Invalid response from http://thecanadianbacon.in/.well-known/acme-challenge/NA2bxkgCOYNvwLhFIBdTfz4Omb7rDiJGMl-QSJsco6o: "
<title>404 Not Found</title>
404 Not Found
"
To fix these errors, please make sure that your domain name was entered correctly and the DNS A/AAAA record(s) for that domain contain(s) the right IP address.
2017-08-24 23:23:58,646:INFO:certbot.auth_handler:Cleaning up challenges
2017-08-24 23:23:58,646:DEBUG:certbot.plugins.webroot:Removing /srv/http/thecanadianbacon/.well-known/acme-challenge/NA2bxkgCOYNvwLhFIBdTfz4Omb7rDiJGMl-QSJsco6o
2017-08-24 23:23:58,646:DEBUG:certbot.plugins.webroot:All challenges cleaned up, removing /srv/http/thecanadianbacon/.well-known/acme-challenge
2017-08-24 23:23:58,647:WARNING:certbot.renewal:Attempting to renew cert (thecanadianbacon.in) from /etc/letsencrypt/renewal/thecanadianbacon.in.conf produced an unexpected error: Failed authorization procedure. thecanadianbacon.in (http-01): urn:acme:error:unauthorized :: The client lac$
<title>404 Not Found</title>
404 Not Found
". Skipping. 2017-08-24 23:23:58,648:DEBUG:certbot.renewal:Traceback was: Traceback (most recent call last): File "/usr/lib/python3.6/site-packages/certbot/renewal.py", line 421, in handle_renewal_request main.renew_cert(lineage_config, plugins, renewal_candidate) File "/usr/lib/python3.6/site-packages/certbot/main.py", line 650, in renew_cert _get_and_save_cert(le_client, config, lineage=lineage) File "/usr/lib/python3.6/site-packages/certbot/main.py", line 77, in _get_and_save_cert renewal.renew_cert(config, domains, le_client, lineage) File "/usr/lib/python3.6/site-packages/certbot/renewal.py", line 297, in renew_cert new_certr, new_chain, new_key, _ = le_client.obtain_certificate(domains) File "/usr/lib/python3.6/site-packages/certbot/client.py", line 318, in obtain_certificate self.config.allow_subset_of_names) File "/usr/lib/python3.6/site-packages/certbot/auth_handler.py", line 81, in get_authorizations self._respond(resp, best_effort) File "/usr/lib/python3.6/site-packages/certbot/auth_handler.py", line 138, in _respond self._poll_challenges(chall_update, best_effort) File "/usr/lib/python3.6/site-packages/certbot/auth_handler.py", line 202, in _poll_challenges raise errors.FailedChallenges(all_failed_achalls) certbot.errors.FailedChallenges: Failed authorization procedure. thecanadianbacon.in (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Invalid response from http://thecanadianbacon.in/.well-known/acme-challenge/NA2bxkgCOYNvwLhFIBdTfz4Omb7rDiJGMl-QSJsc$ <title>404 Not Found</title>
404 Not Found
"
2017-08-24 23:23:58,648:DEBUG:certbot.log:Exiting abnormally:
Traceback (most recent call last):
File "/usr/bin/certbot", line 11, in
load_entry_point('certbot==0.17.0', 'console_scripts', 'certbot')()
File "/usr/lib/python3.6/site-packages/certbot/main.py", line 753, in main
return config.func(config, plugins)
File "/usr/lib/python3.6/site-packages/certbot/main.py", line 703, in renew
renewal.handle_renewal_request(config)
File "/usr/lib/python3.6/site-packages/certbot/renewal.py", line 439, in handle_renewal_request
len(renew_failures), len(parse_failures)))
certbot.errors.Error: 1 renew failure(s), 0 parse failure(s)
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
server {
    server_name thecanadianbacon.in;
    listen 80;
    root ###;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/thecanadianbacon.in/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/thecanadianbacon.in/privkey.pem;
    ssl_trusted_certificate /etc/letsencrypt/live/thecanadianbacon.in/chain.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;
    ssl_prefer_server_ciphers on;
    add_header Strict-Transport-Security max-age=15768000;
    ssl_stapling on;
    ssl_stapling_verify on;
    index index.php;
    location ^~ /.well-known {
        allow all;
        alias /var/lib/letsencrypt/.well-known/;
        default_type "text/plain";
        try_files $uri =404;
    }
    location /live {
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        root /tmp;
        add_header Cache-Control no-cache;
    }
    location /forums/install/app.php {
        try_files $uri $uri/ /forums/install/app.php?$query_string;
    }
    location / {
        try_files $uri $uri/ /index.php?$args;
    }
    location ~ \.(php|html|htm)$ {
        fastcgi_pass unix:/run/php-fpm/php-fpm.sock;
        fastcgi_index index.php;
        include fastcgi.conf;
    }
    access_log /var/log/nginx/in-thecanadianbacon-www-access.log;
    error_log /var/log/nginx/in-thecanadianbacon-www-error.log;
}