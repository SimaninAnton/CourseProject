joshespi commented on 13 Apr 2017 â€¢
edited
My operating system is (include version):
Ubuntu 16.04.2
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
I initially installed with the instructions found here a few months ago.
https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-16-04
This morning (4/13/17) I installed with the instructions found here.
https://certbot.eff.org/#ubuntuxenial-apache
I received the same type of issue before and after installing the new certbot
I ran this command and it produced this output:
command:
sudo certbot renew
Output:
Cert is due for renewal, auto-renewing...
Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)
Attempting to renew cert from /etc/letsencrypt/renewal/globalassets.provo.edu.conf produced an unexpected error: The apache plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',). Skipping.
I receive the same command for all 3 of the certs on this server.
Certbot's behavior differed from what I expected because:
I'm still new to certbot/letsencrypt. I'm not sure what the syntax error on line 2 of the letsencrypt log is referring to.
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
2017-04-13 15:40:43,144:DEBUG:certbot.main:Root logging level set at 20
2017-04-13 15:40:43,145:INFO:certbot.main:Saving debug log to /var/log/letsencrypt/letsencrypt.log
2017-04-13 15:40:43,145:DEBUG:certbot.main:certbot version: 0.11.1
2017-04-13 15:40:43,145:DEBUG:certbot.main:Arguments: []
2017-04-13 15:40:43,145:DEBUG:certbot.main:Discovered plugins: PluginsRegistry(PluginEntryPoint#apache,PluginEntryPoint#webroot,PluginEntryPoint$
2017-04-13 15:40:43,154:DEBUG:certbot.storage:Should renew, less than 30 days before certificate expiry 2017-05-02 20:09:00 UTC.
2017-04-13 15:40:43,154:INFO:certbot.renewal:Cert is due for renewal, auto-renewing...
2017-04-13 15:40:43,155:DEBUG:certbot.plugins.selection:Requested authenticator apache and installer apache
2017-04-13 15:40:43,341:DEBUG:certbot.plugins.disco:Other error:(PluginEntryPoint#apache): There has been an error in parsing the file /etc/apac$
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/disco.py", line 114, in prepare
    self._initialized.prepare()
  File "/usr/lib/python2.7/dist-packages/certbot_apache/configurator.py", line 191, in prepare
    self.check_parsing_errors("httpd.aug")
  File "/usr/lib/python2.7/dist-packages/certbot_apache/augeas_configurator.py", line 77, in check_parsing_errors
    raise errors.PluginError(msg)
PluginError: There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error
2017-04-13 15:40:43,342:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,342:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,342:DEBUG:certbot.plugins.selection:Selected authenticator None and installer None
2017-04-13 15:40:43,342:INFO:certbot.main:Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your$
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)
2017-04-13 15:40:43,343:WARNING:certbot.renewal:Attempting to renew cert from /etc/letsencrypt/renewal/globalassets.provo.edu.conf produced an u$
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',).$
2017-04-13 15:40:43,343:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/renewal.py", line 413, in handle_renewal_request
    main.obtain_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 650, in obtain_cert
    installer, auth = plug_sel.choose_configurator_plugins(config, plugins, "certonly") 
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 197, in choose_configurator_plugins
    diagnose_configurator_problem("authenticator", req_auth, plugins)
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 272, in diagnose_configurator_problem
    raise errors.PluginSelectionError(msg)
PluginSelectionError: The apache plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)

2017-04-13 15:40:43,346:DEBUG:certbot.storage:Should renew, less than 30 days before certificate expiry 2017-05-02 19:40:00 UTC.
2017-04-13 15:40:43,346:INFO:certbot.renewal:Cert is due for renewal, auto-renewing...
2017-04-13 15:40:43,346:DEBUG:certbot.plugins.selection:Requested authenticator apache and installer apache
2017-04-13 15:40:43,532:DEBUG:certbot.plugins.disco:Other error:(PluginEntryPoint#apache): There has been an error in parsing the file /etc/apac$
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/disco.py", line 114, in prepare
    self._initialized.prepare()
  File "/usr/lib/python2.7/dist-packages/certbot_apache/configurator.py", line 191, in prepare
    self.check_parsing_errors("httpd.aug")
  File "/usr/lib/python2.7/dist-packages/certbot_apache/augeas_configurator.py", line 77, in check_parsing_errors
    raise errors.PluginError(msg)
PluginError: There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error
2017-04-13 15:40:43,532:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,532:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,532:DEBUG:certbot.plugins.selection:Selected authenticator None and installer None
2017-04-13 15:40:43,533:INFO:certbot.main:Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your$
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)
2017-04-13 15:40:43,533:WARNING:certbot.renewal:Attempting to renew cert from /etc/letsencrypt/renewal/beta.provo.edu.conf produced an unexpecte$
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',).$

2017-04-13 15:40:43,533:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/renewal.py", line 413, in handle_renewal_request
    main.obtain_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 650, in obtain_cert
    installer, auth = plug_sel.choose_configurator_plugins(config, plugins, "certonly")
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 197, in choose_configurator_plugins
    diagnose_configurator_problem("authenticator", req_auth, plugins)
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 272, in diagnose_configurator_problem
    raise errors.PluginSelectionError(msg)
PluginSelectionError: The apache plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)  

2017-04-13 15:40:43,535:DEBUG:certbot.storage:Should renew, less than 30 days before certificate expiry 2017-05-09 13:33:00 UTC.
2017-04-13 15:40:43,535:INFO:certbot.renewal:Cert is due for renewal, auto-renewing...
2017-04-13 15:40:43,536:DEBUG:certbot.plugins.selection:Requested authenticator apache and installer apache
2017-04-13 15:40:43,722:DEBUG:certbot.plugins.disco:Other error:(PluginEntryPoint#apache): There has been an error in parsing the file /etc/apac$
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/disco.py", line 114, in prepare
   self._initialized.prepare()
  File "/usr/lib/python2.7/dist-packages/certbot_apache/configurator.py", line 191, in prepare
    self.check_parsing_errors("httpd.aug")
  File "/usr/lib/python2.7/dist-packages/certbot_apache/augeas_configurator.py", line 77, in check_parsing_errors
    raise errors.PluginError(msg)
PluginError: There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error
2017-04-13 15:40:43,722:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,722:DEBUG:certbot.plugins.selection:No candidate plugin
2017-04-13 15:40:43,722:DEBUG:certbot.plugins.selection:Selected authenticator None and installer None
2017-04-13 15:40:43,722:INFO:certbot.main:Could not choose appropriate plugin: The apache plugin is not working; there may be problems with your$
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)
2017-04-13 15:40:43,723:WARNING:certbot.renewal:Attempting to renew cert from /etc/letsencrypt/renewal/beta.employee.provo.edu.conf produced an $
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',).$
2017-04-13 15:40:43,723:DEBUG:certbot.renewal:Traceback was:
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/certbot/renewal.py", line 413, in handle_renewal_request
    main.obtain_cert(lineage_config, plugins, renewal_candidate)
  File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 650, in obtain_cert
    installer, auth = plug_sel.choose_configurator_plugins(config, plugins, "certonly")
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 197, in choose_configurator_plugins
    diagnose_configurator_problem("authenticator", req_auth, plugins)
  File "/usr/lib/python2.7/dist-packages/certbot/plugins/selection.py", line 272, in diagnose_configurator_problem
    raise errors.PluginSelectionError(msg)
PluginSelectionError: The apache plugin is not working; there may be problems with your existing configuration.
The error was: PluginError('There has been an error in parsing the file /etc/apache2/sites-available/letsencrypt.log on line 2: Syntax error',)

2017-04-13 15:40:43,723:DEBUG:certbot.main:Exiting abnormally:
Traceback (most recent call last):
  File "/usr/bin/certbot", line 11, in <module>
    load_entry_point('certbot==0.11.1', 'console_scripts', 'certbot')()
  File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 882, in main
    return config.func(config, plugins)
  File "/usr/lib/python2.7/dist-packages/certbot/main.py", line 688, in renew
    renewal.handle_renewal_request(config)
  File "/usr/lib/python2.7/dist-packages/certbot/renewal.py", line 430, in handle_renewal_request
    len(renew_failures), len(parse_failures)))
Error: 3 renew failure(s), 0 parse failure(s)
Here is the file that the error is referring to.
Traceback (most recent call last):
  File "/usr/bin/letsencrypt", line 9, in <module>
    load_entry_point('letsencrypt==0.4.1', 'console_scripts', 'letsencrypt')()
  File "/usr/lib/python2.7/dist-packages/letsencrypt/cli.py", line 1946, in main
    args = prepare_and_parse_args(plugins, cli_args)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/cli.py", line 1638, in prepare_and_parse_args
    return helpful.parse_args()
  File "/usr/lib/python2.7/dist-packages/letsencrypt/cli.py", line 1206, in parse_args
    parsed_args = self.parser.parse_args(self.args)
  File "/usr/lib/python2.7/dist-packages/configargparse.py", line 216, in parse_args
    env_vars = env_vars)
  File "/usr/lib/python2.7/dist-packages/configargparse.py", line 349, in parse_known_args
    self, args=args, namespace=namespace)
  File "/usr/lib/python2.7/argparse.py", line 1733, in parse_known_args
    namespace, args = self._parse_known_args(args, namespace)
  File "/usr/lib/python2.7/argparse.py", line 1939, in _parse_known_args
    start_index = consume_optional(start_index)
  File "/usr/lib/python2.7/argparse.py", line 1879, in consume_optional
    take_action(action, args, option_string)
  File "/usr/lib/python2.7/argparse.py", line 1807, in take_action
    action(self, namespace, argument_values, option_string)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/cli.py", line 1837, in __call__
    _process_domain(args, domain_arg)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/cli.py", line 1818, in _process_domain
    domain = le_util.enforce_domain_sanity(domain)
  File "/usr/lib/python2.7/dist-packages/letsencrypt/le_util.py", line 328, in enforce_domain_sanity
    "bare IP address.".format(domain))
ConfigurationError: Requested name 158.91.1.105 is an IP address. The Let's Encrypt certificate authority will not issue certificates for a bare$