rptb1 commented on 3 Dec 2017 â€¢
edited
My operating system is (include version):
Ubuntu Desktop 16.04.3
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
apt-get, exactly as instructed at https://certbot.eff.org/#ubuntuxenial-nginx
I ran this command and it produced this output:
sudo certbot --nginx
...
IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: [recated]
   Type:   connection
   Detail: Timeout

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address. Additionally, please check that
   your computer has a publicly routable IP address and that no
   firewalls are preventing the server from communicating with the
   client. If you're using the webroot plugin, you should also verify
   that you are serving files from the webroot path you provided.
Certbot's behavior differed from what I expected because:
I thought it would configure automatically for a fresh nginx installation with a simple vhost. My vhost was a direct copy of the nginx example from nginx config file.
I fixed the problem by adding listen 443 ssl (just that, no certs) to the config and re-running certbot --nginx. certbot was then able to get in touch with the server and finish the installation.
I suggest that the certbot scripts ought to detect this case and add their own 443 line (and possibly listen [::]:443).
Here is a Certbot log showing the issue (if available):
Logs are stored in /var/log/letsencrypt by default. Feel free to redact domains, e-mail and IP addresses as you see fit.
Redacted log attached.
Here is the relevant nginx server block or Apache virtualhost for the domain I am configuring:
server {
 listen 80;
 listen [::]:80;
 server_name [reacted];
 root /var/www/[redacted];
 index index.html;
 location / {
  try_files $uri $uri/ =404;
 }
}
letsencrypt.log.txt