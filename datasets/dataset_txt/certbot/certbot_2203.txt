kernelfreak commented on 13 Apr 2016
We have a Debian X64 server which is running multiple small sized Spring-MVC based projects on a single Tomcat instance, having multiple WAR files. There is an Apache web-server, which is running mod_proxy and also hosting a Shopware instance.
Currently, we don't have any SSL certificate installed as it would cost too much to get certificates for individual domains. Today I bumped on LetsEncrypt on internet and wanted to ask if it is possible to LetsEncrypt in this situation and how to go about it.
I tried it out and I keep getting the same error always : Error :
No vhost exists with servername or alias of: domain-name.com. No vhost was selected. Please specify servernames in the Apache config
All the domains are publicly accessible and they all point to this server.
I also tried to get just the certificate, which I would have then manually installed, but authorization procedure is failing as it's calling some URL's on the domain name, for which there is no code behind.
Failed authorization procedure. www.tool-tank.de (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Invalid response from http://www.domain.de/.well-known/acme-challenge/8s9i74Zs0ctkjDBp9kBCh13H3MekUbHexPu8SwjbRVM [148.251.53.149]: 404, tool-tank.de (http-01): urn:acme:error:unauthorized :: The client lacks sufficient authorization :: Invalid response from http://domain.de/.well-known/acme-challenge/muOUnctAujv7Fkmg2jcpHCN-VjyoCbsbKWTMIRVv920 [148.251.53.149]: 404
Apache2 config : default-ssl :
 <VirtualHost _default_:443>
            ServerAdmin webmaster@localhost
            ServerName www.domain6.de
            ServerAlias domain6.de
            DocumentRoot /var/www
            <Directory />
                    Options FollowSymLinks
                    AllowOverride None
            </Directory>
            <Directory /var/www/>
                    Options Indexes FollowSymLinks MultiViews
                    AllowOverride None
                    Order allow,deny
                    allow from all
            </Directory>

            ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
            <Directory "/usr/lib/cgi-bin">
                    AllowOverride None
                    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                    Order allow,deny
                    Allow from all
            </Directory>

            ErrorLog ${APACHE_LOG_DIR}/error.log

            CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

            SSLEngine on
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                    SSLOptions +StdEnvVars
            </FilesMatch>
            <Directory /usr/lib/cgi-bin>
                    SSLOptions +StdEnvVars
            </Directory>

            BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
            BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </VirtualHost>

    <VirtualHost _default_:443>
            ServerAdmin webmaster@localhost
            ServerName www.domain3.de
            ServerAlias domain3.de
            DocumentRoot /var/www
            <Directory />
                    Options FollowSymLinks
                    AllowOverride None
            </Directory>
            <Directory /var/www/>
                    Options Indexes FollowSymLinks MultiViews
                    AllowOverride None
                    Order allow,deny
                    allow from all
            </Directory>

            ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
            <Directory "/usr/lib/cgi-bin">
                    AllowOverride None
                    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                    Order allow,deny
                    Allow from all
            </Directory>

            ErrorLog ${APACHE_LOG_DIR}/error.log

            CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

            SSLEngine on
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                    SSLOptions +StdEnvVars
            </FilesMatch>
            <Directory /usr/lib/cgi-bin>
                    SSLOptions +StdEnvVars
            </Directory>

            BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
            BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </VirtualHost>




    <VirtualHost _default_:443>
            ServerAdmin webmaster@localhost
            ServerName www.domain5.de
            ServerAlias domain5.de
            DocumentRoot /var/www
            <Directory />
                    Options FollowSymLinks
                    AllowOverride None
            </Directory>
            <Directory /var/www/>
                    Options Indexes FollowSymLinks MultiViews
                    AllowOverride None
                    Order allow,deny
                    allow from all
            </Directory>

            ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
            <Directory "/usr/lib/cgi-bin">
                    AllowOverride None
                    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                    Order allow,deny
                    Allow from all
            </Directory>

            ErrorLog ${APACHE_LOG_DIR}/error.log

            CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

            SSLEngine on
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                    SSLOptions +StdEnvVars
            </FilesMatch>
            <Directory /usr/lib/cgi-bin>
                    SSLOptions +StdEnvVars
            </Directory>

            BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
            BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </VirtualHost>


    <VirtualHost _default_:443>
            ServerAdmin webmaster@localhost
            ServerName www.domain4.de
            ServerAlias domain4.de
            DocumentRoot /var/www
            <Directory />
                    Options FollowSymLinks
                    AllowOverride None
            </Directory>
            <Directory /var/www/>
                    Options Indexes FollowSymLinks MultiViews
                    AllowOverride None
                    Order allow,deny
                    allow from all
            </Directory>

            ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
            <Directory "/usr/lib/cgi-bin">
                    AllowOverride None
                    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                    Order allow,deny
                    Allow from all
            </Directory>

            ErrorLog ${APACHE_LOG_DIR}/error.log

            CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

            SSLEngine on
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                    SSLOptions +StdEnvVars
            </FilesMatch>
            <Directory /usr/lib/cgi-bin>
                    SSLOptions +StdEnvVars
            </Directory>

            BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
            BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </VirtualHost>


    <VirtualHost _default_:443>
            ServerAdmin webmaster@localhost
            ServerName www.domain2.de.com
            ServerAlias domain2.de.com
            DocumentRoot /var/www
            <Directory />
                    Options FollowSymLinks
                    AllowOverride None
            </Directory>
            <Directory /var/www/>
                    Options Indexes FollowSymLinks MultiViews
                    AllowOverride None
                    Order allow,deny
                    allow from all
            </Directory>

            ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
            <Directory "/usr/lib/cgi-bin">
                    AllowOverride None
                    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                    Order allow,deny
                    Allow from all
            </Directory>

            ErrorLog ${APACHE_LOG_DIR}/error.log

            CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined

            SSLEngine on
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                    SSLOptions +StdEnvVars
            </FilesMatch>
            <Directory /usr/lib/cgi-bin>
                    SSLOptions +StdEnvVars
            </Directory>

            BrowserMatch "MSIE [2-6]" \
                    nokeepalive ssl-unclean-shutdown \
                    downgrade-1.0 force-response-1.0
            BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </VirtualHost>
Apache tomcat server.xml :
<Host name="localhost"  appBase="webapps" unpackWARs="true" autoDeploy="true">
        <Host name="domain4.de" autoDeploy="true" unpackWARs="true" appBase="domain4_webapps">
                <Alias>www.domain4.de</Alias>
                <Context path=""/>
        </Host>

        <Host name="domain5.de" autoDeploy="true" unpackWARs="true" appBase="domain5_webapps">
                <Alias>www.domain5.de</Alias>
                <Context path=""/>
        </Host>

        <Host name="domain3.de" autoDeploy="true" unpackWARs="true" appBase="domain3_webapps">
                <Alias>www.domain3.de</Alias>
                <Context path=""/>
        </Host>

        <Host name="www.domain1" autoDeploy="true" unpackWARs="true" appBase="domain1_webapps">
                <Alias>domain1</Alias>
                <Context path=""/>
        </Host>
So, how exactly should I perform the setup. What am I doing wrong. Any help would be nice. Thank you. :-)