treii28 commented on 6 Mar 2018 â€¢
edited
Not so much a bug but just a learning curve issue. I inherited a server set up on apache2 and recently had to migrate it to a varnish cache with the actual https content being served by nginx. The copy of magento was also upgraded a couple of times and I believe, in the process, some of the files and settings got lost. (/srv/root/.well-known/acme-challenge and the htaccess location settings for it for example)
My operating system is (include version):
Ubuntu 16.04
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
I believe this was installed with certbot-auto (on the original apache https configuration)
I ran this command and it produced this output:
I'm trying to migrate it over to using nginx. Running:
certbot renew --pre-hook "service nginx stop" --post-hook "service nginx start"
after updating the /etc/letsencrypt/renewal/ourserver.conf to use nginx as authenticator results in a timeout error failing to renew the certificate
Certbot's behavior differed from what I expected because:
I'm new to this so I don't know what to expect. If those files were lost, then it's behaving as I would expect. I just need to know how to fix it. Apparently my predecessor already set up the apache server so there are already certificates, but most of the instructions I'm finding seem to start from not having one. So I'm unclear what needs to be done to just change the renewal (and any other settings) to using nginx and not apache and what files may need to be created or what entries need to be added to the nginx config to allow access to them
Basically I need to know either what command to run to create and/or what files/settings to add into the nginx server root and config files to allow the renew process to work in it rather than in apache. As mentioned the original server root contents were replaced and I'm trying to look for my back-up copies but as this is a new install, and I've had to change the versions/configurations a number of times, I'm having to scour through multiple copies to see if I can find the original version somewhere with the original files.