sasatefa2009 commented on 20 May 2019 â€¢
edited
My operating system is (include version):
Ubuntu 18.04
The issue is that I found that certbot does not redirect my VPS-IP-Address whether in http or https.
This is the new lines added by Certbot for redirection
server {
    if ($host = www.example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    if ($host = example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot



  listen 80;
  listen [::]:80;
  server_name example.com www.example.com xxx.xxx.xxx.xxx;
    return 404; # managed by Certbot

     }
example.com is my domain name and xxx.xxx.xxx.xxx is my VPS-IP-Address.

Certbot uses the above config to do this
Redirect http (www and non-www) domain name to https
Block access to VPS-IP-Address only in http with return 404
The problem here is that my website is still accessible through https://VPS-IP-Address
This is how I fixed it
Deleted My VPS-IP-Address and added a new redirection and this is the final config
server {
    if ($host = www.example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    if ($host = example.com) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

  listen 80;
  listen [::]:80;
  server_name example.com www.example.com;
    return 404; # managed by Certbot

             }

server {
  listen 80;
  listen [::]:80;
  listen 443 ssl;
  listen [::]:443 ssl;
  server_name xxx.xxx.xxx.xxx;
  return 301 https://example.com$request_uri;
}
example.com is my domain name and xxx.xxx.xxx.xxx is my VPS-IP-Address.
now anyone visits http://VPS-IP-Address/ or https://VPS-IP-Address/ will be redirected to my domain with https.