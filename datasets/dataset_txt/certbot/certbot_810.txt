torbennehmer commented on 13 Jan 2018
My operating system is (include version):
Latest Debian Stable
I installed Certbot with (certbot-auto, OS package manager, pip, etc):
OS Debian Package:
root@nathan:~# certbot --version
certbot 0.10.2

root@nathan:~# dpkg -l *certbot*
...
||/ Name                        Version            Architektur        Beschreibung
+++-===========================-==================-==================-===========================================================
ii  certbot                     0.10.2-1~bpo8+1    all                automatically configure HTTPS using Let's Encrypt
ii  python-certbot              0.10.2-1~bpo8+1    all                main library for certbot
ii  python-certbot-apache       0.10.2-1~bpo8+1    all                Apache plugin for Certbot
I ran this command and it produced this output:
root@nathan:/etc/letsencrypt# certbot renew --force-renewal --cert-name nathan.nehmer.net
Saving debug log to /var/log/letsencrypt/letsencrypt.log

-------------------------------------------------------------------------------
Processing /etc/letsencrypt/renewal/nathan.nehmer.net.conf
-------------------------------------------------------------------------------
Starting new HTTPS connection (1): acme-v01.api.letsencrypt.org
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for nathan.nehmer.net
http-01 challenge for isp.nehmer.net
Waiting for verification...
Cleaning up challenges
Unable to clean up challenge directory /etc/apache2/acme-challenge-ispconfig/.well-known/acme-challenge
Generating key (4096 bits): /etc/letsencrypt/keys/0389_key-certbot.pem
Creating CSR: /etc/letsencrypt/csr/0389_csr-certbot.pem
Running renew-hook command: /usr/local/sbin/renew-nathan-ssl.sh
The deployed hook script completes successfully but remains as Zombie. Certbot does not collect it.
Process tree:
 3514 ?        Ss     0:10 /usr/sbin/sshd
11200 ?        Ss     0:00  \_ sshd: root@pts/0 
11202 pts/0    Ss     0:01  |   \_ -bash
26264 pts/0    S+     0:05  |       \_ /usr/bin/python /usr/bin/certbot renew --force-renewal --cert-name nathan.nehmer.net
26981 pts/0    Z+     0:00  |           \_ [renew-nathan-ss] <defunct>
Script executed:
#!/bin/sh

/usr/sbin/service dovecot restart
/usr/sbin/service apache2 restart
/usr/sbin/service postfix restart

exit 0
The log does not help, it ends with:
2018-01-13 12:39:08,666:INFO:certbot.hooks:Running renew-hook command: /usr/local/sbin/renew-nathan-ssl.sh
This is the config file of the domain in question.
# renew_before_expiry = 30 days
version = 0.10.2
archive_dir = /etc/letsencrypt/archive/nathan.nehmer.net
cert = /etc/letsencrypt/live/nathan.nehmer.net/cert.pem
privkey = /etc/letsencrypt/live/nathan.nehmer.net/privkey.pem
chain = /etc/letsencrypt/live/nathan.nehmer.net/chain.pem
fullchain = /etc/letsencrypt/live/nathan.nehmer.net/fullchain.pem

# Options used in the renewal process
[renewalparams]
account = ...
renew_hook = /usr/local/sbin/renew-nathan-ssl.sh
authenticator = webroot
rsa_key_size = 4096
installer = None
[[webroot_map]]
isp.nehmer.net = /etc/apache2/acme-challenge-ispconfig
nathan.nehmer.net = /etc/apache2/acme-challenge-ispconfig
Any ideas regarding this scenario would be gratly appreciated.
Best regards
Torben Nehmer