cfairweather commented on 14 Apr 2016
Running a command of ./letsencrypt-auto --config /opt/letsencrypt.ini certonly --keep-until-expiring --agree-tos -d my.domain.com with configuration file contents that includes the option text = True results in prompted input if certificates are not yet due for removal, breaking automated scripts.
STR:
Request certificates using let's encrypt (using the options provided below).
Request certificates again using --keep-until-expiring flag set and a configuration file that specifies text = True, the same that should have been used for the first request:
An example command would be ./letsencrypt-auto --config /opt/letsencrypt.ini certonly --keep-until-expiring --agree-tos -d my.domain.com
with a configuration file of:
# Let's Encrypt Configuration with defaults
# All flags used by the client can be configured here. Run Let's Encrypt with
# "--help" to learn more about the available options.

# Use a 4096 bit RSA key instead of 2048
rsa-key-size = 4096

# Uncomment and update to register with the specified e-mail address
email = EMAIL_HERE@EMAIL_HERE

# Uncomment and update to generate certificates for the specified
# domains.
# domains = example.com, www.example.com
# Always provide domains via env. See letsencrypt-run.sh

# Uncomment to use a text interface instead of ncurses
text = True

# Uncomment to use the standalone authenticator on port 443
# authenticator = standalone
# standalone-supported-challenges = tls-sni-01

# Uncomment to use the webroot authenticator. Replace webroot-path with the
# path to the public_html / webroot folder being served by your web server.
authenticator = webroot
webroot-path = /var/www/challenges
Expected:
Let's Encrypt client prints:
------------------------------------------------------------------------------- 
Certificate not yet due for renewal; no action taken.                           
------------------------------------------------------------------------------- 
and does not prompt for input afterward, allowing the client to exit with a code of 0.
Actual:
Let's Encrypt client prints:
------------------------------------------------------------------------------- 
Certificate not yet due for renewal; no action taken.                           
------------------------------------------------------------------------------- 
Press Enter to Continue
and requires interaction from a tty before exiting cleanly.
Environment
OS = Ubuntu 14.04.2
Webserver = nginx, but using certonly since acme-challenges are successfully handled through an existing nginx server. The letsencrypt.ini file specifies the correct challenge directory for the client by providing the options
authenticator = webroot
webroot-path = /var/www/challenges
Notes
Let's Encrypt was installed by running and then calling:
git clone https://github.com/letsencrypt/letsencrypt
./letsencrypt-auto --config /opt/letsencrypt.ini certonly --keep-until-expiring --agree-tos -d my.domain.com