joystein commented on 15 Nov 2016
Versoin of certbot (installed as root with pip install --user certbot-nginx):
# pip list --user | grep certbot
certbot (0.9.3)
certbot-nginx (0.9.3)
Os: debian wheezy (7.11)
Command (run through fabric from workstation to remote server):
~/.local/bin/certbot certonly --nginx --email username@domain.no -d sub.domain.no # (real domain redacted)
Actual output:
Cannot find a VirtualHost matching domain player.fabelapp.no.
Expected: that certbot would have found the server block in the nginx config files.
I should note that i have a possibly unusual structure for nginx config files:
|-> nginx 
|        |-> sites-{available,enabled}
|        |        |-> domain1.no
|        |        |       |-> www.conf
|        |        |       |-> api.conf
|        |        |-> domain2.no
|        |        |       |-> www.conf
|        |        |       |-> api.conf
|        |        |-> domain3.no
|        |        |       |-> www.conf
|        |        |       |-> api.conf
This is matched with the following include statements in the main nginx config:
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*.conf;
    include /etc/nginx/sites-enabled/*/*.conf;
I have however tried moving the config files i have been testing to directly under sites-{available,enabled} and i still get the same error.
In the end, i downgraded to pip install ---user 'certbot-nginx < 0.9.0' and finally the command ran, and i could go on with the installation step.