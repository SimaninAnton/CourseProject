kiyoon commented on 20 Jan 2017 â€¢
edited
from keras.layers import Merge
from keras.layers import Dense
from keras.models import Sequential

def pop_layer(model):
    if not model.outputs:
        raise Exception('Sequential model cannot be popped: model is empty.')

    model.layers.pop()
    if not model.layers:
        model.outputs = []
        model.inbound_nodes = []
        model.outbound_nodes = []
    else:
        model.layers[-1].outbound_nodes = []
        model.outputs = [model.layers[-1].output]
    model.built = False

if __name__ == "__main__":
    model = Sequential()
    model.add(Dense(32,input_dim=100))
    model.add(Dense(100))
    pop_layer(model)
    print model.layers[-1].output_shape

    model2 = Sequential()
    model2.add(Dense(32,input_dim=100))
    print model2.layers[-1].output_shape

    merged = Merge([model, model2], mode='concat')
    modelp = Sequential()
    modelp.add(merged)
    print modelp.layers[-1].output_shape

    from keras.utils.visualize_util import plot
    plot(modelp, show_shapes=True, to_file='modelp.png')
So basically model and model2 should be the same because I popped from model.
However, if you see the output plot (modelp.png), model and model2 has different output and the former seems not has been popped.
And if you check out the printed text to standard output, you'll see model and model2 has 32D output and modelp has 132D output, which doesn't make sense.
I only see this problem when I POP and MERGE the layer.
Thank you.