liyi193328 commented on 14 Mar 2017
Hi,
the code below is:
#encoding=utf-8

import tensorflow as tf
import os
os.environ["KERAS_BACKEND"] = "tensorflow"
from keras import initializations
from keras.models import Model
from keras.layers.recurrent import LSTM, Recurrent, SimpleRNN, time_distributed_dense, GRU
from keras import backend as K

w_c = K.random_normal_variable((2,7), mean=0, scale=1)
x = K.random_normal_variable((1, 2, 2), mean=0, scale=1)
# q = time_distributed_dense(x, w_c, output_dim=7, input_dim=2)
q = time_distributed_dense(x, w_c)

sess = tf.Session()
gini = tf.global_variables_initializer()
sess.run(gini)

qv = sess.run(q)
print(qv.shape)
Error is:
  File "E:/project/learn_test/test.py", line 18, in <module>
    q = time_distributed_dense(x, w_c)
  File "e:\project\keras\keras\layers\recurrent.py", line 52, in time_distributed_dense
    x.set_shape([None, None, output_dim])
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\ops.py", line 419, in set_shape
    self._shape = self._shape.merge_with(shape)
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 573, in merge_with
    other = as_shape(other)
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 821, in as_shape
    return TensorShape(shape)
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 457, in __init__
    self._dims = [as_dimension(d) for d in dims_iter]
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 457, in <listcomp>
    self._dims = [as_dimension(d) for d in dims_iter]
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 378, in as_dimension
    return Dimension(value)
  File "D:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_shape.py", line 33, in __init__
    self._value = int(value)
TypeError: int() argument must be a string, a bytes-like object or a number, not 'Tensor'
But when I set time_distributed_dense(x, w_c, output_dim=7, input_dim=2), it run ok;
So what's up here? tf.set_shape can't pass tensor or ? Thanks