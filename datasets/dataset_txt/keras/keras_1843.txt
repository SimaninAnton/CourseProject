alxndrkalinin commented on 28 Jul 2017
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Keras 2.0.6, TF 1.2.1, Ubuntu 16.04.2 LTS, CUDA 8.0, cuDNN 6.0
Snippet: https://gist.github.com/alxndrkalinin/6cc4228e9178ec4af7b2696a0d1ad5a1
Seems like model.fit_generator incorrectly calls data generator based on keras.utils.data_utils.Sequence.
In snippet example with custom generator as described in docs, 20 training samples and batch size 4, model.fit_generator is called with steps_per_epoch=5, epochs=3 without multiprocessing. Generator correctly returns 4 samples per batch.
But during training generator is called 25 times instead of steps_per_epoch x epochs = 15. Each unique batch requested 5 times instead of 3. In generator on_epoch_end is called 5 times.
Trying different parameters showed that model.fit_generator always does 2 more epochs compared to it's epochs parameter.