galkn commented on 29 Nov 2016 â€¢
edited
My generator yields a number of samples that can be different every iteration, and so I'm having trouble setting samples_per_epoch in fit_generator. Moreover, the loop in the generator is supposed to run infinitely, but I have a limited set of files that I'd like to extract features from in every epoch. My generator looks something like this:
def extract_all_features(files):
    file_perms = np.random.permutation(files)
    while True: 
        features, labels = extract_from_files(file_perms[:10])
        file_perms = file_perms[10:]
        yield features, labels
An alternative approach I'm currently using is train_on_batch as follows:
def extract_all_features(files):
    while len(files) > 0:
        features, labels = extract_from_files(files[:10])
        files = files[10:]
        yield features, labels

for i in range(nb_epochs):
    file_perms = np.random.permutation(files)
    for train_x, train_y in extract_all_features(file_perms):
        model.train_on_batch(train_x, train_y)
But I'd like to use fit_generator if possible in this case. Any ideas on what I'm getting wrong here?