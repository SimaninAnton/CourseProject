How does shuffle = 'batch' work in the background?