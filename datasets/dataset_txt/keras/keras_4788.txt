yhifny commented on 13 Jul 2016
Hi
I use this code for Keras==1.0.5,theano 0.8.2 h5py-2.6.0
print('build model...')
model = Sequential()
model.add(GRU(output_dim=hidden_units,  activation='relu',input_shape=(max_seq_len, input_dim)))                
model.add(Dense(nb_classes))
model.add(Activation('softmax'))
rmsprop = RMSprop(lr=learning_rate)
model.compile(loss='categorical_crossentropy',
              optimizer=rmsprop,
              metrics=['accuracy'])

print('train model...')
print(model.summary())
#plot(model, to_file='model.png')

checkpoint = ModelCheckpoint(filepath=out_path+'/checkpoint-{epoch:02d}-{val_loss:.2f}.hdf5')

model.fit_generator(
        cacdi_data_generator(train_embedding_dir,train_encounter_filelist,train_ref_file, batch_size, max_seq_len),
        samples_per_epoch=len(open(train_encounter_filelist, "rb").readlines()),
        validation_data=cacdi_data_generator(dev_embedding_dir,dev_encounter_filelist, dev_ref_file , batch_size,max_seq_len),
        nb_val_samples=len(open(dev_encounter_filelist, "rb").readlines()),
        nb_epoch=nb_epochs,callbacks=[checkpoint])

save_model(model,out_path)
and I got this error
File "cacdi_train_deep.py", line 138, in
main()
File "cacdi_train_deep.py", line 132, in main
nb_epoch=nb_epochs,callbacks=[checkpoint])
File "/home/yasser_hifny/python/lib/python2.7/site-packages/keras/models.py", line 661, in fit_generator
max_q_size=max_q_size)
File "/home/yasser_hifny/python/lib/python2.7/site-packages/keras/engine/training.py", line 1454, in fit_generator
callbacks.on_epoch_end(epoch, epoch_logs)
File "/home/yasser_hifny/python/lib/python2.7/site-packages/keras/callbacks.py", line 39, in on_epoch_end
callback.on_epoch_end(epoch, logs)
File "/home/yasser_hifny/python/lib/python2.7/site-packages/keras/callbacks.py", line 295, in on_epoch_end
self.model.save_weights(filepath, overwrite=True)
File "/home/yasser_hifny/python/lib/python2.7/site-packages/keras/engine/topology.py", line 2329, in save_weights
g.attrs['weight_names'] = weight_names
File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper (/nrg8/clu/users/steven_reber/dist/h5py-2.6.0/h5py/_objects.c:2682)
File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper (/nrg8/clu/users/steven_reber/dist/h5py-2.6.0/h5py/_objects.c:2640)
File "/home/yasser_hifny/python/lib/python2.7/site-packages/h5py/_hl/attrs.py", line 93, in setitem
self.create(name, data=value, dtype=base.guess_dtype(value))
File "/home/yasser_hifny/python/lib/python2.7/site-packages/h5py/_hl/attrs.py", line 175, in create
space = h5s.create_simple(shape)
File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper (/nrg8/clu/users/steven_reber/dist/h5py-2.6.0/h5py/_objects.c:2682)
File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper (/nrg8/clu/users/steven_reber/dist/h5py-2.6.0/h5py/_objects.c:2640)
File "h5py/h5s.pyx", line 101, in h5py.h5s.create_simple (/nrg8/clu/users/steven_reber/dist/h5py-2.6.0/h5py/h5s.c:1533)
ValueError: Zero sized dimension for non-unlimited dimension (Zero sized dimension for non-unlimited dimension)
any help is appreciated.
Thanks,
Yasser``