MortenHannemose commented on 24 Jan 2018 â€¢
edited
batch_dot does not work when the input is 4D and needs "broadcasting".
import keras.backend as K
from keras.layers import Input

x_batch = K.ones(shape=(32, 20, 1, 1))
y_batch = K.ones(shape=(32, 30, 20, 3))

xy_batch_dot = K.batch_dot(x_batch, y_batch, axes=[1, 2])
ValueError: Dimension 1 in both shapes must be equal, but are 20 and 30 for 'MatMul_1' (op: 'BatchMatMul') with input shapes: [32,20,1,1], [32,30,20,3].
Running on: Windows, tensorflow, CPU
Firstly I would like confirmation that other people agree that this is a bug, before we try fixing it.
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/keras-team/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).