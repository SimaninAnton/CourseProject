taylorshin commented on 16 Apr 2017 â€¢
edited
I get the following error when I save the model with ModelCheckpoint('out/model.h5', monitor='loss', save_best_only=True, save_weights_only=False), or explicitly call save like models[0].save('out/test_save.h5'). However, saving only the weights works fine. I'm using Windows 10 and our GitHub repo is at https://github.com/calclavia/DeepJ. To reproduce the error, save the whole model like I mentioned above and run python main.py --train.
Traceback (most recent call last):
  File "main.py", line 65, in <module>
    main()
  File "main.py", line 27, in main
    train(models, args.gen)
  File "main.py", line 62, in train
    models[0].fit(train_data, train_labels, validation_split=0, epochs=100, callbacks=cbs, batch_size=BATCH_SIZE)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\engine\training.py", line 1493, in fit
    initial_epoch=initial_epoch)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\engine\training.py", line 1165, in _fit_loop
    callbacks.on_epoch_end(epoch, epoch_logs)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\callbacks.py", line 76, in on_epoch_end
    callback.on_epoch_end(epoch, logs)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\callbacks.py", line 401, in on_epoch_end
    self.model.save(filepath, overwrite=True)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\engine\topology.py", line 2448, in save
    save_model(self, filepath, overwrite, include_optimizer)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\models.py", line 102, in save_model
    'config': model.get_config()
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\engine\topology.py", line 2264, in get_config
    layer_config = layer.get_config()
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\layers\core.py", line 668, in get_config
    function = func_dump(self.function)
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\keras\utils\generic_utils.py", line 173, in func_dump
    code = marshal.dumps(func.__code__).decode('raw_unicode_escape')
UnicodeDecodeError: 'rawunicodeescape' codec can't decode bytes in position 264-265: truncated \uXXXX
Exception ignored in: <bound method BaseSession.__del__ of <tensorflow.python.client.session.Session object at 0x0000020FE8DE9CF8>>
Traceback (most recent call last):
  File "C:\Anaconda3\envs\tensorflow\lib\site-packages\tensorflow\python\client\session.py", line 582, in __del__
AttributeError: 'NoneType' object has no attribute 'TF_DeleteStatus'
Please make sure that the boxes below are checked before you submit your issue. If your issue is an implementation question, please ask your question on StackOverflow or join the Keras Slack channel and ask there instead of filing a GitHub issue.
Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).