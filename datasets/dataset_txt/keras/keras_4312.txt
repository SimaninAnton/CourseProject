nikicc commented on 26 Sep 2016
After upgrading to Keras version 1+ I cannot load models which were dumped with version 0.3. The models were dumped to JSON and the weights were dumped to a separate file. I am loading with this code:
model = model_from_json(open(fname).read())
model.load_weights(fname.replace('.json', '.h5'))
When loading in version 1.1.0 I get the following error:
  File "/home/user/research/scripts/nn_lib.py", line 701, in load_initial_model
    model = model_from_json(open(fname).read())
  File "/home/user/virtualenvs/theano-env/lib/python3.5/site-packages/keras/models.py", line 197, in model_from_json
    return layer_from_config(config, custom_objects=custom_objects)
  File "/home/user/virtualenvs/theano-env/lib/python3.5/site-packages/keras/utils/layer_utils.py", line 25, in layer_from_config
    class_name = config['class_name']
KeyError: 'class_name'
I checked the JSON (also appended below) and it does not contain the above key. Did the structure of JSON changed between versions 0.3 and 1.1.0? How do I load my models in Keras 1.1.0? Loading works fine if I downgrade to 0.3.3.
The JSON file which causes the error:
{"loss": "categorical_crossentropy", "name": "Sequential", "layers": [{"cache_enabled": true, "input_dim": 1193514, "W_regularizer": null, "mask_zero": false, "trainable": true, "input_shape": [1193514], "name": "Embedding", "input_length": null, "init": "uniform", "output_dim": 200, "W_constraint": null, "activity_regularizer": null, "custom_name": "embedding"}, {"cache_enabled": true, "trainable": true, "name": "Dropout", "custom_name": "dropout", "p": 0.2}, {"cache_enabled": true, "input_dim": 200, "inner_activation": "hard_sigmoid", "forget_bias_init": "one", "output_dim": 2000, "activation": "tanh", "trainable": true, "go_backwards": false, "name": "LSTM", "input_length": null, "init": "glorot_uniform", "stateful": false, "inner_init": "orthogonal", "return_sequences": false, "custom_name": "lstm"}, {"cache_enabled": true, "trainable": true, "name": "Dropout", "custom_name": "dropout", "p": 0.5}, {"cache_enabled": true, "input_dim": null, "W_regularizer": null, "activation": "linear", "trainable": true, "name": "Dense", "b_constraint": null, "init": "glorot_uniform", "b_regularizer": null, "output_dim": 8, "W_constraint": null, "activity_regularizer": null, "custom_name": "dense"}, {"cache_enabled": true, "trainable": true, "name": "Activation", "custom_name": "activation", "activation": "softmax"}], "class_mode": "categorical", "optimizer": {"lr": 0.0010000000474974513, "name": "RMSprop", "epsilon": 1e-06, "rho": 0.8999999761581421}}