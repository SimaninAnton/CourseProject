Custom loss function problem: train on mini-batches