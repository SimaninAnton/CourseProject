yati-sagade commented on 15 Jan 2017
Here's the script to run to see the exception. One can run it like python imggen_reproduce.py /tmp/somedir_that_you_donot_care_about. After a quick glance at the source, it seems like class_mode is not used in the DirectoryIterator constructor to prevent self.nb_sample from being set to 0, which ultimately becomes self.n in the base Iterator.
Some reporters of a previous bug (#4699) have reported that this "works" when you create an additional directory under the directory passed to flow_from_directory(). However, I don't think this is ideal, for semantically, there is no class/label when dealing with test images.
My proposal to fix this is to set self.nb_sample = number of valid image files in the input directory when self.class_mode is None and not self.classes, in DirectoryIterator::__init__. The second clause in the condition will help prevent breakage of code that has hacked its way around this issue by creating an additional directory (or we don't have to be afraid of breaking, it's up to you). Please let me know if you are okay with this, and if you have any ideas (including calling this issue a non-issue :)), and I can accordingly prepare a quick PR (or not).
2