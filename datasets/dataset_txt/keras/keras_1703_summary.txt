Issues with temporal weighting and custom loss functions