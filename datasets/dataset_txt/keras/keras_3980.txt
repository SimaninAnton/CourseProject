rykov8 commented on 6 Nov 2016 â€¢
edited
I have a Reshape layer in my net , that looks like
x = Reshape((-1, 21), name='mbox_conf_reshape')(x)
When I try to create a model with Tensorflow backend (I didn't check Theano), I get the following error:
TypeError: Expected binary or unicode string, got (-1, None, 7308, 21)
I believe, this comes from the line 321 in core.py:
target_shape = self.get_output_shape_for(input_shape)
because:
def get_output_shape_for(self, input_shape):
    return (input_shape[0],) + self._fix_unknown_dimension(input_shape[1:], self.target_shape)
so, now
target_shape = (None, 7308, 21)
and then we reshape like this:
K.reshape(x, (-1,) + target_shape)
that means, that we pass the shape
(-1, None, 7308, 21)
to K.reshape method.
My suggestion is to change line 321 in core.py to the following:
target_shape = self._fix_unknown_dimension(input_shape[1:], target_shape)
When I do this in Keras locally, the Error is gone. Am I right? Or does the problem have a different source?
Gist is available here