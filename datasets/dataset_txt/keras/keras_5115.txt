MisterTea commented on 24 May 2016 â€¢
edited
I'm trying to create a joint embedding by minimizing the distance between two embeddings for occurrences and maximizing the distance between other random pairs. Here's my code and the error I'm getting:
import numpy as np

import keras
from keras.models import Model, Sequential
from keras.layers import Input, Dense, Merge, Activation
from keras import backend as K

model1 = input1 = Input(shape=(9379,))
model1HiddenLayer = Dense(1024, activation='relu')
model1 = model1HiddenLayer(model1)

model2 = input2 = Input(shape=(6456,))
model2HiddenLayer = Dense(1024, activation='relu')
model2 = model2HiddenLayer(model2)

def euclideanSqDistance(inputs):
    if (len(inputs) != 2):
        raise 'oops'
    output = K.mean(K.square(inputs[0] - inputs[1]), axis=-1)
    output = K.expand_dims(output, 1)
    return output

distanceModel = Merge(mode=euclideanSqDistance, output_shape=[[1,]], name='distanceMerge')([model1, model2])
distanceModel = Activation('sigmoid')(distanceModel)

model = Model(input=[input1,input2], output=distanceModel)
model.compile(optimizer='sgd', loss='mean_squared_error')

model.fit(x=[model1Examples,model2Examples], y=labels)
Error:
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-45-5bd8437c4c7e> in <module>()
     25 
     26 model = Model(input=[input1,input2], output=distanceModel)
---> 27 model.compile(optimizer='sgd', loss='mean_squared_error')
     28 
     29 model.fit(x=[model1Examples,model2Examples], y=labels)

/usr/local/lib/python3.5/site-packages/keras/engine/training.py in compile(self, optimizer, loss, metrics, loss_weights, sample_weight_mode, **kwargs)
    571             shape = self.internal_output_shapes[i]
    572             name = self.output_names[i]
--> 573             self.targets.append(K.placeholder(ndim=len(shape), name=name + '_target'))
    574 
    575         # prepare metrics

TypeError: object of type 'int' has no len()
What am I doing wrong?
Please make sure that the boxes below are checked before you submit your issue. Thank you!
[ X] Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
[ X] If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
[ X] Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).