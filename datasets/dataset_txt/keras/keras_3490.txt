alronlam commented on 12 Jan 2017 â€¢
edited
I'm trying to save and load a model, according to https://keras.io/getting-started/faq/#how-can-i-save-a-keras-model
However, when loading the model, this error pops up: NameError: name 'MaxPooling1D' is not defined. It seems that loading the model fails to import the necessary modules.
Here's my code snippet:
model.save("keras_model.h5")
del model
model = load_model('keras_model.h5')
The import error points to my custom-pooling function, which finds the element-wise max, min, and avg for all input tensors, then concatenates them.
def max_min_avg_pooling_context(x):
    max_arr = MaxPooling1D(MAX_SEQUENCE_LENGTH-2)(x)
    min_arr = -K.pool2d(-x, pool_size=(MAX_SEQUENCE_LENGTH-2,1), strides=(MAX_SEQUENCE_LENGTH-2,1), border_mode="valid", dim_ordering="th", pool_mode='max')
    avg_arr = AveragePooling1D(MAX_SEQUENCE_LENGTH-2)(x)

    return K.concatenate([max_arr, min_arr, avg_arr], axis=1)
Notes:
I'm using Keras 1.1.1. I don't want to update to the latest version because it might cause problems with Theano, which I really had a hard time installing on Windows.
I have compiled the model before saving it.
Also tried saving the model architecture and weights separately (according to this tutorial: http://machinelearningmastery.com/save-load-keras-deep-learning-models/). Same error.