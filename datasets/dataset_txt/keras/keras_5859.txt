slyrz commented on 29 Feb 2016
Please make sure that the boxes below are checked before you submit your issue. Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Issue
The current implementation of the dropout in the recurrent layers fails
to compile with variable-length sequences.
Example
from keras.models import Sequential
from keras.layers.core import Dense, Activation
from keras.layers.recurrent import LSTM

def test_compile(**kwargs):
    print(kwargs)
    model = Sequential()
    model.add(LSTM(100, dropout_W=0.5, return_sequences=False, **kwargs))
    model.add(Dense(10))
    model.add(Activation('softmax'))
    model.compile(loss='categorical_crossentropy', optimizer='rmsprop')

# Works fine.
test_compile(input_dim=100, input_length=100)
# Fails.
test_compile(input_dim=100)
This fails with
  File "test.py", line 16, in <module>
    test_compile(input_dim=100, input_length=None)
  File "test.py", line 11, in test_compile
    model.compile(loss='categorical_crossentropy', optimizer='rmsprop')
  File "Keras-0.3.2-py3.4.egg/keras/models.py", line 499, in compile
  File "Keras-0.3.2-py3.4.egg/keras/layers/containers.py", line 130, in get_output
  File "Keras-0.3.2-py3.4.egg/keras/layers/core.py", line 750, in get_output
  File "Keras-0.3.2-py3.4.egg/keras/layers/core.py", line 243, in get_input
  File "Keras-0.3.2-py3.4.egg/keras/layers/core.py", line 1042, in get_output
  File "Keras-0.3.2-py3.4.egg/keras/layers/core.py", line 243, in get_input
  File "Keras-0.3.2-py3.4.egg/keras/layers/recurrent.py", line 183, in get_output
  File "Keras-0.3.2-py3.4.egg/keras/layers/recurrent.py", line 640, in preprocess_input
  File "Keras-0.3.2-py3.4.egg/keras/layers/recurrent.py", line 29, in time_distributed_dense
  File "Keras-0.3.2-py3.4.egg/keras/backend/theano_backend.py", line 228, in concatenate
  File "theano/tensor/basic.py", line 4224, in concatenate
    "arguments of concatenate.", tensor_list)
TypeError: ("The 'tensors' argument must be either a tuple or a list, make sure you did not forget () or [] around arguments of concatenate.", Elemwise{mul,no_inplace}.0)
So I guess there should be either a fix for this or a small hint in the
documentation that dropout requires a constant sequence length, since the Theano
error is very cryptic.