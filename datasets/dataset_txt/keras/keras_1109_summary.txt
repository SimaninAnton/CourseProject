if isCenterloss: lambda_c = 0.2 # this parama is variable input_target = Input(shape=(1,)) # single value ground truth labels as inputs centers = Embedding(OUT_DIMS, Feats_Dims)(input_target) l2_loss = Lambda(lambda x: K.sum(K.square(x[0] - x[1][:, 0]), 1, keepdims=True), name='l2_loss')([fc, centers]) model_centerloss = Model(inputs=[resnet_base.input, input_target], outputs=[x, l2_loss]) model_centerloss.compile(optimizer=SGD(lr=0.05), loss=["categorical_crossentropy", lambda y_true, y_pred: y_pred], loss_weights=[1, lambda_c], metrics=['accuracy'])