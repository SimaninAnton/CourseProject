Contributor
pminervini commented on 18 Jan 2016
Hello everyone, the Lambda and LambdaMerge layers are really useful!
However, I was trying to modularize my functions a little bit, by storing them in a separate package, adding some arguments and so forth. This is where I started having this small issue.
I'm adding a snippet for reproducing it: the following is main.py
from keras.models import Sequential
from keras.layers.embeddings import Embedding
from keras.layers.core import LambdaMerge

import ns.b as b

encoder_a = Sequential()
encoder_a.add(Embedding(input_dim=2, output_dim=3, input_length=1))

encoder_b = Sequential()
encoder_b.add(Embedding(input_dim=2, output_dim=3, input_length=1))

def func(args):
    return b.combiner(args)

model = Sequential()
model.add(LambdaMerge(layers=[encoder_a, encoder_b], function=func))

model.compile(loss='categorical_crossentropy', optimizer='rmsprop')
The LambdaMerge layer applies func() on the two input layers. func() is defined using a simple function stored in ns/b.py (on a side note: ns/init.py exists and is empty):
def combiner(args):
    return args[0] + args[1]
Summing up:
$ find
./main.py
./ns
./ns/b.py
./ns/__init__.py
This is the error I am getting:
$ PYTHONPATH=. python3 -uB main.py 
Using Theano backend.
Traceback (most recent call last):
  File "main.py", line 19, in <module>
    model.compile(loss='categorical_crossentropy', optimizer='rmsprop')
  File "/usr/local/lib/python3.4/dist-packages/keras/models.py", line 433, in compile
    self.y_train = self.get_output(train=True)
  File "/usr/local/lib/python3.4/dist-packages/keras/layers/containers.py", line 128, in get_output
    return self.layers[-1].get_output(train)
  File "/usr/local/lib/python3.4/dist-packages/keras/layers/core.py", line 1481, in get_output
    return func(inputs)
  File "main.py", line 14, in func
    return b.combiner(args)
NameError: name 'b' is not defined
What's the best way of dealing with such cases? If I simply move the code from ns/b.py to main.py everything works like a charm, but I was trying to avoid bloating my main.py.
Thank you guys in advance for your time and help!