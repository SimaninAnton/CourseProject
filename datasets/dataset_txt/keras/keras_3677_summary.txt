Automatic differentiation with concatenated model