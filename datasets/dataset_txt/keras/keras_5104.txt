Contributor
henry0312 commented on 24 May 2016
Something's wrong with activity_regularizer.
Sample Code
def create_model():
    x = Input(shape=(784,), name='x')

    h = BatchNormalization()(x)
    h = Dense(64, init='uniform', activation='relu', W_regularizer='l2', b_regularizer='l2', activity_regularizer='activity_l2')(h)
    h = BatchNormalization()(h)
    y = Dense(1, init='uniform', activation='linear')(h)

    model = Model(input=x, output=y)
    model.compile(optimizer='adagrad', loss='binary_crossentropy', metrics=['accuracy'])
    return model

model = create_model()
history = model.fit_generator(
    datagen.flow(data, KEYS, batch_size=128, shuffle=True, seed=0),
    samples_per_epoch=num_samples,
    nb_epoch=30,
    validation_data=test_datagen.flow(test_data, KEYS),
    nb_val_samples=num_test_samples,
    verbose=2
)
Error
---------------------------------------------------------------------------
MissingInputError                         Traceback (most recent call last)
<ipython-input-26-2812cb8d21af> in <module>()
     18     validation_data=test_datagen.flow(test_data, KEYS),
     19     nb_val_samples=num_test_samples,
---> 20     verbose=2
     21 )

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/keras/engine/training.py in fit_generator(self, generator, samples_per_epoch, nb_epoch, verbose, callbacks, validation_data, nb_val_samples, class_weight, max_q_size)
   1282 
   1283         do_validation = bool(validation_data)
-> 1284         self._make_train_function()
   1285         if do_validation:
   1286             self._make_test_function()

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/keras/engine/training.py in _make_train_function(self)
    668                                              [self.total_loss] + self.metrics,
    669                                              updates=updates,
--> 670                                              **self._function_kwargs)
    671 
    672     def _make_test_function(self):

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/keras/backend/theano_backend.py in function(inputs, outputs, updates, **kwargs)
    526                 msg = "Invalid argument '%s' passed to K.function" % key
    527                 raise ValueError(msg)
--> 528     return Function(inputs, outputs, updates=updates, **kwargs)
    529 
    530 

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/keras/backend/theano_backend.py in __init__(self, inputs, outputs, updates, **kwargs)
    512                                         allow_input_downcast=True,
    513                                         on_unused_input='warn',
--> 514                                         **kwargs)
    515 
    516     def __call__(self, inputs):

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/compile/function.py in function(inputs, outputs, mode, updates, givens, no_default_updates, accept_inplace, name, rebuild_strict, allow_input_downcast, profile, on_unused_input)
    318                    on_unused_input=on_unused_input,
    319                    profile=profile,
--> 320                    output_keys=output_keys)
    321     # We need to add the flag check_aliased inputs if we have any mutable or
    322     # borrowed used defined inputs

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/compile/pfunc.py in pfunc(params, outputs, mode, updates, givens, no_default_updates, accept_inplace, name, rebuild_strict, allow_input_downcast, profile, on_unused_input, output_keys)
    477                          accept_inplace=accept_inplace, name=name,
    478                          profile=profile, on_unused_input=on_unused_input,
--> 479                          output_keys=output_keys)
    480 
    481 

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/compile/function_module.py in orig_function(inputs, outputs, mode, accept_inplace, name, profile, on_unused_input, output_keys)
   1774                    profile=profile,
   1775                    on_unused_input=on_unused_input,
-> 1776                    output_keys=output_keys).create(
   1777             defaults)
   1778 

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/compile/function_module.py in __init__(self, inputs, outputs, mode, accept_inplace, function_builder, profile, on_unused_input, fgraph, output_keys)
   1426             # OUTPUT VARIABLES)
   1427             fgraph, additional_outputs = std_fgraph(inputs, outputs,
-> 1428                                                     accept_inplace)
   1429             fgraph.profile = profile
   1430         else:

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/compile/function_module.py in std_fgraph(input_specs, output_specs, accept_inplace)
    175 
    176     fgraph = gof.fg.FunctionGraph(orig_inputs, orig_outputs,
--> 177                                   update_mapping=update_mapping)
    178 
    179     for node in fgraph.apply_nodes:

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/gof/fg.py in __init__(self, inputs, outputs, features, clone, update_mapping)
    169 
    170         for output in outputs:
--> 171             self.__import_r__(output, reason="init")
    172         for i, output in enumerate(outputs):
    173             output.clients.append(('output', i))

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/gof/fg.py in __import_r__(self, variable, reason)
    358         # Imports the owners of the variables
    359         if variable.owner and variable.owner not in self.apply_nodes:
--> 360                 self.__import__(variable.owner, reason=reason)
    361         if (variable.owner is None and
    362                 not isinstance(variable, graph.Constant) and

/home/tsukasa_omoto/.pyenv/versions/3.5.1/lib/python3.5/site-packages/theano/gof/fg.py in __import__(self, apply_node, check, reason)
    472                             "for more information on this error."
    473                             % str(node)),
--> 474                             r)
    475 
    476         for node in new_nodes:

MissingInputError: ("An input of the graph, used to compute Shape(x), was not provided and not given a value.Use the Theano flag exception_verbosity='high',for more information on this error.", x)