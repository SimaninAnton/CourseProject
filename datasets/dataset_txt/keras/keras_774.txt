abaxi commented on 12 Sep 2018
I've noticed that the process of saving and loading saved models slows down as I generate more models. To clarify, say I have to load 10 models from hdf5 files. The 1st model I load will be loaded quickly, but every successive load will be progressively slower. The models are of the same size, and memory is not an issue. I've attached a python script to reproduce the issue.
OS: Ubuntu 16.04
Backend: Tensorflow
Using CPU only
Thank you
Reproducing code example:
import time
import numpy as np
import keras


from keras.models import Sequential
from keras.layers import Dense, Activation


def get_model(X):
    metric = "mse"
    loss_fn = "mean_squared_error"
    opt_meth = "rmsprop"
    
    layers = [X.shape[1], 10, X.shape[1]]
    act_fns = ["elu", "elu", "elu"]
    
    model = Sequential()

    for i in range(len(layers)):
        model.add(Dense(units=layers[i]))
        model.add(Activation(act_fns[i]))

    model.compile(optimizer=opt_meth, loss=loss_fn, metrics=[metric])
    model.fit(X, X, verbose=0)
    
    return model

if __name__ == '__main__':
    N = 10
    X = np.random.randn(1000,30)
    for i in range(N):
        fname = str(i)+".hdf5"
        m = get_model(X)   
        t = time.time()
        m.save(fname)
        t = round(time.time() - t, 3)
        del m
        print "iter",i," model saved in time:", t

    print "loading models:"
    for i in range(N):
        fname = str(i)+".hdf5"
        t = time.time()
        m = keras.models.load_model(fname)
        t = round(time.time()-t,3)
        del m
        print "iter:",i, "time taken:", t     
Example output:
Using TensorFlow backend.
2018-09-11 20:36:51.754719: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports
 instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
iter 0  model saved in time: 0.027
iter 1  model saved in time: 0.039
iter 2  model saved in time: 0.054
iter 3  model saved in time: 0.065
iter 4  model saved in time: 0.073
iter 5  model saved in time: 0.088
iter 6  model saved in time: 0.101
iter 7  model saved in time: 0.108
iter 8  model saved in time: 0.125
iter 9  model saved in time: 0.139
loading models:
iter: 0 time taken: 0.522
iter: 1 time taken: 0.559
iter: 2 time taken: 0.592
iter: 3 time taken: 0.691
iter: 4 time taken: 0.674
iter: 5 time taken: 0.711
iter: 6 time taken: 0.751
iter: 7 time taken: 0.788
iter: 8 time taken: 0.824
iter: 9 time taken: 0.874