fvisin commented on 26 Apr 2016
The problem I am facing is that the input size is variable and I don't know how to get a symbolic shape in the middle of the graph.
Is there a way to:
Get the symbolic shape of a layer
Specify a symbolic (i.e. variable at run time) target_shape in Reshape(target_shape)
At the moment I came up with this ugly workaround. Is there something better?
x_shape = [10, None, None, None, 3]   # batch + 4 axes
model = models.Sequential() 
model.add(Convolution2D(64, 3, 3, border_mode='same', input_shape=x_shape[1:]))
# Will this cause the theano graph to be duplicated??
sh = model.get_output().shape
# Is there an easier way with core.Reshape??
model.add(Lambda(lambda x: x.flatten(ndim=2), output_shape=flattened_shape))
model.add(Activation(K.softmax))
reshape = Lambda(lambda x: x.reshape((sh[0], sh[1], T.prod(sh[2:]))))

# this is what I'd like to do instead
# model.add(Reshape((x.shape[0], x.shape[1], x.shape[2]*x.shape[3])))