sainimohit23 commented on 22 Dec 2018 â€¢
edited
I'm trying to implement model for triplet loss using FacenetModel.By far I have written this code :
`
def batch_generator(batch_size = 64):
while True:
pos = positiveImg[np.random.choice(len(positiveImg), batch_size)]
neg = negativeImg[np.random.choice(len(negativeImg), batch_size)]
anc = anchorsImg[np.random.choice(len(anchorsImg), batch_size)]
            x_data = {'inp1': anc,
                      'inp2': pos,
                      'inp3': neg
                      }
            y_data = {'y1': np.zeros((64,0)),
                      'y2': np.zeros((64,0)),
                      'y3': np.zeros((64,0))}
            yield (x_data, y_data)
    
    def triplet_loss(y_true, y_pred):    
        anchor, positive, negative = y_pred[0], y_pred[1], y_pred[2]
        pos_dist = tf.reduce_sum(tf.square(tf.subtract(anchor, positive)), axis=-1)
        neg_dist = tf.reduce_sum(tf.square(tf.subtract(anchor, negative)), axis=-1)
        basic_loss = tf.add(tf.subtract(pos_dist, neg_dist), 0.2)
        loss = tf.reduce_sum(tf.maximum(basic_loss, 0.0))
    
        return loss
    
    def getModels():
        FRmodel = keras.models.load_model('FR.h5', custom_objects={'triplet_loss': triplet_loss})
    
        inp1 = Input((3, 96, 96), name= 'inp1')
        inp2 = Input((3, 96, 96), name= 'inp2')
        inp3 = Input((3, 96, 96), name= 'inp3')
    
        pred1 = FRmodel(inp1)
        pred2 = FRmodel(inp2)
        pred3 = FRmodel(inp3)
    
        inputs = [inp1, inp2, inp3]
        outputs = [pred1, pred2, pred3]
    
        model = keras.models.Model(inputs=[inp1, inp2, inp3], outputs= [pred1, pred2, pred3])
    
        return FRmodel, model
    
    generator = batch_generator(64)
    
    FRmodel, my_model = getModels()
    my_model.compile(optimizer = 'adam', loss = triplet_loss, metrics = ['accuracy'])   
    my_model.fit_generator(generator, epochs=5,steps_per_epoch=30)`
But when I compile this model. I get this error: ValueError: No data provided for "FaceRecoModel". Need data for each key in: ['FaceRecoModel', 'FaceRecoModel', 'FaceRecoModel']
What is the correct way to do this?
Please don't get mad. I'm not getting any responses on stackoverflow. Please help.