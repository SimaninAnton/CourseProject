beebrain commented on 9 Nov 2017 â€¢
edited
I am using keras to build my LSTM network. I tried to save weight and model.
model_json = model.to_json()
with open("model.json", "w") as json_file:
    json_file.write(model_json)
# serialize weights to HDF5
model.save_weights('checkpoint_epoch_{}.h5'.format(k))
print("Saved model to disk")
Each epoch, the model will show some result from test dataset. It works fine and gave acc > 90%, but whenever I'm trying to load the model and set the training weight. I got different results.
The acc like an untrained model.
def loadmodel(modelfile,weight_file):
    print("load model file:"+modelfile)
    print("load weight file:" + weight_file)
    json_file = open(modelfile, 'r')
    loaded_model_json = json_file.read()
    json_file.close()
    loaded_model = model_from_json(loaded_model_json)
    # load weights into new model
    loaded_model.load_weights(weight_file)
    loaded_model.compile(loss='categorical_crossentropy',
            optimizer='rmsprop',
            metrics=['accuracy'])
    print("Loaded model from disk")
    return loaded_model
I am using Keras 2.0.6 with theano 0.9.0