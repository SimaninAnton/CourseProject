mawright commented on 27 Nov 2018
[x ] Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/keras-team/keras.git --upgrade --no-deps
[x ] Check that your version of TensorFlow is up-to-date. The installation instructions can be found here.
[x ] Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Previously to commit 9148325, K.batch_dot under Tensorflow had a default behavior where if would use tf.matmul to perform the batch matrix multiply of two tensors.
git checkout 0a639230018d0c9e9f12476dc8b1c6e40c2dd0d0
ipython
xt = K.placeholder([None, 5, 4, 3])
yt = K.placeholder([None, 5, 3, 2])
xtyt = K.batch_dot(xtyt)
xtyt = K.batch_dot(xt, yt)

In [70]: xtyt.shape                                                             
Out[70]: TensorShape([Dimension(None), Dimension(5), Dimension(4), Dimension(2)])
As of now, the behavior is different.
git checkout master
ipython
xt = K.placeholder([None, 5, 4, 3])
yt = K.placeholder([None, 5, 3, 2])
xtyt = K.batch_dot(xtyt)
xtyt = K.batch_dot(xt, yt)

In [13]: xtyt.shape                                                             
Out[13]: TensorShape([Dimension(None), Dimension(5), Dimension(4), Dimension(5), Dimension(2)])
It looks like you can recapture the old behavior by reshaping your tensors down to 3D before passing them to batch_dot, then reshaping the result back to the expected shape of the batch-matrix-multiply, but this is probably a breaking change otherwise.