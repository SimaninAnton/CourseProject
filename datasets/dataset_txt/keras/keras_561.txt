kaushikb11 commented on 5 Dec 2018 â€¢
edited
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/keras-team/keras.git --upgrade --no-deps
Check that your version of TensorFlow is up-to-date. The installation instructions can be found here.
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Python 2.7.12
The Keras version is 2.2.4
The tf version is 1.12.0
The issue is a continuation of #11749 . I would suggest to read the linked issue thoroughly and to reproduce the bug before going ahead.
So, when we add the metric parameter in the model.compile method and train the RNN model, it throws an error:
InvalidArgumentError: Incompatible shapes: [9] vs. [3,3]
  [[{{node metrics/acc/Equal}} = Equal[T=DT_FLOAT, _device="/job:localhost/replica:0/task:0/device:CPU:0"](metrics/acc/Reshape, metrics/acc/Cast)]]
I was able to execute the code on python 3.5 but not on python 2.7 as it is raising the above error.
Points to remember:
The model is trained without raising an error when the batch size is 1, but while evaluating the model, it gives out an error.
It works well when we don't mention the metric parameter in the model.compile method , later we have to create our custom metric method to get the desired kind of metrics.
It works on python 2.7 only when we convert the true labels into a hot vector and have the categorical loss function.
There's no issue with the sparse_categorical_accuracy method, as I executed the method independently with predicted labels and true labels as arguments on python 2.7 and it was working fine. The error raises only when I add the metric parameter in the model.compile method.
There seems to be an issue in the fit_loop method when the model is being trained. I think the issue is with the keras callback function while it's calculating the metric. Will look more thoroughly into it.
Would like more perspectives on it.
Regards.