nelson-liu commented on 7 Feb 2017
Continuation of #3205 , since the issue has not been completely fixed.
Code to reproduce:
from keras.layers import Input, Embedding, merge

input1 = Input(shape=(2,), dtype='int32')
input2 = Input(shape=(2,), dtype='int32')
embedding = Embedding(input_dim=5, output_dim=10)
masked_embedding = Embedding(input_dim=5, output_dim=10, mask_zero=True)
embedded_input1 = embedding(input1)
embedded_input2 = embedding(input2)
masked_embedded_input1 = masked_embedding(input1)
masked_embedded_input2 = masked_embedding(input2)
both_unmasked_concat = merge([embedded_input1, embedded_input2], mode='concat')
both_masked_concat = merge([masked_embedded_input1, masked_embedded_input2], mode='concat')
one_masked_sum = merge([masked_embedded_input1, embedded_input2], mode='sum')
one_masked_concat = merge([masked_embedded_input1, embedded_input2], mode='concat')
I get TypeError: Tensors in list passed to 'values' of 'ConcatV2' Op have types [bool, uint8] that don't all match. from this code on the Tensorflow backend. It works properly in the theano backend.
I think the issue lies in line 1524 of topology.py, where there is an explicit cast to uint8. The Embedding layer returns a mask of type bool, so they are incompatible.
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
2