mwiebusch78 commented on 22 Feb 2017
I am having trouble fitting a network with a locally connected hidden layer using the Theano backend. The code below runs fine for output_dim = 7*24 but crashes on the call to model.fit for output_dim = 2*7*24. The error message is quite long and messy but contains this:
Compilation failed (return status=1): /Users/martinwiebusch/.theano/compiledir_Darwin-16.4.0-x86_64-i386-64bit-i386-3.5.2-64/tmp_eqbf347/mod.cpp:6135:6: fatal error: bracket nesting level exceeded maximum of 256.
Here is the code:
import numpy as np
from keras.models import Sequential
from keras.layers import Dense, Reshape, LocallyConnected1D

np.random.seed(1234)

nsamples = 1024
input_dim = 7 + 24 + 3
output_dim = 2*7*24   # change this to 7*24 and it works
stride = 5
nhidden = 5*output_dim

x = np.random.normal(size=(nsamples, input_dim)).astype(np.float32)
y = np.random.normal(size=(nsamples, output_dim)).astype(np.float32)

model = Sequential()
model.add(Dense(nhidden, input_dim=input_dim, activation='tanh'))
model.add(Reshape((nhidden, 1)))
model.add(LocallyConnected1D(1, stride, subsample_length=stride))
model.add(Reshape((output_dim,)))

model.summary()
print('Compiling model.')
model.compile(loss='mean_squared_error', optimizer='adam')

print('Fitting model.')
model.fit(x, y, nb_epoch=10, batch_size=32, verbose=1)
My keras.json looks like this:
{
    "image_dim_ordering": "tf",
    "floatx": "float32",
    "epsilon": 1e-07,
    "backend": "theano"
}