Contributor
airalcorn2 commented on 5 Nov 2016 â€¢
edited
The code below produces the following error:
ValueError: Shape mismatch: x has 30 cols (and 1 rows) but y has 50 rows (and 30 cols)
when trying to get the output.
import numpy as np

from keras import backend
from keras.layers import Dense, Input, Lambda, merge, LSTM, TimeDistributed
from keras.layers.embeddings import Embedding

MAX_TOKENS = 100
embedding_dim = 40
hidden_dim = 50
NUM_CLASSES = 30

document = Input(shape = (None, ), dtype = "int32")
embedding = Embedding(MAX_TOKENS + 1, embedding_dim)(document)
forward = LSTM(hidden_dim, return_sequences = True)(embedding)
backward = LSTM(hidden_dim, return_sequences = True, go_backwards = True)(embedding)
together = merge([forward, embedding, backward], mode = "concat", concat_axis = 2)
semantic = TimeDistributed(Dense(NUM_CLASSES, activation = "tanh"))(together)
pool_rnn = Lambda(lambda x: x.max(axis = 1), output_shape = (hidden_dim, ))(semantic)
output = Dense(NUM_CLASSES, activation = "softmax")(pool_rnn)

doc_as_array = np.array([[1, 4, 5, 6]])

get_pool_rnn = backend.function([document], pool_rnn)
get_pool_rnn([doc_as_array])

get_output = backend.function([document], output)
get_output([doc_as_array])
I've tried several different permutations of Reshapes and transposes, but I cannot seem to get the output layer to work. Any advice on what I'm missing would be greatly appreciated.