kevinmtian commented on 3 Sep 2016
Hello,
I have been using fit_generator for classifying a large number of images which could not fit into memory. I used the keras ImageDataGenerator and followed this simple example. The only changes I made to the code are:
# line 84 changed to
train_datagen = ImageDataGenerator(featurewise_center = True)
# line 92 changed to
test_datagen = ImageDataGenerator(featurewise_center = True)
As I just would like to remove from each image the mean pixel values across samples. However, I encountered an error below:
File "/home/ubuntu/anaconda/lib/python2.7/site-packages/keras/models.py", line 683, in fit_generator
    pickle_safe=pickle_safe)
  File "/home/ubuntu/anaconda/lib/python2.7/site-packages/keras/engine/training.py", line 1419, in fit_generator
    'or (x, y). Found: ' + str(generator_output))
Exception: output of generator should be a tuple (x, y, sample_weight) or (x, y). Found: None
After checking the Source code, I found out that the member variable self.mean = None in class ImageDataGenerator (line 180) was used before being assigned a value in class DirectoryIterator (line 502).
To be specific, here is the "pathway" in which self.mean is used:
DirectoryIterator -> next() -> line 595:
x = self.image_data_generator.standardize(x)
and in ImageDataGenerator -> standardize() -> line 294:
if self.featurewise_center:
    x -= self.mean
But self.mean was not computed anywhere before being used. So I think the traceback above should be due to subtracting None from x.
Please let me know if the issue can be fixed or if there are some ideas to get around this issue.
Thank you !
---