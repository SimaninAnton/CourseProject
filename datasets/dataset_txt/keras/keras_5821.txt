FiReTiTi commented on 5 Mar 2016
Hi,
I am learning how to use Keras, and I am interested by the CNN.
I wanted to run this little code:
model = Sequential()
model.add(Convolution2D(nb_filter=16, nb_row=7, nb_col=7, border_mode='valid', input_shape=(1, 31, 31), activation='tang'))
model.add(Convolution2D(32, 3, 3, border_mode='valid', activation='tanh'))
model.add(Convolution2D(64, 3, 3, border_mode='valid', activation='tanh'))
model.add(Flatten()) model.add(Dense(23, activation='tanh'))
model.add(Dense(11, activation='sigmoid'))
model.add(Dense(1, activation='sigmoid'))
optimizer = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
model.compile(loss='binary_crossentropy', optimizer=optimizer)
model.fit(dataset, labels, batch_size=32, nb_epoch=10, shuffle=True, validation_split=0.1, verbose=1)
And here are my inputs and labels:
dataset = np.ndarray(shape=(nbimages, image_size, image_size), dtype=np.float32)
labels = np.ndarray(shape=(nbimages, 1), dtype=np.float32)
But it seems that I don't put the good dimensions because I get the following error:
Epoch 1/10
Traceback (most recent call last):
File "Convolutional.py", line 129, in
model.fit(dataset, labels, batch_size=batch_size, nb_epoch=10, shuffle=True, validation_split=0.1, verbose=1)
File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/keras/models.py", line 646, in fit
shuffle=shuffle, metrics=metrics)
File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/keras/models.py", line 280, in _fit
outs = f(ins_batch)
File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/keras/backend/theano_backend.py", line 384, in call
return self.function(*inputs)
File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/theano/compile/function_module.py", line 786, in call
allow_downcast=s.allow_downcast)
File "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/theano/tensor/type.py", line 177, in filter
data.shape))
TypeError: ('Bad input argument to theano function with name "/opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/keras/backend/theano_backend.py:380" at index 0(0-based)', 'Wrong number of dimensions: expected 4, got 3 with shape (32, 31, 31).')
So "expected 4, got 3". But if I add the batch size into my first layer "input_shape=(32, 1, 31, 31)", then I got this other error:
Invalid input shape - Layer expects input ndim=4, was provided with input shape (None, 32, 1, 31, 31)
I looked to a lot of Keras Convolution2D examples, and I didn't get why my code does not compile.
Could you please help me?