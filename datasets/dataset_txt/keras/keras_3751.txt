mustgoplay commented on 6 Dec 2016
I have the following in a custom layer:
neibs = images2neibs(x, self.subsample, (1,1), self.border_mode)
I need to get the shape of the neibs so that I can get the batch size being fed into the layer for a reshape:
batch_shape = K.shape(output_correlations).eval()
I can't eval() the shape, it throws an error during compilation:
batch_shape = K.shape(neibs).eval() File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\gof\graph.py", line 520, in eval self._fn_cache[inputs] = theano.function(inputs, self) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\compile\function.py", line 320, in function output_keys=output_keys) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\compile\pfunc.py", line 479, in pfunc output_keys=output_keys) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\compile\function_module.py", line 1776, in orig_function output_keys=output_keys).create( File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\compile\function_module.py", line 1428, in __init__ accept_inplace) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\compile\function_module.py", line 177, in std_fgraph update_mapping=update_mapping) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\gof\fg.py", line 171, in __init__ self.__import_r__(output, reason="init") File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\gof\fg.py", line 360, in __import_r__ self.__import__(variable.owner, reason=reason) File "C:\Anaconda3\envs\testnet\lib\site-packages\theano\gof\fg.py", line 465, in __import__ detailed_err_msg) theano.gof.fg.MissingInputError: A variable that is an input to the graph was neither provided as an input to the function nor given a value. A chain of variables leading from this input to an output is [imageinputlayer_input_1, AbstractConv2d{border_mode='half', subsample=(1, 1), filter_flip=True, imshp=(None, None, None, None), kshp=(32, 1, 3, 3)}.0, Elemwise{clip,no_inplace}.0, Elemwise{mul,no_inplace}.0, Images2Neibs{valid}.0, DimShuffle{1,0}.0, dot.0, Elemwise{sub,no_inplace}.0, Elemwise{true_div,no_inplace}.0, Shape.0]. This chain may not be unique Backtrace when the variable is created: File "C:/Users/Anon/Documents/PycharmProjects/ailearningnetwork/ailearningnetwork/MNISTKeras.py", line 153, in <module> input_shape = (1, img_rows, img_cols))) File "C:\Anaconda3\envs\testnet\lib\site-packages\keras\models.py", line 275, in add layer.create_input_layer(batch_input_shape, input_dtype) File "C:\Anaconda3\envs\testnet\lib\site-packages\keras\engine\topology.py", line 363, in create_input_layer dtype=input_dtype, name=name) File "C:\Anaconda3\envs\testnet\lib\site-packages\keras\engine\topology.py", line 1081, in Input input_tensor=tensor) File "C:\Anaconda3\envs\testnet\lib\site-packages\keras\engine\topology.py", line 1004, in __init__ name=self.name) File "C:\Anaconda3\envs\testnet\lib\site-packages\keras\backend\theano_backend.py", line 54, in placeholder x = T.TensorType(dtype, broadcast)(name)
Any ideas please as to how to either make the eval work during the compilation or how to get the batch size during compilation?
Please make sure that the boxes below are checked before you submit your issue. Thank you!
[x ] Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
[ x] If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
[x ] Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).