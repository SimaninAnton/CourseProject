paolof89 commented on 5 Jun 2017
Description
I can not fit the GridSearchCV object with n_jobs > 1 (or n_jobs = -1)
The console is trapped into an error loop with this message:
AttributeError: Can't get attribute 'create_model' on <module 'main' (built-in)>
Steps/Code to Reproduce
import math
import numpy as np
import matplotlib.pyplot as plt
from keras.models import Sequential
from keras.layers import Dense, Dropout
from keras.wrappers.scikit_learn import KerasRegressor
from sklearn.model_selection import GridSearchCV
Create timeseries fake data
idx = np.arange(0.0, 3600.0, math.pi).reshape(-1,1)
y = np.sin(idx * np.pi / 180)
x = np.roll(y, -1)
Define function to create a multi layer perceptron network with Keras.models.Sequential
def create_model(input_dim, neurons=[4], dropout=[0.3]):
model = Sequential()
model.add(Dense(neurons[0], input_dim=input_dim, activation='relu'))
model.add(Dropout(dropout[0]))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
return model
Define Keras Regressor and the param grid
model = KerasRegressor(build_fn=create_model, verbose=2)
epochs = [1, 3, 5]
param_grid = dict(input_dim=[1], epochs=epochs)
grid = GridSearchCV(estimator=model, param_grid=param_grid, n_jobs=-1)
grid_result = grid.fit(x, y)
Expected Results
I expect the same results with n_jobs = 1 and n_jobs = -1
print(grid_result)
GridSearchCV(cv=None, error_score='raise',
estimator=<keras.wrappers.scikit_learn.KerasRegressor object at 0x000000A4EE228A58>,
fit_params={}, iid=True, n_jobs=1,
param_grid={'epochs': [1, 3, 5], 'input_dim': [1]},
pre_dispatch='2*n_jobs', refit=True, return_train_score=True,
scoring=None, verbose=0)
Actual Results
Loop on error:
AttributeError: Can't get attribute 'create_model' on <module 'main' (built-in)>
Versions
Windows-2012ServerR2-6.3.9600-SP0
Python 3.5.3 |Continuum Analytics, Inc.| (default, Feb 22 2017, 21:28:42) [MSC v.1900 64 bit (AMD64)]
NumPy 1.12.1
SciPy 0.19.0
Scikit-Learn 0.18.1
Keras 2.0.2