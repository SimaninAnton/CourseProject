QuantumLiu commented on 20 Jan 2017 â€¢
edited
My code is:
X_f=basemodel.predict_generator(datagen.flow(X_train, batch_size=32,shuffle=False),3*len(X_train),nb_worker=16)
train_labels = np.array([0] * 37500 + [1] * 37500)
X_f_val=basemodel.predict_generator(datagen.flow(X_train, batch_size=32,shuffle=False),int(0.1*len(X_train)),nb_worker=16)
train_labels_val = np.array([0] * 1250 + [1] * 1250)
And got error:
Traceback (most recent call last):
  File "vgg16_cd_0120.py", line 33, in <module>
    X_f_val=basemodel.predict_generator(datagen.flow(X_train, batch_size=32,shuffle=False),int(0.1*len(X_train)),nb_worker=16)
  File "/usr/local/lib/python2.7/dist-packages/keras/engine/training.py", line 1749, in predict_generator
    all_outs[i][processed_samples:(processed_samples + nb_samples)] = out
ValueError: could not broadcast input array from shape (32,7,7,512) into shape (4,7,7,512)
Exception in thread Thread-29:
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
    self.run()
  File "/usr/lib/python2.7/threading.py", line 754, in run
    self.__target(*self.__args, **self.__kwargs)
  File "/usr/local/lib/python2.7/dist-packages/keras/engine/training.py", line 412, in data_generator_task
    time.sleep(wait_time)
AttributeError: 'NoneType' object has no attribute 'sleep'
len(X_train) is 2500 .Then I thought it may because when val_samples/batch_size it got a remainder .
So,I changed batch_size and test again.
>>> X_f_val=basemodel.predict_generator(datagen.flow(X_train, batch_size=4,shuffle=False),int(0.1*len(X_train)))
>>> X_f_val=basemodel.predict_generator(datagen.flow(X_train, batch_size=50,shuffle=False),int(0.1*len(X_train)))
W tensorflow/core/common_runtime/bfc_allocator.cc:217] Ran out of memory trying to allocate 3.59GiB. The caller indicates that this is not a failure, but may mean that there could be performance gains if more memory is available.
>>> X_f_val=basemodel.predict_generator(datagen.flow(X_train, batch_size=51,shuffle=False),int(0.1*len(X_train)))
W tensorflow/core/common_runtime/bfc_allocator.cc:217] Ran out of memory trying to allocate 3.62GiB. The caller indicates that this is not a failure, but may mean that there could be performance gains if more memory is available.
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/lib/python2.7/dist-packages/keras/engine/training.py", line 1749, in predict_generator
    all_outs[i][processed_samples:(processed_samples + nb_samples)] = out
ValueError: could not broadcast input array from shape (51,7,7,512) into shape (1,7,7,512)