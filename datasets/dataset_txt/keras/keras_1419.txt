adam-haber commented on 11 Dec 2017
I've trained a model and saved it as a .h5 file using model.save().
When I tried to load the model, I got an error I don't understand; a google search of the error message gives nothing (not even a link to the source file...).
If anyone has any idea how to solve this, it would be much appreciated:
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-16-1855e0b095c7> in <module>()
----> 1 m2 = load_model("example.h5")

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/models.py in load_model(filepath, custom_objects, compile)
    237             raise ValueError('No model found in config file.')
    238         model_config = json.loads(model_config.decode('utf-8'))
--> 239         model = model_from_config(model_config, custom_objects=custom_objects)
    240 
    241         # set weights

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/models.py in model_from_config(config, custom_objects)
    311                         'Maybe you meant to use '
    312                         '`Sequential.from_config(config)`?')
--> 313     return layer_module.deserialize(config, custom_objects=custom_objects)
    314 
    315 

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/layers/__init__.py in deserialize(config, custom_objects)
     52                                     module_objects=globs,
     53                                     custom_objects=custom_objects,
---> 54                                     printable_module_name='layer')

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/utils/generic_utils.py in deserialize_keras_object(identifier, module_objects, custom_objects, printable_module_name)
    137                 return cls.from_config(config['config'],
    138                                        custom_objects=dict(list(_GLOBAL_CUSTOM_OBJECTS.items()) +
--> 139                                                            list(custom_objects.items())))
    140             with CustomObjectScope(custom_objects):
    141                 return cls.from_config(config['config'])

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/models.py in from_config(cls, config, custom_objects)
   1212         for conf in config:
   1213             layer = layer_module.deserialize(conf, custom_objects=custom_objects)
-> 1214             model.add(layer)
   1215         return model
   1216 

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/models.py in add(self, layer)
    473                           output_shapes=[self.outputs[0]._keras_shape])
    474         else:
--> 475             output_tensor = layer(self.outputs[0])
    476             if isinstance(output_tensor, list):
    477                 raise TypeError('All layers in a Sequential model '

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/engine/topology.py in __call__(self, inputs, **kwargs)
    600 
    601             # Actually call the layer, collecting output(s), mask(s), and shape(s).
--> 602             output = self.call(inputs, **kwargs)
    603             output_mask = self.compute_mask(inputs, previous_mask)
    604 

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/layers/core.py in call(self, inputs, mask)
    648         if has_arg(self.function, 'mask'):
    649             arguments['mask'] = mask
--> 650         return self.function(inputs, **arguments)
    651 
    652     def compute_mask(self, inputs, mask=None):

~/anaconda2/envs/tf/lib/python3.5/site-packages/keras/layers/core.py in output_lambda(x, init_alpha, max_beta_value, alpha_kernel_scalefactor)
     83             warnings.warn(message)
     84 
---> 85     a, b = _keras_unstack_hack(x)
     86 
     87     # Implicitly initialize alpha:

NameError: name '_keras_unstack_hack' is not defined
Network architecture is as follows:
Layer (type)                 Output Shape              Param #   
=================================================================
masking_1 (Masking)          (None, None, 21)          0         
_________________________________________________________________
gru_1 (GRU)                  (None, None, 5)           405       
_________________________________________________________________
time_distributed_1 (TimeDist (None, None, 2)           12        
_________________________________________________________________
lambda_1 (Lambda)            (None, None, 2)           0         
=================================================================
Total params: 417
Trainable params: 417
Non-trainable params: 0
Keras 2.0.8
TF 1.3.0
Python 3.5.4
Ubuntu 17.04