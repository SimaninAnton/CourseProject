asmith26 commented on 7 May 2016
I'm trying to run some Keras code that implement "Stochastic Depth" on TensorFlow. The original code runs on Theano, and when switching to TensorFlow I'm getting an error (note I have pulled the latest Keras commits):
Traceback (most recent call last):
...
  File "~/git/keras/keras/backend/tensorflow_backend.py", line 525, in repeat_elements
    x_rep = [s for s in splits for i in range(rep)]
TypeError: range() integer end argument expected, got Tensor.
The code that is breaking it is (where x is a collection of Keras layers built-up using the Functional API):
pad_shape = (1,16,80,60)
padding = K.zeros(pad_shape)
# logging.debug(K.shape(x))
# logging.debug(K.shape(x)[0])
padding = K.repeat_elements(padding, rep=K.shape(x)[0], axis=0)
Thus is looks like, the Theano repeat_elements (which I believe implements this function from Theano) handles "rep=int, scalar or tensor variable"; however the TensorFlow repeat_elements doesn't.
I'm not particularly familiar with the TensorFlow API so I'm not sure if there already exists a similar repeat function to Theano. Otherwise, please can we implement the TensorFlow backend repeat_elements function to handle "int, scalar or tensor variable" like Theano? If it helps, when I uncomment my logging.debug code above I get Theano:
DEBUG:root:Shape.0
DEBUG:root:Subtensor{int64}.0
and TensorFlow:
DEBUG:root:Tensor("Shape:0", shape=(4,), dtype=int32)
DEBUG:root:Tensor("Squeeze:0", shape=(), dtype=int32)
Thanks!
1