dimargn commented on 28 Aug 2018 â€¢
edited by maxpumperla
Hi,
I'm trying to save Keras model that contains Lambda layer for resizing image -
def resize_like(input_tensor, ref_tensor): 
    H, W = ref_tensor.get_shape()[1], ref_tensor.get_shape()[2]
    return K.tf.image.resize_images(input_tensor, [H.value, W.value])

x = _inverted_res_block(x, filters=320, alpha=alpha, stride=1, rate=4,
                                expansion=6, block_id=16, skip_connection=False)  #x is 2D tensor object

b4 = Lambda(resize_like, arguments={'ref_tensor': x})(b4)                 #b4 is 2D tensor object
###some more operation here#####
x = Lambda(resize_like, arguments={'ref_tensor': img_input})(x)           #img_input is 2D tensor object

model = Model(inputs, x, name='model1')
model.save(filePath, overwrite=True)
Each run I get one of those four errors -
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 297, in _reconstruct
state = deepcopy(state, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 155, in deepcopy
y = copier(x, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 243, in _deepcopy_dict
y[deepcopy(key, memo)] = deepcopy(value, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 174, in deepcopy
rv = reductor(4)
TypeError: can't pickle SwigPyObject objects
2)File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 155, in deepcopy
y = copier(x, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 243, in _deepcopy_dict
y[deepcopy(key, memo)] = deepcopy(value, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 174, in deepcopy
rv = reductor(4)
TypeError: cannot serialize '_io.TextIOWrapper' object
3)File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 155, in deepcopy
y = copier(x, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 243, in _deepcopy_dict
y[deepcopy(key, memo)] = deepcopy(value, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 182, in deepcopy
y = _reconstruct(x, rv, 1, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 306, in _reconstruct
y.dict.update(state)
AttributeError: 'NoneType' object has no attribute 'update'
4)File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 155, in deepcopy
y = copier(x, memo)
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 223, in _deepcopy_tuple
y = [deepcopy(a, memo) for a in x]
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 223, in
y = [deepcopy(a, memo) for a in x]
File "T:\Conda\Envs\Kitov-38842-DKtv\lib\copy.py", line 151, in deepcopy
cls = type(x)
RecursionError: maximum recursion depth exceeded while calling a Python object
How can i save the model with Lambda layer?
The python version in 3.5, Keras is 2.2.2, tensorflow is 1.10.0
Thank You!
4