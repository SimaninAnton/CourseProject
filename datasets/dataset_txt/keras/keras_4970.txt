ReallyCoolName commented on 14 Jun 2016 â€¢
edited
Just reinstalled theano+keras to make sure. I've tried a few things and it seems the problem only happens when the RNN being unrolled is before a RepeatVector layer (unrolling a network after the RepeatVector doesn't cause any problem).
My code:
embedding_models =[]
for _ in xrange(n_simultaneous):
    embedding_models += [Sequential()]
    embedding_models[-1].add(Embedding(28,2,batch_input_shape=(b_sz,50 )))

model.add(Merge(embedding_models,mode='concat'))
model.add(GRU(10,stateful=True,unroll=True,return_sequences=True))
model.add(Flatten())
model.add(RepeatVector(10))
model.add(GRU(10,stateful=True,unroll=False,return_sequences=True))
model.add(TimeDistributedDense(180,activation='softmax'))'''
model.compile(loss=categorial_ce, optimizer='rmsprop',metrics=['accuracy'])
X_train,Y_train = get_batch()
model.fit(X_train, Y_train, batch_size=b_sz, nb_epoch=4, verbose=1,validation_split=v_splt)```


The error: (50 times `TensorConstant{10}` if anyone's wondering. probably number of timesteps. And no, `config.mode` is not `FAST_COMPILE`, is `Mode`, which is equivalent to `FAST_RUN`):


```ERROR (theano.gof.opt): Optimization failure due to: constant_folding
ERROR (theano.gof.opt): node: Elemwise{add,no_inplace}(TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10}, TensorConstant{10})
ERROR (theano.gof.opt): TRACEBACK:
ERROR (theano.gof.opt): Traceback (most recent call last):
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/gof/opt.py", line 1772, in process_node
    replacements = lopt.transform(node)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/opt.py", line 5827, in constant_folding
    required = thunk()
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/gof/op.py", line 912, in rval
    r = p(n, [x[0] for x in i], o)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/elemwise.py", line 839, in perform
    super(Elemwise, self).perform(node, inputs, output_storage)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/gof/op.py", line 769, in perform
    "Did you used Theano flags mode=FAST_COMPILE?"
MethodNotDefined: ('perform', <class 'theano.tensor.elemwise.Elemwise'>, 'Elemwise', 'Did you used Theano flags mode=FAST_COMPILE? You can use optimizer=fast_compile instead.')

ERROR (theano.gof.opt): Optimization failure due to: local_mul_zero
ERROR (theano.gof.opt): node: Elemwise{mul,no_inplace}(TensorConstant{50}, Elemwise{switch,no_inplace}.0, Elemwise{switch,no_inplace}.0)
ERROR (theano.gof.opt): TRACEBACK:
ERROR (theano.gof.opt): Traceback (most recent call last):
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/gof/opt.py", line 1772, in process_node
    replacements = lopt.transform(node)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/opt.py", line 5193, in local_mul_zero
    value = get_scalar_constant_value(i)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/basic.py", line 660, in get_scalar_constant_value
    for i in v.owner.inputs]
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/basic.py", line 662, in get_scalar_constant_value
    v.owner.op.perform(v.owner, const, ret)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/tensor/elemwise.py", line 839, in perform
    super(Elemwise, self).perform(node, inputs, output_storage)
  File "/home/azureuser/anaconda2/lib/python2.7/site-packages/theano/gof/op.py", line 769, in perform
    "Did you used Theano flags mode=FAST_COMPILE?"
MethodNotDefined: ('perform', <class 'theano.tensor.elemwise.Elemwise'>, 'Elemwise', 'Did you used Theano flags mode=FAST_COMPILE? You can use optimizer=fast_compile instead.')```

I'd try to help, but I spent all my sanity during the weekend trying to debug my implementation of a neural tensor network.