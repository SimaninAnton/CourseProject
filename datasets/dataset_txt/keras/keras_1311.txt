jlfu commented on 20 Jan 2018
adam = optimizers.Adam()
updates = adam.get_updates(loss=K.constant(loss),constraints=[], params=self.model.trainable_weights)
self.train_fn = K.function(inputs=[probs,reward],
outputs=[],
updates=updates)
When i run the code, i get the following error:
Traceback (most recent call last):
File "model.py", line 462, in
agent.fit(state, chose_arg1, chose_arg2, reward, chose_arg1_probs,chose_arg2_probs)
File "model.py", line 255, in fit
updates = adam.get_updates(loss=K.constant(loss),constraints=[], params=self.model.trainable_weights)
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/keras/optimizers.py", line 398, in get_updates
m_t = (self.beta_1 * m) + (1. - self.beta_1) * g
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/ops/math_ops.py", line 829, in binary_op_wrapper
y = ops.convert_to_tensor(y, dtype=x.dtype.base_dtype, name="y")
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/framework/ops.py", line 676, in convert_to_tensor
as_ref=False)
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/framework/ops.py", line 741, in internal_convert_to_tensor
ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py", line 113, in _constant_tensor_conversion_function
return constant(v, dtype=dtype, name=name)
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py", line 102, in constant
tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))
File "/home/jlfu/RLDiscourse/disenv/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py", line 364, in make_tensor_proto
raise ValueError("None values not supported.")
ValueError: None values not supported.
I have print the loss and self.model.trainable_weights.
the loss is: -0.375
the self.model.trainable_weights: self.model.trainable_weights [<tf.Variable 'embedding_1/embeddings:0' shape=(39660, 300) dtype=float32_ref>, <tf.Variable 'embedding_2/embeddings:0' shape=(39660, 300) dtype=float32_ref>, <tf.Variable 'bidirectional_1/kernel:0' shape=(300, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_1/recurrent_kernel:0' shape=(200, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_1/bias:0' shape=(800,) dtype=float32_ref>, <tf.Variable 'bidirectional_1/kernel_1:0' shape=(300, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_1/recurrent_kernel_1:0' shape=(200, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_1/bias_1:0' shape=(800,) dtype=float32_ref>, <tf.Variable 'bidirectional_2/kernel:0' shape=(300, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_2/recurrent_kernel:0' shape=(200, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_2/bias:0' shape=(800,) dtype=float32_ref>, <tf.Variable 'bidirectional_2/kernel_1:0' shape=(300, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_2/recurrent_kernel_1:0' shape=(200, 800) dtype=float32_ref>, <tf.Variable 'bidirectional_2/bias_1:0' shape=(800,) dtype=float32_ref>, <tf.Variable 'time_distributed_1/kernel:0' shape=(400, 2) dtype=float32_ref>, <tf.Variable 'time_distributed_1/bias:0' shape=(2,) dtype=float32_ref>, <tf.Variable 'time_distributed_2/kernel:0' shape=(400, 2) dtype=float32_ref>, <tf.Variable 'time_distributed_2/bias:0' shape=(2,) dtype=float32_ref>]
it seems like the ## constraints=[] raise the error.
The version of my keras is 2.0.2, and i use the tensorflow as my backend. The version of tensorflow is 1.2. Can anybody help me to solve the quesion? Thank you!
1