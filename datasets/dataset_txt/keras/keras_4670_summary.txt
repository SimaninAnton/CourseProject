Why does this code not work with mode=0?