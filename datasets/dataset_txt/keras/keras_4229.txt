vrodionovpro commented on 6 Oct 2016
I workings on multiple gpu and 'device' state does't save and nothing to load. Set default device for all after loading. I tried save mode full and save via YAML. Result the same.
Here simple test for understanding:
device = '/gpu:1'
with tf.device(device):
    model = Sequential()
    model.add(Embedding(max_features, 1, input_length=xShape, name='inL'))
    model.add(LSTM(64, return_sequences=True))
    model.add(LSTM(64))
    model.add(Dropout(0.5))
    model.add(Dense(1))
    model.add(Activation('sigmoid', name='outL'))

    model.compile(loss='binary_crossentropy', optimizer='adam')

for i in range(len(model.layers)):
    print(model.layers[i].input)

model.save('1.model')

a = load_model('1.model')
print('\nloaded')

for i in range(len(a.layers)):
    print(a.layers[i].input)
model = a
And output without device state.
Tensor("embedding_input_1:0", shape=(?, 1), dtype=int32, device=/device:GPU:1)
Tensor("Gather:0", shape=(?, 1, 1), dtype=float32, device=/device:GPU:1)
Tensor("transpose_1:0", shape=(?, 1, 64), dtype=float32, device=/device:GPU:1)
Tensor("Squeeze_3:0", shape=(?, ?), dtype=float32, device=/device:GPU:1)
Tensor("cond/Merge:0", shape=(?, ?), dtype=float32, device=/device:GPU:1)
Tensor("add_24:0", shape=(?, 1), dtype=float32, device=/device:GPU:1)

loaded
Tensor("embedding_input_2:0", shape=(?, 1), dtype=int32)
Tensor("Gather_1:0", shape=(?, 1, 1), dtype=float32)
Tensor("transpose_5:0", shape=(?, 1, 64), dtype=float32)
Tensor("Squeeze_7:0", shape=(?, ?), dtype=float32)
Tensor("cond_1/Merge:0", shape=(?, ?), dtype=float32)
Tensor("add_49:0", shape=(?, 1), dtype=float32)