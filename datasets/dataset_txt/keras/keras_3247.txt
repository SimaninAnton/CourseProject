unrealwill commented on 10 Feb 2017
Hello,
I'd like to be able to return multiple outputs in the step function of a recurrent network, or even with K.rnn, would be great. Which from the doc of K.rnn is not currently possible, but under the hood I think at least theano can do it.
def test_rnn_multiple_outputs_no_states():
    # implement a simple RNN without states
    input_dim = 8
    output_dim = 4
    timesteps = 5

    input_val = np.random.random((32, timesteps, input_dim))
    W_i_val = np.random.random((input_dim, output_dim))
    W_j_val = np.random.random((input_dim, output_dim))

    def rnn_step_fn(input_dim, output_dim, K):
        W_i = K.variable(W_i_val)
        W_j = K.variable(W_j_val)
        def step_function(x, states):
            output1 = K.dot(x, W_i)
            output2 = K.dot(x, W_j)
            return [output1,output2], []

        return step_function

        # test default setup
    th_rnn_step_fn = rnn_step_fn(input_dim, output_dim, K)
    th_inputs = K.variable(input_val)
    th_initial_states = []
    last_output, outputs, new_states = K.rnn(th_rnn_step_fn, th_inputs,
                                                   th_initial_states,
                                                   go_backwards=False,
                                                   mask=None)
    th_last_output = K.eval(last_output) #Should return a list of two tensors of shape (32,4)
    th_outputs = K.eval(outputs) #Should return a list of two tensors of shape (32,5,4)
Thank you