sileod commented on 8 Jul 2016 â€¢
edited
Hello, I'm trying to use a simple matrix factorization with tensorflow backend
        u = Input(shape=(b_size,), dtype='int32', name='left')
        v = Input(shape=(b_size,), dtype='int32', name='right')

        left =  Embedding(numUsers, factors,init="lecun_uniform", W_regularizer=l2(l) )(u)
        right = Embedding(numMovies,factors,init="lecun_uniform", W_regularizer=l2(l))(v)

        left = Reshape((factors,))(left)
        right = Reshape((factors,))(right)
        dot = merge([left, right], mode='dot',dot_axes=1)
        dot = Reshape((1,))(dot)

        model = Model(input=[u, v], output=dot)

        rp = sorted(prefs.items(), key = lambda x: random.random() ) #ratings of a dok sparse preference matrix
        U = np.array([x[0][0] for x in rp]).astype(np.int32) # flat array of int32
        V = np.array([x[0][1] for x in rp]).astype(np.int32) # flat array of int32
        R = np.array([x[1]- glob_mean for x in rp]).astype(np.float16)  # flat array of float16

        model.compile(loss='mse', optimizer="adam", metrics=[MSE])
        callbacks = [EarlyStopping('val_loss')]
        model.fit([U,V],R, validation_split=0.1,batch_size=bsize, verbose=2, callbacks=callbacks,nb_epoch=7)
But I get this error:
InvalidArgumentError: In[0] and In[1] ndims must be >= 3: 2
     [[Node: BatchMatMul_4 = BatchMatMul[T=DT_FLOAT, adj_x=false, adj_y=true, _device="/job:localhost/replica:0/task:0/cpu:0"](Reshape_16, Reshape_17)]]
Caused by op 'BatchMatMul_4', defined at:
It works perfectly with Theano, I tried to get into tensorflow and use higher dimensions tensors as input but I can't get it to work, can someone help me ? Thanks