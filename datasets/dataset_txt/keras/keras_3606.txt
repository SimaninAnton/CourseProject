Contributor
0bserver07 commented on 24 Dec 2016
During MaxPooling2d() the row with odd number [ 45 ] becomes even [ 22 ], this becomes an issue during Deconv or let's say UpSampling2D(), it doesn't count up to the same sizes as it started.
Here is a gist of the full model, but what I'm pointing to is the maxpooling2d_59
block4_conv3 (Convolution2D)     (None, 512, 45, 60)   2359808     activation_299[0][0]             
____________________________________________________________________________________________________
batchnormalization_312 (BatchNorm(None, 512, 45, 60)   120         block4_conv3[0][0]               
____________________________________________________________________________________________________
activation_300 (Activation)      (None, 512, 45, 60)   0           batchnormalization_312[0][0]     
____________________________________________________________________________________________________
maxpooling2d_59 (MaxPooling2D)   (None, 512, 22, 30)   0           activation_300[0][0]             
____________________________________________________________________________________________________
block5_conv1 (Convolution2D)     (None, 512, 22, 30)   2359808     maxpooling2d_59[0][0]            
____________________________________________________________________________________________________
batchnormalization_313 (BatchNorm(None, 512, 22, 30)   60          block5_conv1[0][0]               
____________________________________________________________________________________________________
activation_301 (Activation)      (None, 512, 22, 30)   0           batchnormalization_313[0][0]   
The issue is here, at size 22 to 44, rather 45
convolution2d_42 (Convolution2D) (None, 512, 22, 30)   2359808     activation_305[0][0]             
____________________________________________________________________________________________________
batchnormalization_318 (BatchNorm(None, 512, 22, 30)   60          convolution2d_42[0][0]           
____________________________________________________________________________________________________
activation_306 (Activation)      (None, 512, 22, 30)   0           batchnormalization_318[0][0]     
____________________________________________________________________________________________________
upsampling2d_52 (UpSampling2D)   (None, 512, 44, 60)   0           activation_306[0][0]             
____________________________________________________________________________________________________
convolution2d_43 (Convolution2D) (None, 512, 44, 60)   2359808     upsampling2d_52[0][0]            
____________________________________________________________________________________________________
batchnormalization_319 (BatchNorm(None, 512, 44, 60)   120         convolution2d_43[0][0]           
____________________________________________________________________________________________________
activation_307 (Activation)      (None, 512, 44, 60)   0           batchnormalization_319[0][0]     
____________________________________________________________________________________________________
It causes this error otherwise continuing to a Reshape() .
ValueError: total size of new array must be unchanged
Relevant issues and each seem to solve it a different way:
Unpooling and deconvolution #378
MaxPooling2D fails to utilize last column in odd dimensional input #2094