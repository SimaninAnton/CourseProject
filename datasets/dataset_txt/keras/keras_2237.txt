bzhong2 commented on 3 Jun 2017 â€¢
edited
Hello, I was trying to follow the standard approach that @fchollet detailed in his blog post(https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html).
I saved the bottleneck features of the out put of pretrained inception3
I build a sequential model with name "Add_layers " and train it with the bottleneck features
Then I try to add this layer to the pretrained inception3 model and do finetuning. However, I got an error. Any help is appreciated!
Here is the core code of what I did:
base_model = InceptionV3(include_top=False, weights='imagenet', input_shape=(img_shape[0],img_shape[1],3), pooling='avg')
Add_layers = Sequential()
Add_layers.add(Dense(1024, activation='relu',name='fc_new_1',input_shape=base_model.output_shape[1:]))
Add_layers.add(Dense(num_classes, activation='sigmoid',name='logit_new'))
Add_layers.compile(optimizer=adam, loss='categorical_crossentropy', metrics=['accuracy'])
Add_layers.fit(.......I fit the added layers with bottleneck feartures.....)
Then I add the Add_layers model to the base_model (pretrained inception3)##
x = base_model.output
predictions = Add_layers(x)
model = Model(inputs=base_model.output, outputs=predictions)
However, It gave me an error:
C:\ProgramData\Anaconda3\lib\site-packages\keras\engine\topology.py:1513: UserWarning: Model inputs must come from a Keras Input layer, they cannot be the output of a previous non-Input layer. Here, a tensor specified as input to "model_1" was not an Input tensor, it was generated by layer global_average_pooling2d_1.
Note that input tensors are instantiated via tensor = Input(shape).
The tensor that caused the issue was: global_average_pooling2d_1/Mean:0
str(x.name))
Traceback (most recent call last):
File "Keras_SQL_inception3_features.py", line 261, in
model = Model(inputs=base_model.output, outputs=predictions)
File "C:\ProgramData\Anaconda3\lib\site-packages\keras\legacy\interfaces.py", line 88, in wrapper
return func(*args, **kwargs)
File "C:\ProgramData\Anaconda3\lib\site-packages\keras\engine\topology.py", line 1566, in init
if layer.is_placeholder:
AttributeError: 'GlobalAveragePooling2D' object has no attribute 'is_placeholder'