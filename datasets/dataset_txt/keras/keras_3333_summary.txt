Is the following code for custom loss used in training correct?