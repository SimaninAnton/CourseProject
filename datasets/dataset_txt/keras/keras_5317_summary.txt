loss computation with mask has a bug