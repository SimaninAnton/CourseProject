zhangyi02 commented on 20 Sep 2019
System information
Have I written custom code (as opposed to using example directory): yes
OS Platform and Distribution (e.g., Linux Ubuntu 16.04): CentOS Linux release 7.6.1810 (Core)
TensorFlow backend (yes / no): yes
TensorFlow version: 1.13.1
Keras version: 2.2.4
Python version: 3.6
CUDA/cuDNN version: V10.0.130/7.6.1
GPU model and memory: TITAN Xp, 12195MiB
Describe the current behavior
I supposed the Lambda layer should have the same behavior with normal layers. But, when I defined the lambda function using elements chosen from a list, it will be changed as the list change.
Code to reproduce the issue
from keras.layers import Input, Lambda, Conv1D
inp = Input((64000,1))
strides=[1,2,4]
i = 0
l1 = Conv1D(1, 3, padding='same', strides=strides[i])
l2 = Lambda(lambda x: x[:, ::strides[i], :])
l1(inp)
l2(inp)
returns
<tf.Tensor 'add_4:0' shape=(?, 64000, 1) dtype=float32>
<tf.Tensor 'strided_slice_2:0' shape=(?, 64000, 1) dtype=float32>
while
i=1
l1(inp)
l2(inp)
returns
<tf.Tensor 'add:0' shape=(?, 64000, 1) dtype=float32>
<tf.Tensor 'strided_slice:0' shape=(?, 32000, 1) dtype=float32>