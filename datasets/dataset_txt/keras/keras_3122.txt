zgbkdlm commented on 26 Feb 2017 â€¢
edited
I was saving the encoder of the example : "examples/variational_autoencoder.py"
def sampling(args):
    z_mean, z_log_var = args
    epsilon = K.random_normal(shape=(batch_size, latent_dim), mean=0.,
                              std=1.0)
    return z_mean + K.exp(z_log_var / 2) * epsilon

z = Lambda(sampling, output_shape=(latent_dim,))([z_mean, z_log_var])
......
encoder = Model(input=vae_input, output=z)
encoder.save('Compiled/variationalAutoencoders_encoder.h5')
But when I load it, the error ocurrs, batch_size not defined. It doesn't work even I set a global batch_size.
from keras.models import Model, load_model
from keras import backend as K
import numpy as np
import matplotlib.pyplot as plt

encoding_dim = 64
batch_size = 100

autoencoder = load_model('Compiled/variationalAutoencoders_autoencoder.h5')
Traceback (most recent call last):
  File "F:/Uppsala/SVAE/probe_script.py", line 9, in <module>
    autoencoder = load_model('Compiled/variationalAutoencoders_autoencoder.h5')
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\models.py", line 142, in load_model
    model = model_from_config(model_config, custom_objects=custom_objects)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\models.py", line 193, in model_from_config
    return layer_from_config(config, custom_objects=custom_objects)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\utils\layer_utils.py", line 40, in layer_from_config
    custom_objects=custom_objects)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\engine\topology.py", line 2582, in from_config
    process_layer(layer_data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\engine\topology.py", line 2579, in process_layer
    layer(input_tensors)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\engine\topology.py", line 572, in __call__
    self.add_inbound_node(inbound_layers, node_indices, tensor_indices)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\engine\topology.py", line 635, in add_inbound_node
    Node.create_node(self, inbound_layers, node_indices, tensor_indices)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\engine\topology.py", line 172, in create_node
    output_tensors = to_list(outbound_layer.call(input_tensors, mask=input_masks))
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python35\lib\site-packages\keras\layers\core.py", line 641, in call
    return self.function(x, **arguments)
  File "F:/Uppsala/SVAE/variationalAutoencoders.py", line 30, in sampling
    epsilon = K.random_normal(shape=(batch_size, latent_dim), mean=0.,
NameError: name 'batch_size' is not defined