ymcui commented on 20 Jan 2016
Hi, Heros
i have a small program that using the "dot merge".
it goes smoothly in training phase,but when i want to do some test with the model, the parameters cannot be loaded into, and it reported an error:
"AssertionError: Provided weight array does not match layer weights (12 layer params vs. 3 provided weights)"
Related codes are as follows (irrelevant parts are removed. ):
a1=Sequential()
a1.add(Embedding(100,input_length=maxlen))
a1.add(LSTM(100,return_sequence=True))
a2=Sequential()
a2.add(Embedding(100,input_length=maxlen))
a2.add(LSTM(100,return_sequence=True, go_backwards=True))
output: (n_sample, maxlen, dim)
a = Sequential()
a.add(Merge([a1,a2], mode='concat'))
b1=Sequential()
b1.add(Embedding(100,input_length=maxlen))
b1.add(LSTM(100,return_sequence=True))
b2=Sequential()
b2.add(Embedding(100,input_length=maxlen))
b2.add(LSTM(100,return_sequence=True, go_backwards=True))
output: (n_sample, dim)
b = Sequential()
b.add(Merge([b1,b2], mode='concat'))
b.add(TimeDistributedMerge(mode='sum'))
output: (n_sample, maxlen ,dim)
b_rep = Sequential()
b_rep.add(Merge([b1,b2], mode='concat'))
b_rep.add(TimeDistributedMerge(mode='sum'))
b_rep.add(RepeatVector(maxlen))
output: (n_sample, maxlen)
c = Sequential()
c.add(Merge([a,b_rep], mode='concat'))
c.add(TimeDistributedMerge(mode='sum'))
c.add(Dense(maxlen))
hope to output : (n_sample, dim)
res=Sequential()
res.add(Merge([b_rep,c], mode='dot', dot_axes=([1],[1]))) #also tried other merge mode, such as: res.add(Merge([b,c], mode='concat')) but it also report the error. so it seems that not the problem only with the DOT mode, but the Merge layer.
the following the is debug code
w = res.get_weights()
model.set_weights(w) #this will cause the error, also tried using save/load_weights, but do not solve the problem
i have tried 0.2.0, 0.3.0, 0.3.1 versions, but none of them can solve this problem.
Wish anyone can help!