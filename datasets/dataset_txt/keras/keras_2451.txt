luzai commented on 8 May 2017 â€¢
edited
In Keras 1: the shape of weight in Conv2D layer is of (filters,channels,height,weight), but in Keras 2: the shape is (kw,kh,num_channel,filters). I have fixed this bug, please ref mnist_net2net_fixed.py in gist:
https://gist.github.com/luzai/3336bd582650ff2c8c4ff97b1186afcd
Meanwhile, I find that model.get_layer(name) returns a None even if model.layers contain this layer. Please ref to get_layer_bug.py in gist.
Temporarily, I fix this bug by some tricks shown below, but may I ask why model.get_layer(name) returns a None?
if model.get_layer(name='conv2-deeper') is None:
 names2ind = {layer.name: ind for ind, layer in enumerate(model.layers)}
 ind = names2ind['conv2-deeper']
 model.layers[ind].set_weights(new_weights)
else:
 model.get_layer(name='conv2-deeper').set_weights(new_weights)