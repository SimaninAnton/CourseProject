shyamupa commented on 18 Jul 2016
I have a vector alpha of size (None,20) and Y of size (None,300,20). I can compute the dot product to get a a vector of size (None,300). However, the model summary shape does not agree with the expected shape. Code below should reproduce the error.
from keras.layers import Input, merge
from keras.models import Model
import numpy as np
import keras.backend as K


def get_R(X):
    Y, alpha = X[0], X[1]
    ans = K.T.batched_dot(Y, alpha)
    return ans


alpha_val = np.arange(200).reshape((10, 20))
Y_val = np.arange(60000).reshape((10, 300, 20))

Y = Input(shape=(300, 20))
alpha = Input(shape=(20,))

r = merge([Y, alpha], output_shape=(300, 1), name="r_", mode=get_R)

model_me = Model(input=[Y, alpha], output=r)

model_me.summary()

print(model_me.predict([Y_val, alpha_val]).shape)
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).