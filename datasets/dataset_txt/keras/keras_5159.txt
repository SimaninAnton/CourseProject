Contributor
joelthchao commented on 17 May 2016
I use K.batch_dot to speedup my code, however, encounter different behaviors in different backends. Although the codes claim to perform same. In theano_backend.py:
if axes is None:
    # behaves like tf.batch_matmul as default
    axes = [x.ndim - 1, y.ndim - 2]
This experiment shows the difference.
# Theano: 0.8.2 / TensorFlow: 0.8.0
# Perform matmul on the last two axis
a = K.variable(np.random.rand(3, 4, 5, 6))
b = K.variable(np.random.rand(3, 4, 6, 7))
result = K.eval(K.batch_dot(a, b))
# Theano: result has shape (3, 4, 5, 4, 7)
# TensorFlow: result has shape(3, 4, 5, 7) (Expected)
Anyone can tell me how to do this in Theano?