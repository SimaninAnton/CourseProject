abouchar-laurent commented on 25 May 2017
Hello,
I noticed that if I have an existing model and load weights from a model hdf5-file (saved with model.save()), if the layer sizes don't match in the two models, TensorFlow raises a ValueError while Theano overwrites the existing model silently. See attached code.
I'm running keras 2.0.4, tensorflow 1.1.0, theano 0.9.0.
Minimal example:
`from keras.layers import Input, Conv2D
from keras.models import Model
dummy model
def build(k=5):
input = Input((1,128,128))
lay = Conv2D(1,(k,k))(input)
return Model(input, lay)
Example
Build a model with 5x5 kernels and save it.
m = build(5)
m.save("model_5.hdf5")
Build a model with 7x7 kernels.
m = build(7)
Try loading the incompatible weights from the model file.
m.load_weights("model_5.hdf5")`
Output
TensorFlow output:
ValueError: Dimension 0 in both shapes must be equal, but are 7 and 5 for 'Assign' (op: 'Assign') with input shapes: [7,7,1,1], [5,5,1,1].
Theano completes silently and has overwritten model m with the content of model_5.hdf5.
Maybe a check could be included inside keras to avoid backend dependent behaviour? Theano's behaviour seems potentially very misleading to me.