michaelosthege commented on 30 Jan 2017 â€¢
edited
Sparse placeholder initialization by K.placeholder does not specify the shape parameter in either tensorflow or theano backends.
According to the tensorflow API docs the shape parameter is optional. (If the shape is not specified, you can feed a sparse tensor of any shape.)
But since Tensor shapes are tracked (through the _keras_shape) attribute, this leads to problems in the computation graph.
I noticed this when K.sum(t_sparse*t_dense) in a metric lead to unexpected behaviour.
The solution to this issue:
tensorflow_backend.py:347 and theano_backend.py:182
tf.sparse_placeholder(dtype, name=name, shape=numpy.array(shape).astype("int64"))
Note that the numpy.array type conversion to int64 is a workaround for tensorflow issue #6749
Note that the theano backend does not specify a shape/broadcast parameter.
Was the shape left out on purpose? If not I'll open a PR to fix it.
cheers