sk-g commented on 3 Apr 2018 â€¢
edited
keras/keras/backend/tensorflow_backend.py
Line 3012 in ef13db0
 len(output.get_shape()) - 1) 
I am working on something that requires me to compute categorical cross entropy on the predictions (output of model.predict or model.predict_on_batch) but the return of .predict methods is a numpy array whereas backend categorical_crossentropy requires tensors.
Here is a non reproducible piece of code that I am working on
for i in range(10):   
 sentence = np.array(arr[i])[None,:-1]
 #print(type(sentence[:-1].T),sentence.T.shape)
 prediction = model.predict_on_batch(sentence)
 prediction = np.argmax(prediction,axis = 2)
 cross_entropy = K.categorical_crossentropy(sentence,prediction) # error here.
 perplexity = K.pow(2.0,cross_entropy)
 print(perplexity)
For reference, here is the error that I get:
  File ".\rnn_lm.py", line 111, in perplexities
    cross_entropy = K.categorical_crossentropy(sentence,prediction)
  File "C:\Program Files\Python36\lib\site-packages\keras\backend\tensorflow_backend.py", line 3000, in categorical_crossentropy
    len(output.get_shape()) - 1,
AttributeError: 'numpy.ndarray' object has no attribute 'get_shape'
Edit:
The following seems to have fixed it but I am really not sure if this is right.
for i in range(10):
 sentence = np.array(arr[i])[None,:-1]
 prediction = np.argmax(model.predict_on_batch(sentence),axis = 2)
 sentence,prediction = K.variable(sentence),K.variable(prediction)
 cross_entropy = K.categorical_crossentropy(sentence,prediction)
 perplexity = K.pow(2.0,cross_entropy).eval(session = K.get_session())
 print(perplexity)
That fixed it.