valexandersaulys commented on 2 Jul 2015
I saw that Convolution1D layer requires the input to be a 4D tensor and not a 3D tensor of (nb_samples, nb_channels, sequence_length), but some tensor that gets wrapped by T.nnet.conv.conv2d(X, (nb_filter, stack_size, 1, filter_length)). See #272 for more on this post.
I have the following code that is throwing a weird error for me, after I format the input to be a 4D tensor. I thought that it might be best to leave it as a 2D input of (nb_samples, seq_length), but also throws an error as it expected the input to be 4D. Below is a snippet of my code.
nb_samples = x_train.shape[0]
nb_features = x_train.shape[1]
newshape = (nb_samples, 1, nb_features, 1)
print newshape
x_train = np.reshape(x_train, newshape).astype('float32')
print x_train.shape; print x_train;
model = Sequential()
model.add(Convolution1D(nb_filter=5,
stack_size=1,
filter_length=3,
init='uniform',
activation=activation_function_1))
model.add(MaxPooling1D(pool_length=3))
model.add(Convolution1D(nb_filter=5,
stack_size=1,
filter_length=3,
init='uniform',
activation=activation_function_1))
model.add(MaxPooling1D(pool_length=3))
model.add(Dense(input_dim=100,output_dim=1,init='uniform'))
model.add(Activation('linear'))
print "Now Building Model"
print "Model will run for " + str(num_epochs)
model.compile(loss='mean_squared_error',
optimizer=RMSprop(lr=LR)
)
print "Model Compiled! Now fitting ... "
model.fit(x_train,y_train,nb_epoch=num_epochs,batch_size=BATCH_SIZE)
And below is the error I receive.
Traceback (most recent call last):
File "keras_conv1d.py", line 103, in
model.fit(x_train,y_train,nb_epoch=num_epochs,batch_size=BATCH_SIZE)
File "/home/sensauratech/ml_vincent/keras/keras/models.py", line 241, in fit
loss = self._train(*ins)
File "/home/sensauratech/Theano/theano/compile/function_module.py", line 534, in call
allow_downcast=s.allow_downcast)
File "/home/sensauratech/Theano/theano/tensor/type.py", line 168, in filter
data.shape))
TypeError: ('Bad input argument to theano function with name "/home/sensauratech/ml_vincent/keras/keras
/models.py:127" at index 1(0-based)', 'Wrong number of dimensions: expected 4, got 2 with shape (1, 1)
.')
I am so lost as to what to do here. Not formatting the input to be 4D results in the following error instead.
Traceback (most recent call last):
File "keras_conv1d.py", line 95, in
model.fit(x_train,y_train,nb_epoch=num_epochs,batch_size=BATCH_SIZE)
File "/home/sensauratech/ml_vincent/keras/keras/models.py", line 241, in fit
loss = self._train(*ins)
File "/home/sensauratech/Theano/theano/compile/function_module.py", line 534, in call
allow_downcast=s.allow_downcast)
File "/home/sensauratech/Theano/theano/tensor/type.py", line 168, in filter
data.shape))
TypeError: ('Bad input argument to theano function with name "/home/sensauratech/ml_vincent/keras/keras
/models.py:127" at index 0(0-based)', 'Wrong number of dimensions: expected 4, got 2 with shape (1, 73
57).')
Any help would be much appreciated! I am at a loss of what to do. :)