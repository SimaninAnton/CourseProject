ricsonc commented on 25 Dec 2016 â€¢
edited
This code demonstrates the issue:
#!/usr/bin/env python

import tensorflow as tf
from keras.layers import *
from keras.models import Model

def foo():
    x = Input(shape = (2,))
    ones_vector = Input(tensor = tf.constant([[1.0],[1.0]])) #column vector
    sum_components = Lambda(lambda x : K.dot(x, ones_vector))
    y = sum_components(x)
    M = Model(input = x, output = y)
    print M.get_config() #this fails

x = Input(shape = (2,))
ones_vector = Input(tensor = tf.constant([[1.0],[1.0]])) #column vector
sum_components = Lambda(lambda x : K.dot(x, ones_vector))
y = sum_components(x)
M = Model(input = x, output = y)
print M.get_config() #this works

foo()
The resulting output:
http://pastebin.com/raw/EANrtZd0
As described in the title, the configuration of the model declared in the function does not print and causes an error, whereas the configuration of the model declared globally does print. The error message is
TypeError: can't pickle NotImplementedType objects (full error / stacktrace in the pastebin)
I have only had this problem with models involving K.dot inside a Lambda layer.
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).