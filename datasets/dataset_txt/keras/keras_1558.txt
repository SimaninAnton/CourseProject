talhadar commented on 29 Oct 2017 â€¢
edited
Hi,
I'm experiencing exceptions when i'm trying to save LSTM model in Keras.
I'm using keras 2.0.8 running on Tensorflow backend 1.2.0 with python 3.6
I tried upgrading Tensorflow to 1.3.0 still same problem
my model is created like this:
resnet50 = ResNet50(include_top=self.include_top, weights=self.weights, input_shape=self.input_shape)
  
resnet50.trainable = False
for layer in resnet50.layers:
 layer.trainable = False

K.set_learning_phase(0)

if self.sub_sequence_length != 0:
 seq_len = self.sub_sequence_length*self.crop_image_ratio
else:
 seq_len = self.seq_len*self.crop_image_ratio

input_layer = Input(batch_shape=(1, seq_len, ) + self.input_shape)
curr_layer = TimeDistributed(Lambda(lambda x: resnet50(x)))(input_layer)
target_shape=(seq_len, int(curr_layer.shape[2]*curr_layer.shape[3]*curr_layer.shape[4]))
curr_layer = Reshape(target_shape)(curr_layer)
curr_layer = BatchNormalization()(curr_layer)
curr_layer = LSTM(128, stateful=True)(curr_layer)
output_layer = Dense(8, activation="softmax")(curr_layer)

model = Model(inputs=input_layer, outputs=output_layer)
when i try to save the model using:
model.save("D:\\dataset\\model.hdf5")
i get the following error:
Traceback (most recent call last):
  File "train_resnet50_video.py", line 52, in <module>
    epochs, validation_steps, steps_per_epoch)
  File "U:\git\code311016\Resnet50Video.py", line 91, in fit_generator
    self.model.save("D:\\dataset\\model.hdf5")
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\site-packages\keras\engine\topology.py", line 2553, in save
    save_model(self, filepath, overwrite, include_optimizer)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\site-packages\keras\models.py", line 107, in save_model
    'config': model.get_config()
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\site-packages\keras\engine\topology.py", line 2394, in get_config
    return copy.deepcopy(config)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in <listcomp>
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in <listcomp>
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in <listcomp>
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 218, in _deepcopy_list
    y.append(deepcopy(a, memo))
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in _deepcopy_tuple
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 223, in <listcomp>
    y = [deepcopy(a, memo) for a in x]
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 297, in _reconstruct
    state = deepcopy(state, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 155, in deepcopy
    y = copier(x, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 243, in _deepcopy_dict
    y[deepcopy(key, memo)] = deepcopy(value, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 182, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File "C:\Users\koko\AppData\Local\conda\conda\envs\tf\lib\copy.py", line 306, in _reconstruct
    y.__dict__.update(state)
AttributeError: 'NoneType' object has no attribute 'update'