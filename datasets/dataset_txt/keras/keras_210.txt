maximilianley commented on 25 May 2019
System information
TensorFlow backend (yes / no): yes
TensorFlow version: 1.12.0
Keras version: 2.2.4
Python version: 3.6
I'm using the Docker image
Describe the current behavior
Hi,
I'm trying to run a model. I'm trying to train it with images and their corresponding labels, which I downloaded from the internet, with the purpose of it detecting and recognizing faces. Loading images and labels works, but when calling fit() it always gives an Exception saying that the shape of the array ( (11,) ) isn't the same as the expected shape of the final output layer ( (10,) ).
Code:
from keras.utils.np_utils import to_categorical
import createFaceRecModel
model1 = createFaceRecModel()
model1.compile(optimizer='rmsprop',loss='categorical_crossentropy', metrics=['accuracy'])
x_train, y_train, x_test, y_test = load_images()
y_train = to_categorical(y_train)
model1.fit(x_train, y_train, batch_size=batch_size, epochs=epochs, verbose=1, validation_data=(x_test, y_test));
Log:
File "/usr/local/lib/python3.6/site-packages/keras/engine/training.py", line 952, in fit
batch_size=batch_size)
File "/usr/local/lib/python3.6/site-packages/keras/engine/training.py", line 789, in _standardize_user_data
exception_prefix='target')
File "/usr/local/lib/python3.6/site-packages/keras/engine/training_utils.py", line 138, in standardize_input_data
str(data_shape))
ValueError: Error when checking target: expected flatten_1 to have shape (10,) but got array with shape (11,)
.
.
.
Here is the model I'm using (also from the Internet):
`
def createFaceRecModel():
nclasses=10

model = Sequential()
model.add(ZeroPadding2D((1,1),input_shape=(250, 250, 3)))
model.add(Convolution2D(64, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(64, (3, 3), activation='relu'))
model.add(MaxPooling2D((2,2), strides=(2,2)))
 
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(128, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(128, (3, 3), activation='relu'))
model.add(MaxPooling2D((2,2), strides=(2,2)))
 
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(256, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(256, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(256, (3, 3), activation='relu'))
model.add(MaxPooling2D((2,2), strides=(2,2)))
 
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(MaxPooling2D((2,2), strides=(2,2)))
 
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(ZeroPadding2D((1,1)))
model.add(Convolution2D(512, (3, 3), activation='relu'))
model.add(MaxPooling2D((2,2), strides=(2,2)))
 
model.add(Convolution2D(4096, (7, 7), activation='relu'))
model.add(Dropout(0.5))
model.add(Convolution2D(4096, (1, 1), activation='relu'))
model.add(Dropout(0.5))
model.add(Convolution2D(2622, (1, 1)))
model.add(Dense(nClasses, activation='softmax')) # output layer
model.add(Flatten())

return model`
Other info
My .csv file contains a total of 10 labels, and for each label 10 images. Each label is a number.
labels.txt
source
I have looked at the source code to try to find out what causes the exception, but no success.
Also when altering the .csv file I get some strange results. So for instance if I remove all Ariel_Sharon and all Donald_Rumsfeld images, such that there are no more labels "3" and "2", the exception still says it got an array of shape (11, ), even though now there are two labels less in total.
Similarly if I try just:
File Name,Label
Donald_Rumsfeld_0003.jpg,2
Ariel_Sharon_0001.jpg,3
the array is of shape (4, )
and with:
File Name,Label
Donald_Rumsfeld_0003.jpg,2
Ariel_Sharon_0001.jpg,3
Arnold_Schwarzenegger_0001.jpg,1
shape is still (4, )
and with:
File Name,Label
Donald_Rumsfeld_0003.jpg,2
Ariel_Sharon_0001.jpg,3
Arnold_Schwarzenegger_0001.jpg,1
George_W_Bush_0007.jpg,5
it is (6, )
I'm not sure if this behavior has got something to do with the problem, or if I'm missing something. I would be really grateful if someone could help me.
Thanks in advance