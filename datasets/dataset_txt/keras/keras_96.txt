Permafacture commented on 31 Jul 2019 â€¢
edited
KerasClassifier gives an object that cannot be fully used with Sk-Learn's Pipeline.
The following code works:
model = Pipeline(steps=[
    ('min_max_scale', MinMaxScaler()),
    ('estimator', SVC(probability=True))
])

model.set_params(**params)
model.fit(X, y > TRUTH_THRESH)

with open(model_file, 'wb') as fh:
    dill.dump(nn_model, fh)
If I use a KerasClassifier, fails on dill.dump with a maximum recursion error. I an post the exact traceback if needed but I'd need to obfuscated the paths.
nn_model = Pipeline(steps=[
     ('min_max_scale', MinMaxScaler()),
     ('estimator', model.KerasClassifier(build_fn=model.create_keras_model, epochs=40, batch_size=10, verbose=2))
 ])

nn_model.set_params(**nn_params)
nn_model.fit(X, y > TRUTH_THRESH)

with open(model_file, 'wb') as fh:
    dill.dump(nn_model, fh). # FAILS
System information
Mac OSX
using tensoflow backend
TensorFlow version: 1.5
Keras version: 2.2.0
Python version: 2.7
This is similar to #4274 however they were not using a Pipeline. One user said dill worked for them with a Pipeline but it did not for me.