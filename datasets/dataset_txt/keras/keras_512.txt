a6225301 commented on 22 Dec 2018 â€¢
edited
Hi, i want to add the batchsize features during the training and my code is as below, however, it comes to the error of 'AttributeError: 'Tensor' object has no attribute '_keras_history'' . Any solutions ? Thanks
import tensorflow as tf
from keras.layers.convolutional import (
    Conv2D,
    AveragePooling2D,
    MaxPooling2D,
    ZeroPadding2D
    
)
from keras.layers import Input, Dense, merge,BatchNormalization,Reshape,Flatten


input_1=Input(batch_shape=(10,img_rows,img_cols,1))

def feature_encoder(input_tensor):
    
    conv_1=Conv2D(64,(3,3))(input_tensor)
    max_1=MaxPooling2D((2,2))(conv_1)
    add_layer=tf.keras.backend.sum(max_1,0,keepdims=True)
    add_layer=tf.keras.layers.Reshape((int(add_layer.shape[1]),int(add_layer.shape[2]),
                                       int(add_layer.shape[3])))(add_layer)
    print (add_layer)
#     add_layer=max_1
    max_2=MaxPooling2D((2,2))(add_layer)
#     print (max_2.shape)  
    return max_2



def dense_layer(concat_layer):
    dense_1=Dense(8,activation='relu')(concat_layer)
    flatten_layer=Flatten()(dense_1)
    dense_2=Dense(1,activation='sigmoid')(flatten_layer) 
    return dense_2



feature_class_1=feature_encoder(input_1)
output=dense_layer(feature_class_1)



model=Model(inputs=input_1,outputs=output)

model.summary()

model.compile(optimizer='adam',loss='binary_crossentropy',metrics=['accuracy'])