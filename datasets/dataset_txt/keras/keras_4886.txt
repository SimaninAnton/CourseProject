pengx-scu commented on 28 Jun 2016
For a given data $X \in N*M$ (N is the data size, M is the input dim), the reconstruction of autoencoder and the corresponding representation (the output of encoder) are $Y$ and $H$. I hope to enforce some constraints on $H$, and my loss function is:
$(X-Y)^{2} + lambda*(H-CH)^{2}$, where C is a pre-defined matrix. My code is as follows:
X = Input(shape=(784,), name='X')
H = Dense(10, activation='tank')(X)
Y = Dense(784, activation='tanh')(H)
model = Model(input=X, output=Y)
model.compile(optimizer='sgd', loss=my_loss(C, H, 0.2)) # C is the given matrix, whose shape is N*N, where N is the size of X.
model.fit(X, X, nb_epoch=100, batch_size=32)
the custom loss function
def my_loss(C, H, lmd): # C is given, whose shape is N*N, where N is the size of X.
global_loss = K.mean(K.square(encoded - K.dot(C, encoded)), axis=-1)
def loss(y_true, y_pred):
local_loss = K.mean(K.square(y_true - y_pred), axis=-1)
return local_loss + lmd * global_loss
return loss
I got the following errors:
AssertionError: Theano Assert failed!
Apply node that caused the error: Assert{msg='Theano Assert failed!'}(Elemwise{Composite{(i0 * (Abs(i1) + i2 + i3))}}[(0, 2)].0, Elemwise{eq,no_inplace}.0)
Toposort index: 46
Inputs types: [TensorType(float32, matrix), TensorType(int8, scalar)]
Inputs shapes: [(32, 10), ()]
Inputs strides: [(40, 4), ()]
Inputs values: ['not shown', array(0, dtype=int8)]
Outputs clients: [[Elemwise{sub,no_inplace}(Assert{msg='Theano Assert failed!'}.0, InplaceDimShuffle{x,x}.0)]]
HINT: Re-running with most Theano optimization disabled could give you a back-trace of when this node was created. This can be done with by setting the Theano flag 'optimizer=fast_compile'. If that does not work, Theano optimizations can be disabled with 'optimizer=None'.
HINT: Use the Theano flag 'exception_verbosity=high' for a debugprint and storage map footprint of this apply node.
I guess that the obtained error may result from passing the fix-sized matrix C into my loss. Anybody can kindly help me to solve this issue? Thank you very much.