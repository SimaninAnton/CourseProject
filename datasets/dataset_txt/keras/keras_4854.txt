boyander commented on 2 Jul 2016
Hi!
I am trying to merge two models to train my deepnet. I'm using a function as the merge mode as defined in the API, but keras gave me the following error:
Exception: Output tensors to a Model must be Keras tensors. Found: Join.0
Here's the code i'm using:
def dotpMerge(inputs):
    plane_sweep_color = inputs[0]
    depth_probabilities = inputs[1]

    r_map = []
    g_map = []
    b_map = []
    for i in range(0, len(plane_sweep_color)):
        plane = plane_sweep_color[i]
        # Multiply R,G,B
        r_map.append(K.dot(plane[0], depth_probabilities[0]))
        g_map.append(K.dot(plane[1], depth_probabilities[1]))
        b_map.append(K.dot(plane[2], depth_probabilities[2]))

    final_r = r_map[0]
    final_g = g_map[0]
    final_b = b_map[0]
    for i in range(1, len(r_map)):
        final_r += r_map[i]
        final_g += g_map[i]
        final_b += g_map[i]

    return K.concatenate([final_r, final_g, final_b])

# Output dot product
color_model = Model(input=color_inputs, output=color_outputs)
select_model = Model(input=select_inputs, output=select_outputs)
output_towers_merge = merge([color_outputs, select_outputs], output_shape=(None, 8, 8, 3), mode=dotpMerge)

# Create the model
model = Model(color_inputs + select_inputs, output_towers_merge)
model.compile(optimizer='rmsprop',
              loss='categorical_crossentropy',
              metrics=['accuracy'])
Any ideas on what i'm doing wrong? is there any issue with keras related to this?
Thanks in advance.