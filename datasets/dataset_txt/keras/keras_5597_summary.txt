how to handle state of a stateful shared recurrent