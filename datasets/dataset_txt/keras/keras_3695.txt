rex-yue-wu commented on 13 Dec 2016
The padding size in pool2d is problematic in the sense that the pixels before and after pooling is NOT aligned.
Below is the code to decide the padding size of pool2d
def pool2d(x, pool_size, strides=(1, 1), border_mode='valid', dim_ordering='default', pool_mode='max'):
    if dim_ordering == 'default':
        dim_ordering = image_dim_ordering()
    if dim_ordering not in {'th', 'tf'}:
        raise Exception('Unknown dim_ordering ' + str(dim_ordering))
    assert pool_size[0] >= 1 and pool_size[1] >= 1

    if border_mode == 'same':
        w_pad = pool_size[0] - 2 if pool_size[0] > 2 and pool_size[0] % 2 == 1 else pool_size[0] - 1
        h_pad = pool_size[1] - 2 if pool_size[1] > 2 and pool_size[1] % 2 == 1 else pool_size[1] - 1
        padding = (w_pad, h_pad)
This setting of w_pad and h_pad works OK if strides = pool_size, but cause a center-shift if strides = (1,1). Below is a fix to ensure the pixels before and after pooling are aligned.
        w_pad = pool_size[0] // 2
        h_pad = pool_size[1] // 2