Writing your own batch generator