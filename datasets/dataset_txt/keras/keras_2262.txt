paultpa commented on 31 May 2017
I have tried to extract feature in the keras ( with tensorflow and as well as with theano background). But became not successful.
My code is :
`model = Sequential()
model.add(Convolution2D(64, 5, 5, input_shape=(3,img_width, img_height)))
model.add(LeakyReLU(alpha=.01))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Convolution2D(64, 2, 2))
model.add(LeakyReLU(alpha=.01))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Dropout(0.1))
model.add(Flatten())
model.add(Dense(128))
model.add(Activation('relu'))
model.add(Dense(8))
model.add(ActivityRegularization(l2=0.01))
model.add(Activation('relu'))
model.add(Dropout(0.25))
model.add(Dense(1))
model.add(Activation('sigmoid'))
model.load_weights("weights-improvement-01-0.79.hdf5")
rms =RMSprop( lr=0.0001)
model.compile(loss='binary_crossentropy',
optimizer=rms,
metrics=['accuracy'])
test_datagen = ImageDataGenerator(rescale=1./255)
test_generator = test_datagen.flow_from_directory(
test_data_dir,
target_size=(img_width, img_height),
batch_size=16,
class_mode='binary')
scores = model.evaluate_generator(test_generator, 237)
print("Accuracy = ", scores[1])
get_activations = theano.function([model.layers[0].input],
model.layers[3].output(train=False), allow_input_downcast=True)
activations = get_activations(test_generator)`
I have used fit_generator for train, validation and test cases.
I am getting accuracy correctly. But after that,I am getting an error when the code is trying to extract feature vector:
File "test.py", line 96, in <module> get_activations = theano.function([model.layers[0].input], model.layers[3].output(train=False), allow_input_downcast=True) TypeError: 'TensorVariable' object is not callable
I have also tried in the tensorflow mode, but the error is coming.
How can I do it In theano or in the tensorflow mode ( any of them or both). I have used fit_generator in my code for image augmentation.
Please help.