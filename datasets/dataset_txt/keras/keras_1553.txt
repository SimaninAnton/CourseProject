JustinhoCHN commented on 30 Oct 2017 •
edited
Hi guys, I have a issue about implementing fit_generator with multi-input-output, here's my problem detail:
" slice index 1 of dimension 0 out of bounds" when implementing multi-output fit_generator
why I receive this error? I think the shape of y_predict is the same as y_true (1, 4096), no matter I try to set y = (1, 4096) or (4096, 1) or something else, the error still rise. Any ideas would be greatful !
keras 2.0.5
tensorflow-gpu 1.3.0
ubuntu 16.04
update：
unbelievable, after I changed the batch_size=4, it worked!
def multi_input_generator(data_path):
    gen = image.ImageDataGenerator()
    trn_a = gen.flow_from_directory(data_path + 'a/', target_size=(224, 224), batch_size=4, class_mode=None, shuffle=False)
    trn_p = gen.flow_from_directory(data_path + 'p/', target_size=(224, 224), batch_size=4, class_mode=None, shuffle=False)
    trn_n = gen.flow_from_directory(data_path + 'n/', target_size=(224, 224), batch_size=4, class_mode=None, shuffle=False)
    while True:
        x1 = trn_a.next()
        x2 = trn_p.next()
        x3 = trn_n.next()
        y = np.zeros((4, 4)) # here, I modify it as (4, 4)
        yield ([x1, x2, x3], [y, y, y])
        #yield [x1[0], x2[0], x3[0]], [x1[1], x2[1], x3[1]]
mas_vgg.fit_generator(multi_input_generator(data_path), steps_per_epoch=2500,
                     epochs=1, verbose=1)
It start training now! I got the idea from this issue StackOverflow-Keras: network doesn't train with fit_generator()
Your batch size this way is 1. Try passing more elements per iteration to the model. This means having your next method return for example 32 elements. Maybe your intra class differences are too large to use 1 as a batch_size. – Thomas Pinetz Feb 4 at 19:08
But why is that? Why should I use batch_size > 1 instead of =1 ? Anyone can give some insight?