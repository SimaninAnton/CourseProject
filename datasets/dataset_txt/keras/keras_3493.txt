ijmbarr commented on 12 Jan 2017
I'm not sure if this is an issue with keras or with theano, but I'm having trouble with the following model:
from keras.models import Sequential
from keras.layers import GRU, TimeDistributed, Dense, Embedding, Activation
import numpy as np

import theano
theano.config.exception_verbosity = "high"
theano.config.optimizer = "None"


N_CHARACTERS = 12
seq_length = 1
batch_size = 64

model = Sequential()

model.add(Embedding(N_CHARACTERS, N_CHARACTERS,
                input_length=seq_length,
                batch_input_shape=(
                    batch_size, seq_length),
                mask_zero=True,
                weights=[np.diag(np.ones(N_CHARACTERS))],
                trainable=False))

model.add(GRU(128,
              return_sequences=True,
              stateful=True))

model.add(Activation("tanh"))

model.add(
    TimeDistributed(Dense(N_CHARACTERS, activation='softmax')))

model.compile(optimizer='rmsprop', loss='categorical_crossentropy')
When I run
test_input = np.array([[1 for _ in range(seq_length)] for _ in range(batch_size)])
model.predict(test_input)
I get the following error
ValueError: Input dimension mis-match. (input[0].shape[0] = 32, input[1].shape[0] = 64)
What's interesting is that if I set batch_size to 32 or less, then the model works fine, but as soon as it's increased beyond that, I get this error. Am I doing something wrong?
Thanks
Iain