fingerecho commented on 27 Dec 2018
I try to build a network model using cnn. The code works well in my local area.
`
def generate_model_then_predict_model(model_name:str,epochs=2):
train_size = len(os.listdir(DOG_SUMU_DIR)) + len(os.listdir(DOG_JINMAO_DIR))
train_fi = len(os.listdir(DOG_JINMAO_DIR))
trains = np.empty((train_size,DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3),dtype="float32")
labels = np.empty((train_size),dtype="int32")

for ind in range(len(os.listdir(DOG_JINMAO_DIR))):
 img = Image.open(os.path.join(DOG_JINMAO_DIR, os.listdir(DOG_JINMAO_DIR)[ind]))
 arr = np.asarray(img,dtype="float32")
 trains[ind,:,:,:] = arr.reshape(DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3) # (460,585,3)
 labels[ind] = 0

for ind in range(len(os.listdir(DOG_SUMU_DIR))):
 img = Image.open(os.path.join(DOG_SUMU_DIR, os.listdir(DOG_SUMU_DIR)[ind]))#tf.image.decode_jpeg(img,channels=3)
 arr = np.asarray(img,dtype="float32")
 trains[ind+train_fi,:,:,:] = arr.reshape(DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3)
 labels[ind+train_fi] = 1

write_log(str(labels),file=log_file)

model = keras.Sequential([
 keras.layers.Flatten(input_shape=(DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3)),
 keras.layers.Dense(2,activation=tf.nn.relu,input_shape=(DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3)),
 keras.layers.Dense(2,activation=tf.nn.relu),
 keras.layers.Dense(2,activation=tf.nn.softmax)
])

model.compile(
 optimizer =tf.train.AdamOptimizer(),
 loss = 'sparse_categorical_crossentropy',
 metrics = ['accuracy']
)

model.fit(trains,labels,epochs=epochs,steps_per_epoch=20)
model.save(test_6_MODEL+"/"+model_name)
predict_dog(model,test_jinmao)
But when I use a CentOS 7.3 Ali Cloud server, hint the following error
-> if name == 'main':
(Pdb) n
/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py(132)()
-> generate_model_then_predict_model("1915_01.h5",10)
(Pdb) n
MemoryError
/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py(132)()
-> generate_model_then_predict_model("1915_01.h5",10)
(Pdb) n
--Return--
/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py(132)()->None
-> generate_model_then_predict_model("1915_01.h5",10)
(Pdb) n
MemoryError
(1)()->None
(Pdb) n
--Return--
(1)()->None
(Pdb) n
Traceback (most recent call last):
File "/usr/local/python3/lib/python3.6/pdb.py", line 1667, in main
pdb._runscript(mainpyfile)
File "/usr/local/python3/lib/python3.6/pdb.py", line 1548, in _runscript
self.run(statement)
File "/usr/local/python3/lib/python3.6/bdb.py", line 434, in run
exec(cmd, globals, locals)
File "", line 1, in
File "/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py", line 132, in
generate_model_then_predict_model("1915_01.h5",10)
File "/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py", line 97, in generate_model_then_predict_model
trains = np.empty((train_size,DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3),dtype="float32")
MemoryError
Uncaught exception. Entering post mortem debugging
Running 'cont' or 'step' will restart the program
/srv/dog-face-identify/dog-face-check/cnn/_test_cnn_6.py(97)generate_model_then_predict_model()
-> trains = np.empty((train_size,DOG_PIC_WIDTH,DOG_PIC_HEIGHT,3),dtype="float32")
`