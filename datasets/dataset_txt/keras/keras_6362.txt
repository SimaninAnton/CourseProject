Contributor
tzachar commented on 1 Dec 2015
Custom objectives are not supported.
Check the following unit test, which throws an exception on the current code:
Added a pull request to correct: #1025
from keras.models import Sequential, model_from_json
from keras.layers.core import Dense
from keras.optimizers import SGD


def my_mse(y, pred):
    import theano.tensor as T
    return T.mean((y - pred) ** 2)


def create_model():
    model = Sequential()
    model.add(Dense(100, input_shape=(100,)))
    return model

model = create_model()
sgd = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
model.compile(loss=my_mse, optimizer=sgd)

open('/tmp/json_model', 'w').write(model.to_json())

model = model_from_json(open('/tmp/json_model').read(), custom_objects={'my_mse': my_mse})
throws:
Traceback (most recent call last):
  File "check_custom_objects.py", line 22, in <module>
    model = model_from_json(open('/tmp/json_model').read(), custom_objects={'my_mse': my_mse})
  File "/tmp/keras/keras/models.py", line 122, in model_from_json
    return model_from_config(config, custom_objects=custom_objects)
  File "/tmp/keras/keras/models.py", line 148, in model_from_config
    model.compile(loss=loss, optimizer=optimizer, class_mode=class_mode, theano_mode=theano_mode)
  File "/tmp/keras/keras/models.py", line 352, in compile
    self.loss = objectives.get(loss)
  File "/tmp/keras/keras/objectives.py", line 67, in get
    return get_from_module(identifier, globals(), 'objective')
  File "/tmp/keras/keras/utils/generic_utils.py", line 12, in get_from_module
    raise Exception('Invalid ' + str(module_name) + ': ' + str(identifier))
Exception: Invalid objective: my_mse