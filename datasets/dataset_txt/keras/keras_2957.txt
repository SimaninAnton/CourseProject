xidongbo commented on 16 Mar 2017
in the function 'sequences_to_matrix':
for j, c in list(counts.items()): if mode == 'count': X[i][j] = c elif mode == 'freq': X[i][j] = c / len(seq) elif mode == 'binary': X[i][j] = 1 elif mode == 'tfidf': # Use weighting scheme 2 in # https://en.wikipedia.org/wiki/Tf%E2%80%93idf tf = 1 + np.log(c) idf = np.log(1 + self.document_count / (1 + self.index_docs.get(j, 0))) X[i][j] = tf * idf else: raise ValueError('Unknown vectorization mode:', mode)
‘X[i][j]‘ will result the first column of the output matrix is all zero. Because 0 is a reserved index that won't be assigned to any word, j must >=1. So they all should be X[i][j-1]. Thus the last column of the output matrix is all zero ,because the code 'i>= nb_words'. It should be 'i>nb_words'. So delete the '=' in two code lines 152 and 197.
Because I use keras1.2.0 , I don't know whether other versions have fixed the bug.
Thanks .