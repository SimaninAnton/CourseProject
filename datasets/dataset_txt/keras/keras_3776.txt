Contributor
jmhessel commented on 4 Dec 2016 â€¢
edited
I think that the tensorflow version of K.batch_dot is inconsistent with the documentation. Consider the following script:
import keras.backend as K
import numpy as np

x = K.placeholder(shape=(None,100))
y = K.placeholder(shape=(None,100))
res = K.batch_dot(x,y,axes = 1)
f = K.function([x,y], [res])

xv = np.random.random(size = (32, 100))
yv = np.random.random(size = (32, 100))

dots = []
for i in range(32):
    dots.append(np.dot(xv[i,:], yv[i,:]))
resv = f([xv,yv])[0].flatten()
dots = np.array(dots)
print(resv.shape)
print(dots.shape)
assert np.allclose(resv, dots)
This runs fine with the theano backend, but the assertion fails for the tensorflow backend.
>>> import tensorflow as tf
>>> tf.__version__
'0.12.0-rc0
>>> import theano
>>> theano.__version__
'0.9.0dev4.dev-ad1310c88830ed96119194c4f2da22b9b37c7622'
>>> keras.__version__
'1.1.2'
Please make sure that the boxes below are checked before you submit your issue. Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).