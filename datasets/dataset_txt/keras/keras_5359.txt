francis7999 commented on 24 Apr 2016 â€¢
edited
As a beginner to DL and keras, I'm trying to build a system with timedistributed CNN + LSTM to classify videos of variable lengths, and I want to use a batch size of one , which means I feed the network one video per batch. between the timedistributed CNNs and LSTMs , I use a Reshape layer to change tensor's shape from (batch_size, video_length, number_of_kernels, feature_map_size, feature_map_size) to (batch_size, video_length, number_of_kernels * feature_map_size * feature_map_size) to form a sequence for LSTMs to classify. But Reshape seems to not work some how, when I run code like below, I got an error like this:
Traceback (most recent call last):
  File "CNN+LSTM_train+test_batchsize_one.py", line 89, in <module>
    model.add(Reshape((-1, 16)))
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/models.py", line 139, in add
    output_tensor = layer(self.outputs[0])
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/engine/topology.py", line 485, in __call__
    self.add_inbound_node(inbound_layers, node_indices, tensor_indices)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/engine/topology.py", line 543, in add_inbound_node
    Node.create_node(self, inbound_layers, node_indices, tensor_indices)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/engine/topology.py", line 148, in create_node
    output_tensors = to_list(outbound_layer.call(input_tensors[0], mask=input_masks[0]))
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/layers/core.py", line 223, in call
    target_shape = self.get_output_shape_for(input_shape)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/layers/core.py", line 206, in get_output_shape_for
    return (input_shape[0],) + self._fix_unknown_dimension(input_shape[1:], self.target_shape)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/keras/layers/core.py", line 195, in _fix_unknown_dimension
    original = np.prod(input_shape, dtype=int)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/numpy/core/fromnumeric.py", line 2492, in prod
    out=out, keepdims=keepdims)
  File "/home/zhounan/anaconda2/lib/python2.7/site-packages/numpy/core/_methods.py", line 35, in _prod
    return umr_prod(a, axis, dtype, out, keepdims)
TypeError: long() argument must be a string or a number, not 'NoneType'
Here is my code about my model, hopeing some would like to help me out of this problem ^-^, thanks in advance
#define our time-distributed model
model = Sequential()
model.add(TimeDistributed(Convolution2D(4, 3, 3, border_mode= 'valid'), input_shape=(None, 1,img_size, img_size)))
model.add(Activation('relu'))
model.add(TimeDistributed(Convolution2D(8, 3, 3, border_mode= 'valid')))
model.add(TimeDistributed(AveragePooling2D(pool_size=(2, 2),border_mode= 'valid')))
model.add(Activation('relu'))
model.add(TimeDistributed(Convolution2D(16, 2, 2, border_mode= 'valid')))
model.add(Activation('relu'))
model.add(Reshape((-1, 16)))
#In Reshape(), The second parameter represents the features extracted by CNNs, 
#the first paremeter represents input video's length, 
#it's set -1 because I don't know the length of input video
#model.add(LSTM(output_dim=100,return_sequences=True))
model.add(LSTM(output_dim=20,return_sequences=False))
model.add(Dropout(.5))
model.add(Dense(256))
model.add(Activation('relu'))
model.add(Dense(14))
model.add(Activation('softmax'))
Please make sure that the boxes below are checked before you submit your issue. Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).