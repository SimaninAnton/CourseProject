Contributor
bzamecnik commented on 1 May 2018 â€¢
edited
Analogous to CuDNN RNN nested in Bidirectional: #8908
In addition same bug as in: Convert h5py Dataset to np.array before preprocess_weights_for_loading (#9662)
I've already wrote a fix and I'll post a detailed description soon.
ValueError: Shapes must be equal rank, but are 2 and 1 for 'Assign_732' (op: 'Assign') with input shapes: [2,384], [768].
Bias is not converted from CuDNNGRU shape (2unitsgates) to CuDNN-compatible, GRU(reset_after=True shape (2, units*gates). The reason that nesting to Model is missing in keras.topology.saving.preprocess_weights_for_loading().
We can do the same as in the block for converting from Keras 1 model.
In addition weights[2] is H5 dataset:
biases = weights[2].reshape((2, -1) if from_cudnn else -1)
and fails with:
'Dataset' object has no attribute 'reshape'
Fix is:
biases = np.array(weights[2]).reshape((2, -1) if from_cudnn else -1)