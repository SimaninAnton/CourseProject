selimelawwa commented on 19 Apr 2018 â€¢
edited
I am loading a pre-trained model, removing last layer using model.layers.pop() then when I add a final layer, then I save the new model.
the code is available https://github.com/selimelawwa/Speaker_Verification
This is the part where I load a pre-trained model , pop last layer, then add a new last layer, train it then save
model = load_model('model-8april.h5')
model.load_weights('model-weights-8april.h5')

model.layers.pop()
model.add(Dense(num_classes, activation='sigmoid', name='addedDense'))
model.summary()
sgd = keras.optimizers.SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
model.compile(loss=keras.losses.binary_crossentropy,
                  optimizer='adamax',
                  metrics=['binary_accuracy'])
model.fit(X_train, y_train_hot,batch_size=batch_size,epochs=epochs, verbose=verbose, validation_data=(X_valid, y_valid_hot))

model.save('enroll-model.h5')
model.save_weights('enroll-model-weights.h5')
After this when I try to re-load the newly saved model
newmodel = load_model('enroll-model.h5')

newmodel.load_weights('enroll-model-weights.h5')
I get this error
File "D:\Anaconda3\envs\Tensorflow\lib\site-packages\tensorflow\python\framework\common_shapes.py", line 676, in _call_cpp_shape_fn_impl
raise ValueError(err.message)
ValueError: Dimension 0 in both shapes must be equal, but are 256 and 250 for 'Assign_138' (op: 'Assign') with input shapes: [256,2], [250,2].