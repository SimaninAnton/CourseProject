neuralyzer commented on 14 Mar 2016
The keras.backend.theano_backend.clip function is not doing the same thing as theano.tensor.clip. Keras' clip version expects as parameter a tensor followed by 2 numbers. Theano's clip can deal with three tensors and does elementwise clip. The problem arises as Keras checks if max_value < min_value. However, if max_value and min_value are theano symbolic or shared variable this breaks since such a comparison cannot always be cast to a boolean.
Example
import scipy as sp
import theano
min = theano.shared(sp.rand(10,10))
max = theano.shared(sp.rand(10,10))
x = theano.shared(sp.rand(10,10))
The following works:
theano.tensor.clip(a, min, max)
However
keras.backend.theano_backend.clip(a, min, max)
throws an error.
I guess the clip function could look like
def clip(x, min_value, max_value):
    max_value = T.maximum(min_value, max_value)
    return T.clip(x, min_value, max_value)
this should also work with float input.
1