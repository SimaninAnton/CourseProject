MartijnL commented on 3 May 2016 â€¢
edited
Hi,
I think I have a problem with a simple solution, however I cannot find it.
I have the following fully convolutional network, which worked before I updated to the new Keras*
    # A network named 'model' is initialized before calling this network.
    model2 = Sequential()

    model2.add(Convolution2D(64, 3, 3, weights=model.layers[1].get_weights(), 
                             input_shape=(img_channels, None, None))) #img_channels=1
    model2.add(Activation('relu'))
    model2.add(MaxPooling2D((2,2), strides=(2,2)))

    model2.add(Convolution2D(128, 3, 3, weights=model.layers[4].get_weights()))
    model2.add(Activation('relu'))
    model2.add(MaxPooling2D((2,2), strides=(2,2)))

    model2.add(Convolution2D(256, 3, 3, weights=model.layers[7].get_weights()))
    model2.add(Activation('relu'))
    model2.add(MaxPooling2D((2,2), strides=(2,2)))

    model2.add(Convolution2D(4096, 6, 6, activation='relu'))
    model2.add(Dropout(0.5))
    model2.add(Convolution2D(4096, 1, 1, activation='relu'))
    model2.add(Dropout(0.5))
    model2.add(Convolution2D(7, 1, 1))
    model2.add(Flatten())
    model2.add(Activation('sigmoid'))

    sgd = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
    model2.compile(optimizer=sgd, loss='categorical_crossentropy')
Because the input shape contains None, None, I could use any size images as input. However, now after the update, I get the following error when trying to train with this network:
Exception: The shape of the input to "Flatten" is not fully defined (got (7, None, None). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.
What do I have to change in order to make it work again?
* EDIT: By reverting back to an older version I found out this is not a problem with Keras 1.x, but rather with upgrading from 0.3.2 tot 0.3.3.