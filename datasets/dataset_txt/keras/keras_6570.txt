sergeyf commented on 11 Oct 2015
Below is my sequence to sequence model (thanks to various folks throughout the forum for helping me assemble this with all of your informative posts). I have 1 dimensional time series, and they are no longer than length 50.
input_dim = 1
seqlen = 50
hidden_size = 16
print('Build model...')
model = Sequential()
model.add(LSTM(input_dim=input_dim, output_dim=hidden_size, return_sequences=False))
model.add(Dense(hidden_size))
model.add(Activation('relu'))
model.add(RepeatVector(seqlen))
model.add(LSTM(hidden_size, return_sequences=True))
model.add(TimeDistributedDense(output_dim=input_dim, activation="linear"))

optimizer = rmsprop(lr=0.01, clipnorm=10)
model.compile(optimizer=optimizer, loss='mse')
This compiles and trains well. The time-series are reproduced very well.
However, I would like to also have masking in the input for the purpose of filling in the inputs. So now I'd like to add a Masking layer, like so:
print('Build model...')
hidden_size = 16
model = Sequential()
model.add(Masking(mask_value=0))
model.add(LSTM(input_dim=input_dim, output_dim=hidden_size, return_sequences=False))
model.add(Dense(hidden_size))
model.add(Activation('relu'))
model.add(RepeatVector(seqlen))
model.add(LSTM(hidden_size, return_sequences=True))
model.add(TimeDistributedDense(output_dim=input_dim, activation="linear"))

optimizer = rmsprop(lr=0.01, clipnorm=10)
model.compile(optimizer=optimizer, loss='mse')
And this provides the traceback:
Build model...
Traceback (most recent call last):

  File "<ipython-input-9-c9d8834ae358>", line 5, in <module>
    model.add(LSTM(input_dim=input_dim, output_dim=hidden_size, return_sequences=False))

  File "build\bdist.win-amd64\egg\keras\layers\containers.py", line 37, in add
    self.layers[-1].set_previous(self.layers[-2])

  File "build\bdist.win-amd64\egg\keras\layers\core.py", line 32, in set_previous
    assert self.input_ndim == len(layer.output_shape), "Incompatible shapes: layer expected input with ndim=" +\

  File "build\bdist.win-amd64\egg\keras\layers\core.py", line 82, in output_shape
    return self.input_shape

  File "build\bdist.win-amd64\egg\keras\layers\core.py", line 65, in input_shape
    raise Exception('Layer is not connected. Did you forget to set "input_shape"?')

Exception: Layer is not connected. Did you forget to set "input_shape"
Any ideas on how to add Masking to the model? Thanks very much.