gattia commented on 12 Mar 2017 â€¢
edited
I am trying to train a segmentation network. I am running into issues when trying to use image augmentation. Below is attached my function that sets the generator, fits it (though I dont think I really need to), it then zips the label and image generators.
It is when trying to zip these that my program hangs and never moves on. Playing around it seems that it has to do with the flow function. Whenever I call the flow function it just runs on it's own indefinitely.
I have made some changes to the image.py file to allow for 3D manipulations, but I have check/doublechecked / even gone back and re-implemented my changes in a clean copy of image.py to make sure I wasn't changing anything that should effect this process.
image.py.zip
I've attached a zip of my updated image.py. Most of the functions at the start are left as the 2D counterparts, its within the random_transform that most of the 3D manipulations are located.
Does anyone have any thoughts?
Thanks,
Anthony.
def train(dataLocation):
    print('-'*30)
    print('Creating and compiling model...')
    print('-'*30)
    ## Augmentation Stuff
    seed = 1
    image_datagen = ImageDataGenerator(rotation_range=15, horizontal_flip=True, order=3) 
    mask_datagen = ImageDataGenerator(rotation_range=15, horizontal_flip=True, order=0)

    image_datagen.fit(trainImages2, augment=True, seed=seed) 
    mask_datagen.fit(trainLabels2, augment=True, seed=seed)
    print('start image generator')
    image_generator = image_datagen.flow(trainImages2, batch_size=2, seed=seed)
    print('start label generator')
    mask_generator = mask_datagen.flow(trainLabels2, batch_size=2, seed=seed)
    print('start zip')
    train_generator = zip(image_generator, mask_generator)
    print('done zipping? ')
    
    print('loadingModelweights')
    #Get and fit model 
    model = get_vnet()
    model.load_weights(dataLocation + 'vNet_Simplified_Femur_March_5_2017_UpdatingWeights_fromTibia.hdf5')
    model_checkpoint = ModelCheckpoint(dataLocation + 'vNet_Simplified_Femur_March_11_2017_UpdatingWeights_fromTibia_Augmentation.hdf5', monitor='loss', save_best_only=True)
    
    print('-'*30)
    print('Fitting model...')
    print('-'*30)
    model.fit_g

train(dataLocation)
3