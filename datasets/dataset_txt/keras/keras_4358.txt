Tharu87 commented on 18 Sep 2016
Hi,
I have a CNN model with two merged branches. The model compiles and trains without error. However when I save the model and load the saved model it gives the following error:
Traceback (most recent call last):
File "\eclipse\workspace\AKEOS\position_cnn\main_classify.py", line 283, in
final_model = load_model("causal_model.h5")
File "\Anaconda2\lib\site-packages\keras\models.py", line 128, in load_model
model = model_from_config(model_config, custom_objects=custom_objects)
File \Anaconda2\lib\site-packages\keras\models.py", line 177, in model_from_config
return layer_from_config(config, custom_objects=custom_objects)
File "\Anaconda2\lib\site-packages\keras\utils\layer_utils.py", line 36, in layer_from_config
return layer_class.from_config(config['config'])
File "\Anaconda2\lib\site-packages\keras\models.py", line 1016, in from_config
merge = Merge.from_config(first_layer_config)
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 1465, in from_config
return super(Merge, cls).from_config(config)
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 929, in from_config
return cls(**config)
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 1180, in init
node_indices, tensor_indices)
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 1203, in _arguments_validation
layer_output_shape = layer.get_output_shape_at(node_indices[i])
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 660, in get_output_shape_at
'output shape')
File "\Anaconda2\lib\site-packages\keras\engine\topology.py", line 636, in _get_node_attribute_at_index
'and thus has no defined ' + attr_name + '.')
Exception: The layer has never been called and thus has no defined output shape.
The code for the CNN model is as below:
    text_branch = Sequential()
    text_branch.add(Embedding(vobabsize, embedding_size, input_length=data_len,weights=[U]))

    e1pos_branch = Sequential()
    e1pos_branch.add(Embedding(max_pos+1, dim_pose, input_length=data_len,weights=[U_Pose]))

    e2pos_branch = Sequential()
    e2pos_branch.add(Embedding(max_pos+1, dim_pose, input_length=data_len,weights=[U_Pose]))

    merged_m = Merge([text_branch, e1pos_branch], mode='concat')
    merged = Merge([merged_m, e2pos_branch], mode='concat')       

    final_model = Sequential()
    final_model.add(merged)      
    final_model.add(Convolution1D(nb_filter=num_filters,
                             filter_length=filter_size,
                             border_mode='valid',
                             activation='relu',
                             subsample_length=1))
    final_model.add(MaxPooling1D(pool_length=poolsize, stride=None, border_mode='valid'))
    flatten = Flatten(name="flatten")
    final_model.add(flatten)
    final_model.add(Dense(3))

    final_model.add(Activation('softmax'))
what could be the cause of the error?
Thanks in advance!