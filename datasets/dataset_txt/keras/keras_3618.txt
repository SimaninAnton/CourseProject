asif-shakeel commented on 22 Dec 2016 â€¢
edited
I ran the training of inceptionv3 on keras:
import keras
import tensorflow
from keras.applications.inception_v3 import InceptionV3
from keras.preprocessing import image
from keras.models import Model
from keras.layers import Dense, GlobalAveragePooling2D
from keras import backend as K
train_datagen = image.ImageDataGenerator(
rescale=1./255,
shear_range=0.2,
zoom_range=0.2,
horizontal_flip=True)
test_datagen = image.ImageDataGenerator(rescale=1./255)
train_generator = train_datagen.flow_from_directory(
'/home/asif/Documents/work/tensorflow/flower_train',
target_size=(299, 299),
batch_size=64,
save_to_dir='/home/asif/Documents/work/tensorflow/flower_sv',
class_mode='categorical')
validation_generator = test_datagen.flow_from_directory(
'/home/asif/Documents/work/tensorflow/flower-val',
target_size=(299, 299),
batch_size=64,
save_to_dir='/home/asif/Documents/work/tensorflow/flower-val_sv',
class_mode='categorical')
base_model = InceptionV3(weights='imagenet', include_top=False,input_shape=(299,299,3))
x = base_model.output
x = GlobalAveragePooling2D()(x)
x = Dense(1024, activation='relu')(x)
predictions = Dense(5, activation='softmax')(x)
model = Model(input=base_model.input, output=predictions)
for layer in base_model.layers:
layer.trainable = False
model.compile(optimizer='rmsprop', loss='categorical_crossentropy', metrics=['accuracy'])
model.fit_generator(
generator=train_generator,
samples_per_epoch=2304,
nb_epoch=20,
validation_data=validation_generator,
nb_val_samples=1152)
for i, layer in enumerate(base_model.layers):
print(i, layer.name)
for layer in model.layers[:172]:
layer.trainable = False
for layer in model.layers[172:]:
layer.trainable = True
from keras.optimizers import SGD
model.compile(optimizer=SGD(lr=0.0001, momentum=0.9), loss='categorical_crossentropy', metrics=['accuracy'])
model.fit_generator(
train_generator,
samples_per_epoch=2304,
nb_epoch=20,
validation_data=validation_generator,
nb_val_samples=1152)
I get the following error at the end of training inceptionv3 model on keras.
val_loss: 0.2445 - val_acc: 0.9502Exception in thread Thread-42:
Traceback (most recent call last):
File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
self.run()
File "/usr/lib/python2.7/threading.py", line 754, in run
self.__target(*self.__args, **self.__kwargs)
File "/home/ashakeel/tensorflow/keras/keras/engine/training.py", line 409, in
data_generator_task
generator_output = next(generator)
File "/home/ashakeel/tensorflow/keras/keras/preprocessing/image.py", line 693,
in next
x = self.image_data_generator.random_transform(x)
File "/home/ashakeel/tensorflow/keras/keras/preprocessing/image.py", line 403,
in random_transform
fill_mode=self.fill_mode, cval=self.cval)
File "/home/ashakeel/tensorflow/keras/keras/preprocessing/image.py", line 109, in apply_transform
final_offset, order=0, mode=fill_mode, cval=cval) for x_channel in x]
AttributeError: 'NoneType' object has no attribute 'interpolation'