Contributor
jmhessel commented on 25 Apr 2017
I have a model involving sparse tensors that runs in the theano backend but not in the keras backend. In particular, the issue might be with the tensorflow concatenation. I use the functional interface's concatenate function, and in theano it works. However, in tensorflow is does not. The line that seems to be causing trouble is
all_enc = concatenate([enc1, enc2, enc3])
and here is the stack trace
File "/usr/local/lib/python2.7/dist-packages/Keras-2.0.3-py2.7.egg/keras/layers/merge.py", line 508, in concatenate
    return Concatenate(axis=axis, **kwargs)(inputs)
  File "/usr/local/lib/python2.7/dist-packages/Keras-2.0.3-py2.7.egg/keras/engine/topology.py", line 585, in __call__
    output = self.call(inputs, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/Keras-2.0.3-py2.7.egg/keras/layers/merge.py", line 283, in call
    return K.concatenate(inputs, axis=self.axis)
  File "/usr/local/lib/python2.7/dist-packages/Keras-2.0.3-py2.7.egg/keras/backend/tensorflow_backend.py", line 1605, in concatenate
    return tf.concat([to_dense(x) for x in tensors], axis)
  File "/usr/local/lib/python2.7/dist-packages/Keras-2.0.3-py2.7.egg/keras/backend/tensorflow_backend.py", line 243, in to_dense
    return tf.sparse_tensor_to_dense(tensor)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/sparse_ops.py", line 692, in sparse_tensor_to_dense
    name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/sparse_ops.py", line 557, in sparse_to_dense
    name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/gen_sparse_ops.py", line 1032, in _sparse_to_dense
    validate_indices=validate_indices, name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/op_def_library.py", line 768, in apply_op
    op_def=op_def)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py", line 2336, in create_op
    original_op=self._default_original_op, op_def=op_def)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow/python/framework/ops.py", line 1228, in __init__
    self._traceback = _extract_stack()

InvalidArgumentError (see above for traceback): indices[1] = [0,10365] is out of order
         [[Node: concatenate_1/SparseToDense = SparseToDense[T=DT_FLOAT, Tindices=DT_INT64, validate_indices=true, _device="/job:localhost/replica:0/task:0/cpu:0"](_recv_input_2/indices_0, _recv_input_2/shape_0, _recv_input_2/values_0, concatenate_1/SparseToDense/default_value)]]
I can put more details if that would be helpful. It's possible I simply coded something wrong, but all of this does work in the theano backend.
Please make sure that the boxes below are checked before you submit your issue. If your issue is an implementation question, please ask your question on StackOverflow or join the Keras Slack channel and ask there instead of filing a GitHub issue.
Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
1