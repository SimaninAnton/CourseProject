RaffEdwardBAH commented on 21 Sep 2016
Please make sure that the boxes below are checked before you submit your issue. Thank you!
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
[] Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
There seems to be an issue applying models trained with version 1.0.4 of keras, that use batch norm, with version 1.0.9+. Depending on the version of theano I get different errors. Not sure what is happening, but interested if other shave observed anything similar. I get the below error when using the head version of Theano, and oddly isn't fixed by taking the max of epsilon and 1e-5.
/usr/local/lib/python2.7/dist-packages/keras/layers/normalization.pyc in call(self, x, mask)
    136                 x_normed, mean, std = K.normalize_batch_in_training(
    137                     x, self.gamma, self.beta, reduction_axes,
--> 138                     epsilon=self.epsilon)
    139 
    140                 self.updates = [K.moving_average_update(self.running_mean, mean, self.momentum),

/usr/local/lib/python2.7/dist-packages/keras/backend/theano_backend.pyc in normalize_batch_in_training(x, gamma, beta, reduction_axes, epsilon)
    413     normed = batch_normalization(x, broadcast_mean, broadcast_var,
    414                                  broadcast_beta, broadcast_gamma,
--> 415                                  epsilon)
    416     return normed, mean, var
    417 

/usr/local/lib/python2.7/dist-packages/keras/backend/theano_backend.pyc in batch_normalization(x, mean, var, beta, gamma, epsilon)
    426         try:
    427             return theano.sandbox.cuda.dnn.dnn_batch_normalization_test(x, gamma, beta, mean, var,
--> 428                                                                         'spatial', epsilon)
    429         except AttributeError:
    430             pass

/usr/local/lib/python2.7/dist-packages/theano/sandbox/cuda/dnn.pyc in dnn_batch_normalization_test(inputs, gamma, beta, mean, var, mode, epsilon)
   2783                          (mean.ndim, var.ndim, ndim))
   2784     if epsilon < 1e-5:
-> 2785         raise ValueError("epsilon must be at least 1e-5, got %f" % epsilon)
   2786 
   2787     if ndim < 4:

ValueError: epsilon must be at least 1e-5, got 0.000001