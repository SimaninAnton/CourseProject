raginisharma14 commented on 8 Sep 2017 â€¢
edited
Hi All,
I am trying to add the last layer's output of one model to last layer's output of another model as below.
class Student(object):

    def build(self, rgb, alpha, teacher):
        shape = (1, 1, int(1024 * alpha))
        """
        This looks dangerous. Not sure how the model would get affected with the laarning_phase variable set to True.
        """
        K.set_learning_phase(True)
        img_input = Input(shape=(32,32,3))

        conv = _conv_block(img_input, 32, alpha, strides=(2, 2))
        conv = _depthwise_conv_block(conv, 64, alpha, depth_multiplier, block_id =1)
        conv = _depthwise_conv_block(conv, 128, alpha, depth_multiplier,strides=(2, 2), block_id =2)
        conv = _depthwise_conv_block(conv, 128, alpha, depth_multiplier,block_id =3)
        conv = _depthwise_conv_block(conv, 256, alpha, depth_multiplier, strides=(2,2),block_id =4)
        conv = _depthwise_conv_block(conv, 256, alpha, depth_multiplier, block_id =5)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, strides = (2,2), block_id =6)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, block_id =8)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, block_id =9)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, block_id =10)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, block_id =11)
        conv = _depthwise_conv_block(conv, 512, alpha, depth_multiplier, block_id =12)
        conv = _depthwise_conv_block(conv, 1024, alpha, depth_multiplier,strides=(2,2), block_id =13)
        conv = _depthwise_conv_block(conv, 1024, alpha, depth_multiplier, block_id =14)

        conv = GlobalAveragePooling2D()(conv)
        conv = Reshape(shape, name='reshape_1')(conv)

        conv = Dropout(0.5, name='dropout')(conv)
        conv = Conv2D(NUM_CLASSES, (1, 1), padding='same', name='conv_preds')(conv)
        conv = Activation('softmax', name='act_softmax')(conv)
        conv = Reshape((NUM_CLASSES,), name='reshape_2')(conv)
        conv = add([conv, teacher.layers[87].output], name='add')
        model = Model(img_input, conv)
        return model
I am passing the teacher object to student build function, so that I can access teacher's last layer output.
I have used add layer to add element wise tensors of teacher and student.
But I am seeing below error. ValueError: Graph disconnected: cannot obtain value for tensor Tensor("input_1:0", shape=(?, 32, 32, 3), dtype=float32) at layer "input_1". The following previous layers were accessed without issue: []
Does someone knows the issue?
1