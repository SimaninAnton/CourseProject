King-Of-Knights commented on 23 Sep 2018 â€¢
edited
Like what is described in #6900,
The code load_model() for a single custom layer works well:
model = load_model('Network.hdf5', custom_objects= {'Myclass': Myclass})
but not works for the Model which contains multipe same Custom layers, like AlexNet, which contains
3 LRN, and LRN is my custom layer.
Since I will get something like that:
File "D:/AlexNet.py", line 114, in <module>
   model = load_model('AlexNet.h5', custom_objects= {'LRN': LRN})
 File "E:\Anaconda3\lib\site-packages\keras\engine\saving.py", line 260, in load_model
   model = model_from_config(model_config, custom_objects=custom_objects)
 File "E:\Anaconda3\lib\site-packages\keras\engine\saving.py", line 334, in model_from_config
   return deserialize(config, custom_objects=custom_objects)
 File "E:\Anaconda3\lib\site-packages\keras\layers\__init__.py", line 55, in deserialize
   printable_module_name='layer')
 File "E:\Anaconda3\lib\site-packages\keras\utils\generic_utils.py", line 145, in deserialize_keras_object
   list(custom_objects.items())))
 File "E:\Anaconda3\lib\site-packages\keras\engine\sequential.py", line 293, in from_config
   model.add(layer)
 File "E:\Anaconda3\lib\site-packages\keras\engine\sequential.py", line 193, in add
   self.build()
 File "E:\Anaconda3\lib\site-packages\keras\engine\sequential.py", line 233, in build
   name=self.name)
 File "E:\Anaconda3\lib\site-packages\keras\engine\network.py", line 237, in _init_graph_network
   self.inputs, self.outputs)
 File "E:\Anaconda3\lib\site-packages\keras\engine\network.py", line 1442, in _map_graph_network
   ' times in the model. 
ValueError: The name "LRN2D" is used 2 times in the model. All layer names should be unique.
Which is caused by multipe same Custom layers
Since I am working on network prune experiment, it is a little complicated to use model.load_weights(),
because the model architecture is always changing.
Any idea about this? Appreciation in advance!