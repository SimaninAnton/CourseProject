Contributor
blue-atom commented on 25 Sep 2018
For following python script,
from keras.models import Sequential
from keras.layers import Dense,Conv2D, Flatten

model=Sequential()
model.add(Conv2D(10,(3,3)))
model.add(Conv2D(10,(3,3)))
model.add(Flatten())
model.add(Dense(20))
model.add(Dense(10))

model.compile(loss='categorical_crossentropy',
              optimizer='sgd',
              metrics=['accuracy'])

model.summary()
In the keras version 2.2.2, the error message is like following
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-83-30ace2d20b7d> in <module>()
     13               metrics=['accuracy'])
     14 
---> 15 model.summary()

/opt/conda/lib/python3.6/site-packages/keras/engine/network.py in summary(self, line_length, positions, print_fn)
   1245         if not self.built:
   1246             raise ValueError(
-> 1247                 'This model has never been called, thus its weights '
   1248                 'have not yet been created, so no summary can be displayed. '
   1249                 'Build the model first '

ValueError: This model has never been called, thus its weights have not yet been created, so no summary can be displayed. Build the model first (e.g. by calling it on some test data).
But in the keras version 2.1.6, it is like following
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-8-30ace2d20b7d> in <module>()
      3 
      4 model=Sequential()
----> 5 model.add(Conv2D(10,(3,3)))
      6 model.add(Conv2D(10,(3,3)))
      7 model.add(Flatten())

/usr/local/lib/python3.6/dist-packages/keras/models.py in add(self, layer)
    482                     # know about its input shape. Otherwise, that's an error.
    483                     if not hasattr(layer, 'batch_input_shape'):
--> 484                         raise ValueError('The first layer in a '
    485                                          'Sequential model must '
    486                                          'get an `input_shape` or '

ValueError: The first layer in a Sequential model must get an `input_shape` or `batch_input_shape` argument.
The difference here is that version 2.1.6 doesn't allow to add the first layer if input_shape is missing and version 2.2.2 allows to build the model even if input shape is missing. I am new to this repository so, I am not sure about it but I think that keras 2.2.2 will figure out input_shape when fit() is called for the first time, and that is being suggested by error msg in version 2.2.2. From looking at the code I can say that it is checking whether or not the model is built or not before calling summary utility.
But error message seems misleading, it asks to fit the model before calling summary() but many times we need to see the number of parameters and output shapes (especially CNN) before actually training. And it is very likely that such error will occur due to not specifying "input_shape" by mistake. And in such scenario debugging the error will be very difficult.
So i am suggesting following error message
ValueError: This model has not yet been built, so no summary can be displayed. Build the model first (e.g. by calling it on some test data) or specify the 'input_shape' in the first layer
Above suggested error message would help in debugging if "input_shape" is not specified due to a mistake and creating a model which computes input shape on the go is not the intention
I will be happy to send PR to fix this issue, but I want to discuss it with the community first.
Issue Guidelines List :
Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/keras-team/keras.git --upgrade --no-deps
If running on TensorFlow, check that you are up-to-date with the latest version. The installation instructions can be found here.
Used keras 2.2.2 and 2.1.6
If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
I am using tensorflow backend
Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Provided above