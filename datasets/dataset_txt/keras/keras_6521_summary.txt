Making Keras flexible without too many specific edge cases