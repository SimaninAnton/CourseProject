GauravBh1010tt commented on 7 Jun 2017
Hi. I am trying to pass a constant from the fit function that needs to be accessed by the keras model.
Specifically, I have the WordNet dataset that has two entities along with a relation - <e1, rel, e2>. I am trying to implement Neural Tensor Network for knowledge base completion. For each relation, a separate neural tensor model (ntn_layer) needs to be initialized. This can be achieved as follows:
inpx = Input(shape=(dimx,))
inpy = Input(shape=(dimy,))

''' problem in initializing the variable k which is to be passed from fit'''
#k = Input(shape=(1,))
#k = K.constant()

ntn = {}
for i in range(num_relations):
    ntn[i] = ntn_layer(inp_size=dimx,out_size=4)([inpx,inpy])
score = Dense(1,activation='tanh')(ntn[k])
model = Model([inpx,inpy,k],score)
Here, ntn[i] is the model's parameters for ith relation. Ntn_layer is the neural tensor layer and is working fine for single relation dataset. In WordNet we have 11 relations, so I have divided the dataset relation-wise, that is I want only the kth ntn parameters to be updated for kth relation data. The fit function looks like this:
for k in range(num_relations):
    for batch_id in range(num_batches[k]):
        e1,e2, labels_train = make_batches(k, batch_id)
        model.fit( [e1,e2,k], labels_train, nb_epoch=1, batch_size=100) 
''' passing only the _kth_ relation data along with the relation number _k_'''