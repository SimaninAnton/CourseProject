Gradient calculation gives NaN value