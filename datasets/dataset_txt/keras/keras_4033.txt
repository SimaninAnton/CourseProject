Contributor
javidcf commented on 31 Oct 2016 â€¢
edited
The following snippet:
from keras.layers import Input, LSTM, Dense
from keras.layers.wrappers import TimeDistributed
from keras.models import Model

batch_size = 32
time_steps = 10
input_dim = 5
num_classes = 3
hidden_size = 16
inputs = Input(batch_shape=(batch_size, time_steps, input_dim))
y = LSTM(hidden_size, return_sequences=True)(inputs)
y = TimeDistributed(Dense(num_classes, activation='softmax'))(y)  # Exception raised here
model = Model(input=inputs, output=y)
model.compile(optimizer='rmsprop')
Raises the following exception in the indicated line when using TensorFlow backend:
ValueError: The shape for while_1/Merge_2:0 is not an invariant for the loop. It enters
the loop with shape (10, 16), but has shape (32, 3) after one iteration. Provide shape
invariants using either the `shape_invariants` argument of tf.while_loop or set_shape()
on the loop variables.
This seems to be a compatibility issue with TensorFlow 0.11:
TensorFlow 0.10rc0 + Keras 1.1.0: Works
TensorFlow 0.11rc0 + Keras 1.1.0: Fails
TensorFlow 0.11rc1 + Keras 1.1.0: Fails
I have tested this with Python 3 on Debian Jessie and Ubuntu 14.04.5 LTS.