bartgras commented on 10 Apr 2017
Tensorflow 1.0.1 as Keras backend. Keras version 2.0.
Below is simplified version of problem I'm having.
Sample data:
X = np.round(np.random.rand(10, 10) * 10).astype(np.int32)
y = np.round(np.random.rand(10)).astype(np.int32)
Model:
i = Input(shape=(10,), name='sentence_input', dtype='int32')
x = Embedding(12, 10, mask_zero=True)(i)
o = LSTM(10)(x)
enc_model = Model(i, o)

i2 = Input(shape=(10,), dtype='int32')
x2 = enc_model(i2)
o2 = Dense(1, activation='sigmoid')(x2)

model = Model(i2, o2)
model.compile(optimizer='rmsprop', loss='binary_crossentropy')
model.fit(X, y, epochs=1)
I want to add masking but the moment mask_zero=True is added, it fails with error:
InvalidArgumentError: You must feed a value for placeholder tensor 'sentence_input_10' with dtype int32
[[Node: sentence_input_10 = Placeholder[dtype=DT_INT32, shape=[], _device="/job:localhost/replica:0/task:0/cpu:0"]()]]
I though adding dtype='int32' on both Input layers will fix the problem.
I need enc_model as a separate Model because it's reused in 2 separate inputs that have to share the same weights.