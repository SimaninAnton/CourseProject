XiaotaoChen commented on 7 Jun 2017
Hi,
I get the different result by the two functions named "train_on_batch" and "test_on_batch" feed with the same data accidentally. And each layer.trainable was set by 'False'. the don't know why. the details as follows:
1. load trained model, by follow code.
def continue_train_model(model_path):
    model = load_model(model_path)
    for layer in model.layers:
        layer.trainable = False
    return model
2. use the two functions get results feed with the same data.
train_feature_batch = get_shuffled_data(x_train_new, index_for_shuffle, ran_train_sample, batch_size)
train_label_batch = get_shuffled_data(y_train_new, index_for_shuffle, ran_train_sample, batch_size)
ran_train_sample = ran_train_sample+batch_size
temp = model.test_on_batch(train_feature_batch, train_label_batch)
print('test batch:%d, loss:%.6f, mse:%.6f, acc:%6f'%(ran_train_sample, temp[0], temp[1], temp[2]))
temp = model.train_on_batch(train_feature_batch, train_label_batch)
print('train batch:%d, loss:%.6f, mse:%.6f, acc:%6f'%(ran_train_sample, temp[0], temp[1], temp[2]))
3. it's info printed as follows:
test batch:100, loss:0.032870, mse:0.006512, acc:1.000000
train batch:100, loss:3.948478, mse:0.657277, acc:0.290000
test batch:200, loss:0.010902, mse:0.000904, acc:1.000000
train batch:200, loss:3.740743, mse:0.727334, acc:0.180000
test batch:300, loss:0.023010, mse:0.007636, acc:0.990000
train batch:300, loss:3.480110, mse:0.707776, acc:0.170000
test batch:400, loss:0.104351, mse:0.035595, acc:0.940000
train batch:400, loss:3.038500, mse:0.671575, acc:0.210000
test batch:500, loss:0.028863, mse:0.004068, acc:1.000000
train batch:500, loss:2.745351, mse:0.704359, acc:0.150000
Can anyone explain it. Thanks.
2