VirtualKley commented on 9 Jun 2019
Please help me I'm have error with flow in ImageDataGenerator
the code is:
#Iniciando lista de datos y etiquetas
data = []
labels = []
print('[INFO] Cargando imagenes...')
imagePaths = sorted(list(paths.list_images(args['dataset']))) #Captura la rutas de las imagenes para ser tratadas
random.seed(42) #Crea una nueva semilla de aleatoriedad
random.shuffle(imagePaths) #Baraja las imagenes que se han encontrado
#Tratamiento de las imagenes
for imagePath in imagePaths:
image = cv2.imread(imagePath) #Se carga la imagen
image = cv2.resize(image, (IMAGE_DIMS[0],IMAGE_DIMS[1])) #Se redimensiona la imagen actual por los pixeles dados
image = img_to_array(image) #Permite convertir una imagen en matriz
data.append(image) #Se agrega la matriz a una lista llamada data
label = imagePath.split(os.path.sep)[-2] #Se separa el nombre del directorio ya sea el nombre del pokemon
labels.append(label)#Se agrega a la lista el nombre del pokemon ya extraido anteriormente
#Tratamiento de pixeles
data = np.array(data, dtype='float')/255.0 #Se genera la division de la intesidad de los pixeles para que en vez de 255 sea el maximo solo llegue a 1
labels = np.array(labels) #Se genera un array de los nombres de pokemons
print("[INFO] data matrix: {:.2f}MB".format(data.nbytes / (1024 * 1000.0)))
#Binarizacion de etiquetas
lb = LabelBinarizer()#Se instancia la binarizacion
labels = lb.fit_transform(labels) #Combierte cada etiqueta en un numero binario para que la maquina pueda asociarlo
(trainX, trainY, testX, testY) = np.array(train_test_split(data, labels, test_size=0.2, random_state=42))
#Modificacion y creacion de nuevas imagenes a partir de ya creadas
aug = ImageDataGenerator(rotation_range=25, width_shift_range=0.1, height_shift_range=0.1, shear_range=0.2,
zoom_range=0.2, horizontal_flip=True, fill_mode='nearest')
#Inicializando la compilacion del modelo
print("[INFO] Compilando modelo...")
model = SmallerVGGNet.build(width=IMAGE_DIMS[1], height=IMAGE_DIMS[0], depth=IMAGE_DIMS[2], classes=len(lb.classes_))
opt = Adam(lr=INIT_LR, decay=INIT_LR/EPOCHS)
model.compile(optimizer=opt, loss='categorical_crossentropy', metrics=["accuracy"])
#Entrenando al modelo
print("[INFO] Entrenando al modelo")
H = model.fit_generator(aug.flow(trainX, trainY, batch_size=BS), validation_data=(testX, testY), steps_per_epoch=len(trainX)//BS, epochs=EPOCHS, verbose=1)
AND THE ERROR IS:
Traceback (most recent call last):
File "train.py", line 77, in
H = model.fit_generator(aug.flow(trainX, trainY, batch_size=BS), validation_data=(testX, testY), steps_per_epoch=len(trainX)//BS, epochs=EPOCHS, verbose=1)
File "C:\Users\EDSONG1\ML\lib\site-packages\keras_preprocessing\image\image_data_generator.py", line 430, in flow
subset=subset
File "C:\Users\EDSONG1\ML\lib\site-packages\keras_preprocessing\image\numpy_array_iterator.py", line 80, in init
(np.asarray(x).shape, np.asarray(y).shape))
ValueError: x (images tensor) and y (labels) should have the same length. Found: x.shape = (528, 96, 96, 3), y.shape = (132, 96, 96, 3)
PLEASE HELP ME