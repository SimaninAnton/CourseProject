jgc128 commented on 25 Dec 2015
Hi!
The following script is failing to load weights with an error AssertionError: Provided weight array does not match layer weights (2 layer params vs. 0 provided weights)
I am using the lastest version of Keras from GitHub
from keras.models import Sequential
from keras.layers.core import Layer, Dense, Merge, add_shared_layer

model_weights_filename = 'test_weights.hdf5'

input1 = Sequential()
input1.add(Layer(input_shape=(10,)))

input2 = Sequential()
input2.add(Layer(input_shape=(10,)))

add_shared_layer(Dense(5), [input1, input2])

merge_sum = Sequential()
merge_sum.add(Merge([input1, input2], mode='sum'))

merge_mul = Sequential()
merge_mul.add(Merge([input1, input2], mode='mul'))


dense = Sequential()
dense.add(Merge([merge_mul, merge_sum], mode='concat'))

dense.save_weights(model_weights_filename, overwrite=True)
dense.load_weights(model_weights_filename)
Merging without merge_mul and merge_sum only with the last merge works fine.
I think it has something to do with the parameters that the merge layers is getting from the shared layer - maybe it gets it twice...