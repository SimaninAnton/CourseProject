Custom metric gives incorrect results