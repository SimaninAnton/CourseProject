qq775193759 commented on 31 Aug 2016 â€¢
edited
I used LSTM to solve my question. When I upgrade my environment I meet some error.
data.shape : (191, 128, 130)
label.shape : (191, 128, 1)
The cause of error is the dimension of label is 1. I have tried to use label.shape =(191, 128, 2), in this case, there is no error.
environment and version:
Ubuntu 14.04.4
Theano (0.9.0dev2)
Keras (1.0.8)
Code:
from keras.models import Sequential
from keras.layers.recurrent import LSTM
import numpy as np


model = Sequential()
model.add(LSTM(128, input_dim=130, return_sequences=True))
model.add(LSTM(1, return_sequences=True))
model.compile(optimizer='rmsprop',loss='mse')

data = np.random.random([191,128,130])
label = np.random.random([191,128,1])

model.fit(data, label, nb_epoch=20, batch_size=32, validation_split=0.25)
Error:
Using Theano backend.
Using gpu device 0: GeForce GTX 970 (CNMeM is enabled with initial size: 80.0% of memory, cuDNN 4007)
(191, 128, 130)
(191, 128, 1)
Traceback (most recent call last):
File "lstm_part.py", line 34, in
model.fit(data, label, nb_epoch=20, batch_size=32, validation_split=0.25)
File "/usr/local/lib/python2.7/dist-packages/keras/models.py", line 620, in fit
sample_weight=sample_weight)
File "/usr/local/lib/python2.7/dist-packages/keras/engine/training.py", line 1061, in fit
self._make_test_function()
File "/usr/local/lib/python2.7/dist-packages/keras/engine/training.py", line 716, in _make_test_function
*_self._function_kwargs)
File "/usr/local/lib/python2.7/dist-packages/keras/backend/theano_backend.py", line 682, in function
return Function(inputs, outputs, updates=updates, *_kwargs)
File "/usr/local/lib/python2.7/dist-packages/keras/backend/theano_backend.py", line 668, in init
**kwargs)
File "/usr/local/lib/python2.7/dist-packages/theano/compile/function.py", line 326, in function
output_keys=output_keys)
File "/usr/local/lib/python2.7/dist-packages/theano/compile/pfunc.py", line 484, in pfunc
output_keys=output_keys)
File "/usr/local/lib/python2.7/dist-packages/theano/compile/function_module.py", line 1789, in orig_function
defaults)
File "/usr/local/lib/python2.7/dist-packages/theano/compile/function_module.py", line 1653, in create
input_storage=input_storage_lists, storage_map=storage_map)
File "/usr/local/lib/python2.7/dist-packages/theano/gof/link.py", line 699, in make_thunk
storage_map=storage_map)[:3]
File "/usr/local/lib/python2.7/dist-packages/theano/gof/vm.py", line 1051, in make_all
no_recycling))
File "/usr/local/lib/python2.7/dist-packages/theano/scan_module/scan_op.py", line 730, in make_thunk
self.validate_inner_graph()
File "/usr/local/lib/python2.7/dist-packages/theano/scan_module/scan_op.py", line 249, in validate_inner_graph
(self.name, type_input, type_output))
TypeError: ('The following error happened while compiling the node', forall_inplace,gpu,scan_fn}(Shape_i{1}.0, GpuSubtensor{int64:int64:int8}.0, GpuIncSubtensor{InplaceSet;:int64:}.0, DeepCopyOp.0, Shape_i{1}.0, lstm_2_U_o, lstm_2_U_f, lstm_2_U_i, lstm_2_U_c), '\n', "Inconsistency in the inner graph of scan 'scan_fn' : an input and an output are associated with the same recurrent state and should have the same type but have type 'CudaNdarrayType(float32, col)' and 'CudaNdarrayType(float32, matrix)' respectively.")