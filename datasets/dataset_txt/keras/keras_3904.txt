vicmak commented on 17 Nov 2016 â€¢
edited
Hi !
I am trying to train a network on a large dataset (Microsoft sentence completion challenge) and I have to split the train data to batches since it does not fit into the GPU memory. Oddly enough preparing the train in the same exact manner, but with a gnerator that yields the X and Y - I receive the following error:
Exception: Error when checking model input: expected dense_input_1 to have shape (None, 1200) but got array with shape (1200L, 1L)
each observation instance is actually an array of 1200 floats.
Yes, removed the dimension before yield, since it is one observation and not a set.
the model is defined as following:
word_dimension = 300
context_size = 4
hidden_layer_size = 100
vocabulary_size = 30000
log_file_name = "C:\\corpora\\MSCC\\log_mscc.txt"
model_save_file_name = "C:\\corpora\\models\\model.h5"
start_time = time.time()
print("Creating the model object")
model = Sequential()
model.add(Dense(hidden_layer_size, input_dim=context_size * word_dimension, init='uniform', activation='tanh'))
model.add(Dense(vocabulary_size, init='normal', activation='softmax'))  # can be also sigmoid (for a multiclass)
print("compiling...")
model.compile(loss='sparse_categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
print("compiled!")
the code is here, and the difference in functions train_model_from_dir_batch and train_model_from_dir
The train call differs in the following way:
on complete fit:
model.fit(arrX, arrY, nb_epoch=50, batch_size=dataset.shape[0])
on fit_generator:
model.fit_generator(n_gram_generator(vocabulary,current_filename, vectors), samples_per_epoch=100, nb_epoch=50)
Please make sure that the boxes below are checked before you submit your issue. Thank you!
[V] Check that you are up-to-date with the master branch of Keras. You can update with:
pip install git+git://github.com/fchollet/keras.git --upgrade --no-deps
[V] If running on Theano, check that you are up-to-date with the master branch of Theano. You can update with:
pip install git+git://github.com/Theano/Theano.git --upgrade --no-deps
[V] Provide a link to a GitHub Gist of a Python script that can reproduce your issue (or just copy the script here if it is short).
Thanks a lot!