litingsjj commented on 5 Mar 2017 â€¢
edited
I use the layer "merge" like this:
model_gray = Sequential()
model_gray.add(Convolution3D(nb_filters[0],kernel_dim1=nb_conv[0], kernel_dim2=nb_conv[0],
kernel_dim3=nb_conv[0], input_shape=(1, img_rows, img_cols,patch_size),
activation='relu'))
...
model_flow_x = Sequential()
model_flow_x.add(Convolution3D(nb_filters[0],kernel_dim1=nb_conv[0], kernel_dim2=nb_conv[0],
kernel_dim3=nb_conv[0], input_shape=(1, img_rows, img_cols,patch_size),
activation='relu'))
...
model_flow_y = Sequential()
model_flow_y.add(Convolution3D(nb_filters[0],kernel_dim1=nb_conv[0], kernel_dim2=nb_conv[0],
kernel_dim3=nb_conv[0], input_shape=(1, img_rows, img_cols,patch_size),
activation='relu'))
...
merged = Merge([model_gray,model_flow_x, model_flow_y], mode='concat')
model = Sequential()
model.add(merged)
model.add(Dense(128, init='normal', activation='relu'))
...
When I define theano.function (or K.function) to get full connect layer, like this:
get_feature = K.function(model_gray.layers[0].input,model_flow_x.layers[0].input,model_flow_y.layers[0].input,
K.learning_phase()],model.layers[1].output) #the function has no error
train_feature = get_feature([X_train_gray,X_train_flow_x,X_train_flow_y]) #have an error: TypeError: ('Bad input argument to theano function with name "<ipython-input- 84-04c3e9b312ad>:3" at index 0(0-based)', 'Wrong number of dimensions: expected 5, got 6 with shape (3, 3307, 1, 80, 60, 30).')
If I use
train_feature = get_feature(X_train_gray,X_train_flow_x,X_train_flow_y) #the error is :TypeError: Missing required input: keras_learning_phase
I don't have any idea of it! Can you help me? thanks!