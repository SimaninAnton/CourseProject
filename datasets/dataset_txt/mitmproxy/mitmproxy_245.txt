FFY00 commented on 18 Jul 2018 â€¢
edited
Steps to reproduce the problem:
python setup.py pytest
Output:
==================================== ERRORS ====================================
________________________ ERROR at setup of test_mitmweb ________________________
file /build/mitmproxy-git/src/mitmproxy/test/mitmproxy/tools/test_main.py, line 9
  def test_mitmweb(event_loop, tdata):
E       fixture 'event_loop' not found
>       available fixtures: cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, monkeypatch, pytestconfig, record_property, record_xml_attribute, record_xml_property, recwarn, tdata, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/build/mitmproxy-git/src/mitmproxy/test/mitmproxy/tools/test_main.py:9
_______________________ ERROR at setup of test_mitmdump ________________________
file /build/mitmproxy-git/src/mitmproxy/test/mitmproxy/tools/test_main.py, line 18
  def test_mitmdump(event_loop, tdata):
E       fixture 'event_loop' not found
>       available fixtures: cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, monkeypatch, pytestconfig, record_property, record_xml_attribute, record_xml_property, recwarn, tdata, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/build/mitmproxy-git/src/mitmproxy/test/mitmproxy/tools/test_main.py:18
python setup.py pytest
Output:
Exception in thread WebsocketFrameReader:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/build/mitmproxy-git/src/mitmproxy/pathod/pathoc.py", line 128, in run
    r, _, _ = select.select([self.rfile], [], [], 0.05)
ValueError: file descriptor cannot be a negative integer (-1)
Any other comments? What have you tried so far?
I ran pytest --fixtures
Output:
---------------------------------------------------------------------------------------- fixtures defined from test.conftest ----------------------------------------------------------------------------------------
tdata
    build/mitmproxy-git/src/mitmproxy/test/conftest.py:41: no docstring available

------------------------------------------------------------------------------ fixtures defined from test.mitmproxy.addons.test_export ------------------------------------------------------------------------------
get_request
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_export.py:15: no docstring available
post_request
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_export.py:26: no docstring available
patch_request
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_export.py:37: no docstring available
tcp_flow
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_export.py:44: no docstring available

------------------------------------------------------------------------------ fixtures defined from test.mitmproxy.tools.web.test_app ------------------------------------------------------------------------------
no_tornado_logging
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/tools/web/test_app.py:19: no docstring available

----------------------------------------------------------------------------- fixtures defined from test.mitmproxy.addons.test_readfile -----------------------------------------------------------------------------
data
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_readfile.py:15: no docstring available
corrupt_data
    build/mitmproxy-git/src/mitmproxy/test/mitmproxy/addons/test_readfile.py:33: no docstring available

------------------------------------------------------------------------------- fixtures defined from test.examples.test_xss_scanner --------------------------------------------------------------------------------
logger
    build/mitmproxy-git/src/mitmproxy/test/examples/test_xss_scanner.py:308: no docstring available
System information
Latest from git (tag.revision.commit): 4.0.0.r93.7f464b892
(git describe --long --tags | sed 's/^v//;s/\([^-]*-\)g/r\1/;s/-/./g;s/\.rc./rc/g')
I don't know why 4.0.0 shows up as the tag.
Note
I am maintaining mitmproxy-git in Arch Linux's AUR repo. The packaging process runs tests by default. Committing to the repo without checking if the changes break the tests will break the package, please be careful when doing this. Thanks.