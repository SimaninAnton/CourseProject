cameronmccord2 commented on 9 Sep 2015
When I build from source from the current master branch of all 3 projects the build works correctly but I am unable to get any https traffic to show up in mitmproxy or mitmdump. I can get http traffic. Running pip's mitmproxy(0.13) logs http and https traffic. Building from source v0.13 on the same box works correctly and I can see http and https traffic. I use the --host and --nonanonymous flags, as shown below.
AWS
instance type: t2.micro
os: ubuntu-trusty-14.04-amd64-server-20150325 (ami-d05e75b8)
Traffic generated from an iPhone iOS 8.latest with a proxy setup on the wifi port 80 using auth.
mitm.it certificate installed after mitmproxy starts and before trying any http or https sites.
Bash steps I am using to build from master:
# Install everything
sudo apt-get update
sudo apt-get -y upgrade
sudo apt-get -y install python-pip python-dev libffi-dev libssl-dev libxml2-dev libxslt1-dev git
sudo pip install virtualenv
# Clone projects
git clone https://github.com/mitmproxy/mitmproxy.git
git clone https://github.com/mitmproxy/netlib.git
git clone https://github.com/mitmproxy/pathod.git
# Setup system to recieve requests
sudo sysctl -w net.ipv4.ip_forward=1
echo 0 | sudo tee /proc/sys/net/ipv4/conf/*/send_redirects
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8080
# Build
cd mitmproxy
source ./dev
. ../venv.mitmproxy/bin/activate
mitmdump --version
#0.13.1
# Run
mitmproxy --nonanonymous --host
Bash steps I am using to build from 0.13:
# Install everything
sudo apt-get update
sudo apt-get -y upgrade
sudo apt-get -y install python-pip python-dev libffi-dev libssl-dev libxml2-dev libxslt1-dev git
sudo pip install virtualenv
# Clone projects
git clone https://github.com/mitmproxy/mitmproxy.git
cd mitmproxy
git reset --hard 675e70c7ebd980bbbc55a49e888f21cf8fbbe818
cd ..
git clone https://github.com/mitmproxy/netlib.git
cd netlib
git reset --hard fb482172241b6235da083f6dbf154b641772a4fc
rm -rf .git
cd ..
git clone https://github.com/mitmproxy/pathod.git
cd pathod
git reset --hard 46255e6e9cfca6ee5b32d287be7d2a0eb8d73c20
rm -rf .git
cd ..
# Setup system to recieve requests
sudo sysctl -w net.ipv4.ip_forward=1
echo 0 | sudo tee /proc/sys/net/ipv4/conf/*/send_redirects
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8080
# Build
cd mitmproxy
source ./dev
. ../venv.mitmproxy/bin/activate
mitmdump --version
#0.13.1
# Run
mitmproxy --nonanonymous --host
Thanks for a great product!