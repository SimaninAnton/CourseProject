laurmurclar commented on 14 Feb 2017
Steps to reproduce the problem:
mitmproxy --nonanonymous
Set a proxy username and password in System Preferences -> Network -> Wifi -> Advanced -> Proxies for both HTTP and HTTPS.
Save changes. A dialog appears:

Choose Always Apply
Open browser and navigate to a HTTPS page eg. https://www.google.ie/. This appears:
Fill in username and password to match those entered earlier.
Get the following error (ERR_SPDY_PROTOCOL_ERROR):
Any other comments? What have you tried so far?
After googling the error, I tried flushing the socket pools at chrome://net-internals/#sockets. I immediately got the same error after trying to access a HTTPS site again.
Previously I had been getting two dialog boxes; one requesting credentials for localhost:8080 and then another requesting credentials for google.ie:443 (or whatever site) directly after the localhost one.
Not sure if it matters, but the proxy credentials in my keychain:
System information
Mitmproxy version: 2.0.0 (1.0.1dev0129-0x919385d)
Python version: 3.6.0
Platform: Darwin-15.6.0-x86_64-i386-64bit
SSL version: OpenSSL 1.0.2k 26 Jan 2017
Mac version: 10.11.6 ('', '', '') x86_64