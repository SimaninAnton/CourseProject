JakeAustwick commented on 21 Apr 2017
I also posted this on Discourse, but I'm posting it here because I believe it to be a bug.
I have my script changing the upstream proxy for HTTP connections, but it seems to fail for HTTPS connections. Here's a basic stripped down example.
https://gist.github.com/JakeAustwick/c3116d86f4483d1acede4420f02efb72
The script works fine for http://api.ipify.org/, but fails for https://api.ipify.org/. With HTTPS I see the following, which shows the upstream proxy wasn't changed.
Server connection to default_proxy:8888 failed: Error connecting to "default_proxy": [Errno 8] nodename nor servname provided, or not known
Running Command:
mitmdump -s utilities/proxy_redirects.py -U http://default_proxy:8888
Platform / Library Version ( I also tested on Ubuntu):
mitmdump --version
Mitmproxy version: 2.0.1 (release version) 
Python version: 3.6.1
Platform: Darwin-14.5.0-x86_64-i386-64bit
SSL version: OpenSSL 1.1.0e 16 Feb 2017
Mac version: 10.10.5 ('', '', '') x86_64