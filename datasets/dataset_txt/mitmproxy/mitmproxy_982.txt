paragordius commented on 5 Aug 2016 â€¢
edited
Steps to reproduce the problem:
Start mimtproxy withe the -T --host flags
Run a video streaming application through it for 8+ hours (such as a fireTV channel or AppleTV app)
What is the expected behavior?
mitmproxy remains stable
What went wrong?
Traceback (most recent call last):                                                                                                                            
  File "/usr/local/lib/python2.7/dist-packages/mitmproxy/proxy/server.py", line 121, in handle                                                                
    root_layer()                                                                                                                                              
  File "/usr/local/lib/python2.7/dist-packages/mitmproxy/proxy/modes/transparent_proxy.py", line 22, in __call__                                              
    layer()                                                                                                                                                   
  File "/usr/local/lib/python2.7/dist-packages/mitmproxy/protocol/rawtcp.py", line 43, in __call__                                                            
    r = ssl_read_select(conns, 10)                                                                                                                              File "/usr/local/lib/python2.7/dist-packages/netlib/tcp.py", line 389, in ssl_read_select                                                                   
    ] or select.select(rlist, (), (), timeout)[0]                                                                                                             
ValueError: filedescriptor out of range in select()                                                                                                           

mitmproxy has crashed!                                                                                                                                        
Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy
Any other comments? What have you tried so far?
I have an inline script running that streams "Content-Type" that starts with "video/". This is to keep RAM usage and log sizes sane (I'm more interested in HTTP errors and latency than actual video chunks). I was running into the Too many open files error, but I set * - nofile 100000 in /etc/security/limits.conf.
Output of lsof -n -p $(pgrep mitmproxy) in case it is needed: http://pastebin.com/raw/CtYaShmG
Mitmproxy Version: mitmproxy 0.17
Operating System: "Linux Mint 18 Sarah"