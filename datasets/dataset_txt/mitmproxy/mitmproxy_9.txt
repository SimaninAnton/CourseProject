Hacksawfred3232 commented 19 days ago
Problem Description
When attempting to connect to the proxy port via using something like Edge, Edge reports that
the certificate is invalid. The most striking quirk about this is the absence of a subject line. I'm suspecting that this gets set upon receiving a server address from the client. It looks like some programs have a way of testing the proxy due to this quirk. When either set in the proxy settings for the target, or using a program to force the target to use a proxy, the target program reports a "self-signed certificate" in the chain, although it is reading the certificate store to check root certificates, which the MITMProxy's certificate is installed in there. A forced installation of the root certificate into "AuthRoot" - as indicated in RegEdit - was also performed. In addition, the absence of an additional certificate to verify the presence of HSTS verification might be related.
Steps to reproduce the behaviour:
Start any target program that uses libcurl 7.55.1-DEV or something akin to this version.
Start up MITMProxy. Settings used: "--anticache, -k". I am using the windows version installed via pip.
Attempt to connect to the proxy on the proxy port (In this case for me, its 8080). You should get an error about an invalid certificate, where the certificate has a blank subject line.
Attempt to connect to a secure remote host with the target program.
Outcome - You should get an error through either debug or a visible prompt that the target
can't connect to the remote host due to a "self-signed certificate".
System Information
mitmproxy: 4.0.4
Python: 3.7.4
OpenSSL: OpenSSL 1.1.0i 14 Aug 2018
Platform: Windows-10-10.0.18362-SP0