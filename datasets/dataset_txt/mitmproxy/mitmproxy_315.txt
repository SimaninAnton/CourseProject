johndoesenior commented on 3 May 2018
Steps to reproduce the problem:
running mitmproxy transparent mode with ssl on
going to any website (HTTPS)
results in failure
ubuntu 16.04
python 3.6
Error: 192.168.42.19:49597: Traceback (most recent call last):(more in eventlog)Traceback (most recent call last):
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/proxy/server.py", line 121, in handle
    root_layer()
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/proxy/modes/transparent_proxy.py", line 19, in __call__
    layer()
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/proxy/protocol/tls.py", line 279, in __call__
    self._establish_tls_with_client_and_server()
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/proxy/protocol/tls.py", line 355, in _establish_tls_with_client_and_server
    self._establish_tls_with_server()
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/proxy/protocol/tls.py", line 444, in _establish_tls_with_server
    **args
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/connections.py", line 292, in establish_tls
    self.convert_to_tls(cert=client_cert, sni=sni, **kwargs)
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/net/tcp.py", line 388, in convert_to_tls
    **sslctx_kwargs
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/net/tls.py", line 285, in create_client_context
    **sslctx_kwargs,
  File "/usr/local/lib/python3.6/site-packages/mitmproxy/net/tls.py", line 194, in _create_ssl_context
    context.set_alpn_protos(alpn_protos)
  File "/usr/local/lib/python3.6/site-packages/OpenSSL/SSL.py", line 654, in explode
    raise NotImplementedError(error)
NotImplementedError: ALPN not available

mitmproxy has crashed!
Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy
Thanks