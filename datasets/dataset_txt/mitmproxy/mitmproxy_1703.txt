stoarca commented on 19 Mar 2014
Hi there,
I'm attempting to build a proxy rotation service on top of libmproxy. I have the following function
def get_upstream_server(conn):
    proxyDef = proxylist.proxyChooser.getProxy()
    print('get upstream server ' + proxyDef.ip)
    return [False, False, proxyDef.ip, proxyDef.port]
which I pass into the ProxyConfig constructor. The getProxy() call returns a proxy of my choosing. I'd like each request to be made through the proxy that is returned by getProxy() (usually a different proxy). However, establish_server_connection in libmproxy/proxy/server.py reuses an existing connection if possible, so sometimes several requests are sent through the same upstream proxy. Can somebody point me in the right direction for where the appropriate place is to disable the connection reuse? Or is there something else that will help me achieve what I want?