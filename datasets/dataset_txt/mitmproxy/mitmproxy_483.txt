Mradr commented on 19 Dec 2017 â€¢
edited
Steps to reproduce the problem:
After a while with many devices on the proxy - the server slows down and then freezes.
I really don't have a way to reproduce the steps, but I had similar issues a while back when I ran a public proxy and had many many bots connect and disconnect that resulted in errors of things not closing out correctly.
We have about 50 devices and it seems "speed" wise fine until about an hour or so in then it slows down and then stop functioning altogether with no error.
Seems like it doesn't want to take on new connections - last we see are "Disconnect" over the last open connections.
Any other comments? What have you tried so far?
I put try/except around my code, but I don't see any errors with my code. This leads me to mitmproxy having the issues and not my personal code. I be more than happy to pull any information I can to help figure this problem out. Like I said, it seems to happen every hour or so. Right now I create a watchdog to help protect against it crashing like it was so by restarting the proxy software and it seems like it runs fine again for about an hour before it does it again.
I understand Mitmproxy wasn't redesign for speed in mind, but seems like the more devices we do add - the shorter the time table before the proxy just freezes up. What steps can I take to future proof this just a bit? Thread count does reach into 400-600s or so when it last crash). It shouldn't be enough to really break Linux, but something I did notice.
System information
Mitmproxy version: 2.0.2 (release version)
Python version: 3.5.2
Platform: Linux-4.4.0-93-generic-x86_64-with-Ubuntu-16.04-xenial
SSL version: OpenSSL 1.1.0f 25 May 2017
Linux distro: Ubuntu 16.04 xenial
Past ticket
#2575