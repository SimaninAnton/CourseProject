spozdnyakov commented on 26 Apr 2018 â€¢
edited
Transparent mode used to work OK on Windows in version 2.0.2. There was an issue with showing correct Host headers however, so I tried to upgrade to 3.0.4 and found that transparent mode now doesn't work at all. On every client request mitmweb shows the following error message:
Transparent mode failure: RuntimeError('Cannot resolve original destination.',)
I've tried previous mitmproxy releases and found that this functionality was broken starting from v3.0.0
RC2. I do understand that this mode is not "officially" supported on Windows, but since it used to work, I hope it can be fixed :)
Steps to reproduce the problem:
Enable IP forwarding (https://gist.github.com/mhils/e9769fab7b1dd0775335)
Set port redirection, e.g.:
netsh interface portproxy add v4tov4 listenport=80 connectaddress=192.168.0.90 connectport=8080
netsh interface portproxy add v4tov4 listenport=443 connectaddress=192.168.0.90 connectport=8080
Start mitmproxy in transparent mode:
mitmweb.exe --mode transparent --showhost
Install mitmproxy certificate on the phone
Set default gateway in phone's Wi-Fi connection properties to the mitmproxy host (e.g. 192.168.0.90)
Open any website in phone's browser
System information
Mitmproxy: 3.0.4 binary
Python: 3.6.4
OpenSSL: OpenSSL 1.1.0h 27 Mar 2018
Platform: Windows-10-10.0.16299