alinpopa commented on 18 Mar 2017
Quick description
When using mitmproxy, and sending a large POST request using curl (which as well sets the Expect: 100-continue header), will strip out the expect header, and this will not get to the end server. When using a script to set the expect header, the request hangs.
Steps to reproduce the problem:
Create a minimal http server that is capable of the followings:
accept POST/PUT requests
logs out all the request headers, and the request body
Start mitmproxy
Send a POST request using curl, having a considerable large request body (I've used a json, Content-Length: 2017
Notice the final server will not get the expect header.
Any other comments? What have you tried so far?
Tried to use a script in order to set the expect header, but it looks like that the entire flow hangs.
Due to this issue, we've noticed on a production servers (that are relying on this particular 100 Continue feature) that the request body gets truncated. Sure, we fixed this, but was thinking that this 100 Continue thing shouldn't be hidden by mitmproxy, but to be forwarded to the end server.
System information
Mitmproxy version: 2.0.1 (release version)
Python version: 3.6.0
Platform: Darwin-16.4.0-x86_64-i386-64bit
SSL version: OpenSSL 1.1.0e 16 Feb 2017
Mac version: 10.12.3 ('', '', '') x86_64