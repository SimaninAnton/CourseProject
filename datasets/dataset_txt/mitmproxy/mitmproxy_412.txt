huguesb commented on 9 Feb 2018
Steps to reproduce the problem:
https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04
http://docs.mitmproxy.org/en/stable/transparent/linux.html
curl -v https://gutenberg.org
Sorry to post a screenshot. Somehow the dying process screws my terminal in a way that prevents me from copy/pasting the output...
Any other comments? What have you tried so far?
I've tried a bunch of variations of iptables rules. So far, either the vpn traffic bypasses mitmproxy entirely or mitmproxy dies... Running mitmproxy as unprivileged user or as root doesn't seem to make a difference either.
System information
mitmproxy 0.15
$ sudo iptables -t nat -L
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination

Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
REDIRECT   tcp  --  anywhere             anywhere             tcp dpt:https redir ports 8080

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  --  10.0.0.0/8           anywhere