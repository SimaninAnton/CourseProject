stevesbrain commented on 12 May 2016 â€¢
edited
Steps to reproduce the problem:
Using Chrome, with HTTP(S) proxy set to mitmproxy, browse to Gmail for business (already logged in - may also work on personal gmail, but don't have one). This triggers one crash
Once loaded, if you open an email, this triggers a separate error
What is the expected behavior?
Presumably, not to crash. Haven't used mitmproxy long enough to determine if this is expected behaviour with Gmail or not.
What went wrong?
The error message was observed. Gmail still useable. Hangouts however will not load on a fresh session. If hangouts was loaded before proxying, it continues to work.
Any other comments?
Emails may trigger this same response because Hangouts/Google Plus info is loaded on the right hand side - this may be the section that's triggering this. Error messages received are as below:
Browsing into email on existing session:
Traceback (most recent call last):de an HTTP2 stream is not supported.")ions.")
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/server.py", line 121, in handlell__
    root_layer()rce_conn.h2.receive_data(raw_frame)tmproxy/mitmproxy
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/modes/http_proxy.py", line 11, in __call__
    layer()me in self.incoming_buffer:
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()f._update_header_buffer(f)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http1.py", line 67, in __call__uffer
    layer()eaders_buffer.append(f)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 171, in __call__
    self.handle_regular_mode_connect(request)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 263, in handle_regular_mode_connect
    layer()e a bug report at: https://github.com/mitmproxy/mitmproxy
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 234, in __call__
    events = source_conn.h2.receive_data(raw_frame)
  File "/usr/lib/python2.7/site-packages/h2/connection.py", line 1142, in receive_data
    for frame in self.incoming_buffer:
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 172, in next
    f = self._update_header_buffer(f)
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 131, in _update_header_buffer
    self._headers_buffer.append(f)
AttributeError: 'NoneType' object has no attribute 'append'
[614/836]                                                                                                                                                                                                                                                  ?:help q:back [*:8080]
mitmproxy has crashed!read-411:
Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy
  File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
    self.run()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 422, in run
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 191, in __call__
    self.establish_server_connection(flow)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 371, in establish_server_connection
    self.connect()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 414, in connect
    raise ValueError("CONNECT inside an HTTP2 stream is not supported.")
ValueError: CONNECT inside an HTTP2 stream is not supported.
[614/1060]                                                                                                                                                                                                                                                 ?:help q:back [*:8080]Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/server.py", line 121, in handle
    root_layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/modes/http_proxy.py", line 11, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http1.py", line 67, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 171, in __call__
    self.handle_regular_mode_connect(request)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 263, in handle_regular_mode_connect
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 234, in __call__
    events = source_conn.h2.receive_data(raw_frame)
  File "/usr/lib/python2.7/site-packages/h2/connection.py", line 1142, in receive_data
    for frame in self.incoming_buffer:
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 172, in next
    f = self._update_header_buffer(f)
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 131, in _update_header_buffer
    self._headers_buffer.append(f)
[614/1068]                                                                                                                                                                                                                                                 ?:help q:back [*:8080]Exception in thread Thread-621:
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
    self.run()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 422, in run
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 191, in __call__
    self.establish_server_connection(flow)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 371, in establish_server_connection
    self.connect()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 414, in connect
    raise ValueError("CONNECT inside an HTTP2 stream is not supported.")
ValueError: CONNECT inside an HTTP2 stream is not supported.
Fresh loading page when already logged in:
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/server.py", line 121, in handle
    root_layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/proxy/modes/http_proxy.py", line 11, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http1.py", line 67, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 171, in __call__
    self.handle_regular_mode_connect(request)
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http.py", line 263, in handle_regular_mode_connect
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/tls.py", line 358, in __call__
    layer()
  File "/usr/lib/python2.7/site-packages/mitmproxy/protocol/http2.py", line 234, in __call__
    events = source_conn.h2.receive_data(raw_frame)
  File "/usr/lib/python2.7/site-packages/h2/connection.py", line 1142, in receive_data
    for frame in self.incoming_buffer:
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 172, in next
    f = self._update_header_buffer(f)
  File "/usr/lib/python2.7/site-packages/h2/frame_buffer.py", line 131, in _update_header_buffer
    self._headers_buffer.append(f)
AttributeError: 'NoneType' object has no attribute 'append'

mitmproxy has crashed!
Mitmproxy Version: 0.17
Operating System: Arch Linux (up to date as of posting this information) Linux HOSTNAME 4.5.3-1-ARCH #1 SMP PREEMPT Sat May 7 20:43:57 CEST 2016 x86_64 GNU/Linux