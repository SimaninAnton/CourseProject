Member
mhils commented on 23 Feb 2016
Steps to reproduce the problem:
Surf on some HTTP2 website
???
127.0.0.1:36141: Traceback (most recent call last):
  File "/media/sf_git/mitmproxy/mitmproxy/proxy/server.py", line 121, in handle
    root_layer()
  File "/media/sf_git/mitmproxy/mitmproxy/proxy/modes/http_proxy.py", line 11,
in __call__
    layer()
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/tls.py", line 350, in
__call__
    layer()
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http1.py", line 67, in
__call__
    layer()
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http.py", line 168, in
__call__
    self.handle_regular_mode_connect(request)
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http.py", line 256, in
handle_regular_mode_connect
    layer()
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/tls.py", line 350, in
__call__
    layer()
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http2.py", line 237, in
__call__
    if not self._handle_event(event, source_conn, other_conn, is_server):
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http2.py", line 173, in
_handle_event
    other_conn.h2.safe_reset_stream(other_stream_id, event.error_code)
  File "/media/sf_git/mitmproxy/mitmproxy/protocol/http2.py", line 49, in
safe_reset_stream
    except h2.exceptions.StreamClosedError:
NameError: global name 'h2' is not defined
I really don't have a good way to reproduce it, sorry.
While We're at it, let's replace from h2.events import * with explicit imports to get rid of the major bunch of landscape warnings here.