markus-kusano commented on 22 Jun 2016
gtm2.zip
Steps to reproduce the problem:
Unzip recording: unzip gtm2.zip
Replay the recording using --kill: mitmdump --no-pop --rheader Host --kill --server-replay ./gtm2.out
GET the page in the recording: https://www.googletagmanager.com/gtm.js?id=GTM-K787WT
What is the expected behavior?
The webpage loads (a javascript file is shown).
What went wrong?
mitmdump throws an exception:
127.0.0.1:57022: clientconnect
127.0.0.1 GET https://www.googletagmanager.com/gtm.js?id=GTM-K787WT HTTP/2.0
 << Connection killed
Exception in thread Http2SingleStreamLayer-1:
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 810, in __bootstrap_inner
    self.run()
  File "/home/markus/mitmproxy/mitmproxy/protocol/http2.py", line 503, in run
    self()
  File "/home/markus/mitmproxy/mitmproxy/protocol/http2.py", line 509, in __call__
    layer()
  File "/home/markus/mitmproxy/mitmproxy/protocol/http.py", line 174, in __call__
    self.process_request_hook(flow)
  File "/home/markus/mitmproxy/mitmproxy/protocol/http.py", line 338, in process_request_hook
    request_reply = self.channel.ask("request", flow)
  File "/home/markus/mitmproxy/mitmproxy/controller.py", line 139, in ask
    raise exceptions.Kill()
Kill: None
Any other comments? What have you tried so far?
The network connection in the browser hangs attempting to download the page. This causes the browser to never fully load the page.
Mitmproxy Version:
commit:
7523f41
Operating System: Ubuntu 14.04.4