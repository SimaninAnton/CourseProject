ghost commented on 18 Apr 2014
I've been struggling with mitmproxy over the past few hours when trying to proxy https traffic. I've tried a number of different browsers - curl, wget, Chrome on Windows 7, and Firefox on OSX 10.9. I've also tried with and without the CA certificate imported. When I initially tried I would just timeout and nothing much interesting would happen from the browser side -- it would just sit and the event log would repeat:
10.181.70.65:49956: 400: SSL handshake error: [('SSL routines', 'SSL23_GET_CLIENT_HELLO', 'http request')]
10.181.70.65:49956: disconnect
-> handled 0 requests
When going to https://mitm.it I would get a certificate error:
The certificate that Chrome received during this connection attempt is not formatted correctly, so Chrome cannot use it to protect your information.
Error type: Malformed certificate
Subject: mitm.it
Issuer: mitmproxy
I figured maybe the certificates aren't being generated correctly so I generated my own certificates. Now I am able to get to https://mitm.it with the expected certificate warnings.. however it still doesn't work. Event log messages:
10.181.70.65:51613: 400: SSL handshake error: [('SSL routines', 'SSL23_GET_CLIENT_HELLO', 'http request')]
10.181.70.65:51613: disconnect

10.181.70.65:51823: 400: SSL handshake error: (-1, 'Unexpected EOF')
On the client I get this - Error code: ERR_TIMED_OUT
Versions -
pyOpenSSL: Installed version (0.14) is most up-to-date
cryptography: Installed version (0.3) is most up-to-date