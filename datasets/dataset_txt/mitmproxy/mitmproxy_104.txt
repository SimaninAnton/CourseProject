i54cxy commented on 10 Jul 2019
I can visit most website except for linkedin.
This is a weird issue for me and I haven't found any solution yet. Maybe it's a simple mistake or configuration error on my end but I really couldn't figure it out myself so I'm hoping that I can get some help here.
Steps to reproduce the problem:
I installed ubuntu on my windows laptop using virtualbox. To replicate the problem, the following steps are done on a newly installed ubuntu.
sudo apt install python3-pip
sudo pip3 install -U pip
sudo pip3 install mitmproxy
After I installed mitmproxy like that, I ran mitmproxy or mitmweb to start a simple proxy. I used firefox, configured its proxy setting to 127.0.0.1:8080, and visited google. Then I had the page that says software issue is preventing me from visiting google. I then went to mitm.it to install the certificate. After that I could visit google, and in fact a lot of other sites like facebook, pinterest, twitter, dmv, etc, but I just cannot visit linkedin. As soon as I hit enter in the address bar the webpage kinda refreshed and stayed at previous page. I tried google linkedin and visit them from there but it's still not responding and giving me blank pages if opened in a new tab.
Any other comments? What have you tried so far?
Part of the output from mitmweb looks like this when I tried visit linkedin.com:
127.0.0.1:47522: clientconnect
127.0.0.1:47524: clientconnect
127.0.0.1:47526: clientconnect
127.0.0.1:47528: clientconnect
127.0.0.1:47530: clientconnect
127.0.0.1:47532: clientconnect
::ffff:127.0.0.1:47510: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:47510: clientdisconnect
::ffff:127.0.0.1:47508: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:47508: clientdisconnect
::ffff:127.0.0.1:47518: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:47518: clientdisconnect
::ffff:127.0.0.1:47514: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:47514: clientdisconnect
::ffff:127.0.0.1:47512: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
I have tried curl as well:
Connecting to google is fine:
~$ curl -V
curl 7.58.0 (x86_64-pc-linux-gnu) libcurl/7.58.0 OpenSSL/1.1.1 zlib/1.2.11 libidn2/2.0.4 libpsl/0.19.1 (+libidn2/2.0.4) nghttp2/1.30.0 librtmp/2.3
Release-Date: 2018-01-24
Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp 
Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP HTTP2 UnixSockets HTTPS-proxy PSL
~$ curl -Ikv --proxy 127.0.0.1:8080 https://www.google.com
* Rebuilt URL to: https://www.google.com/
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
* allocate connect buffer!
* Establish HTTP proxy tunnel to www.google.com:443
> CONNECT www.google.com:443 HTTP/1.1
> Host: www.google.com:443
> User-Agent: curl/7.58.0
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
HTTP/1.1 200 Connection established
< 

* Proxy replied 200 to CONNECT request
* CONNECT phase completed!
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*   CAfile: /etc/ssl/certs/ca-certificates.crt
  CApath: /etc/ssl/certs
* (304) (OUT), TLS handshake, Client hello (1):
* CONNECT phase completed!
* CONNECT phase completed!
* (304) (IN), TLS handshake, Server hello (2):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Unknown (8):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Certificate (11):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, CERT verify (15):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Finished (20):
* (304) (OUT), TLS change cipher, Client hello (1):
* (304) (OUT), TLS Unknown, Certificate Status (22):
* (304) (OUT), TLS handshake, Finished (20):
* SSL connection using unknown / TLS_AES_256_GCM_SHA384
* ALPN, server accepted to use h2
* Server certificate:
*  subject: CN=www.google.com
*  start date: Jul  7 22:33:38 2019 GMT
*  expire date: Jul  8 22:33:38 2021 GMT
*  issuer: CN=mitmproxy; O=mitmproxy
*  SSL certificate verify result: self signed certificate in certificate chain (19), continuing anyway.
* Using HTTP2, server supports multi-use
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* Using Stream ID: 1 (easy handle 0x55ab8f543580)
* (304) (OUT), TLS Unknown, Unknown (23):
> HEAD / HTTP/2
> Host: www.google.com
> User-Agent: curl/7.58.0
> Accept: */*
> 
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Newsession Ticket (4):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Newsession Ticket (4):
* (304) (IN), TLS Unknown, Unknown (23):
* Connection state changed (MAX_CONCURRENT_STREAMS updated)!
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
< HTTP/2 200 
HTTP/2 200 
But connecting to linkedin is not successful:
~$ curl -Ikv --proxy 127.0.0.1:8080 https://www.linkedin.com
* Rebuilt URL to: https://www.linkedin.com/
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
* allocate connect buffer!
* Establish HTTP proxy tunnel to www.linkedin.com:443
> CONNECT www.linkedin.com:443 HTTP/1.1
> Host: www.linkedin.com:443
> User-Agent: curl/7.58.0
> Proxy-Connection: Keep-Alive
> 
< HTTP/1.1 200 Connection established
HTTP/1.1 200 Connection established
< 

* Proxy replied 200 to CONNECT request
* CONNECT phase completed!
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*   CAfile: /etc/ssl/certs/ca-certificates.crt
  CApath: /etc/ssl/certs
* (304) (OUT), TLS handshake, Client hello (1):
* CONNECT phase completed!
* CONNECT phase completed!
* (304) (IN), TLS handshake, Server hello (2):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Unknown (8):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Certificate (11):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, CERT verify (15):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Finished (20):
* (304) (OUT), TLS change cipher, Client hello (1):
* (304) (OUT), TLS Unknown, Certificate Status (22):
* (304) (OUT), TLS handshake, Finished (20):
* SSL connection using unknown / TLS_AES_256_GCM_SHA384
* ALPN, server accepted to use h2
* Server certificate:
*  subject: CN=www.linkedin.com
*  start date: Jul  7 22:35:31 2019 GMT
*  expire date: Jul  8 22:35:31 2021 GMT
*  issuer: CN=mitmproxy; O=mitmproxy
*  SSL certificate verify result: self signed certificate in certificate chain (19), continuing anyway.
* Using HTTP2, server supports multi-use
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* Using Stream ID: 1 (easy handle 0x56270c7f0580)
* (304) (OUT), TLS Unknown, Unknown (23):
> HEAD / HTTP/2
> Host: www.linkedin.com
> User-Agent: curl/7.58.0
> Accept: */*
> 
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Newsession Ticket (4):
* (304) (IN), TLS Unknown, Certificate Status (22):
* (304) (IN), TLS handshake, Newsession Ticket (4):
* (304) (IN), TLS Unknown, Unknown (23):
* Connection state changed (MAX_CONCURRENT_STREAMS updated)!
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
* (304) (OUT), TLS Unknown, Unknown (23):
* (304) (IN), TLS Unknown, Unknown (23):
* Connection #0 to host 127.0.0.1 left intact
curl: (16) Error in the HTTP2 framing layer
For all the websites I've tried so far, linkedin is the only website that cannot be visited.
I've also tried install mitmproxy on my original windows system and it can visit linkedin just fine.
System information
~$ mitmproxy --version
Mitmproxy: 4.0.4
Python:    3.6.8
OpenSSL:   OpenSSL 1.1.1  11 Sep 2018
Platform:  Linux-4.18.0-25-generic-x86_64-with-Ubuntu-18.04-bionic
Firefox version: Firefox Quantum 67.0.4 64bit