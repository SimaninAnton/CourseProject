lfuh commented on 18 Sep 2014
I try to capture the iOS8 software update traffic in mitmproxy, first, the iOS8 update is about 957MB, the attemp to download failed couple of time leaving some request-response like this:
GET http://appldnld.apple.com/iOS8/xxxxxxx/0dfaf41c8998ad43b00d7f7632d4260951e4cbbf.zip
‚Üê 200 application/octet-stream [no content] 112.1kB/s
when I enter to this transaction, the request side header showed fine, if I tab over to the response side, the proxy will crash and showing these on screen:
mitmproxy -p 8080 --host
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 605, in run
    self.ui.run_wrapper(self.loop)
  File "/usr/local/lib/python2.7/dist-packages/urwid/raw_display.py", line 268, in run_wrapper
    return fn()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 832, in loop
    k = self.view.keypress(size, k)
  File "/usr/local/lib/python2.7/dist-packages/urwid/container.py", line 1124, in keypress
    return self.body.keypress( (maxcol, remaining), key )
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 677, in keypress
    self.view_response()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 475, in view_response
    body = self.conn_text(self.flow.response)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 223, in conn_text
    headers, msg, body = self.conn_text_raw(conn)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 185, in conn_text_raw
    return headers, msg, body
UnboundLocalError: local variable 'msg' referenced before assignment

mitmproxy has crashed!
Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy
Shutting down...
Traceback (most recent call last):
  File "/usr/local/bin/mitmproxy", line 9, in <module>
    load_entry_point('mitmproxy==0.11', 'console_scripts', 'mitmproxy')()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/main.py", line 108, in mitmproxy
    m.run()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 614, in run
    self.shutdown()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 990, in shutdown
    self.state.killall(self)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/flow.py", line 427, in killall
    i.kill(master)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/protocol/http.py", line 865, in kill
    master.handle_error(self)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 1053, in handle_error
    self.process_flow(f)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 1030, in process_flow
    self.refresh_flow(f)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/__init__.py", line 1020, in refresh_flow
    self.body.refresh_flow(c)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 495, in refresh_flow
    self.view_response()
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 475, in view_response
    body = self.conn_text(self.flow.response)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 223, in conn_text
    headers, msg, body = self.conn_text_raw(conn)
  File "/usr/local/lib/python2.7/dist-packages/libmproxy/console/flowview.py", line 185, in conn_text_raw
    return headers, msg, body
UnboundLocalError: local variable 'msg' referenced before assignment
I am using 0.11 version from the GitHub cloned on 9-17. the netlib cloned on the same day.