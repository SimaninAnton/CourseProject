jeffgortmakerquovo commented on 29 Jun 2015
Hi,
I've been using libmproxy in conjunction with Python's requests module, and I've run into a problem with certain websites.
One of these websites is https://www.401save.com. Trying to access it through libmproxy results in:
SSL handshake error: The client may not trust the proxy's certificate.
Here's a short script that demonstrates my problem:
import threading
from libmproxy import controller, proxy
from libmproxy.proxy.server import ProxyServer
import requests

config = proxy.ProxyConfig(port=8888)
server = ProxyServer(config)
mitm = controller.Master(server)
t = threading.Thread(target=mitm.run)
t.daemon = True
t.start()

requests.get('https://www.401save.com', proxies={'https': 'http://localhost:8888'}, verify=False)

mitm.shutdown()
Printing the server's logs, this is what comes up:
127.0.0.1:58270: clientconnect
127.0.0.1:58270: request
  -> CONNECT www.401save.com:443 HTTP/1.0
127.0.0.1:58270: Set new server address: www.401save.com:443
127.0.0.1:58270: serverconnect
  -> www.401save.com:443
127.0.0.1:58270: Received CONNECT request to SSL port. Upgrading to SSL...
127.0.0.1:58270: Establish SSL
  -> with client
  -> with server (sni: None)
127.0.0.1:58270: SSL handshake error: The client may not trust the proxy's certificate.
127.0.0.1:58270: ProxyError('NetLibError("SSL handshake error: SysCallError(-1, \'Unexpected EOF\')",)',)
127.0.0.1:58270: clientdisconnect
127.0.0.1:58270: serverdisconnect
Could this be related to #427?
Best,
Jeff