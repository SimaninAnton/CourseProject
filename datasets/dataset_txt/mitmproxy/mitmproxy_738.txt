Member
mhils commented on 4 Mar 2017
We currently host the compiled JavaScript code for mitmweb in https://github.com/mitmproxy/mitmproxy/tree/master/mitmproxy/tools/web/static so that one can use mitmweb directly from a repo checkout. This is quite useful, but on the other hand it tends to be annoying to have those files not in gitignore as their contents depend on the exact version of dependencies in node_modules. To mitigate this, I would propose to move the compiled files to .gitignore and then use a pattern like this in index.html where we try to use the local copy first but fall back to an online version alternatively:
<script src="/static/vendor.js"></script>
<script src="/static/app.js"></script>
<script type="text/javascript">
if(!window.some_var_defined_by_scripts_above) {
  console.warn("Falling back to precompiled JS copy...")
  document.write('\x3Cscript type="text/javascript" src="http://example.com/vendor.js"\x3E\x3C/script\x3E')
  document.write('\x3Cscript type="text/javascript" src="http://example.com/app.js"\x3E\x3C/script\x3E')
}
</script>
There are a two tricky questions:
Where do we host the precompiled files? Dedicated GitHub, CI?
How do we make sure that our binaries still include those files? Make sure to download the online copy before compiling?