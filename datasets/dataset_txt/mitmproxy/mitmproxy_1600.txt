Member
mhils commented on 8 Oct 2014
There's some weird SSL behaviour, which can be triggered by running mitmproxy with
mitmdump --cert cert.pem
cert.pem (self-signed CA cert + leaf including privkey)
For some reason, this triggers a
`('SSL routines', 'SSL3_GET_CLIENT_HELLO', 'no shared cipher')`
in server.py#L195. What's even more weird is that handle_sni is called a second time when the server conn has already been cleaned up (server.py#L96). The python interpreter crashes when the first call to handle_sni updates the context (server.py#L275). If we remove connection.set_context(new_context), we get a traceback at least, but that doesn't really explain why it's called twice in the first place.
Logs: https://gist.github.com/mhils/d58537ed2a1f484cc3ae