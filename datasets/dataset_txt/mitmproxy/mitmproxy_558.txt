zero-master commented on 10 Sep 2017
Steps to reproduce the problem:
With 2 HTTPs proxies setup with https://tinyproxy.github.io/
Use the code from here: https://github.com/mitmproxy/mitmproxy/blob/master/examples/complex/change_upstream_proxy.py
Use mitmdump -U http://default-upstream-proxy.local:8080/ -s change_upstream_proxy.py`
It works fine on https://whatismyipaddress.com/ but it errors out on https://whoer.net/ and https://www.bing.com/
System information
Mitmproxy version: 2.0.2 (release version)
Python version: 3.5.3
Platform: Linux-4.10.0-28-generic-x86_64-with-Ubuntu-17.04-zesty
SSL version: OpenSSL 1.0.2g 1 Mar 2016
Linux distro: Ubuntu 17.04 zesty
stdout:
127.0.0.1:57574: ValueError('file descriptor cannot be a negative integer (-1)',)
127.0.0.1:57574: clientdisconnect
127.0.0.1:57548: HTTP/2 connection terminated by server: error code: 0, last stream id: 1, additional data: None
127.0.0.1:57548: clientdisconnect
127.0.0.1:57486: clientdisconnect
127.0.0.1:57562: clientdisconnect
127.0.0.1:57558: clientdisconnect
127.0.0.1:57552: clientdisconnect
127.0.0.1:57556: clientdisconnect
127.0.0.1:57526: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:57560: clientdisconnect
127.0.0.1:57526: clientdisconnect
127.0.0.1:57554: clientdisconnect
127.0.0.1:57532: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:57532: clientdisconnect
127.0.0.1:57534: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:57534: clientdisconnect
127.0.0.1:57488: HTTP/2 connection terminated by client: error code: 0, last stream id: 0, additional data: None
127.0.0.1:57488: clientdisconnect