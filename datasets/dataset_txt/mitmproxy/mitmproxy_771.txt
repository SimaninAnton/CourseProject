greenboxal commented on 12 Feb 2017 â€¢
edited
Steps to reproduce the problem:
Use the dns spoof example script
Send a request with the correct Host header
Any other comments? What have you tried so far?
I needed to do two changes in order to get it working:
Comment around line 152 on master.py:
                f.request.host = self.server.config.upstream_server.address.host
And comment around line 281 proxy/protocol/http.py:
             if self.config.options.mode == "reverse":
             f.request.headers["Host"] = self.config.upstream_server.address.host
Although it works, those changes are absolutely invalid and will break a lot of other stuff.
Seems like that example relied on the host header which is permanently changed before the script is executed when using reverse proxy mode.
System information
mitmproxy 1.0.2