markus-kusano commented on 21 Aug 2016
rec.zip
Steps to reproduce the problem:
Run mitmdump with the attached recording: mitmdump --server-replay findastation.out
An exception is thrown:
Traceback (most recent call last):
  File "/home/markus/src/mitmproxy/venv3.5/bin/mitmdump", line 11, in <module>
    load_entry_point('mitmproxy', 'console_scripts', 'mitmdump')()
  File "/home/markus/src/mitmproxy/mitmproxy/main.py", line 102, in mitmdump
    master = dump.DumpMaster(server, dump_options)
  File "/home/markus/src/mitmproxy/mitmproxy/dump.py", line 64, in __init__
    self._readflow(options.server_replay),
  File "/home/markus/src/mitmproxy/mitmproxy/dump.py", line 96, in _readflow
    return flow.read_flows_from_paths(paths)
  File "/home/markus/src/mitmproxy/mitmproxy/flow/io.py", line 83, in read_flows_from_paths
    flows.extend(FlowReader(f).stream())
  File "/home/markus/src/mitmproxy/mitmproxy/flow/io.py", line 49, in stream
    yield models.FLOW_TYPES[data["type"]].from_state(data)
  File "/home/markus/src/mitmproxy/mitmproxy/models/flow.py", line 112, in from_state
    f.set_state(state)
  File "/home/markus/src/mitmproxy/mitmproxy/models/flow.py", line 107, in set_state
    super(Flow, self).set_state(state)
  File "/home/markus/src/mitmproxy/mitmproxy/stateobject.py", line 55, in set_state
    val = state.pop(attr)
KeyError: 'marked'
What is the expected behavior?
mitmdump continues running and the replayed page is served
Any other comments? What have you tried so far?
Note that this is a recording made with an olderversion of mitmproxy, probably from about 2 months ago. Other recordings do not crash similarly.
Running on commit 62ab2f2 with Python 3.5 on Linux.
Thanks :)