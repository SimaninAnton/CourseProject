ifishchuk commented on 17 Nov 2017 â€¢
edited
Hi,
I tried to configure mitmproxy in upstream proxy mode to Charles(4.2) as was described here
In my case there is the following scheme:
Client(Roku)<---https/http--->MITMproxy<----HTTP/HTTPS---> Charles
I trusted the root CA cert in my keychain and even imported mitmproxy-ca-cert.p12 into Charles
If I run mitmproxy -T --host(in the transparent mode) without redirecting the request to Charles I'm able to view both http/https requests
If I send requests directly to Charles("Enable transparent HTTP proxying" option is enabled) I can view HTTP traffic
The reason why I'm trying to put mitmproxy in the middle between my Roku device and Charles is to handle HTTPS traffic as well
When I start mitmproxy in the upstream mode(mitmproxy -U "http://localhost:8888") and forward all the requests to Charles("Enable transparent HTTP proxying" option is disabled) the Roku application simply crushes
In the even log I found - HTTP protocol error in client request: Invalid HTTP request form (expected: authority or absolute, got: relative)
In the Charles Contents tab - com.xk72.proxy.http.HttpFieldsException: Invalid first line in request
Could you please advise if I can catch/handle HTTP/HTTPS traffic in the way described above?
./mitmproxy --version
Mitmproxy version: 2.0.2 (release version) Precompiled Binary
Python version: 3.5.2
Platform: Linux-4.10.0-38-generic-x86_64-with-debian-stretch-sid
SSL version: OpenSSL 1.1.0e 16 Feb 2017
Linux distro: debian stretch/sid