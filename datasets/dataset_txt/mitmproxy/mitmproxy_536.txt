ddor254 commented on 26 Oct 2017 â€¢
edited
Hi , i'm facing a problem when running transparent mode and mitm certificate is trusted in the proxied machine -
when i'm running on regular mode and i do manual proxy on the proxied machine - all good and i can decrypt the https traffic with the mitm certificate. - see no problems and i'm entering https sites with no warnings.
when changing that to -T option (transparent) and creating iptables rules, and removing the manual proxy configuration from the proxied device , but with the same certificates , every time that i'm entering https site i get " your connection is not private"\ NET:ERR_CERT_AUTHORITY_INVALID , and the mitm proxy is still in the trusted CA.
is this a feature or a bug?
Steps to reproduce the problem:
1.install certificate on mobile device
2.set iptables rules in machine that redirect https traffic to port 8080
iptables --table nat --insert PREROUTING -p tcp --destination-port 443 -j REDIRECT --to-ports 8080
run mitmproxy : mitmproxy --host -T -p 8080
Any other comments? What have you tried so far?
I followed this manual : http://docs.mitmproxy.org/en/stable/transparent/linux.html
System information
Sony Xperia , android version 7.1.1 as the proxied device
Ubuntu 16.04 as the proxy server
Mitmproxy version: 2.0.2 (release version)
when running mitmdump instead of mitmproxy i get the following error :
10.0.1.5:52341: Client Handshake failed. The client may not trust the proxy's certificate for cdn.taboola.com.
so there must be something wrong with the certificate - but in regular mode with the same certificate it works !
4