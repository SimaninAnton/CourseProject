washcroft commented on 16 Jun 2018
mitmproxy is crashing with the below error, not sure how to resolve since OpenSSL has ALPN support and I have recompiled cryptographgy, pyOpenSSL and mitmproxy from source.
mitmproxy --version
Mitmproxy: 4.0.3
Python: 3.6.3
OpenSSL: OpenSSL 1.0.2l 25 May 2017
Platform: Linux-4.9.35-v7+-armv7l-with-debian-8.0
mitmproxy has crashed!
Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy
10.10.10.101:56144: Traceback (most recent call last):
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/proxy/server.py", line 121, in handle
root_layer()
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/proxy/modes/transparent_proxy.py", line 19, in call
layer()
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/proxy/protocol/tls.py", line 279, in call
self._establish_tls_with_client_and_server()
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/proxy/protocol/tls.py", line 355, in _establish_tls_with_client_and_server
self._establish_tls_with_server()
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/proxy/protocol/tls.py", line 444, in _establish_tls_with_server
**args
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/connections.py", line 292, in establish_tls
self.convert_to_tls(cert=client_cert, sni=sni, **kwargs)
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/net/tcp.py", line 386, in convert_to_tls
**sslctx_kwargs
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/net/tls.py", line 285, in create_client_context
**sslctx_kwargs,
File "/usr/local/lib/python3.6/site-packages/mitmproxy-4.0.3-py3.6.egg/mitmproxy/net/tls.py", line 194, in _create_ssl_context
context.set_alpn_protos(alpn_protos)
File "/usr/local/lib/python3.6/site-packages/pyOpenSSL-18.0.0-py3.6.egg/OpenSSL/SSL.py", line 650, in explode
raise NotImplementedError(error)
NotImplementedError: ALPN not available