Contributor
Fuzion24 commented on 4 Apr 2013
I built mitmproxy from master (and tried the .8 release). When I run mitmproxy with --no-upstream-cert it seems to work OK.
Below is some sample code that I've been using to play with mitmproxy:
        try{
        String url = "https://www.openssl.org/";
        Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress("127.0.0.1", 8080));
        HttpsURLConnection conn = (HttpsURLConnection)new URL(url).openConnection(proxy);
        String s =  new Scanner(conn.getInputStream(),"UTF-8").useDelimiter("\\A").next();
        System.out.println(s);
        }catch (Exception e){
            e.printStackTrace();
        }
The error I get when running this:
javax.net.ssl.SSLProtocolException: no more data allowed for version 1 certificate
    at sun.security.ssl.HandshakeMessage$CertificateMsg.<init>(HandshakeMessage.java:449)
    at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:154)
    at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)
Doing the same on android with either conditions of upstream certs yields:
javax.net.ssl.SSLHandshakeException: javax.net.ssl.SSLProtocolException: SSL handshake aborted: ssl=0xb851c9f0: Failure in SSL library, usually a protocol error
error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol (external/openssl/ssl/s23_clnt.c:766 0xaed4c5e1:0x00000000)