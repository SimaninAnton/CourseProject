Contributor
phackt commented on 16 Nov 2016 â€¢
edited
Steps to reproduce the problem:
Working with with flowwriter.py template for version v0.18.2
mitmproxy --script "./flowwriter.py ./test.log" --eventlog
full command is mitmproxy --anticache --host --anticomp --noapp --script "./flowwriter.py ./requests.log" --script ./sslstrip.py --eventlog
Any other comments? What have you tried so far?
flowwriter.py is not working in conjunction with an other script and with wb mode (nothing written in file).
It seems that this is a buffering matter, an f = open(path, "ab") will do the trick on my side, without any decoded(flow.request) function and without any other script loaded. Unfortunately the f = open(path, "wb", 0) is not doing the trick if i do not want to be in an append mode. But as mentioned another problem is that loading this script (flowwriter.py), or any file writing method (option -a, -w), will cause any other scripts unstable (like reloading several times) (ex: --script "./flowwriter.py ./requests.log" --script ./sslstrip.py). The same behavior occurs with mitmdump with --script ./sslstrip.py -a ./requests.log, but everything works fine (mitmproxy and mitmdump) if i do not write into files for logging.
Regards,
EDIT
a last thing:
mitmproxy --script "./sslstrip.py" --eventlog -a requests.log ==> Does not work as expected
(go on http://www.ameli.fr/, click on "Mon compte ameli", HttpReadDisconnect('Server disconnected',) error)
mitmproxy --script "./sslstrip.py" --eventlog ==> Works as expected
(go on http://www.ameli.fr/, click on "Mon compte ameli", page is well displayed)
Thanks,
System information
Mitmproxy version: 0.18.2
Python version: 2.7.12+
Platform: Linux-4.8.0-kali1-amd64-x86_64-with-Kali-kali-rolling-kali-rolling
SSL version: OpenSSL 1.0.2j 26 Sep 2016
Linux distro: Kali kali-rolling kali-rolling
$ whereis mitmproxy
mitmproxy: /usr/bin/mitmproxy /usr/share/man/man1/mitmproxy.1.gz