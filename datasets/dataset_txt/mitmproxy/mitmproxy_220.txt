securisec commented on 30 Aug 2018 â€¢
edited
Steps to reproduce the problem:
Not an issue. I am failing to understand how i can start the proxy from a script, and then write any flows on a file. Here is my script so far. Script is a put together form various script ideas by googling around. didnt want to create an issue, but couldnt really get in help on twitter/slack/irc etc. I understand this is simper to do using subprocess, but i am not trying to use subprocess
import os
import sys

from mitmproxy import http
# from mitmproxy.master import Master
import mitmproxy.master as master
from mitmproxy.addons import core
from mitmproxy.proxy import ProxyConfig, ProxyServer
from mitmproxy.options import Options
from mitmproxy import io, http


class Writer(master.Master, http.HTTPFlow):
    def __init__(self, options, server, file_path):
        master.Master.__init__(self, options)
        self.server = server
        self.file_path = file_path
        self.f = open(self.file_path, 'wb+')
        self.w = io.FlowWriter(self.f)

    def run(self):
        try:
            master.Master.run(self)
        except KeyboardInterrupt:
            self.shutdown()
            sys.exit(0)
    
    def writestuff(self):
        flo = http.HTTPFlow
        print(flo)
        self.w.add(flo)


def start_proxy(port, file_path):
    options = Options(
        listen_port=port,
    )
    config = ProxyConfig(
        options=options,
    )
    server = ProxyServer(config)
    # print(dir(http.HTTPFlow))
    m = Writer(options, server, file_path)
    m.addons.add(core.Core())
    m.run()
    m.writestuff()

start_proxy(8080, '/tmp/dumptest')
System information
Mitmproxy: 4.0.4
Python: 3.7.0
OpenSSL: OpenSSL 1.1.0h 27 Mar 2018
Platform: Darwin-16.7.0-x86_64-i386-64bit