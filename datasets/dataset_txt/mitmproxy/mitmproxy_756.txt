straverso commented on 20 Feb 2017
Hey,
I am running mitmproxy in my own python script.
I am facing this issue when accessing few websites from Safari.
For instance, https://www.pec.it
The complete error provided by the browser is:
502 Bad Gateway
TlsProtocolException('Cannot establish TLS with www.pec.it:443 (sni: www.pec.it): TlsException("SSL handshake error: SysCallError(-1, \'Unexpected EOF\')",)',) 
Steps to reproduce the problem:
Visit https://www.pec.it from Safari, with mitmproxy in the middle.
Any other comments? What have you tried so far?
Everything works good using Chrome or Firefox.
Apparently, tested websites do not support TLSv1.2.
It happens that as soon as the mitmproxy sends the CHELO message, the server sends back a FIN message and interrupts the connection.
System information
Happens on MacOS Sierra Version 10.12.3, Safari Version 10.0.3 (12602.4.8) and mitmproxy (commit 337b1c9)
$ mitmproxy --version
Mitmproxy version: 2.0.0 (release version)
Python version: 3.5.2
Platform: Darwin-16.4.0-x86_64-i386-64bit
SSL version: OpenSSL 1.0.2j  26 Sep 2016
Mac version: 10.12.3 ('', '', '') x86_64
Thanks,
Stefano
2