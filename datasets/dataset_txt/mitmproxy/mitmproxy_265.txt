paul-bell commented on 20 Jun 2018
Steps to reproduce the problem:
mitmdump --mode reverse:https://172.19.7.40:443 -p 8082 -v -w ./vsphere.log --ssl-insecure -s ./pbtest.py > shell.log
start the client application (talks to 172.19.7.40) and attempt to register 172.19.7.40. This is done by pointing the client to the IP:PORT where mitmdump (or mitmproxy) is running.
Any other comments? What have you tried so far?
The server at 172.19.7.40:443 is a VMware vSphere server. The client registration of this server involves client use of the vSphere SDK APIs. My understanding is that these APIs talk "SOAP".
The shell.log file contains this:
Proxy server listening at http://*:8082
172.20.2.157:51319: clientconnect
::ffff:172.20.2.157:51319: serverconnect
  -> ('172.19.7.40', 443)
::ffff:172.20.2.157:51319: Establish TLS with server
::ffff:172.20.2.157:51319: Certificate verification error for 172.19.7.40: unable to get local issuer certificate (errno: 20, depth: 0)
::ffff:172.20.2.157:51319: Ignoring server verification error, continuing with connection
::ffff:172.20.2.157:51319: ALPN selected by server: -
::ffff:172.20.2.157:51319: Establish TLS with client
 << Invalid header line: b'SOAPAction\r\n'
::ffff:172.20.2.157:51319: serverdisconnect
  -> ('172.19.7.40', 443)
172.20.2.157:51319: HTTP protocol error in client request: Invalid header line: b'SOAPAction\r\n'
172.20.2.157:51319: ProtocolException("HTTP protocol error in client request: Invalid header line: b'SOAPAction\\r\\n'",)
172.20.2.157:51319: clientdisconnect
System information
Mitmproxy: 4.0.3
Python: 3.6.5
OpenSSL: OpenSSL 1.1.0h 27 Mar 2018
Platform: Linux-2.6.32-642.11.1.el6.x86_64-x86_64-with-centos-6.9-Final
Grateful for any light you can shed on this.
-Paul