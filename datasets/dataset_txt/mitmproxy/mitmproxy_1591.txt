drbolsen commented on 16 Oct 2014
Hi there,
Just wanted to report an issue with mitmproxy I experienced recently.
The proxy crashed with the following error (real IPs replaced with XXX.XXX.XXX.XXX):
[Oct 15 05:01:44.457] XXX.XXX.XXX.XXX GET http://XXX.XXX.XXX.XXX/../../../../../../../../../../windows/win.ini
[Oct 15 05:01:44.457]  << 403 Forbidden 312B
[Oct 15 05:01:54.357] Traceback (most recent call last):
[Oct 15 05:01:54.357]   File "/usr/local/bin/mitmdump", line 55, in <module>
[Oct 15 05:01:54.357]     m.run()
[Oct 15 05:01:54.357]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/dump.py", line 230, in run
[Oct 15 05:01:54.358]     return flow.FlowMaster.run(self)
[Oct 15 05:01:54.358]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/controller.py", line 112, in run
[Oct 15 05:01:54.358]     self.tick(self.masterq)
[Oct 15 05:01:54.358]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/flow.py", line 1499, in tick
[Oct 15 05:01:54.359]     return controller.Master.tick(self, q)
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/controller.py", line 101, in tick
[Oct 15 05:01:54.359]     self.handle(*msg)
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/controller.py", line 119, in handle
[Oct 15 05:01:54.359]     m(obj)
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/dump.py", line 218, in handle_error
[Oct 15 05:01:54.359]     self._process_flow(f)
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/dump.py", line 177, in _process_flow
[Oct 15 05:01:54.359]     print >> self.outfile, str_request(f.request, self.showhost)
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/dump.py", line 55, in str_request
[Oct 15 05:01:54.359]     r = "%s %s %s"%(c, req.method, req.get_url(showhost))
[Oct 15 05:01:54.359]   File "/usr/local/lib/python2.7/dist-packages/libmproxy/flow.py", line 486, in get_url
[Oct 15 05:01:54.360]     host = host.encode("idna")
[Oct 15 05:01:54.360]   File "/usr/lib/python2.7/encodings/idna.py", line 164, in encode
[Oct 15 05:01:54.360]     result.append(ToASCII(label))
[Oct 15 05:01:54.360]   File "/usr/lib/python2.7/encodings/idna.py", line 73, in ToASCII
[Oct 15 05:01:54.360]     raise UnicodeError("label empty or too long")
[Oct 15 05:01:54.360] UnicodeError: label empty or too long
Additional details:
Platform Ubuntu 14.04 in a docker container (docker.com).