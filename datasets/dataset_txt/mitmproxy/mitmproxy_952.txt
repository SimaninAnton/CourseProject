Member
cortesi commented on 7 Sep 2016
Steps to reproduce the problem:
Set up a Python3.5 venv
py.test -n8 ./test
What is the expected behavior?
No segfault.
What went wrong?
Fatal Python error: Segmentation fault

Thread 0x0000700002816000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py", line 173 in get
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 360 in dispatch_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 199 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x0000700001e10000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 549 in wait
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py", line 82 in queue_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 146 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x0000700004125000 (most recent call first):
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/OpenSSL/SSL.py", line 1301 in recv
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 210 in read
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 250 in readline
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 228 in _get_first_line
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 241 in _read_request_line
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 53 in read_request_head
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 27 in read_request
  File "/Users/cortesi/mitmproxy/mitmproxy/pathod/protocols/http.py", line 47 in read_request
  File "/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py", line 131 in handle_http_request
  File "/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py", line 284 in handle
  File "/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py", line 386 in handle_client_connection
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 907 in connection_thread
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 862 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x0000700003c22000 (most recent call first):
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/OpenSSL/SSL.py", line 1301 in recv
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 210 in read
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 250 in readline
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 228 in _get_first_line
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 241 in _read_request_line
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 53 in read_request_head
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py", line 27 in read_request
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py", line 16 in read_request
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py", line 245 in get_request_from_client
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py", line 146 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py", line 75 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/tls.py", line 391 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py", line 271 in handle_regular_mode_connect
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py", line 178 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py", line 75 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/tls.py", line 391 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/modes/http_proxy.py", line 11 in __call__
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/server.py", line 119 in handle
  File "/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/server.py", line 65 in handle_client_connection
  File "/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py", line 907 in connection_thread
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 862 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x000070000371f000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py", line 173 in get
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 360 in dispatch_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 199 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x000070000321c000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 549 in wait
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py", line 82 in queue_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 146 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x000070000190d000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py", line 173 in get
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 360 in dispatch_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 199 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x000070000140a000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 549 in wait
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py", line 82 in queue_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 146 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x0000700000f07000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py", line 173 in get
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 360 in dispatch_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 199 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Thread 0x0000700000a04000 (most recent call first):
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 297 in wait
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 549 in wait
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py", line 82 in queue_events
  File "/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py", line 146 in run
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 914 in _bootstrap_inner
  File "/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py", line 882 in _bootstrap

Current thread 0x00007fff75211000 (most recent call first):
Any other comments? What have you tried so far?
Mitmproxy version: 0.18
Python version: 3.5.2
Platform: Darwin-15.6.0-x86_64-i386-64bit
SSL version: OpenSSL 1.0.2h 3 May 2016
Mac version: 10.11.6 ('', '', '') x86_64