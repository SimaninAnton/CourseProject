Member
cortesi commented on 20 Feb 2018
I don't have time to dig into this right now, but I'm seeing the following failure on master. Perhaps related to recent IPv6 changes?
self = <test.mitmproxy.net.test_tcp.TestServerBind object at 0x10f1fc828>

    def test_bind(self):
        """ Test to bind to a given random port. Try again if the random port turned out to be blocked. """
        for i in range(20):
            random_port = random.randrange(1024, 65535)
            try:
                c = tcp.TCPClient(
                    ("127.0.0.1", self.port), source_address=(
                        "127.0.0.1", random_port))
                with c.connect():
>                   assert c.rfile.readline() == str(("127.0.0.1", random_port)).encode()
E                   assert b"('::ffff:12... 27754, 0, 0)" == b"('127.0.0.1', 27754)"
E                     At index 2 diff: 58 != 49
E                     Left contains more items, first extra item: 32
E                     Use -v to get the full diff