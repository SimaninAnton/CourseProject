Member
mhils commented on 26 Feb 2014
taken from #222
@machduck:
Hello!
Can confirm - https requests are not going through.
Browser says the connection was reset.
The mitmproxy event log and libmproxy standalone give the following stacktrace[s]:
----------------------------------------
Error in processing of request from 127.0.0.1:38722
Traceback (most recent call last):
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/netlib/tcp.py", line 376, in request_thread
    self.handle_connection(request, client_address)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 545, in handle_connection
    h.handle()
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 192, in handle
    while self.handle_request(cc) and not cc.close:
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 208, in handle_request
    request = self.read_request(cc)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 355, in read_request
    return self.read_request_proxy(client_conn)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 386, in read_request_proxy
    return self._read_request_origin_form(client_conn, "https", host, port)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 447, in _read_request_origin_form
    self.establish_ssl(client_conn, host, port)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/libmproxy/proxy.py", line 335, in establish_ssl
    self.convert_to_ssl(dummycert, self.config.certfile or self.config.cacert, handle_sni=sni)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/netlib/tcp.py", line 302, in convert_to_ssl
    ctx.set_tlsext_servername_callback(handle_sni)
  File "/home/[redacted]/venv/local/lib/python2.7/site-packages/OpenSSL/SSL.py", line 776, in set_tlsext_servername_callback
    @wraps(callback)
  File "/usr/lib/python2.7/functools.py", line 33, in update_wrapper
    setattr(wrapper, attr, getattr(wrapped, attr))
AttributeError: HandleSNI instance has no attribute '__name__'
----------------------------------------
Any advice on what to do?
@alexyakoubian:
Yeah, I have the same problem and my event log looks the same as above. Seems this problem only exists on v0.10 from PyPI (master branch works fine).