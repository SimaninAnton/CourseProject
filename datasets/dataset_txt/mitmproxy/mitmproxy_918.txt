Contributor
phackt commented on 20 Oct 2016
Steps to reproduce the problem:
Mitmproxy v0.18.1
Hello Team, i'm creating a transparent proxy with a custom sslstrip.py script (keeping if possible clear connection between proxy and victim, and on the other side mitmproxy is replaying the https one on its side with the destination server).
On the routing machine with the mitmproxy running:
sysctl -w net.ipv4.ip_forward=1
echo 0 | sudo tee /proc/sys/net/ipv4/conf/*/send_redirects
iptables -t nat -A PREROUTING -i wlan0 -p tcp --dport 80 -j REDIRECT --to-port 8080
mitmproxy -T --anticache --host --anticomp --noapp --script ./sslstrip.py --eventlog
Victim is configured to route on the routing machine with mitmproxy running.
What is the expected behavior?
With regular proxy tests, everything is working fine, no certificate problem for mitmproxy when it's establishing the httpS connection.
What went wrong?
But in transparent mode:
GET https://assure.ameli.fr/
‚Üê Certificate Verification Error for 93.174.145.36: hostname '93.174.145.36' doesn't match u'assure.ameli.fr'
It seems that it's expecting the hostname, not the ip address of the destination server. Don't know what could be the root cause of this problem. I will be glad if you have an idea, i will be able to investigate further.
If needed can find all the stuff for my test here, mainly the screenshots done:
https://github.com/phackt/share/tree/master/mitmproxy
Thanks again for your work guyz,
Phackt.
Mitmproxy Version: v0.18.1
Operating System: Kali2 (Debian Jessie)