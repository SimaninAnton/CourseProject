a3135134 commented on 26 Dec 2017 â€¢
edited
Steps to reproduce the problem:
1.I'm trying to see the Azure IoT SDK which supports AMQP on SSL (port 5671) and set up a MITM using command like"mitmdump -T --raw-tcp".
2.There will be a HTTP parse error blocking the mitmdump.
(BTW, I changed source code fixing the blocking problem(see below please). However, I still cannot see plain AMQP on SSL.)
Any other comments? What have you tried so far?
I looked into the sourcecode on github, it seems that file "proxy/root_context.py" line 113 "Check for raw tcp mode" is wrong. I think it should be "if self.config.options.rawtcp or not is_ascii:" , because AMQP starts with "A"? I changed that myself and mitmdump won't be blocked. Is it a bug?
(However, I still cannot see plain AMQP on SSL by wireshark. Does anyone sniff AMQP on SSL successfully? I did the same experiment on MQTTS and it works well.)
https://github.com/mitmproxy/mitmproxy/blob/master/mitmproxy/proxy/root_context.py
System information
mitmproxy version 2.0.2 (release version)
Python version 3.6.4rc1
Platform: Linux-4.13.0-kali1-amd64-x86_64-with-Kali-kali-rolling-kali-rolling
SSL version: OpenSSL 1.0.2n 7 Dec 2017