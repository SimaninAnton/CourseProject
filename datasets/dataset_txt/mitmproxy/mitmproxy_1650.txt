clarkewd commented on 27 Jul 2014
Hi,
I'm running the master branch (mitmproxy 0.11) on OS X 10.9. I've been attempting to selectively use a forward proxy to send some requests to Charles Web Debugging Proxy
This works well with non-SSL requests, setup is as follows:
Step 1 - Configure Browser
I have configured the browser to use mitmproxy via a PACfile that returns PROXY localhost:8080. I also trusted the root CA cert in my keychain. After starting mitmproxy with no parameters both HTTP and HTTPS requests work fine and yield a green browser bar.
Step 2 - Attempt to use an upstream proxy
Charles will allow both HTTP and SOCKS proxies
So I re-launch mitm with an upstream proxy of http://localhost:8888 - and HTTP traffic works but HTTPS requests give a SSL handshake error
I have also attempted some of these options ( fyi to others - -F has changed to -U on mitmproxy 0.11 )
mitmproxy -U "http://localhost:8888"
mitmproxy -U "https://localhost:8888"
mitmproxy -U "http://localhost:8888" --no-upstream-cert
mitmproxy -U "https://localhost:8888" --no-upstream-cert
mitmproxy -U "http://localhost:8888" --cert-forward
mitmproxy -U "https://localhost:8888" --cert-forward
None of these options seem to make this work.
I don't think I can try "socks5://localhost:8888" (yet) as it looks like socks support will be added in the future
I see that in the 0.11 there is something regarding a new protocol - 2https - is that something that could be used to achieve this?
Also, i addition to adding the CA certificate to the system's keychain I have also tried using the same CA to sign SSL requests with both CharlesProxy and mitmproxy - but that did not seem to help either.
An upstream proxy that does not do the SSL "mitm" on the fly certificate signing would probably work, but again, I'm hoping to be able to use MITM to look at SSL requests and selectively forward some of the requests to another debugging tool.