dragosMC91 commented on 26 Oct 2018
Steps to reproduce the problem:
Complete setup of mitmproxy on - pc/ mac
Install mitmproxy certificate on client - samsung phone with android 8.0
Start debugging traffic for apps on the client which have api target leve = 26
Actual results
I've noticed that ever since the mobile app i'm testing updated its target api level (targetSdkVersion) parameter to '26', traffic is no longer visible in mitmproxy interface.
What i've tried
I have tried various combinations of setups (mac/ pc) with numerous OSs (macos, ubuntu, windows) and with various clients.
The same app's traffic can easily be inspected from a different phone with android 5.1.
I'm not sure i fully grasp what goes on 'behind the scenes' while decrypting https traffic but i found something in the android 8.0 documentation (https://developer.android.com/about/versions/oreo/android-8.0-changes) which might be the problem. The notes state '
The system no longer sends user-agent and proxy-authorization headers from a tunneled request to the proxy server.
The system no longer sends a proxy-authorization header on a tunneled Http(s)URLConnection to the proxy when setting up the tunnel. Instead, the system generates a proxy-authorization header, and sends it to the proxy when that proxy sends HTTP 407 in response to the initial request.
Similarly, the system no longer copies the user-agent header from the tunneled request to the proxy request that sets up the tunnel. Instead, the library generates a user-agent header for that request.
'
PS
I'm having the exact same issue while trying to debug https traffic with Fiddler.
This tool has been super helpful for my testing effort, hope this will get fixed or that i'm missing something in my config.