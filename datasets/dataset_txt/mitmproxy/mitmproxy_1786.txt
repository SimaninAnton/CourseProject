poliva commented on 17 Apr 2013
Hello,
I am running mitmdump from git (cloned today), when I start it in transparent proxy mode (-T), it works fine for http connections, but it crashes on https connections with the following stack trace:
Error in processing of request from 192.168.10.201:50748
Traceback (most recent call last):
File "/usr/local/lib/python2.7/dist-packages/netlib/tcp.py", line 341, in request_thread
self.handle_connection(request, client_address)
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 525, in handle_connection
h.handle()
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 183, in handle
while self.handle_request(cc) and not cc.close:
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 198, in handle_request
request = self.read_request(cc)
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 440, in read_request
return self.read_request_transparent(client_conn)
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 335, in read_request_transparent
dummycert = self.find_cert(client_conn, host, port, host)
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 308, in find_cert
conn = self.get_server_connection(cc, "https", host, port, sni)
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 171, in get_server_connection
self.server_conn.connect()
File "/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py", line 71, in connect
self.convert_to_ssl(cert=clientcert, sni=self.sni)
File "/usr/local/lib/python2.7/dist-packages/netlib/tcp.py", line 198, in convert_to_ssl
self.connection.set_tlsext_host_name(sni)
AttributeError: '_socketobject' object has no attribute 'set_tlsext_host_name'
Anything I can do to help?