lpcdma commented on 9 Oct 2019
Steps to reproduce the problem:
1.run command ./mitmweb --listen-port=7777 --web-iface 0.0.0.0 --set block_global=false --set http2_priority=true --set termlog_verbosity=debug --set bodyize_limit=3m
2.usage C# clinet send http/2.0 package
3. mitm print error Error decoding header block: Encoder did not shrink table size to within the max
debug info
::ffff:127.0.0.1:39876: HTTP2 Event from server
  -> <SettingsAcknowledged changed_settings:{ChangedSetting(setting=SettingCodes.HEADER_TABLE_SIZE, original_value=4096, new_value=0), ChangedSetting(setting=SettingCodes.ENABLE_PUSH, original_value=1, new_value=0)}>
::ffff:127.0.0.1:39876: HTTP2 Event from client
  -> <SettingsAcknowledged changed_settings:{ChangedSetting(setting=SettingCodes.MAX_CONCURRENT_STREAMS, original_value=100, new_value=20)}>
::ffff:127.0.0.1:39876: HTTP2 Event from client
  -> <SettingsAcknowledged changed_settings:{}>
::ffff:127.0.0.1:39876: HTTP2 Event from server
  -> <SettingsAcknowledged changed_settings:{}>
::ffff:127.0.0.1:39876: ProtocolError('Error decoding header block: Encoder did not shrink table size to within the max',)
::ffff:127.0.0.1:39876: serverdisconnect
clinet debug info
System.AggregateException : One or more errors occurred. (An error occurred while sending the request.)
 ---- System.Net.Http.HttpRequestException : An error occurred while sending the request.
-------- System.IO.IOException : The request was aborted.
------------ System.IO.IOException : The response ended prematurely, with at least 9 additional bytes expected.
System information
./mitmweb --version
Mitmproxy: 4.0.4 binary
Python: 3.6.3
OpenSSL: OpenSSL 1.1.0h 27 Mar 2018
Platform: Linux-4.4.0-62-generic-x86_64-with-debian-stretch-sid
https://discourse.mitmproxy.org/t/error-decoding-header-block-encoder-did-not-shrink-table-size-to-within-the-max/1692