Member
Kriechi commented on 12 Dec 2017
I'm getting this test failure on my macOS 10.13.2 system with the latest git-master branch:
self = <test.mitmproxy.net.test_tcp.TestServerBind object at 0x113612240>

    def test_bind(self):
        """ Test to bind to a given random port. Try again if the random port turned out to be blocked. """
        for i in range(20):
            random_port = random.randrange(1024, 65535)
            try:
                c = tcp.TCPClient(
                    ("127.0.0.1", self.port), source_address=(
                        "127.0.0.1", random_port))
                with c.connect():
>                   assert c.rfile.readline() == str(("127.0.0.1", random_port)).encode()
E                   assert b"('::ffff:12... 32413, 0, 0)" == b"('127.0.0.1', 32413)"
E                     At index 2 diff: 58 != 49
E                     Left contains more items, first extra item: 32
E                     Use -v to get the full diff

test/mitmproxy/net/test_tcp.py:110: AssertionError
TravisCI doesn't show this error. I cleaned & recreated my whole environment - no improvement.