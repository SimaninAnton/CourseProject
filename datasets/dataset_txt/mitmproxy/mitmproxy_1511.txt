chaserhkj commented on 25 Feb 2015
Hi, there
I wonder if mitmproxy could be used as a reverse proxy that accepts multiple destination which routes the request according to the host: header of the request.
That is to say, it acts, like this:
mitmproxy listen on 80 port on the proxy machine
on the client machine, use some technique to let it point some domains (take www.a.com and www.b.com for examples) to the proxy machine (such as modifying hosts file or dns hijacking).
requests are made to the proxy machine, and mitmproxy uses host: header to determine the destination.
requests with header host: www.a.com will be routed to http://www.a.com
requests with header host: www.b.com will be routed to http://www.b.com
mitmproxy could do interception on all requests
It's quite like setting up an apache httpd on virtualhost with server www.a.com and on virtualhost with server www.b.com, both of which virtualhosts are configured with proper reverse proxy settings.
I know that as the cert is delivered during the initialization of TLS connection, before any headers are transmitted, so it may cause cert issues while the cert hostname does not match with url hostname in https proxies. But let's assume that this will be used in http proxies or a wildcard cert would be used to match the hostnames.
Is it possible to do this in the mitmproxy framework by some already implemented feature, writing inline scripts or using libmitmproxy?
Thanks,
Happy Hacking!