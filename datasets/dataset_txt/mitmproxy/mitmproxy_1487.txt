Contributor
monoxygen commented on 25 Mar 2015
Certificates are being stored in the saved response file when initial recording traffic, but during server playback these certificates are not used (although they are loaded into the flow object).
I ran into this issue because a rogue server was sending back the wrong certificate, and thus I was getting the bad certificate even though I thought the certificates were being pulled from my saved response file.
--no-upstream-cert works around the issue, but I don't get the same altnames as the saved certificate.
I can't find exactly where in the code this is going wrong, but I did notice in libmproxy/proxy/server.py that find_cert() is always using the upstream cert even for server playback, since it seems to have a connection to the upstream server. That's unexpected too, I don't want my server playbacks to be connecting upstream, they should only be communicating with the client by returning responses from the saved response file.