epitron commented on 19 Mar 2015
I noticed an odd bug in mitmproxy: if I try to connect to a shoutcast stream, the client receives a 502 error, and the mitmproxy curses UI prints HttpError("Invalid HTTP version in line: 'ICY'",) in red with no HTTP code. However, if I look at my network connections, mitmproxy has connected to the shoutcast stream and is downloading it.
It also doesn't write any of the data that it's streaming to the flows file when I use the -w option.
It's like there's zombie connection that mitmproxy has forgotten about.
Example:
$ http_proxy=localhost:8080 curl http://xstream1.somafm.com:8002
            <html>
                <head>
                    <title>502 Bad Gateway</title>
                </head>
                <body>HttpError("Invalid HTTP version in line: 'ICY'",)</body>
            </html>
When I check my network traffic, mitmproxy is still streaming the audio from somafm.com. If I connect multiple times, it'll have multiple downloading streams. They won't stop until I kill the process.
(This happens on the latest git checkout.)