Contributor
kabirkhan commented on 20 Nov 2019
How to reproduce the behaviour
I'm creating a component for candidate generation using nearest neighbors and am trying to use the spacy KnowledgeBase.
I'm running into this error in boty spacy 2.1.9 and spacy 2.2.2 where I get an empty AssertionError:
when trying to dump the KnowledgeBase like below.
def to_disk(self, path, exclude=tuple(), **kwargs):
        """Save data to disk"""
        path = ensure_path(path)
        serialize = {}
        serialize["cfg"] = lambda p: srsly.write_json(p, {"k_neighbors": self.k})
        serialize["kb"] = lambda p: self.kb.dump(p)
        exclude = util.get_serialization_exclude(serialize, exclude, kwargs)
        util.to_disk(path, serialize, exclude)
        self.cg.to_disk(path)
Seems to be an issue actually writing the file using the cython c file I/O libraries.
In the file: kb.pyx in the Writer _write method. I guess the status is not 1.
cdef int _write(self, void* value, size_t size) except -1:
    status = fwrite(value, size, 1, self._fp)
    assert status == 1, status
Your Environment
Operating System: Tried on Ubuntu 18.04 in WSL and Ubuntu 16.04 in Azure Machine Learning
Python Version Used: 3.6
spaCy Version Used: Issue in 2.1.9 and 2.2.2
Environment Information: