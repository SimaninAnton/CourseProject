jack-rory-staunton commented 8 days ago â€¢
edited
How to reproduce the behaviour
I set a custom extension on Tokens, tok._.x. When I create a Doc, the Tokens all have the correct value of the token extension. If I then select a span and call span.as_doc(), the resulting document's tokens' .has_extension() is True, but the value is set to the default value. On closer inspection, it appears that .as_doc() does not process the span into a doc by using the nlp pipeline that originally created the span. If I process the doc returned from Span.as_doc() with the relevant pipeline component, I get the expected values on the tokens' custom extension. Is this the expected behavior? It seems like .as_doc() should respect the originating pipeline. I'm not 100% sure, but I never noticed this kind of discrepancy with Span or Doc custom extensions not being preserved in this way, so it may be specific to the token extensions.
Your Environment
spaCy version: 2.2.3
Platform: Darwin-19.2.0-x86_64-i386-64bit
Python version: 3.7.4