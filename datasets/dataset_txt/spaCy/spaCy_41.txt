ewaldatsensentia commented on 31 Dec 2019
How to reproduce the behaviour
import spacy
from spacy import displacy
from spacy.pipeline import EntityRuler
nlp = spacy.load('en_core_web_md')
ruler = EntityRuler(nlp, validate=True, overwrite_ents=True)
patterns = [{"label":"ORGAN", "pattern":[{"LEMMA":"heart"}]},
{"label":"ORGAN", "pattern":[{"LEMMA":"pancreas"}]},
{"label":"ORGAN", "pattern":[{"LEMMA":"stomach"}]}]
ruler.add_patterns(patterns)
nlp.add_pipe(ruler, after="ner")
text = "This affects the heart, stomach, and pancreas only."
doc = nlp(text)
displacy.render(doc, style="ent", jupyter=True)
This affects the heart ORGAN , stomach ORGAN , and pancreas only.
It doesn't find pancreas as an ORGAN.
Oddly, if you remove the last comma, it works. If you remove the "only" it works. If you interchange "pancreas" and "stomach" it works. That is:
text = "This affects the heart, stomach, and pancreas."
doc = nlp(text)
displacy.render(doc, style="ent", jupyter=True)
This affects the heart ORGAN , stomach ORGAN , and pancreas ORGAN .
The lemma of the token in the working phrases for "pancreas" is "pancreas" and for the bug it is "pancrea". That isn't a real word.
Your Environment
spaCy version: 2.2.1
Platform: Windows-10-10.0.18362-SP0
Python version: 3.7.3