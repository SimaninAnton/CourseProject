Contributor
BreakBB commented on 10 Jul 2019
I am currently working with texts that include a lot of quotes and direct speech. The problem I am facing is that the quote tokens sometimes are registered as single token sentences instead of part of the sentence. The thing is that the token after an opening quote “ can be considered to be is_sent_start as well so the quote will be a sentence with just one token.
With the custom sentence segmentation I found a solution but I am wondering if this is intended or just a problem with the models.
import spacy
nlp = spacy.load("en")
text = u"“I want this to work,” says a man. “That would be really great.”"

print("Before\n", list(nlp(text).sents))
# [“, I want this to work,” says a man., “, That would be really great., ”]


def custom_sentencizer(doc):
    for t in doc:
        # First token is always sent_start AND
        # Token after is_left_punct should not be sent_start OR
        # Last token should not be sent_start
        if t.i != 0 and (t.nbor(-1).is_left_punct or t.i == len(doc) - 1):
            t.is_sent_start = False
    return doc


nlp.add_pipe(custom_sentencizer, before="parser")

doc = nlp(text)
print("\nAfter:\n", list(doc.sents))
# [“I want this to work,” says a man., “That would be really great.”]
Your Environment
Operating System: Windows 10
Python Version Used: 3.7.3
spaCy Version Used: 2.1.4
1