Contributor
juliamakogon commented on 4 Jul 2019 â€¢
edited
How to reproduce the behaviour
The code below works with longer text like "John Doe goes," but fails when the entity and the sentence coincide.
    nlp_en = spacy.blank(language)
    sentencizer = nlp_en.create_pipe("sentencizer")
    nlp_en.add_pipe(sentencizer)

    doc = nlp_en("John Doe")
    doc_ents = []
    taghash = nlp_en.vocab.strings.add('PERSON')
    doc_ents.append(Span(doc, 0, 2, label=taghash))
    merge_ents = nlp_en.create_pipe("merge_entities")
    doc.ents = doc_ents
    for ent in doc.ents:
        print(ent, '*', ent.sent) # John Doe * John Doe
        assert ent is not None
        assert ent.sent is not None
    doc = merge_ents(doc)
    for ent in doc.ents:
        print(ent, '*', ent.sent) # John Doe * None
        assert ent is not None
        assert ent.sent is not None
Your Environment
spaCy version: 2.1.4
Platform: Linux-4.15.0-54-generic-x86_64-with-debian-buster-sid
Python version: 3.6.7
Models: en, en_core_web_md, xx