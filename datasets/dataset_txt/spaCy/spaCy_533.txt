JohnStuartRutledge commented on 14 Jul 2019 â€¢
edited
How to reproduce the behaviour
It would appear that calling to_json() on a Doc that was created via the as_doc() method is prone to failure. This may very well be connected to other issues with with as_doc like the that mentioned in issue #3669
import spacy

nlp = spacy.load('en')
doc = nlp('He jests at scars, that never felt a wound.')
span = doc[0:3]      # "He jests at"
doc2 = span.as_doc()
doc2.to_json()
# IndexError: [E040] Attempt to access token at 7, max length 3.
The above error seems to trigger when second token of the span (jests), calls spacy.tokens.Token.head.__get__() and hits the self.c.head
Environment
spaCy version: 2.1.6
Platform: Darwin-18.6.0-x86_64-i386-64bit
Python version: 3.6.4
Models: en