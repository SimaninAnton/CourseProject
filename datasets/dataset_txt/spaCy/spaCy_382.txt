gsoul commented on 28 Aug 2019
Hey everyone.
First of all I'd like to thank Spacy creators for such an amazing tool. Unfortunately either I'm doing something wrong or I found a bug.
I've got the following text:
My dark eyes had the look of held back tears. "It’s okay," I said
And what I'm trying to achieve is so that the split for the sentence would happen after '.' and not after '"'. Here's the code I use to try solve this issue, which is based on this manual page (https://spacy.io/usage/linguistic-features#sbd-custom) and some Googling:
import spacy


def custom_sentencizer(doc):
    for t in doc:
        if (t.text == '"') and (not t.whitespace_) and (t.nbor(-1).whitespace_): # and t.nbor(1).is_sent_start:
            doc[t.i].is_sent_start = True
            doc[t.nbor(1).i].is_sent_start = False

    return doc


nlp = spacy.load('en_core_web_sm', disable=['parser', 'tagger'])
nlp.max_length = 1500000
nlp.add_pipe(nlp.create_pipe('sentencizer'))
nlp.add_pipe(custom_sentencizer, after="sentencizer")



input = "My dark eyes had the look of held back tears. \"It’s okay,\" I said"
doc = nlp(input)
for sentence in doc.sents:
    print(sentence.text)
Any help would be greatly appreciated.
About my environment:
Ubuntu 18.04
Python 3.7
spacy==2.1.1