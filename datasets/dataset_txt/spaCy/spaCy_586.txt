marina-sp commented on 25 Jun 2019
Hello, I'm working with spacy a lot, and I especially like the spacy.matchers! But I think I found something that is not working properly (yet).
If a pattern contains a pattern element with a specified OP followed by another optional pattern element with OP=?, then all other restrictions one the first element (like ORTH or REGEX) are ignored.
How to reproduce
import spacy
import de_core_news_sm
from spacy.matcher import Matcher

nlp = de_core_news_sm.load()

text = 'Das ist ein Test.'
doc = nlp(text)
assert(len(doc) == 5)

pattern1 = [
    {'ORTH': 'Das', 'OP': '?'}, 
    {'OP': '?'},
    {'ORTH': 'Test'}
]
matcher = Matcher(nlp.vocab)
matcher.add('rule1', None, pattern1)
matches = matcher(doc) 
assert(len(matches) == 2)   # fails because of a FP match 'ist ein Test'
False positives appear on other OPs as well:
My Environment
spaCy version: 2.1.4
Platform: Windows-10-10.0.17763-SP0
Python version: 3.7.3
I hope this is helpful and you will be able to look into it. Thank you in advance!