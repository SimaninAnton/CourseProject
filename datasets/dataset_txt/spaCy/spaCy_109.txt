JohnGiorgi commented on 27 Nov 2019 â€¢
edited
How to reproduce the behaviour
Simply run the provided pretrain_kb.py and train_entity_linker.py scripts. E.g.
python pretrain_kb.py -m en_core_web_lg -n 1 -o ./tmp
python train_entity_linker.py ./tmp/kb ./tmp/vocab -o ./tmp -n 1       
During the execution of the second command, a KeyError is raised with the following traceback
Created blank 'en' model with vocab from 'tmp/vocab'
Loaded Knowledge Base from 'tmp/kb'
('Russ Cochran his reprints include EC Comics.', 'Russ Cochran captured his first major title with his son as caddie.', 'Russ Cochran has been publishing comic art.', "Russ Cochran was a member of University of Kentucky's golf team.") ({'links': {(0, 12): {'Q7381115': 1.0, 'Q2146908': 0.0}}}, {'links': {(0, 12): {'Q7381115': 0.0, 'Q2146908': 1.0}}}, {'links': {(0, 12): {'Q7381115': 1.0, 'Q2146908': 0.0}}}, {'links': {(0, 12): {'Q7381115': 0.0, 'Q2146908': 1.0}}})
Traceback (most recent call last):
  File "train_entity_linker.py", line 167, in <module>
    plac.call(main)
  File "/Users/johngiorgi/miniconda3/envs/el/lib/python3.7/site-packages/plac_core.py", line 367, in call
    cmd, result = parser.consume(arglist)
  File "/Users/johngiorgi/miniconda3/envs/el/lib/python3.7/site-packages/plac_core.py", line 232, in consume
    return cmd, self.func(*(args + varargs + extraopts), **kwargs)
  File "train_entity_linker.py", line 127, in main
    sgd=optimizer,
  File "/Users/johngiorgi/miniconda3/envs/el/lib/python3.7/site-packages/spacy/language.py", line 515, in update
    proc.update(docs, golds, sgd=get_grads, losses=losses, **kwargs)
  File "pipes.pyx", line 1219, in spacy.pipeline.pipes.EntityLinker.update
KeyError: (0, 12)
There is another closed issue (#4469) that reports this same problem. Suggestions are to use the latest version of SpaCy (I tried with 2.2.2 and 2.2.3) and to update the line
kb = KnowledgeBase(vocab=nlp.vocab)
in pretrain_kb.py with
kb = KnowledgeBase(vocab=nlp.vocab, entity_vector_length=64)
This solution did not work for me (I recieve the same error as above).
Your Environment
spaCy version: 2.2.2
Platform: Darwin-19.0.0-x86_64-i386-64bit
Python version: 3.7.5
1