oliviercwa commented on 5 Dec 2019
How to reproduce the behaviour
1- Load vocab from any spacy model
2- Instantiate EntityRecognizer with vocab
3- Load EntityRecognizer model from disk by passing either the 'ner' folder path or the model root pat
import os
import sys
from distutils.sysconfig import get_python_lib
from spacy.pipeline import EntityRecognizer
from spacy.vocab import Vocab
import spacy

model_path = os.path.join(get_python_lib(), 'en_core_web_sm')
vocab = Vocab()  
vocab = vocab.from_disk(os.path.join(model_path,'en_core_web_sm-2.1.0', 'vocab'))
ner = EntityRecognizer(vocab)
ner.from_disk(os.path.join(model_path,'en_core_web_sm-2.1.0', 'ner'))
Result:
Passing the NER folder path ==>
"ValueError: Can't read file: ...\Python\Python37\Lib\site-packages\en_core_web_sm\en_core_web_sm-2.1.0\ner\vocab\strings.json"
Passing the root folder path ==>
FileNotFoundError: [Errno 2] No such file or directory: ...\Python\Python37\Lib\site-packages\en_core_web_sm\en_core_web_sm-2.1.0\moves'
Expected:
Be able to load independently each component model
Notes:
1- the model is located in the folder and all the folders exist.
2- You can load the full pipeline using spacy.load, but in certain scenarios we need to load independently each component model.
3- The issue is that the EntityRecognizer needs files in both the NER folder and in the VOCAB folder and there does not seem to be a way to pass both paths.
4- The workaround is to disable the vocab:
ner.from_disk(os.path.join(model_path,'en_core_web_sm-2.1.0', 'ner'), exclude = ['vocab'])
Your Environment
Operating System: Win 10
Python Version Used: 3.7.4
spaCy Version Used: 2.1.9
Environment Information: