ryszardtuora commented on 8 Oct 2019
Ever since the 2.2 update I've been having trouble training parser models. Training both taggers and NER is fine, but with parsers I get an error:
Training pipeline: ['parser']
Starting with blank model 'pl'
Loading vector from model 'vocab_kgr_100_handpruned22'
Counting training words (limit=0)

Itn  Dep Loss    UAS     LAS    Token %  CPU WPS
---  ---------  ------  ------  -------  -------
✔ Saved model to output directory                                                                                                             
base_parser_22/model-final
⠴ Creating best model...
Traceback (most recent call last):
  File "/home/rtuora/.local/lib/python3.6/site-packages/spacy/cli/train.py", line 356, in train
    for batch in util.minibatch_by_words(train_docs, size=batch_sizes):
  File "/home/rtuora/.local/lib/python3.6/site-packages/spacy/util.py", line 569, in minibatch_by_words
    doc, gold = next(items)
  File "gold.pyx", line 222, in train_docs
  File "gold.pyx", line 240, in iter_gold_docs
  File "gold.pyx", line 258, in spacy.gold.GoldCorpus._make_docs
ValueError: need more than 0 values to unpack

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/rtuora/.local/lib/python3.6/site-packages/spacy/__main__.py", line 35, in <module>
    plac.call(commands[command], sys.argv[1:])
  File "/home/rtuora/.local/lib/python3.6/site-packages/plac_core.py", line 328, in call
    cmd, result = parser.consume(arglist)
  File "/home/rtuora/.local/lib/python3.6/site-packages/plac_core.py", line 207, in consume
    return cmd, self.func(*(args + varargs + extraopts), **kwargs)
  File "/home/rtuora/.local/lib/python3.6/site-packages/spacy/cli/train.py", line 486, in train
    best_model_path = _collate_best_model(meta, output_path, nlp.pipe_names)
  File "/home/rtuora/.local/lib/python3.6/site-packages/spacy/cli/train.py", line 554, in _collate_best_model
    path2str(best_component_src / component), path2str(best_dest / component)
TypeError: unsupported operand type(s) for /: 'NoneType' and 'str'
How to reproduce the behaviour
I've converted the data with spaCy 2.2 converter. I run the train command with this input:
nice -n 19 python3 -m spacy train pl base_parser_22 LFG22/pl_lfg-ud-train.json LFG22/pl_lfg-ud-dev.json --pipeline parser --vectors vocab_kgr_100_handpruned22 --n-iter 50 --n-early-stopping 10 -G
I've tried this with other treebanks and the error persists. I do not recall encountering anything like it in the previous version.
Your Environment
spaCy version: 2.2.1
Platform: Linux-4.15.0-58-generic-x86_64-with-Ubuntu-18.04-bionic
Python version: 3.6.8