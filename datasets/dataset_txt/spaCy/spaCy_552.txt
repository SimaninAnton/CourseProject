shaked571 commented on 9 Jul 2019 •
edited
Can't dump a ruler with utf-8 pattern:
 from spacy.pipeline import EntityRuler
        import en_core_web_md
        nlp = en_core_web_md.load()
        ruler = EntityRuler(nlp, overwrite_ents=True)
        ruler.add_patterns( {"label": "CALENDAREVENT", "pattern": [{"lower": "day"}, {"lower": "of"}, {"lower": "andalucía"}]})
       ruler.to_disk('my/path/config') # also tried with ('my/path/config', ensure_ascii=False, encoding='utf-8' 
==>my/path/config.jsonl:
{"label":"CALENDAREVENT","pattern":[{"lower":"day"},{"lower":"of"},{"lower":"andaluc\u00eda"}]}
I manage to solve it using this patch:
 def dump_ruler_nonascii(data_path, ruler):
        path = Path(os.path.join(data_path, 'config.jsonl'))
        pattern = ruler.patterns
        with open(path, "a", encoding="utf-8") as f:
            for line in pattern:
                f.write(json.dumps(line, ensure_ascii=False) + "\n")


import en_core_web_md
nlp = en_core_web_md.load()
ruler = EntityRuler(nlp, overwrite_ents=True)
ruler.add_patterns( {"label": "CALENDAREVENT", "pattern": [{"lower": "day"}, {"lower": "of"}, {"lower": "andalucía"}]})
dump_ruler_nonascii('my/path/config', ruler)
==>my/path/config.jsonl:
{"label":"CALENDAREVENT","pattern":[{"lower":"day"},{"lower":"of"},{"lower":"andalucía"}]}
Your Environment
Info about spaCy
spaCy version: 2.1.4
Platform: Windows-7-6.1.7601-SP1
Python version: 3.6.2
Environment Information: