JohnGiorgi commented 27 days ago •
edited
How to reproduce the behaviour
Simply run the provided pretrain_kb.py script. Here is my exact setup:
conda create -n spacy python=3.7 -y
conda activate spacy
pip install spacy==2.2.3
python -m spacy download en_core_web_sm 
wget https://raw.githubusercontent.com/explosion/spaCy/master/examples/training/pretrain_kb.py
python pretrain_kb.py -m en_core_web_sm -n 1 -o ./tmp
During the execution, a Shape mismatch is raised with the following traceback
Loaded model 'en_core_web_sm'
Traceback (most recent call last):
  File "pretrain_kb.py", line 131, in <module>
    plac.call(main)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/plac_core.py", line 367, in call
    cmd, result = parser.consume(arglist)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/plac_core.py", line 232, in consume
    return cmd, self.func(*(args + varargs + extraopts), **kwargs)
  File "pretrain_kb.py", line 77, in main
    encoder.train(description_list=descriptions, to_print=True)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py", line 61, in train
    processed, loss = self._train_model(description_list)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py", line 95, in _train_model
    loss = self._update(batch)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py", line 143, in _update
    np.asarray(vectors), drop=self.DROP
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/thinc/neural/_classes/feed_forward.py", line 46, in begin_update
    X, inc_layer_grad = layer.begin_update(X, drop=drop)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/thinc/check.py", line 155, in checked_function
    check(arg_id, fix_args, kwargs)
  File "/Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/thinc/check.py", line 74, in has_shape_inner
    raise ShapeMismatchError(arg.shape, shape_values, shape)
thinc.exceptions.ShapeMismatchError: 

  Shape mismatch: input (2, 0) not compatible with [None, 300].

  Traceback:
  ├─ train in /Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py:61
  ├─── _train_model in /Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py:95
  └───── _update in /Users/johngiorgi/miniconda3/envs/spacy/lib/python3.7/site-packages/bin/wiki_entity_linking/train_descriptions.py:143
         >>> np.asarray(vectors), drop=self.DROP
Your Environment
spaCy version: 2.2.3
Platform: Darwin-19.2.0-x86_64-i386-64bit
Python version: 3.7.5