Contributor
danielkingai2 commented on 15 Oct 2019 â€¢
edited
How to reproduce the behaviour
Same issue as #4386, #4388 doesn't quite fix it, as the first element of the tuple here:
spaCy/spacy/vectors.pyx
Line 340 in 2d249a9
 sorted_index = xp.arange(scores.shape[0])[:,None],xp.argsort(scores[i:i+batch_size], axis=1)[:,::-1] 
still has the shape of the full array instead of the batch. Pretty sure it just needs to be turned into this:
sorted_index = xp.arange(scores.shape[0])[:,None][i:i+batch_size],xp.argsort(scores[i:i+batch_size], axis=1)[:,::-1]
Will open a PR in case you agree. I would also suggest not sorting if n=1 since its not necessary so I'll also add that in the PR.
Your Environment
Info about spaCy
spaCy version: 2.2.1 (master)
Platform: Linux-4.4.0-112-generic-x86_64-with-debian-stretch-sid
Python version: 3.6.7