AnnaAnia commented on 1 Oct 2019
Hi,
I have created a custom pipe with a to_disk() function to package up my model. This is however throwing an error.
Model built in spacy 2.1.5
Python 3.7
Error appearing in Python 3.6 and 3.7 and Spacy 2.1.4 - 2.1.6.
I would appreciate some guidance on how to resolve it
class EntityOptimiser(object):
    
    name="entity_optimiser"
    
    def __init__(self):
        with open(r"PATH\word_search_keys_cmpny.json", 'r') as f:
            self.search_keys=json.load(f)
        f.close()
        self.spacy = spacy.load(r"PATH\en_core_web_sm-2.1.0")
        self.ent_list=[]

    def __call__(self,doc):
        doc=self.function_1(doc)
        doc=self.function_2(doc)
        return(doc)

    def function_1(self,doc):
        """ Do something to doc """
        return (doc)    

    def function_2(self,doc):   
        """ Do something to doc """
        return (doc)

    def to_disk(self, path):
        search_keys_path = path / "search_keys.json"
        with search_keys_path.open("w", encoding="utf8") as f:
            f.write(json.dumps(self.search_keys))
        
    def from_disk(self, path, **cfg):
        search_keys_path = path / "search_keys.json"
        with search_keys_path.open("r", encoding="utf8") as f:
            self.search_keys = json.loads(f)
        return self
The error I'm getting is:
  File "C:\Anaconda351\envs\python_36\lib\site-packages\spacy\language.py", line 779, in <lambda>
    serializers[name] = lambda p, proc=proc: proc.to_disk(p, exclude=["vocab"])
TypeError: to_disk() got an unexpected keyword argument 'exclude'