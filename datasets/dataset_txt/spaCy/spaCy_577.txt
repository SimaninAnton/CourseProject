jcrousse commented on 28 Jun 2019
Description:
When trying to track the progress of the Language.pipe function with tqdm as suggested in #2318 (also tried progressbar2) it appears that the progress tracking is updated only at the end of the processing.
The below code takes about 13 seconds to run on my machine, and the tqdm progress bar "jumps" from 0 to 500 at the end of the 13 seconds.
I can "fix" the issue by setting the option batch_size to 1, but then I lose in efficiency.
If I add a custom component to track the progress (by example by printing something) the print output appears all at once at the end (if last component of the pipeline) or at the very beginning before processing the text (if first component of the pipeline).
Maybe this is the intended behaviour, but the answer to #2318 makes me think it is not.
How to reproduce the behaviour
Took a random dataset from here
from tqdm import tqdm
import pandas as pd
import spacy

DATASET = pd.read_csv("imdb_master.csv", 
                      encoding="latin-1",  nrows=500)["review"].values

nlp = spacy.load("en_core_web_sm")

processed_docs = []
for doc in tqdm(nlp.pipe(DATASET)):
    processed_docs.append(doc)
Environment
Operating System: Ubuntu 18.04
Python Version Used: 3.6.8
spaCy Version Used: 2.1.4
Environment Information: