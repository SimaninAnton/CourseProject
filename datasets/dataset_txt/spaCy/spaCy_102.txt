theudas commented on 30 Nov 2019 â€¢
edited
How to reproduce the behaviour
I have a pipeline that sets some custom ._.attribute.
If I run my pipeline with nlp.pipe(texts, n_processes=16) it forgot that any of my custom._.attributes do exist:
Traceback (most recent call last):
File "C:\Users\psodm\Anaconda3\lib\multiprocessing\process.py", line 297, in _bootstrap
self.run()
File "C:\Users\psodm\Anaconda3\lib\multiprocessing\process.py", line 99, in run
self._target(*self._args, **self._kwargs)
File "C:\Users\psodm\Anaconda3\lib\site-packages\spacy\language.py", line 1124, in _apply_pipes
sender.send([doc.to_bytes() for doc in docs])
File "C:\Users\psodm\Anaconda3\lib\site-packages\spacy\language.py", line 1124, in
sender.send([doc.to_bytes() for doc in docs])
File "C:\Users\psodm\Anaconda3\lib\site-packages\spacy\language.py", line 1105, in _pipe
for doc in docs:
File "C:\Users\psodm\Anaconda3\lib\site-packages\spacy\language.py", line 1106, in pipe
doc = proc(doc, **kwargs)
File "C:\python\pipeline\pipeline\modules\module_inherited.py", line 26, in call
self.apply(doc, p)
File "C:\python\pipeline\pipeline\modules\module_base.py", line 28, in apply
token..affirmed = category == 0
File "C:\Users\psodm\Anaconda3\lib\site-packages\spacy\tokens\underscore.py", line 63, in setattr
raise AttributeError(Errors.E047.format(name=name))
AttributeError: [E047] Can't assign a value to unregistered extension attribute 'affirmed'. Did you forget to call the set_extension method?
My guess is, that during the pickle process the custom attributes are getting lost.
Info about spaCy
spaCy version: 2.2.3
Platform: Windows-10-10.0.18362-SP0
Python version: 3.7.4