RandomJungle commented on 26 Nov 2019
Hello,
I noticed a strange behavior when updating to new version 2.2.3 from the version I was using before, which was 2.1.4. The 'LENGTH' attribute of token used in patterns started to match on anything. Below is the piece of code I used to reproduce the error:
import spacy
from spacy.matcher import Matcher
nlp = spacy.load("fr_core_news_md")
matcher = Matcher(nlp.vocab)
pattern = [{'SHAPE': 'dddd', 'LENGTH': 9}]
matcher.add("number", None, pattern)
doc = nlp("Bonjour nous sommes bien en 2005 ! Il est 9h du matin")
matches = matcher(doc)
print(matches)
On former version, there was no match, which is expected behavior. On newer version however, I get a match on 2005, [(432, 5, 6)]. Now here's a run of the same code, without the "shape" ingredient :
import spacy
from spacy.matcher import Matcher
nlp = spacy.load("fr_core_news_md")
matcher = Matcher(nlp.vocab)
pattern = [{'LENGTH': 10}]
matcher.add("number", None, pattern)
doc = nlp("Bonjour nous sommes bien en 2005 ! Il est 9h du matin, surprenant !")
matches = matcher(doc)
if matches:
    for match in matches:
        print(doc[match[1]:match[2]])
It prints out every token of the sentence, which is odd to me, since LENGTH is listed as one of the token attribute that can be used in matcher on the official doc. Now if I run the exact same code with the former version (2.1.4) with model 2.1 of fr_core_news_md, it prints out "surprenant", which makes sense.
Is the LENGTH attribute of the token deprecated in the new model version ?