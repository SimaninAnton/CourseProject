zrlaida commented on 8 Oct 2019 â€¢
edited
How to reproduce the behaviour
In the example from the documentation https://spacy.io/api/phrasematcher
the callback function is not executed:
import spacy

nlp = spacy.load("en_core_web_sm")

def on_match(matcher, doc, id, matches):
      print('Matched!', matches)

matcher = spacy.matcher.PhraseMatcher(nlp.vocab)
matcher.add("OBAMA", on_match, nlp("Barack Obama"))
matcher.add("HEALTH", on_match, nlp("health care reform"),
                                  nlp("healthcare reform"))
doc = nlp("Barack Obama urges Congress to find courage to defend his healthcare reforms")
matches = matcher(doc)

for match in matches:
    print("Match: ", match, nlp.vocab.strings[match[0]])
And another example:
import spacy

def on_match(matcher, doc, id, matches):
    print('Callback executes on matches!', matches)

nlp = spacy.load("en_core_web_sm")
matcher = spacy.matcher.PhraseMatcher(nlp.vocab)
matcher.add("OBAMA", on_match, nlp("Barack Obama"))
matcher.add("HEALTH", on_match, nlp("health care reform"), nlp("healthcare reform"))
doc = nlp("Barack Obama urges Congress to find courage to defend his healthcare reform")
print("Start matching. Print in on_match should come after this.")
matches = matcher(doc)
for match in matches:
    print("Match: ", match, nlp.vocab.strings[match[0]])
My Environment
Operating System: MacOS 10.13.3
Python Version Used: 3.7.0
spaCy Version Used: 2.2.1
Environment Information:
1