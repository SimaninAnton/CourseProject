ChrisPalmerNZ commented on 10 Nov 2019 â€¢
edited
How to reproduce the problem
I am on Windows 10, Python 3.6.8. I installed spaCy and ran it with no problem until I switched my conda prompt to a directory which has a lot of github sites in sub-directores, including an older cupy one. Then when I start python and issue import spacy I get the following error (below). If I rename the cupy directory and restart then the error goes away. So, it seems that the thinc component used by spaCy is looking for and finding a cupy directory relative to where it is invoked, rather than to the site-packages directory where spaCy and thinc are installed.
This may be "by-design" as Python may naturally look locally before referring back to site-directories for its libraries - please confirm if that's the case, and I will consider it as a "trap for (relatively) young players"...
In [1]: import spacy
   ...:
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-76a01d9c502b> in <module>
----> 1 import spacy

g:\anaconda3\envs\deep-learning\lib\site-packages\spacy\__init__.py in <module>
      8
      9 # These are imported as part of the API
---> 10 from thinc.neural.util import prefer_gpu, require_gpu
     11
     12 from . import pipeline

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\__init__.py in <module>
      2 from __future__ import unicode_literals
      3
----> 4 from ._classes.model import Model  # noqa: F401

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\_classes\model.py in <module>
      9
     10 from .. import util
---> 11 from ..train import Trainer
     12 from ..ops import NumpyOps, CupyOps
     13 from ..mem import Memory

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\train.py in <module>
      5 from tqdm import tqdm
      6
----> 7 from .optimizers import Adam, linear_decay
      8
      9

optimizers.pyx in init thinc.neural.optimizers()

ops.pyx in init thinc.neural.ops()

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\_custom_kernels.py in <module>
     35 PWD = Path(__file__).parent
     36 SRC = (PWD / "_custom_kernels.cu").open("r", encoding="utf8").read()
---> 37 KERNELS = compile_kernels(SRC)
     38
     39 MMH_SRC = (PWD / "_murmur3.cu").open("r", encoding="utf8").read()

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\_custom_kernels.py in compile_kernels(src)
     25         return defaultdict(lambda: None)
     26     kernels = parse_kernels(src)
---> 27     return {name: cupy.RawKernel(src, name) for name, src in kernels.items()}
     28
     29 def compile_mmh(src):

g:\anaconda3\envs\deep-learning\lib\site-packages\thinc\neural\_custom_kernels.py in <dictcomp>(.0)
     25         return defaultdict(lambda: None)
     26     kernels = parse_kernels(src)
---> 27     return {name: cupy.RawKernel(src, name) for name, src in kernels.items()}
     28
     29 def compile_mmh(src):

AttributeError: module 'cupy' has no attribute 'RawKernel'
Your Environment
Operating System: Windows 10
Python Version Used: 3.6.8
spaCy Version Used: 2.2.2
Environment Information: