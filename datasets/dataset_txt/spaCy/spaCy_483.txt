Collaborator
adrianeboyd commented on 26 Jul 2019
The textcat component doesn't seem to handle empty texts well.
How to reproduce the behaviour
nlp = spacy.load("/path/to/textcat-model")
nlp("")
The errors are different depending on the type of model, but both bow and simple_cnn crash with an IndexError in thinc.
For bow:
  File "/home/adriane/spacy/venv/spacy21/lib/python3.7/site-packages/thinc/neural/_classes/feed_forward.py", line 46, in begin_update
    X, inc_layer_grad = layer.begin_update(X, drop=drop)
  File "linear.pyx", line 45, in thinc.linear.linear.LinearModel.begin_update
  File "linear.pyx", line 67, in thinc.linear.linear.LinearModel._begin_cpu_update
IndexError: Out of bounds on buffer access (axis 0)
For simple_cnn:
  File "/home/adriane/spacy/venv/spacy21/lib/python3.7/site-packages/thinc/api.py", line 310, in predict
    X = layer(layer.ops.flatten(seqs_in, pad=pad))
  File "ops.pyx", line 113, in thinc.neural.ops.Ops.flatten
IndexError: list index out of range
Your Environment
spaCy version: 2.1.6
Platform: Linux-4.19.0-5-amd64-x86_64-with-debian-10.0
Python version: 3.7.3