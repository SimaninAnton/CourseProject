Make shell completion DRYer and less hacky