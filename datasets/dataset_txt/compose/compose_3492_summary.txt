Supporting graceful upgrades and zero-downtime dpeloys