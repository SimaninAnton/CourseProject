Contributor
fridex commented on 30 Apr 2018
Pipenv fails resolution when extras are used.
$ python -m pipenv.help output
$ pipenv install 'selinon[celery]'
Adding selinon[celery] to Pipfile's [packages]…
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.Hint: try $ pipenv lock --pre if it is a pre-release dependency
Could not find a version that matches selinon[celery]
Tried: 0.1.0rc2, 0.1.0rc3, 0.1.0rc4, 0.1.0rc4, 0.1.0rc5, 0.1.0rc5, 0.1.0rc6, 0.1.0rc6, 0.1.0rc7, 0.1.0rc7, 0.1.0rc8, 0.1.0rc8, 0.1.0rc9, 0.1.0rc9, 1.0.0rc1, 1.0.0rc1, 1.0.0rc2, 1.0.0rc2, 1.0.0rc3, 1.0.0rc3, 1.0.0rc4, 1.0.0rc4
There are incompatible versions in the resolved dependencies.
However, if I explicitly specify version, the Pipfile.lock is correctly created:
$ pipenv install 'selinon[celery]==1.0.0rc4'
Expected result
The Pipenv.lock is correctly created even without specifying version explicitly.
Actual result
The lockfile is not correctly created, pipenv exits in ROUND 1 during resolution:
...
Using pip: -i https://pypi.org/simple

                          ROUND 1                           
Current constraints:

Finding the best candidates:

Finding secondary dependencies:
------------------------------------------------------------
Result of round 1: stable, done

Locking [packages] dependencies…
Using pip: -i https://pypi.org/simple

                          ROUND 1                           
Current constraints:
  selinon[celery]

Finding the best candidates:
Using pip: -i https://pypi.org/simple

                          ROUND 1                           
Current constraints:
  selinon[celery]

Finding the best candidates:

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
...
Steps to replicate
Just try to install selinon[celery] in a new environment:
$ pipenv install 'selinon[celery]'