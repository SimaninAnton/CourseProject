wearpants commented on 3 Apr 2018 •
edited
Attempting to install matplotlib using pipenv erroneously pulls in subprocess32. Installing directly with pip under a virtualenv works correctly. My python setup is a described by jacobian (ie, pyenv->pipsi->pipenv). This is on Raspbian GNU/Linux 9.4 (stretch), an ARM platform.
$ python -m pipenv.help output
Expected result
Matplotlib successfully installed
Actual result
Matplotlib install fails b/c it's trying to pull in subprocess32, which is not needed by Python3.6. Full log attached. pipenv-matplotlib.log
pi@raspberrypi:~/tmp$ pipenv install matplotlib -v 2>&1 |tee pipenv-matplotlib.log
Creating a virtualenv for this project…
Using /home/pi/.pyenv/versions/3.6.4/bin/python3.6m (3.6.4) to create virtualenv…
Running virtualenv with interpreter /home/pi/.pyenv/versions/3.6.4/bin/python3.6m
Using base prefix '/home/pi/.pyenv/versions/3.6.4'
New python executable in /home/pi/.local/share/virtualenvs/pi-V9tpwFal/bin/python3.6m
Also creating executable in /home/pi/.local/share/virtualenvs/pi-V9tpwFal/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /home/pi/.local/share/virtualenvs/pi-V9tpwFal
Installing matplotlib…

...

INFO:notpip.req.req_set:Collecting subprocess32==3.2.7
INFO:pip9.download:File was already downloaded /home/pi/.cache/pipenv/pkgs/subprocess32-3.2.7.tar.gz
INFO:pip9.utils:Complete output from command python setup.py egg_info:
INFO:pip9.utils:This backport is for Python 2.x only.

----------------------------------------
Traceback (most recent call last):
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/resolver.py", line 82, in <module>
    main()
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/resolver.py", line 71, in main
    clear=do_clear,
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/resolver.py", line 63, in resolve
    verbose=verbose,
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/utils.py", line 425, in resolve_deps
    pre,
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/utils.py", line 336, in actually_resolve_reps
    resolved_tree.update(resolver.resolve(max_rounds=PIPENV_MAX_ROUNDS))
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 102, in resolve
    has_changed, best_matches = self._resolve_one_round()
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 200, in _resolve_one_round
    for dep in self._iter_dependencies(best_match):
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 297, in _iter_dependencies
    dependencies = self.repository.get_dependencies(ireq)
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 174, in get_dependencies
    legacy_results = self.get_legacy_dependencies(ireq)
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 222, in get_legacy_dependencies
    result = reqset._prepare_file(self.finder, ireq, ignore_requires_python=True)
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/notpip/req/req_set.py", line 644, in _prepare_file
    abstract_dist.prep_for_dist()
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/patched/notpip/req/req_set.py", line 134, in prep_for_dist
    self.req_to_install.run_egg_info()
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/pip9/req/req_install.py", line 439, in run_egg_info
    command_desc='python setup.py egg_info')
  File "/home/pi/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/pip9/utils/__init__.py", line 707, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pip9.exceptions.InstallationError: Command "python setup.py egg_info" failed with error code 1 in /tmp/tmp4e0pkookbuild/subprocess32/
Steps to replicate
run pipenv install matplotlib