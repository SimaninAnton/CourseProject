ivan-alles commented on 26 Nov 2018 •
edited by uranusjr
Issue description
For investigating of this problem I created a public SVN repository. It contains a ^ character in the path: https://eu-subversion.assembla.com/svn/testuuu^testuuu-first-space/test_pyenv/trunk/test_package_1
I tried to install a package from it using pipenv:
pipenv install -e svn+https://eu-subversion.assembla.com/svn/testuuu^testuuu-first-space/test_pyenv/trunk/test_package_1#egg=test-package1
This fails because the pipenv misses the ^ character (see below).
Expected result
The package should be installed. It works with pip, if I quote the path:
pip install -e "svn+https://eu-subversion.assembla.com/svn/testuuu^testuuu-first-space/test_pyenv/trunk/test_package_1#egg=test-package1"
Quoting does not help with pipenv.
Actual result
c:\Python36\Scripts\pipenv --verbose install -e svn+https://eu-subversion.assemb
la.com/svn/testuuu^testuuu-first-space/test_pyenv/trunk/test_package_1#egg=test-package1
Installing -e svn+https://eu-subversion.assembla.com/svn/testuuutestuuu-first-space/test_pyenv/trunk/test_package_1#egg=test-package1…
[    ] Installing...Installing 'test-package1'
$ ['C:\\Users\\ivan\\.virtualenvs\\test_pipenv-4FKtD8uM\\Scripts\\pip.exe', 'install', '--src', 'C:\\Users\\ivan\\.virtualenvs\\test_pipenv-4FKtD8uM\\src', '--v
erbose', '--upgrade', '-e', 'svn+https://eu-subversion.assembla.com/svn/testuuutestuuu-first-space/test_pyenv/trunk/test_package_1#egg=test-package1', '-i', 'ht
tps://pypi.org/simple']
Adding test-package1 to Pipfile's [packages]…
Installation Succeeded
Pipfile.lock (c58142) out of date, updating to (6c5ddb)…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
[    ] Pinning VCS Packages...INFO:pipenv.patched.notpip._internal.vcs.subversion:Checking out https://eu-subversion.assembla.com/svn/testuuutestuuu-first-space
/test_pyenv/trunk/test_package_1 to c:\users\ivan\appdata\local\temp\requirementslibqlbhaoiy\test-package1
[=   ] Pinning VCS Packages...svn: E170013: Unable to connect to a repository at URL 'https://eu-subversion.assembla.com/svn/testuuutestuuu-first-space/test_pye
nv/trunk/test_package_1'
svn: E175009: The XML response contains invalid XML
svn: E130003: Malformed XML: no element found
Traceback (most recent call last):
  File "c:\Python36\Scripts\pipenv-script.py", line 11, in <module>
    load_entry_point('pipenv', 'console_scripts', 'pipenv')()
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 717, in main
    rv = self.invoke(ctx)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\click\decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "c:\python36\scripts\src\pipenv\pipenv\cli\command.py", line 250, in install
    editable_packages=state.installstate.editables,
  File "c:\python36\scripts\src\pipenv\pipenv\core.py", line 2005, in do_install
    skip_lock=skip_lock,
  File "c:\python36\scripts\src\pipenv\pipenv\core.py", line 1214, in do_init
    pypi_mirror=pypi_mirror,
  File "c:\python36\scripts\src\pipenv\pipenv\core.py", line 1061, in do_lock
    lockfile=lockfile
  File "c:\python36\scripts\src\pipenv\pipenv\utils.py", line 612, in venv_resolve_deps
    dev=dev,
  File "c:\python36\scripts\src\pipenv\pipenv\utils.py", line 1294, in get_vcs_deps
    with locked_repository(requirement) as repo:
  File "c:\python36\lib\contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "c:\python36\scripts\src\pipenv\pipenv\utils.py", line 1430, in locked_repository
    with requirement.req.locked_vcs_repo(src_dir=src_dir) as repo:
  File "c:\python36\lib\contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\requirementslib\models\requirements.py", line 840, in locked_vcs_repo
    vcsrepo = self.get_vcs_repo(src_dir=src_dir)
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\requirementslib\models\requirements.py", line 802, in get_vcs_repo
    vcsrepo.obtain()
  File "c:\python36\scripts\src\pipenv\pipenv\vendor\requirementslib\models\vcs.py", line 37, in obtain
    self.repo_instance.obtain(self.checkout_directory)
  File "c:\python36\scripts\src\pipenv\pipenv\patched\notpip\_internal\vcs\__init__.py", line 332, in obtain
    self.fetch_new(dest, url, rev_options)
  File "c:\python36\scripts\src\pipenv\pipenv\patched\notpip\_internal\vcs\subversion.py", line 54, in fetch_new
    self.run_command(cmd_args)
  File "c:\python36\scripts\src\pipenv\pipenv\patched\notpip\_internal\vcs\__init__.py", line 456, in run_command
    spinner=spinner)
  File "c:\python36\scripts\src\pipenv\pipenv\patched\notpip\_internal\utils\misc.py", line 705, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pipenv.patched.notpip._internal.exceptions.InstallationError: Command "svn checkout -q https://eu-subversion.assembla.com/svn/testuuutestuuu-first-space/test_py
env/trunk/test_package_1 C:\Users\ivan\AppData\Local\Temp\requirementslibqlbhaoiy\test-package1" failed with error code 1 in None
The ^ charachter is missing in the path pipenv is trying to check out.
Steps to replicate
See actual result.
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
$ pipenv --support