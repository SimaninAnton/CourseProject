bbarker commented on 27 Feb 2018
The first bit of the error is: note that /home/b/ is not a directory on my system.
Warning: Your Pipfile requires python_version 3.6, but you are using None (/home/b/.local/share/v/a/bin/python).                                                                                                                                                               
  $ pipenv check will surely fail.    
Describe your environment
OS Type: Ubuntu 16.04 with nixpkgs
Python version: $ python -V: Python 3.6.4
Pipenv version: $ pipenv --version: pipenv, version 10.1.0
Expected result
A successful installation of packages
Actual result
When I install my environment from default.nix (I will paste the relevant lines below), I get this:
$ nix-shell default.nix                                                                                                                                                                                                                                                        
Using base prefix '/nix/store/p1bp0kpmxi7nzrla7n7c4waqic0a2myk-python3-3.6.4'                                                                                                                                                                                                  
New python executable in /home/brandon/workspace/arxiv-accounts/venv/bin/python3.6m                                                                                                                                                                                            
Not overwriting existing python script /home/brandon/workspace/arxiv-accounts/venv/bin/python (you must use /home/brandon/workspace/arxiv-accounts/venv/bin/python3.6m)                                                                                                        
Installing setuptools, pip, wheel...done.                                                                                                                                                                                                                                      
Requirement already satisfied: pipenv in ./venv/lib/python3.6/site-packages                                                                                                                                                                                                    
Requirement already satisfied: virtualenv in ./venv/lib/python3.6/site-packages (from pipenv)                                                                                                                                                                                  
Requirement already satisfied: urllib3>=1.21.1 in ./venv/lib/python3.6/site-packages (from pipenv)                                                                                                                                                                             
Requirement already satisfied: pew>=0.1.26 in ./venv/lib/python3.6/site-packages (from pipenv)                                                                                                                                                                                 
Requirement already satisfied: requests>2.18.0 in ./venv/lib/python3.6/site-packages (from pipenv)                                                                                                                                                                             
Requirement already satisfied: pip>=9.0.1 in ./venv/lib/python3.6/site-packages (from pipenv)                                                                                                                                                                                  
Requirement already satisfied: virtualenv-clone>=0.2.5 in ./venv/lib/python3.6/site-packages (from pew>=0.1.26->pipenv)                                                                                                                                                        
Requirement already satisfied: setuptools>=17.1 in ./venv/lib/python3.6/site-packages (from pew>=0.1.26->pipenv)                                                                                                                                                               
Requirement already satisfied: idna<2.7,>=2.5 in ./venv/lib/python3.6/site-packages (from requests>2.18.0->pipenv)                                                                                                                                                             
Requirement already satisfied: chardet<3.1.0,>=3.0.2 in ./venv/lib/python3.6/site-packages (from requests>2.18.0->pipenv)                                                                                                                                                      
Requirement already satisfied: certifi>=2017.4.17 in ./venv/lib/python3.6/site-packages (from requests>2.18.0->pipenv)                                                                                                                                                         
Warning: Your Pipfile requires python_version 3.6, but you are using None (/home/b/.local/share/v/a/bin/python).                                                                                                                                                               
  $ pipenv check will surely fail.                                                                                                                                                                                                                                             
Installing dependencies from Pipfile.lock (dca5f5)‚Ä¶                                                                                                                                                                                                                            
Traceback (most recent call last):‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/54 ‚Äî 00:00:00                                                                                                                                                                                                                        
  File "/home/brandon/workspace/arxiv-accounts/venv/bin/pipenv", line 11, in <module>                                                                                                                                                                                          
    sys.exit(cli())                                                                                                                                                                                                                                                            
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__                                                                                                                                            
    return self.main(*args, **kwargs)                                                                                                                                                                                                                                          
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 697, in main                                                                                                                                                
    rv = self.invoke(ctx)                                                                                                                                                                                                                                                      
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke                                                                                                                                             
    return _process_result(sub_ctx.command.invoke(sub_ctx))                                                                                                                                                                                                                    
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 895, in invoke                                                                                                                                              
    return ctx.invoke(self.callback, **ctx.params)                                                                                                                                                                                                                             
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 535, in invoke                                                                                                                                              
    return callback(*args, **kwargs)                                                                                                                                                                                                                                           
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/cli.py", line 197, in install                                                                                                                                                           
    selective_upgrade=selective_upgrade                                                                                                                                                                                                                                        
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/core.py", line 1795, in do_install                                                                                                                                                      
    do_init(dev=dev, allow_global=system, ignore_pipfile=ignore_pipfile, system=system, skip_lock=skip_lock, verbose=verbose, concurrent=concurrent, deploy=deploy, pre=pre)                                                                                                   
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/core.py", line 1355, in do_init                                                                                                                                                         
    skip_lock=skip_lock, verbose=verbose, concurrent=concurrent)                                                                                                                                                                                                               
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/core.py", line 837, in do_install_dependencies                                                                                                                                          
    index=index                                                                                                                                                                                                                                                                
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/core.py", line 1455, in pip_install                                                                                                                                                     
    c = delegator.run(pip_command, block=block)                                                                                                                                                                                                                                
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 267, in run                                                                                                                                                  
    c.run(block=block, binary=binary)                                                                                                                                                                                                                                          
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 156, in run                                                                                                                                                  
    s = PopenSpawn(self._popen_args, **pexpect_kwargs)                                                                                                                                                                                                                         
  File "/home/brandon/workspace/arxiv-accounts/venv/lib/python3.6/site-packages/pipenv/vendor/pexpect/popen_spawn.py", line 46, in __init__                                                                                                                                    
    self.proc = subprocess.Popen(cmd, **kwargs)                                                                                                                                                                                                                                
  File "/nix/store/p1bp0kpmxi7nzrla7n7c4waqic0a2myk-python3-3.6.4/lib/python3.6/subprocess.py", line 709, in __init__                                                                                                                                                          
    restore_signals, start_new_session)                                                                                                                                                                                                                                        
  File "/nix/store/p1bp0kpmxi7nzrla7n7c4waqic0a2myk-python3-3.6.4/lib/python3.6/subprocess.py", line 1344, in _execute_child                                                                                                                                                   
    raise child_exception_type(errno_num, err_msg, err_filename)                                                                                                                                                                                                               
FileNotFoundError: [Errno 2] No such file or directory: '/home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip': '/home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip'                                                                     
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/54 ‚Äî 00:00:00                                                                                                                                                                                                                        
bash: private_vars.sh: No such file or directory                                                                                                                                                                                                                               
Warning: Your Pipfile requires python_version 3.6, but you are using None (/home/b/.local/share/v/a/bin/python).                                                                                                                                                               
  $ pipenv check will surely fail.                                                                                                                                                                                                                                             
Spawning environment shell (/nix/store/zqh3l3lyw32q1ayb15bnvg9f24j5v2p0-bash-4.4-p12/bin/bash). Use 'exit' to leave.                                                                                                                                                           
bash: complete: command not found                                                                                                                                                                                                                                              
bash: complete: command not found                                                                                                                                            
Additional strangeness is that the missing pip does exist:
$ ls -last /home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip                                                                                                                                                                                              
4 -rwxr-xr-x 1 brandon brandon 267 Feb 14 22:29 /home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip                                                                                                                                                         
(arxiv-accounts-eu8pyu8g) brandon@brandon-750-170se-DevContainer:~/workspace/arxiv-accounts                                                                                                                                                                                    
$ du -h -s /home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip                                                                                                                                                                                              
4.0K    /home/brandon/.local/share/virtualenvs/arxiv-accounts-eu8pyu8g/bin/pip                                             ```

Relevant lines from default.nix:
SOURCE_DATE_EPOCH=$(date +%s)                                                                                                                                                                                                                                              
virtualenv venv                                                                                                                                                                                                                                                            
export PATH=$PWD/venv/bin:$PATH                                                                                                                                                                                                                                            
export PYTHONPATH=$PWD                                                                                                                                                                                                                                                     
pip install pipenv                                                                                                                                                                                                                                                         
pipenv install --dev                                                                                                                                                                                                                                                       
export FLASK_APP=app.py                                                                                                                                                                                                                                                    
export FLASK_DEBUG=1                                                                                                                                                                                                                                                       
source private_vars.sh                                                                                                                                                                                                                                                     
pipenv shell             
##### Steps to replicate

I can provide a [nix container](git@github.com:CornellCAC/docker-nix-intellij.git) to easily get nix up and running, but it might be easier for someone to follow a more standard install if necessary. After that, here is my [default.nix](https://github.com/pypa/pipenv/files/1762995/default.nix.txt), which can be run using -`nix-shell default.nix`; I assume that any Pipfile would reproduce the issue, so I'm not attaching mine.
 