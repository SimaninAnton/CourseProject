jonbesga commented on 11 Apr 2019
Issue description
pipenv lock does not use the private repository to lock the dependencies.
Expected result
pipenv lock using the correct repository when locking dependencies
Actual result
See steps to replicate for more context
Locking [dev-packages] dependencies…
Locking [packages] dependencies…

⠋ Locking...�
[...]
⠋ Locking...�✔ Success! 
Using pip: -i https://user:pass@private-repo/simple
Using pip: -i https://user:pass@private-repo/simple
Using pip: -i https://user:pass@private-repo/simple

                          ROUND 1                           
Current constraints:
  ftrack-python-api==1.7.1

Finding the best candidates:
  found candidate ftrack-python-api==1.7.1 (constraint was ==1.7.1)

Finding secondary dependencies:
  ftrack-python-api==1.7.1  requires arrow<1,>=0.4.4, clique<2,>=1.2.0, pyparsing<3,>=2.0, requests<3,>=2, termcolor<2,>=1.1.0, websocket-client<1,>=0.40.0

New dependencies found in this round:
  adding ['arrow', '<1,>=0.4.4', '[]']
  adding ['clique', '<2,>=1.2.0', '[]']
  adding ['pyparsing', '<3,>=2.0', '[]']
  adding ['requests', '<3,>=2', '[]']
  adding ['termcolor', '<2,>=1.1.0', '[]']
  adding ['websocket-client', '<1,>=0.40.0', '[]']
Removed dependencies in this round:
Unsafe dependencies in this round:
------------------------------------------------------------
Result of round 1: not stable

                          ROUND 2                           
Current constraints:
  arrow<1,>=0.4.4
  clique<2,>=1.2.0
  ftrack-python-api==1.7.1
  pyparsing<3,>=2.0
  requests<3,>=2
  termcolor<2,>=1.1.0
  websocket-client<1,>=0.40.0

Finding the best candidates:
  found candidate arrow==0.13.1 (constraint was >=0.4.4,<1)
  found candidate clique==1.5.0 (constraint was >=1.2.0,<2)
  found candidate ftrack-python-api==1.7.1 (constraint was ==1.7.1)
  found candidate pyparsing==2.4.0 (constraint was >=2.0,<3)
  found candidate requests==2.21.0 (constraint was >=2,<3)
  found candidate termcolor==1.1.0 (constraint was >=1.1.0,<2)
  found candidate websocket-client==0.56.0 (constraint was >=0.40.0,<1)

Finding secondary dependencies:
  arrow==0.13.1             requires python-dateutil
  websocket-client==0.56.0  requires six
  pyparsing==2.4.0          requires -
  termcolor==1.1.0          requires -
  clique==1.5.0             requires -
  requests==2.21.0          requires certifi>=2017.4.17, chardet<3.1.0,>=3.0.2, idna<2.9,>=2.5, urllib3<1.25,>=1.21.1
  ftrack-python-api==1.7.1  requires arrow<1,>=0.4.4, clique<2,>=1.2.0, pyparsing<3,>=2.0, requests<3,>=2, termcolor<2,>=1.1.0, websocket-client<1,>=0.40.0

New dependencies found in this round:
  adding ['certifi', '>=2017.4.17', '[]']
  adding ['chardet', '<3.1.0,>=3.0.2', '[]']
  adding ['idna', '<2.9,>=2.5', '[]']
  adding ['python-dateutil', '', '[]']
  adding ['six', '', '[]']
  adding ['urllib3', '<1.25,>=1.21.1', '[]']
Removed dependencies in this round:
Unsafe dependencies in this round:
------------------------------------------------------------
Result of round 2: not stable

                          ROUND 3                           
Current constraints:
  arrow<1,>=0.4.4
  certifi>=2017.4.17
  chardet<3.1.0,>=3.0.2
  clique<2,>=1.2.0
  ftrack-python-api==1.7.1
  idna<2.9,>=2.5
  pyparsing<3,>=2.0
  python-dateutil
  requests<3,>=2
  six
  termcolor<2,>=1.1.0
  urllib3<1.25,>=1.21.1
  websocket-client<1,>=0.40.0

Finding the best candidates:
  found candidate arrow==0.13.1 (constraint was >=0.4.4,<1)
  found candidate certifi==2019.3.9 (constraint was >=2017.4.17)
  found candidate chardet==3.0.4 (constraint was >=3.0.2,<3.1.0)
  found candidate clique==1.5.0 (constraint was >=1.2.0,<2)
  found candidate ftrack-python-api==1.7.1 (constraint was ==1.7.1)
  found candidate idna==2.8 (constraint was >=2.5,<2.9)
  found candidate pyparsing==2.4.0 (constraint was >=2.0,<3)
  found candidate python-dateutil==2.8.0 (constraint was <any>)
  found candidate requests==2.21.0 (constraint was >=2,<3)
  found candidate six==1.12.0 (constraint was <any>)
  found candidate termcolor==1.1.0 (constraint was >=1.1.0,<2)
  found candidate urllib3==1.24.1 (constraint was >=1.21.1,<1.25)
  found candidate websocket-client==0.56.0 (constraint was >=0.40.0,<1)

Finding secondary dependencies:
  certifi==2019.3.9         requires -
  arrow==0.13.1             requires python-dateutil
  pyparsing==2.4.0          requires -
  python-dateutil==2.8.0    requires six>=1.5
  requests==2.21.0          requires certifi>=2017.4.17, chardet<3.1.0,>=3.0.2, idna<2.9,>=2.5, urllib3<1.25,>=1.21.1
  termcolor==1.1.0          requires -
  idna==2.8                 requires -
  chardet==3.0.4            requires -
  six==1.12.0               requires -
  websocket-client==0.56.0  requires six
  ftrack-python-api==1.7.1  requires arrow<1,>=0.4.4, clique<2,>=1.2.0, pyparsing<3,>=2.0, requests<3,>=2, termcolor<2,>=1.1.0, websocket-client<1,>=0.40.0
  urllib3==1.24.1           requires -
  clique==1.5.0             requires -

New dependencies found in this round:
  adding ['six', '>=1.5', '[]']
Removed dependencies in this round:
  removing ['six', '', '[]']
Unsafe dependencies in this round:
------------------------------------------------------------
Result of round 3: not stable

                          ROUND 4                           
Current constraints:
  arrow<1,>=0.4.4
  certifi>=2017.4.17
  chardet<3.1.0,>=3.0.2
  clique<2,>=1.2.0
  ftrack-python-api==1.7.1
  idna<2.9,>=2.5
  pyparsing<3,>=2.0
  python-dateutil
  requests<3,>=2
  six>=1.5
  termcolor<2,>=1.1.0
  urllib3<1.25,>=1.21.1
  websocket-client<1,>=0.40.0

Finding the best candidates:
  found candidate arrow==0.13.1 (constraint was >=0.4.4,<1)
  found candidate certifi==2019.3.9 (constraint was >=2017.4.17)
  found candidate chardet==3.0.4 (constraint was >=3.0.2,<3.1.0)
  found candidate clique==1.5.0 (constraint was >=1.2.0,<2)
  found candidate ftrack-python-api==1.7.1 (constraint was ==1.7.1)
  found candidate idna==2.8 (constraint was >=2.5,<2.9)
  found candidate pyparsing==2.4.0 (constraint was >=2.0,<3)
  found candidate python-dateutil==2.8.0 (constraint was <any>)
  found candidate requests==2.21.0 (constraint was >=2,<3)
  found candidate six==1.12.0 (constraint was >=1.5)
  found candidate termcolor==1.1.0 (constraint was >=1.1.0,<2)
  found candidate urllib3==1.24.1 (constraint was >=1.21.1,<1.25)
  found candidate websocket-client==0.56.0 (constraint was >=0.40.0,<1)

Finding secondary dependencies:
  arrow==0.13.1             requires python-dateutil
  six==1.12.0               requires -
  urllib3==1.24.1           requires -
  idna==2.8                 requires -
  requests==2.21.0          requires certifi>=2017.4.17, chardet<3.1.0,>=3.0.2, idna<2.9,>=2.5, urllib3<1.25,>=1.21.1
  pyparsing==2.4.0          requires -
  ftrack-python-api==1.7.1  requires arrow<1,>=0.4.4, clique<2,>=1.2.0, pyparsing<3,>=2.0, requests<3,>=2, termcolor<2,>=1.1.0, websocket-client<1,>=0.40.0
  chardet==3.0.4            requires -
  websocket-client==0.56.0  requires six
  clique==1.5.0             requires -
  python-dateutil==2.8.0    requires six>=1.5
  certifi==2019.3.9         requires -
  termcolor==1.1.0          requires -
------------------------------------------------------------
Result of round 4: stable, done


Updated Pipfile.lock (bfe865)!
Steps to replicate
The package ftrack-python-api from the public pypi (1.8.0) only support Python 2. However, there is branch in the project repository with support for Python 3. I built that branch and deployed it into my private repo. The version in the private repo is 1.7.1
After specifying the private index in the Pipfile, run pipenv lock -v (I usually have both the public pypi and the private repo but having only the private is enough to prove the problem)
One dependency that comes in the version of the package supporting Python 3 is future. which is not added in the pipfile.lock, so therefore is using the version 1.7.1 from the public repo (which doesn't contain that dependency).
To confirm that is not a problem with the package in the private repo I built it with another name 'ftrack-python-api-custom-py' and then pipenv lock fetches the correct dependencies from the private repository.
$ pipenv --support
2