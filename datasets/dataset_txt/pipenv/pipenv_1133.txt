Inveracity commented on 29 Apr 2018 •
edited
The issue
Using pipenv in a vagrant box is causing a little trouble with the symlinking.
It has been requested that --always-copy is added to pipenv when it creates the virtual environment see ( #1929) but it appears that is not gonna happen
The error
Using /usr/bin/python3.6m (3.6.5) to create virtualenv…
Running virtualenv with interpreter /usr/bin/python3.6m
Using base prefix '/usr'
New python executable in /vagrant/project/thing/.venv/bin/python3.6m
Also creating executable in /vagrant/project/thing/.venv/bin/python
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/virtualenv.py", line 2349, in <module>
    main()
  File "/usr/local/lib/python3.6/dist-packages/virtualenv.py", line 712, in main
    symlink=options.symlink)
  File "/usr/local/lib/python3.6/dist-packages/virtualenv.py", line 927, in create_environment
    site_packages=site_packages, clear=clear, symlink=symlink))
  File "/usr/local/lib/python3.6/dist-packages/virtualenv.py", line 1395, in install_python
    os.symlink(py_executable_base, full_pth)
OSError: [Errno 71] Protocol error: 'python3.6m' -> '/vagrant/project/thing/.venv/bin/python'
Environment variables
export PIPENV_VENV_IN_PROJECT=1
export PIPENV_IGNORE_VIRTUALENVS=1
commands to fix it
pipenv sync # Fails with OSError listed above
virtualenv --always-copy .venv
pipenv sync # Success!
Seen in vagrant box: ubuntu/xenial64 and ubuntu/bionic64
I hope it helps someone who got stuck with this like I did
1