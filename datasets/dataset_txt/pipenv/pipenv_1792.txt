mattjegan commented on 23 Nov 2017 â€¢
edited
When using pipenv in a CI environment occasionally the provider's internet connection becomes unstable and this can cause ConnectionErrors through pipenv. I propose that this could be handled better than just throwing a trace or logging the error by instead implementing a retry but doubling the time between tries up to some upper bound, say 16 seconds (4 tries).
Describe your environment
Alpine Linux
Python version: 3.6.0
Pipenv version: 8.2.6
Expected result
Upon failing some requests pipenv could've retried rather than throw a ConnectionError.
Actual result
.
.
.
  File "/usr/local/lib/python3.6/site-packages/pipenv/utils.py", line 495, in resolve_deps
    r = requests.get('https://pypi.org/pypi/{0}/json'.format(name), timeout=10)
  File "/usr/local/lib/python3.6/site-packages/requests/sessions.py", line 521, in get
    return self.request('GET', url, **kwargs)
  File "/usr/local/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/local/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/usr/local/lib/python3.6/site-packages/requests/adapters.py", line 490, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))
Steps to replicate
Unknown (pipenv install), because it's the peer (PyPI) that reset the connection.
1