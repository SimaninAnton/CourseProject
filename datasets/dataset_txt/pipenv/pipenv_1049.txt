Contributor
AlJohri commented on 18 May 2018 •
edited
Describe the issue briefly here.
pipenv install --system --deploy is still creating a virtualenv for some reason?
Please run $ python -m pipenv.help, and paste the results here.
$ python -m pipenv.help output
Expected result
Describe what you expected.
I expect it to use the system python only and not create a virtualenv. Here are the relevant lines from above:
Creating a virtualenv for this project…
Using /usr/local/bin/python (3.6.5) to create virtualenv…
Already using interpreter /usr/local/bin/python
Using base prefix '/usr/local'
New python executable in /root/.local/share/virtualenvs/api-P_wDauxm/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /root/.local/share/virtualenvs/api-P_wDauxm
Actual result
When possible, provide the verbose output (--verbose), especially for locking and dependencies resolving issues.
Step 14/15 : RUN pipenv install --system --deploy --verbose
 ---> Running in 7698b564e3e5
Installing '-e ../../lib/python'
Installing -e ../../lib/python…
$ "/usr/local/bin/pip" install   --verbose    -e "../../lib/python" -i https://pypi.python.org/simple --exists-action w
Created temporary directory: /tmp/pip-ephem-wheel-cache-llgkcaqi
Created temporary directory: /tmp/pip-install-ge6935bv
Looking in indexes: https://pypi.python.org/simple
Obtaining file:///code/lib/python
  Running setup.py (path:/code/lib/python/setup.py) egg_info for package from file:///code/lib/python
    Running command python setup.py egg_info
    running egg_info
    writing heliograf.egg-info/PKG-INFO
    writing dependency_links to heliograf.egg-info/dependency_links.txt
    writing top-level names to heliograf.egg-info/top_level.txt
    reading manifest file 'heliograf.egg-info/SOURCES.txt'
    writing manifest file 'heliograf.egg-info/SOURCES.txt'
  Source in /code/lib/python has version 0.1.0, which satisfies requirement heliograf==0.1.0 from file:///code/lib/python
Installing collected packages: heliograf
  Running setup.py develop for heliograf
    Running command /usr/local/bin/python -c "import setuptools, tokenize;__file__='/code/lib/python/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" develop --no-deps
    running develop
    running egg_info
    writing heliograf.egg-info/PKG-INFO
    writing dependency_links to heliograf.egg-info/dependency_links.txt
    writing top-level names to heliograf.egg-info/top_level.txt
    reading manifest file 'heliograf.egg-info/SOURCES.txt'
    writing manifest file 'heliograf.egg-info/SOURCES.txt'
    running build_ext
    Creating /usr/local/lib/python3.6/site-packages/heliograf.egg-link (link to .)
    Adding heliograf 0.1.0 to easy-install.pth file

    Installed /code/lib/python
Successfully installed heliograf
Cleaning up...

Adding -e ../../lib/python to Pipfile's [packages]…
Creating a virtualenv for this project…
Using /usr/local/bin/python (3.6.5) to create virtualenv…
Already using interpreter /usr/local/bin/python
Using base prefix '/usr/local'
New python executable in /root/.local/share/virtualenvs/api-P_wDauxm/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /root/.local/share/virtualenvs/api-P_wDauxm
Your Pipfile.lock (1190ad) is out of date. Expected: (457709).
Aborting deploy.
ERROR: Service 'app' failed to build: The command '/bin/sh -c pipenv install --system --deploy --verbose' returned a non-zero code: 1
Steps to replicate
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
It seems like it's happening everytime I run pipenv install --system --deploy. Perhaps it has something to do with the local editable package?