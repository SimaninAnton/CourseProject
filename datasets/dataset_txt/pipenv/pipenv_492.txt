asmaier commented on 31 Oct 2018 •
edited
Issue description
It seems that pipenv since version 2018.10.09 cannot detect versions of Python installed by pyenv anymore.
I experienced this issue on Mac OS X 10.13.6 with pipenv and pyenv installed via homebrew using pipenv version 2018.10.9 and also the newest version 2018.10.13 .
Expected result
When calling pipenv install pipenv should detect existing versions of Python installed by pyenv. If it doesn't find a Python version as specified in the Pipfile it should start installing the correct Python version via pyenv and then use it to create the virtual environment.
Actual result
Despite version 3.6.5 being installed and available with pyenv
$ pyenv versions
* system (set by /Users/<username>/.pyenv/version)
  3.6.5  
and despite having set PYENV_ROOT correctly
$ env | grep PYENV
PYENV_ROOT=/Users/<username>/.pyenv
pipenv does not recognize this version and tries to install a new version
$ pipenv install
Warning: Python 3.6.5 was not found on your system…
Would you like us to install CPython 3.6.5 with pyenv? [Y/n]:
And if one does install the version pipenv will claim after the installation, that it still cannot find the installed version of python
$ pipenv install
Warning: Python 3.6.5 was not found on your system…
Would you like us to install CPython 3.6.5 with pyenv? [Y/n]: Y
Installing CPython 3.6.5 with pyenv (this may take a few minutes)…
⠙
Warning: The Python you just installed is not available on your PATH, apparently.
All this used to work in pipenv 2018.7.1.
Workaround
On Mac OS X if you just recently updated your version of pipenv you can switch to an older version (2018.7.1):
$ brew list --versions pipenv
pipenv 2018.10.13 2018.7.1
$ brew switch pipenv 2018.7.1
Alternatively you can install Python via pyenv and set the python path manually when creating the virtual environment
$ pyenv install 3.6.5
$ pipenv install --dev --python=/Users/<username>/.pyenv/versions/3.6.5/bin/python
Possible cause
I'm not very familiar with the pipenv code base but the following commit seems to have removed adding of pyenv installations to the PATH:
6d7b26a?diff=unified
$ pipenv --support