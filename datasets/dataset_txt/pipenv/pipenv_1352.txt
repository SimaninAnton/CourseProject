iScrE4m commented on 14 Mar 2018
I have a Pipfile with a package packaged limited by maximum version ("tornado<=4.5.3"), and I'm installing another dependency from git, that dependency also requires tornado, however with >=3.2.
The lockfile then has these two:
        "tornado": {
            "hashes": [
                "sha256:5ef073ac6180038ccf99411fe05ae9aafb675952a2c8db60592d5daf8401f803",
                "sha256:6d14e47eab0e15799cf3cdcc86b0b98279da68522caace2bd7ce644287685f0a",
                "sha256:92b7ca81e18ba9ec3031a7ee73d4577ac21d41a0c9b775a9182f43301c3b5f8e",
                "sha256:ab587996fe6fb9ce65abfda440f9b61e4f9f2cf921967723540679176915e4c3",
                "sha256:b36298e9f63f18cad97378db2222c0e0ca6a55f6304e605515e05a25483ed51a"
            ],
            "index": "pypi",
            "version": "==4.5.3"
        },
        "shelter": {
            "git": "url-to-private-git-repo",
            "ref": "1.1.4"
        },
The problem is - sometimes tornado 5.0.0 is installed instead of 4.5.3. It happens when tornado itself installs before shelter. When shelter is being installed second, it installs 5.0.0 over 4.5.3. In the case of tornado being installed second, it uninstalls 5.0.0 and installs 4.5.3 correctly. The issue is not with locking mechanism, but installing itself. I'm trying to see if --sequential will fix it, but having nondeterministic result is not really that great with the default option.
pipenv-11.7.2, python 3.5, debian in docker.
Expected result
Tornado 4.5.3 installed ALWAYS
Actual result
Tornado 5.0.0 installed sometimes. The pipenv install --verbose log is really long, I can upload it on request.
Steps to replicate
Have a Pipfile.lock with a hard version that is not the newest
Install dependency from git that can have the newest version installed
Run this a few times, be amazed.
1