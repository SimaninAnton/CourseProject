andyneff commented on 6 Jun 2019
Issue description
It appears that environment variable expansion is not performed before the hash of a Pipfile is calculated. This results in an outdated Pipfile.lock being used when environment variables are changed.
Expected result
A lock happens when versions are changes
Actual result
A lock does not happen, and the wrong version is installed
Steps to replicate
Pipfile
[[source]]
name = "pypi"
url = "https://pypi.org/simple"
verify_ssl = true

[dev-packages]

[packages]
django = "==${DJANGO_VERSION}"
Run inside of docker run -it --rm python:3 bash
DJANGO_VERSION=2.2.1 pipenv install
pipenv run python -c "import django;print(django.__version__)"
pipenv --rm
DJANGO_VERSION=2.2.2 pipenv install
pipenv run python -c "import django;print(django.__version__)"
As you will see, 2.2.1 is still installed instead of 2.2.2. You will see on the second install that Pipfile.lock out of date, updating toâ€¦ is not displayed, telling me the hash isn't updated by the environment variable
$ pipenv --support