lbenezriravin commented on 8 Nov 2018
Issue description
Pipenv cannot create a virtualenv when the working directory contains colon.
Expected result
A virtualenv to be created as normal
Actual result
$ pwd
/home/user/a:a
$ pipenv --python 3.7 --verbose
Creating a virtualenv for this project…
Pipfile: /home/user/a:a/Pipfile
Using /usr/bin/python3.7 (3.7.0) to create virtualenv…
⠸Running virtualenv with interpreter /usr/bin/python3.7
Using base prefix '/usr'
/home/user/.local/lib/python2.7/site-packages/virtualenv.py:1041: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
  import imp
New python executable in /home/user/.local/share/virtualenvs/a:a-Oe7g_AWA/bin/python3.7
Also creating executable in /home/user/.local/share/virtualenvs/a:a-Oe7g_AWA/bin/python
Fatal Python error: initfsencoding: Unable to get the locale encoding
ModuleNotFoundError: No module named 'encodings'

Current thread 0x00007f03effaa580 (most recent call first):
ERROR: The executable /home/user/.local/share/virtualenvs/a:a-Oe7g_AWA/bin/python3.7 is not functioning
ERROR: It thinks sys.prefix is '/home/user/a:a' (should be '/home/user/.local/share/virtualenvs/a:a-Oe7g_AWA')
ERROR: virtualenv is not compatible with this system or executable

Traceback (most recent call last):
  File "/home/user/.local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 1114, in invoke
    return Command.invoke(self, ctx)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/cli/command.py", line 203, in cli
    clear=state.clear,
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/core.py", line 565, in ensure_project
    pypi_mirror=pypi_mirror,
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/core.py", line 500, in ensure_virtualenv
    python=python, site_packages=site_packages, pypi_mirror=pypi_mirror
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/core.py", line 901, in do_create_virtualenv
    click.echo(crayons.blue("{0}".format(c.err)), err=True)
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/delegator.py", line 146, in err
    return self._pexpect_out
  File "/home/user/.local/lib/python2.7/site-packages/pipenv/vendor/delegator.py", line 114, in _pexpect_out
    result += self.subprocess.after
TypeError: coercing to Unicode: need string or buffer, type found
Steps to replicate
Run any pipenv command in a directory that contains a colon in the name.
$ pipenv --support