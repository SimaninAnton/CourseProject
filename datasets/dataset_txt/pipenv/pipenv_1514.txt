Contributor
MarcDufresne commented on 27 Feb 2018 â€¢
edited
Since the update to 10.X all our requirements.txt files get commented out because of this specific piece of code: https://github.com/pypa/pipenv/blob/master/pipenv/core.py#L802
It wants the dependencies to include --hash but generating the lock file does not populate the hashes. And in our situation we can't use hashes because our team is a mix of different linux distros and macOS, so hashes are useless.
I suggest adding a flag to the lock command to ignore the '--hash' not in dep[0] requirement.
Something like:
if '--hash' not in dep[0] and not ignore_pip_hash_mode:
Describe your environment
OS version: macOS 10.13, Ubuntu 16.04, Arch Linux x86_64 Linux 4.15.5-1-ARCH
Python version: 3.6.3, 3.6.4
Pipenv version: v10.1.0
Expected result
Normal requirement file, with no requirement being commented out.
alembic==0.9.7
arrow==0.12.1
mako==1.0.7
markupsafe==1.0
munch==2.2.0
pymysql==0.7.11
python-dateutil==2.6.1
python-editor==1.0.3
pyyaml==3.12
six==1.11.0
sqlalchemy==1.1.15
ujson==1.35
Actual result
Commented out requirements
# alembic==0.9.7
# arrow==0.12.1
# mako==1.0.7
# markupsafe==1.0
# munch==2.2.0
# pymysql==0.7.11
# python-dateutil==2.6.1
# python-editor==1.0.3
# pyyaml==3.12
# six==1.11.0
# sqlalchemy==1.1.15
# ujson==1.35
Steps to replicate
Pipfile:
[[source]]
url = "https://our.custom.devpi.com/simple"
verify_ssl = true

[requires]
python_version = "3.6"

[packages]
alembic = ">=0.9,<0.10"
arrow = ">=0.12.0"
Munch = "*"
PyYAML = ">=3.12,<4"
sqlalchemy = ">=1.1,<1.2"
ujson = "*"
PyMySQL = ">=0.7,<0.8"

[dev-packages]
pytest = ">=3.0,<3.1"
pytest-cov = ">=2.4,<2.5"
flake8 = "*"
yapf = "*"
Commands:
$ pipenv lock -r
This works fine on 9.0.3, but not on 10.1.0.
We started seeing the issue on 9.1.0 where only six would get commented out.
We've noticed that the issue does not happen (hashes get populated in the lock file) when using https://pypi.python.org/simple as a source url, but we have closed source packages that we can't make public so we have to use our own devpi server. And AFAIK hashes don't work across different OSes, so we'd still have an issue, albeit a different one.