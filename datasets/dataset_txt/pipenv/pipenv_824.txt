konstin commented on 18 Jul 2018
Issue description
If the Pipfile.lock is invalid json, e.g. like this example which has a merge conflict, pipenv crashes with a JSONDecodeError
Expected result
Pipenv would either print an error that the Pipfile.lock is invalid or override the invalid file (I'd prefer the latter).
Actual result
$ pipenv install
Traceback (most recent call last):
  File "/usr/local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/cli.py", line 435, in install
    selective_upgrade=selective_upgrade,
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/core.py", line 1943, in do_install
    pypi_mirror=pypi_mirror,
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/core.py", line 1245, in do_init
    old_hash = project.get_lockfile_hash()
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/project.py", line 785, in get_lockfile_hash
    lockfile = self.load_lockfile(expand_env_vars=False)
  File "/home/konsti/.local/lib/python3.6/site-packages/pipenv/project.py", line 768, in load_lockfile
    j = json.load(lock)
  File "/usr/lib/python3.6/json/__init__.py", line 299, in load
    parse_constant=parse_constant, object_pairs_hook=object_pairs_hook, **kw)
  File "/usr/lib/python3.6/json/__init__.py", line 354, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python3.6/json/decoder.py", line 339, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python3.6/json/decoder.py", line 355, in raw_decode
    obj, end = self.scan_once(s, idx)
json.decoder.JSONDecodeError: Expecting property name enclosed in double quotes: line 4 column 1 (char 35)
Steps to replicate
Create a folder with this Pipfile and this Pipfile.lock. Run pipenv install
$ pipenv --support