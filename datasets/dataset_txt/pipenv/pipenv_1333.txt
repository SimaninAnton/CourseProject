QasimK commented on 16 Mar 2018 •
edited
It seems as though Pipenv does not correctly detect the fish shell when determining what to output for pipenv --completion. This is a regression that appeared within the last couple of weeks for me.
$ python -m pipenv.help output
Expected result
I'd expect the completion to complete without errors :)
Actual result
When attempting to auto-complete on the first Pipenv command:
qasim@qasim-desktop ~> pipenv - (line 1): Illegal command name “_pipenv_completion()”
begin;  _pipenv_completion() {     local IFS=$'\t'     COMPREPLY=( $( env COMP_WORDS="${COMP_WORDS[*]}" \                    COMP_CWORD=$COMP_CWORD \                    _PIPENV_COMPLETE=complete-bash $1 ) )     return 0 }  complete -F _pipenv_completion -o default pipenv 
        ^
from sourcing file -
 called on line 60 of file /usr/share/fish/functions/eval.fish

in function “eval”
 called on line 1 of file ~/.config/fish/completions/pipenv.fish

from sourcing file ~/.config/fish/completions/pipenv.fish
 called on standard input

in command substitution
 called on standard input

source: Error while reading file “-”
It seems as though this is the bash code being output from <???> rather than the fish code.
Steps to replicate
pip install --user --upgrade pipenv
Setup fish completions inside ~/.config/fish/completions/pipenv.fish: eval (pipenv --completion)
Enter fish and type Pipenv and then try to auto-complete something
3