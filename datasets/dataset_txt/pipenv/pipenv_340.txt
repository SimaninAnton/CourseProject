DanielSwain commented on 9 Jan 2019 •
edited
Issue description
When I create a venv with pipenv --python 3.6, it puts the venv in ~/.virtualenvs, which is fine. However, I want to mirror the production machine, which has venv's located at /opt/virtualenvs/, so I created a .env file that contains only:
WORKON_HOME=/opt/virtualenvs
When I activate the shell, it seems to activate correctly but does not use the correct Python version, even though the venv contains the correct version (3.6) and shows as being activated.
FIRST skip down and read NOTE: The following pipenv --support output . . . before reviewing the following Steps to Re-create
Steps to Re-create:
Note: The annotated series of commands shown below was executed after first creating a venv in ~/.virtualenvs using sudo pipenv --python 3.6 and creating a .env file as described above.
Disable the previously created .env file by renaming it:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ mv .env .envTEMP
Then activate the venv found at ~/.virtualenvs via pipenv shell:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv shell
Launching subshell in virtual environment…
. /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/activate
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ . /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/activate
Check which Python and Python version:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ which python
/home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/python
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ python --version
Python 3.6.8
Exit the shell:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ exit
exit
Reenable the .env file by renaming it back to .env:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ mv .envTEMP .env
Now move the venv from ~/.virtualenvs to /opt/virtualenvs and activate the venv now found at
/opt/virtualenvs via pipenv shell:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ sudo mv ~/.virtualenvs/GR_BH-DzdKWSvX/ /opt/virtualenvs/
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv shell
Loading .env environment variables…
Launching subshell in virtual environment…
. /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ . /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
Check which Python and Python version:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ which python
/usr/bin/python
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ python --version
Python 2.7.12
Exit the shell:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ exit
exit
Again create the venv in ~/.virtualenvs:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv --python 3.6
Creating a virtualenv for this project…
Pipfile: /vagrant/GR BH/Pipfile
Using /usr/bin/python3.6m (3.6.8) to create virtualenv…
⠼ Creating virtual environment...Using base prefix '/usr'
New python executable in /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/python3.6m
Also creating executable in /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/python
Installing setuptools, pip, wheel...
done.
Running virtualenv with interpreter /usr/bin/python3.6m
✔ Successfully created virtual environment!
Virtualenv location: /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX
Execute pipenv shell with .env file still in place but with duplicate venvs - one at ~/.virtualenvs and one at /opt/virtualenvs:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv shell
Loading .env environment variables…
Launching subshell in virtual environment…
. /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ . /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
Check which python and Python version:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ which python
/home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin/python
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ python --version
Python 3.6.8
Exit shell:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ exit
exit
Remove venv from ~/.virtualenvs and run pipenv shell again:
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ sudo rm -r ~/.virtualenvs/GR_BH-DzdKWSvX/
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv shell
Loading .env environment variables…
Launching subshell in virtual environment…
. /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ . /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
Check which python and Python version again:
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ which python
/usr/bin/python
(GR BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ python --version
Python 2.7.12
System:
Running Ubuntu 16.04.5 LTS in VirtualBox within Vagrant
Python versions installed: 2.7, 3.5 and 3.6
Some system commands and what they return:
python --version returns: Python 2.7.12
python3 --version returns: Python 3.5.2
pip --version returns: pip 18.1 from /usr/local/lib/python3.6/dist-packages/pip (python 3.6)
pip3 --version returns: pip 18.1 from /usr/local/lib/python3.6/dist-packages/pip (python 3.6)
pip show pipenv returns:
Name: pipenv
Version: 2018.11.26
Summary: Python Development Workflow for Humans.
Home-page: https://github.com/pypa/pipenv
Author: Kenneth Reitz
Author-email: me@kennethreitz.org
License: MIT
Location: /usr/local/lib/python3.6/dist-packages
Requires: certifi, virtualenv-clone, virtualenv, pip, setuptools
Required-by:
NOTE: The following pipenv --support output was obtained IMMEDIATELY AFTER executing the following at the command line:
(Notice that the venv is activated from /opt/virtualenvs, but that the VIRTUAL_ENV variable in the following still contains: /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX)
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ pipenv shell
Loading .env environment variables…
Launching subshell in virtual environment…
. /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ . /opt/virtualenvs/GR_BH-DzdKWSvX/bin/activate
(GR_BH) vagrant@vagrant-ubuntu-trusty-64:/var/sites/gr_bh$ python --version
Python 2.7.12
Pipenv version: '2018.11.26'
Pipenv location: '/usr/local/lib/python3.6/dist-packages/pipenv'
Python location: '/usr/bin/python3.6'
Python installations found:
3.6.8: /usr/bin/python3.6m
3.6.8: /usr/bin/python3.6
3.5.2: /usr/bin/python3.5
3.5.2: /usr/bin/python3.5m
2.7.12: /usr/bin/python
PEP 508 Information:
{'implementation_name': 'cpython',
 'implementation_version': '3.6.8',
 'os_name': 'posix',
 'platform_machine': 'x86_64',
 'platform_python_implementation': 'CPython',
 'platform_release': '4.4.0-141-generic',
 'platform_system': 'Linux',
 'platform_version': '#167-Ubuntu SMP Wed Dec 5 10:40:15 UTC 2018',
 'python_full_version': '3.6.8',
 'python_version': '3.6',
 'sys_platform': 'linux'}
System environment variables:
XDG_SESSION_ID
PIP_PYTHON_PATH
SHELL
TERM
SSH_CLIENT
SSH_TTY
USER
LS_COLORS
VIRTUAL_ENV
WORKON_HOME
PIPENV_ACTIVE
PATH
MAIL
PWD
LANG
PS1
PYTHONDONTWRITEBYTECODE
HOME
SHLVL
LOGNAME
PIP_DISABLE_PIP_VERSION_CHECK
SSH_CONNECTION
LESSOPEN
XDG_RUNTIME_DIR
DISPLAY
LESSCLOSE
_
PIP_SHIMS_BASE_MODULE
PYTHONFINDER_IGNORE_UNSUPPORTED
Pipenv–specific environment variables:
PIPENV_ACTIVE: 1
Debug–specific environment variables:
PATH: /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
SHELL: /bin/bash
LANG: en_US.UTF-8
PWD: /var/sites/gr_bh
VIRTUAL_ENV: /home/vagrant/.local/share/virtualenvs/GR_BH-DzdKWSvX
Contents of Pipfile ('/vagrant/GR BH/Pipfile'):
[[source]]

name = "pypi"
url = "https://pypi.python.org/simple"
verify_ssl = true

[requires]

python_version = "3.6"

[dev-packages]

[packages]
Output from pipenv --support WITHOUT venv activated:
Pipenv version: '2018.11.26'
Pipenv location: '/usr/local/lib/python3.6/dist-packages/pipenv'
Python location: '/usr/bin/python3.6'
Python installations found:
3.6.8: /usr/bin/python3.6m
3.6.8: /usr/bin/python3.6
3.5.2: /usr/bin/python3.5
3.5.2: /usr/bin/python3.5m
2.7.12: /usr/bin/python
PEP 508 Information:
{'implementation_name': 'cpython',
 'implementation_version': '3.6.8',
 'os_name': 'posix',
 'platform_machine': 'x86_64',
 'platform_python_implementation': 'CPython',
 'platform_release': '4.4.0-141-generic',
 'platform_system': 'Linux',
 'platform_version': '#167-Ubuntu SMP Wed Dec 5 10:40:15 UTC 2018',
 'python_full_version': '3.6.8',
 'python_version': '3.6',
 'sys_platform': 'linux'}
System environment variables:
XDG_SESSION_ID
TERM
SHELL
SSH_CLIENT
OLDPWD
SSH_TTY
USER
LS_COLORS
MAIL
PATH
PWD
LANG
SHLVL
HOME
LOGNAME
SSH_CONNECTION
LESSOPEN
DISPLAY
XDG_RUNTIME_DIR
LESSCLOSE
_
PIP_DISABLE_PIP_VERSION_CHECK
PYTHONDONTWRITEBYTECODE
PIP_SHIMS_BASE_MODULE
PIP_PYTHON_PATH
PYTHONFINDER_IGNORE_UNSUPPORTED
Pipenv–specific environment variables:
Debug–specific environment variables:
PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
SHELL: /bin/bash
LANG: en_US.UTF-8
PWD: /home/vagrant/.virtualenvs