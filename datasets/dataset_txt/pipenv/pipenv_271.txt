Contributor
gkoz commented on 25 Feb 2019
Issue description
pipenv sync --sequential may silently fail to install a package.
pipenv sync --sequential -v doesn't emit verbose logs of any pip install invocations but the first.
Fixed in #3537.
Expected result
An error:
[user@dev repro]$ ../.venv/bin/pipenv sync --sequential
Creating a virtualenv for this project‚Ä¶
Pipfile: /home/user/pipenv/repro/Pipfile
Using /home/user/pipenv/.venv/bin/python3 (3.7.2) to create virtualenv‚Ä¶
‚†á Creating virtual environment...Already using interpreter /home/user/pipenv/.venv/bin/python3
Using base prefix '/usr'
New python executable in /home/user/pipenv/repro/.venv/bin/python3
Also creating executable in /home/user/pipenv/repro/.venv/bin/python
Installing setuptools, pip, wheel...
done.

‚úî Successfully created virtual environment! 
Virtualenv location: /home/user/pipenv/repro/.venv
Installing dependencies from Pipfile.lock (63bec0)‚Ä¶
An error occurred while installing requests==2.21.0 --hash=sha256:0000000000000000000000000000000000000000000000000000000000000000! Will try again.
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 5/5 ‚Äî 00:00:03
Installing initially failed dependencies‚Ä¶
[pipenv.exceptions.InstallError]:   File "/home/user/pipenv/pipenv/core.py", line 2599, in do_sync
[pipenv.exceptions.InstallError]:       system=system,
[pipenv.exceptions.InstallError]:   File "/home/user/pipenv/pipenv/core.py", line 1228, in do_init
[pipenv.exceptions.InstallError]:       pypi_mirror=pypi_mirror,
[pipenv.exceptions.InstallError]:   File "/home/user/pipenv/pipenv/core.py", line 834, in do_install_dependencies
[pipenv.exceptions.InstallError]:       retry_list, procs, failed_deps_queue, requirements_dir, **install_kwargs
[pipenv.exceptions.InstallError]:   File "/home/user/pipenv/pipenv/core.py", line 740, in batch_install
[pipenv.exceptions.InstallError]:       _cleanup_procs(procs, failed_deps_queue, retry=retry)
[pipenv.exceptions.InstallError]:   File "/home/user/pipenv/pipenv/core.py", line 661, in _cleanup_procs
[pipenv.exceptions.InstallError]:       raise exceptions.InstallError(c.dep.name, extra=err_lines)
[pipenv.exceptions.InstallError]: ['Collecting requests==2.21.0 (from -r /tmp/pipenv-4aqevpfx-requirements/pipenv-zu00lfak-requirement.txt (line 1))', '  Using cached https://files.pythonhosted.org/packages/7d/e3/20f3d364d6c8e5d2353c72a67778eb189176f08e873c9900e10c0287b84b/requests-2.21.0-py2.py3-none-any.whl']
[pipenv.exceptions.InstallError]: ['THESE PACKAGES DO NOT MATCH THE HASHES FROM THE REQUIREMENTS FILE. If you have updated the package versions, please update the hashes. Otherwise, examine the package contents carefully; someone may have tampered with them.', '    requests==2.21.0 from https://files.pythonhosted.org/packages/7d/e3/20f3d364d6c8e5d2353c72a67778eb189176f08e873c9900e10c0287b84b/requests-2.21.0-py2.py3-none-any.whl#sha256=7bf2a778576d825600030a110f3c0e3e8edc51dfaafe1c146e39a2027784957b (from -r /tmp/pipenv-4aqevpfx-requirements/pipenv-zu00lfak-requirement.txt (line 1)):', '        Expected sha256 0000000000000000000000000000000000000000000000000000000000000000', '             Got        7bf2a778576d825600030a110f3c0e3e8edc51dfaafe1c146e39a2027784957b']
ERROR: ERROR: Package installation failed...
  ‚ò§  ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/1 ‚Äî 00:00:00
Actual result
Silent failure to install requests:
[user@dev repro]$ ../.venv/bin/pipenv sync --sequential
Creating a virtualenv for this project‚Ä¶
Pipfile: /home/user/pipenv/repro/Pipfile
Using /home/user/pipenv/.venv/bin/python3 (3.7.2) to create virtualenv‚Ä¶
‚†ß Creating virtual environment...Already using interpreter /home/user/pipenv/.venv/bin/python3
Using base prefix '/usr'
New python executable in /home/user/pipenv/repro/.venv/bin/python3
Also creating executable in /home/user/pipenv/repro/.venv/bin/python
Installing setuptools, pip, wheel...
done.

‚úî Successfully created virtual environment! 
Virtualenv location: /home/user/pipenv/repro/.venv
Installing dependencies from Pipfile.lock (63bec0)‚Ä¶
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 5/5 ‚Äî 00:00:04
To activate this project's virtualenv, run pipenv shell.
Alternatively, run a command inside the virtualenv with pipenv run.
All dependencies are now up-to-date!
[user@dev repro]$ ../.venv/bin/pipenv run pip list
Package    Version   
---------- ----------
certifi    2018.11.29
chardet    3.0.4     
idna       2.8       
pip        19.0.3    
setuptools 40.8.0    
urllib3    1.24.1    
wheel      0.33.1    
Steps to replicate
Cause a hash mismatch one of the packages.
        "requests": {
            "hashes": [
                "sha256:0000000000000000000000000000000000000000000000000000000000000000"
            ],
Run pipenv sync --sequential.
$ pipenv --support