Contributor
hroncok commented on 27 Jun 2018
The testuite fails on Python 3.7 due to PEP 479.
$ python -m pipenv.help output
Expected result
The testsuite should pass, pipenv should work on Python 3.7.
Actual result
tests/unit/test_vendor.py::test_table 
[gw0] [100%] FAILED tests/unit/test_vendor.py::test_table 

=================================== FAILURES ===================================
__________________________________ test_table __________________________________
[gw0] linux -- Python 3.7.0 /home/churchyard/.local/share/virtualenvs/pipenv-7nIhKB6W-3.7/bin/python3.7m

    def test_table():
        initial_toml = """id=42 # My id\nage=14"""
        tokens = tuple(lexer.tokenize(initial_toml))
        table = TableElement(
            [
                AtomicElement(tokens[0:1]),
                PunctuationElement(tokens[1:2]),
                AtomicElement(tokens[2:3]),
                WhitespaceElement(tokens[3:4]),
                CommentElement(tokens[4:6]),
                AtomicElement(tokens[6:7]),
                PunctuationElement(tokens[7:8]),
>               AtomicElement(tokens[8:9]),
            ]
        )

tests/unit/test_vendor.py:33: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
pipenv/patched/prettytoml/elements/table.py:22: in __init__
    self._check_for_duplicate_keys()
pipenv/patched/prettytoml/elements/table.py:25: in _check_for_duplicate_keys
    if len(set(self.keys())) < len(self.keys()):
pipenv/patched/prettytoml/elements/abstracttable.py:37: in keys
    return tuple(key for (key, _) in self.items())
pipenv/patched/prettytoml/elements/abstracttable.py:37: in <genexpr>
    return tuple(key for (key, _) in self.items())
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[RuntimeError("generator raised StopIteration") raised in repr()] TableElement object at 0x7f1e19187ef0>

    def items(self):
>       for (key_i, key), (value_i, value) in self._enumerate_items():
E       RuntimeError: generator raised StopIteration

pipenv/patched/prettytoml/elements/abstracttable.py:30: RuntimeError
===Flaky Test Report===


===End Flaky Test Report===
=========================== 1 failed in 4.48 seconds ===========================
Steps to replicate
I run the testuite as:
$ PIPENV_PYTHON=3.7 pipenv install --dev
$ PIPENV_PYTHON=3.7 pipenv run time pytest -v -n auto tests
Or just the failing test:
$ PIPENV_PYTHON=3.7 pipenv run time pytest -v -n auto tests -k test_table