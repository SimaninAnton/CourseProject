stephen-bunn commented on 5 Sep 2017
I'm having permission denied issues when trying to run pipenv install --dev within the shell of my python3.6 virtual environment.
I installed pipenv using the following command.
$ pip3 install --user pipenv

Collecting pipenv
  Downloading pipenv-5.3.3-py3-none-any.whl (1.2MB)
    100% |████████████████████████████████| 1.2MB 6.2MB/s 
Requirement already satisfied: pew>=0.1.26 in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: pip-tools>=1.9.0 in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: semver in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: pip in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: setuptools>=36.3.0 in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: virtualenv in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: background in /home/user/.local/lib/python3.5/site-packages (from pipenv)
Requirement already satisfied: virtualenv-clone>=0.2.5 in /home/user/.local/lib/python3.5/site-packages (from pew>=0.1.26->pipenv)
Requirement already satisfied: pythonz-bd>=1.10.2 in /home/user/.local/lib/python3.5/site-packages (from pew>=0.1.26->pipenv)
Requirement already satisfied: click>=6 in /home/user/.local/lib/python3.5/site-packages (from pip-tools>=1.9.0->pipenv)
Requirement already satisfied: first in /home/user/.local/lib/python3.5/site-packages (from pip-tools>=1.9.0->pipenv)
Requirement already satisfied: six in /home/user/.local/lib/python3.5/site-packages (from pip-tools>=1.9.0->pipenv)
Requirement already satisfied: futures in /home/user/.local/lib/python3.5/site-packages (from background->pipenv)
Requirement already satisfied: resumable-urlretrieve; python_version == "3.5" in /home/user/.local/lib/python3.5/site-packages (from pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Requirement already satisfied: requests in /home/user/.local/lib/python3.5/site-packages (from resumable-urlretrieve; python_version == "3.5"->pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Requirement already satisfied: certifi>=2017.4.17 in /home/user/.local/lib/python3.5/site-packages (from requests->resumable-urlretrieve; python_version == "3.5"->pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Requirement already satisfied: idna<2.7,>=2.5 in /home/user/.local/lib/python3.5/site-packages (from requests->resumable-urlretrieve; python_version == "3.5"->pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Requirement already satisfied: urllib3<1.23,>=1.21.1 in /home/user/.local/lib/python3.5/site-packages (from requests->resumable-urlretrieve; python_version == "3.5"->pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Requirement already satisfied: chardet<3.1.0,>=3.0.2 in /home/user/.local/lib/python3.5/site-packages (from requests->resumable-urlretrieve; python_version == "3.5"->pythonz-bd>=1.10.2->pew>=0.1.26->pipenv)
Installing collected packages: pipenv
Successfully installed pipenv-5.3.3
Here are the steps I took to create the virtual environment.
First I created a virtual environment using python3.6 on my path
$ pipenv --python python3.6

Creating a virtualenv for this project...
Using python3.6 to create virtualenv...
⠋Running virtualenv with interpreter /usr/bin/python3.6
Using base prefix '/usr'
New python executable in /home/user/.local/share/virtualenvs/my-project-ySf4NbVn/bin/python3.6
Also creating executable in /home/user/.local/share/virtualenvs/my-project-ySf4NbVn/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /home/user/.local/share/virtualenvs/my-project-ySf4NbVn
Then I activate the created virtual environment
$ pipenv shell

Launching subshell in virtual environment. Type 'exit' or 'Ctrl+D' to return.
Then I try to install packages and development packages
$ pipenv install --dev

No package provided, installing all dependencies.
Pipfile found at /home/user/Documents/Github/my-project/Pipfile. Considering this to be the project home.
Installing dependencies from Pipfile.lock...
An error occured while installing! 3/24 - 00:00:07
Collecting babel==2.5.0
  Using cached Babel-2.5.0-py2.py3-none-any.whl
Requirement already satisfied: pytz>=0a in /home/user/.local/lib/python2.7/site-packages (from babel==2.5.0)
Installing collected packages: babel
  Found existing installation: Babel 2.4.0
    Uninstalling Babel-2.4.0:
      Successfully uninstalled Babel-2.4.0
  Rolling back uninstall of Babel

Exception:
Traceback (most recent call last):
  File "/home/user/.local/lib/python2.7/site-packages/pip/basecommand.py", line 215, in main
    status = self.run(options, args)
  File "/home/user/.local/lib/python2.7/site-packages/pip/commands/install.py", line 342, in run
    prefix=options.prefix_path,
  File "/home/user/.local/lib/python2.7/site-packages/pip/req/req_set.py", line 784, in install
    **kwargs
  File "/home/user/.local/lib/python2.7/site-packages/pip/req/req_install.py", line 851, in install
    self.move_wheel_files(self.source_dir, root=root, prefix=prefix)
  File "/home/user/.local/lib/python2.7/site-packages/pip/req/req_install.py", line 1064, in move_wheel_files
    isolated=self.isolated,
  File "/home/user/.local/lib/python2.7/site-packages/pip/wheel.py", line 345, in move_wheel_files
    clobber(source, lib_dir, True)
  File "/home/user/.local/lib/python2.7/site-packages/pip/wheel.py", line 316, in clobber
    ensure_dir(destdir)
  File "/home/user/.local/lib/python2.7/site-packages/pip/utils/__init__.py", line 83, in ensure_dir
    os.makedirs(path)
  File "/usr/lib/python2.7/os.py", line 157, in makedirs
    mkdir(name, mode)
OSError: [Errno 13] Permission denied: '/usr/local/lib/python2.7/dist-packages/babel'

[================================] 3/24 - 00:00:02
However, if I try and install the packages outside of the subshell, it installs the packages fine.
I don't understand why the pip module is trying to place things inside the system's python2.7 packages when I am running pipenv within the virtual environment's subshell.
Here is a copy of the Pipfile if you need it.
[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true

[packages]
jsonschema = ">=2.6.0"


[dev-packages]
flake8 = "*"
Sphinx = ">=1.6.1"
sphinx-readable-theme = "*"
sphinx-autodoc-typehints = "*"