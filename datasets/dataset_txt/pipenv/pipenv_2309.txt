musicformellons commented on 29 May 2017
When running this ansible play:
  - name: create a virtualenv with pipenv and python 2 (thus pip2)
    command: pipenv install {{item}} --two chdir={{ virtualenv_dir }}
    with_items:
      - requests==2.10.0
      - argparse==1.2.1
I get this seemingly successful ansible output (it shows a successful 'change', no 'error'):
TASK [create a virtualenv with pipenv and python 2 (thus pip2)] **********************************************************************************************
changed: [151.80.145.127] => (item=requests==2.10.0) => {"changed": true, "cmd": ["pipenv", "install", "requests==2.10.0", "--two"], "delta": "0:00:05.674023", "end": "2017-05-29 10:17:47.911344", "item": "requests==2.10.0", "rc": 0, "start": "2017-05-29 10:17:42.237321", "stderr": "Creating a Pipfile for this project...\nCreating a virtualenv for this project...\nAlready using interpreter /usr/bin/python2\nNew python executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python2\nAlso creating executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python\nInstalling setuptools, pip, wheel...done.\n\nVirtualenv location: /root/.local/share/virtualenvs/env-V_d8Ml62\n/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  SNIMissingWarning\n/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecurePlatformWarning", "stderr_lines": ["Creating a Pipfile for this project...", "Creating a virtualenv for this project...", "Already using interpreter /usr/bin/python2", "New python executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python2", "Also creating executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python", "Installing setuptools, pip, wheel...done.", "", "Virtualenv location: /root/.local/share/virtualenvs/env-V_d8Ml62", "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  SNIMissingWarning", "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  InsecurePlatformWarning"], "stdout": "Installing requests==2.10.0...\nCollecting requests==2.10.0\n  Downloading requests-2.10.0-py2.py3-none-any.whl (506kB)\nInstalling collected packages: requests\nSuccessfully installed requests-2.10.0\n\nAdding requests==2.10.0 to Pipfile's [packages]...", "stdout_lines": ["Installing requests==2.10.0...", "Collecting requests==2.10.0", "  Downloading requests-2.10.0-py2.py3-none-any.whl (506kB)", "Installing collected packages: requests", "Successfully installed requests-2.10.0", "", "Adding requests==2.10.0 to Pipfile's [packages]..."]}
changed: [151.80.145.127] => (item=argparse==1.2.1) => {"changed": true, "cmd": ["pipenv", "install", "argparse==1.2.1", "--two"], "delta": "0:00:04.469525", "end": "2017-05-29 10:17:52.994386", "item": "argparse==1.2.1", "rc": 0, "start": "2017-05-29 10:17:48.524861", "stderr": "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  SNIMissingWarning\n/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecurePlatformWarning\nVirtualenv already exists!\nRemoving existing virtualenv...\nCreating a virtualenv for this project...\nAlready using interpreter /usr/bin/python2\nNew python executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python2\nAlso creating executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python\nInstalling setuptools, pip, wheel...done.\n\nVirtualenv location: /root/.local/share/virtualenvs/env-V_d8Ml62\n/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecurePlatformWarning\n/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings\n  InsecurePlatformWarning", "stderr_lines": ["/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  SNIMissingWarning", "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  InsecurePlatformWarning", "Virtualenv already exists!", "Removing existing virtualenv...", "Creating a virtualenv for this project...", "Already using interpreter /usr/bin/python2", "New python executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python2", "Also creating executable in /root/.local/share/virtualenvs/env-V_d8Ml62/bin/python", "Installing setuptools, pip, wheel...done.", "", "Virtualenv location: /root/.local/share/virtualenvs/env-V_d8Ml62", "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  InsecurePlatformWarning", "/usr/local/lib/python2.7/dist-packages/pipenv-4.1.1-py2.7.egg/pipenv/vendor/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings", "  InsecurePlatformWarning"], "stdout": "Installing argparse==1.2.1...\nRequirement already satisfied: argparse==1.2.1 in /usr/lib/python2.7\n\nAdding argparse==1.2.1 to Pipfile's [packages]...", "stdout_lines": ["Installing argparse==1.2.1...", "Requirement already satisfied: argparse==1.2.1 in /usr/lib/python2.7", "", "Adding argparse==1.2.1 to Pipfile's [packages]..."]}
A next step in the ansible play -using the virtualenv packages- fails. When I ssh into the server and activate the virtualenv and then try to import the packages into the python environment it can not import the package (error). When I manually install with pipenv install requests and then try to import the package in the python environment, it works.
What's wrong? Why are the installed packages via ansible 'not found'?