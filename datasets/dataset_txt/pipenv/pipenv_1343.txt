ralexx commented on 15 Mar 2018 •
edited
Calling pytest from a pipenv raises 'pipenv run pytest' terminated by signal SIGILL (Illegal instruction) when $SHELL is fish 2.7.1 and Illegal instruction: 4 when $SHELL is bash 3.2.
I have opened an issue here because the same version of pytest installed in a conda environment on the same machine executes as expected. I am trying to replicate my conda workflow using pipenv, so testing them side by side.
Please run $ python -m pipenv.help, and paste the results here.
I installed pipenv from homebrew so apparently this does not work.
Expected result
pytest runs my tests as it does in a conda env shown below:
pytest tests/                    
============================= test session starts ==============================
platform darwin -- Python 3.6.3, pytest-3.3.1, py-1.5.2, pluggy-0.6.0
rootdir: /foo, inifile:
plugins: xdist-1.20.1, forked-0.2, cov-2.5.1, hypothesis-3.38.5
collected 1 item

tests/test_pgdb.py .
Actual result
With $SHELL = /usr/local/bin/fish:
pipenv run pytest --collect-only --debug tests/test_pgdb.py
writing pytestdebug information to /foo/pytestdebug.log
============================= test session starts ==============================
platform darwin -- Python 3.6.4, pytest-3.3.1, py-1.5.2, pluggy-0.6.0 -- /Users/me/.local/share/virtualenvs/warehouse-nvT3qLa9/bin/python3.6
using: pytest-3.3.1 pylib-1.5.2
rootdir: /foo, inifile:
collecting 0 items                                                             
fish: 'pipenv run pytest --collect-onl…' terminated by signal SIGILL (Illegal instruction)
With $SHELL = /bin/bash:
pipenv shell
Spawning environment shell (/bin/bash). Use 'exit' to leave.
bash-3.2$ . /Users/me/.local/share/virtualenvs/warehouse-nvT3qLa9/bin/activate
(warehouse-nvT3qLa9) bash-3.2$ pytest tests/
============================= test session starts ==============================
platform darwin -- Python 3.6.4, pytest-3.3.1, py-1.5.2, pluggy-0.6.0
rootdir: /foo, inifile:
collecting 0 items                                                             
Illegal instruction: 4
Steps to replicate
pipenv 11.7.2, macOS 10.12.6, Mac Pro 5,1
Uninstall pytest optional plugins in case they were at issue
Either call pipenv shell and then call pytest tests/ or `pipenv run pytest tests/'. Results are identical.
Pipfile