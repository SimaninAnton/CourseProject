p-himik commented on 5 Oct 2018 •
edited
Issue description
I have a private PyPI repo (not a mirror!) that contains a private package chet-tools.
PIP_EXTRA_INDEX_URL is set to that repo's URL.
pipenv-2018.5.18: PIP_EXTRA_INDEX_URL works, pipenv install chet-tools outputs something like:
Installing chet-tools...
⠋Installing 'chet-tools'
$ "/home/p-himik/dev/git/strayhorn/.venv/bin/pip" install   --verbose    "chet-tools" -i https://pypi.python.org/simple --exists-action w
Created temporary directory: /tmp/pip-ephem-wheel-cache-3nlrhfds
Created temporary directory: /tmp/pip-req-tracker-o4vx89uk
Created requirements tracker '/tmp/pip-req-tracker-o4vx89uk'
Created temporary directory: /tmp/pip-install-g6t9_xxv
Looking in indexes: https://pypi.python.org/simple, %private_repo_url%/
Collecting chet-tools
  2 location(s) to search for versions of chet-tools:
  * https://pypi.python.org/simple/chet-tools/
  * %private_repo_url%/chet-tools/
  Getting page https://pypi.python.org/simple/chet-tools/
  Looking up "https://pypi.python.org/simple/chet-tools/" in the cache
  Returning cached "301 Moved Permanently" response (ignoring date and etag information)
  Looking up "https://pypi.org/simple/chet-tools/" in the cache
  No cache entry available
  Starting new HTTPS connection (1): pypi.org:443
  https://pypi.org:443 "GET /simple/chet-tools/ HTTP/1.1" 404 13
  Status code 404 not in (200, 203, 300, 301)
  Could not fetch URL https://pypi.python.org/simple/chet-tools/: 404 Client Error: Not Found for url: https://pypi.org/simple/chet-tools/ - skipping
  Getting page %private_repo_url%/chet-tools/
  Looking up "%private_repo_url%/chet-tools/" in the cache
  Current age based on date: 937
  Freshness lifetime from request max-age: 600
  Starting new HTTPS connection (1): repo.fury.io:443
  %private_repo_url% "GET %private_repo_url_piece%/chet-tools/ HTTP/1.1" 304 0
  Analyzing links from page %private_repo_url%/chet-tools/
    Found link %private_repo_url%/-/ver_23V4MH/chet_tools-1.0.0.tar.gz#md5=1407a596a3c3d709d2dbfab4b323d2d6 (from %private_repo_url%/chet-tools/), version: 1.0.0
    Found link %private_repo_url%/-/ver_Gcesm/chet_tools-1.1.0.tar.gz#md5=c119a7c19ed47917a49d855dfd8f8445 (from %private_repo_url%/chet-tools/), version: 1.1.0
    Found link %private_repo_url%/-/ver_1GieGh/chet_tools-1.2.0.tar.gz#md5=77a095714272b8cc62b411d8b2b68b39 (from %private_repo_url%/chet-tools/), version: 1.2.0
    Found link %private_repo_url%/-/ver_Xw9IR/chet_tools-1.3.0.tar.gz#md5=28cae27c16f886c5cd6fbe69fd083747 (from %private_repo_url%/chet-tools/), version: 1.3.0
    Found link %private_repo_url%/-/ver_ebm1n/chet_tools-1.4.0.tar.gz#md5=57f922bb9f823f4076fcaf4856412273 (from %private_repo_url%/chet-tools/), version: 1.4.0
  Using version 1.4.0 (newest of versions: 1.0.0, 1.1.0, 1.2.0, 1.3.0, 1.4.0)
  Using cached wheel link: file:///home/p-himik/.cache/pipenv/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl
  Added chet-tools from file:///home/p-himik/.cache/pipenv/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl to build tracker '/tmp/pip-req-tracker-o4vx89uk'
  Removed chet-tools from file:///home/p-himik/.cache/pipenv/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl from build tracker '/tmp/pip-req-tracker-o4vx89uk'
Requirement already satisfied: attrs>=17.2 in ./.venv/lib/python3.7/site-packages (from chet-tools) (18.2.0)
Requirement already satisfied: pytz>=2017.3 in ./.venv/lib/python3.7/site-packages (from chet-tools) (2018.5)
Installing collected packages: chet-tools

Successfully installed chet-tools-1.4.0
Cleaning up...
Removed build tracker '/tmp/pip-req-tracker-o4vx89uk'

Adding chet-tools to Pipfile's [packages]...
Pipfile.lock (c5050c) out of date, updating to (c1e7c0)...
Locking [dev-packages] dependencies...
Locking [packages] dependencies...

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches chet-tools (from -r /tmp/pipenv-aruk1o_3-requirements/pipenv-46j3qfrw-constraints.txt (line 22))
No versions found
Was https://pypi.python.org/simple reachable?
pipenv-2018.6.25: PIP_EXTRA_INDEX_URL has stopped working, and is still not working in 2018.7.1. Output of pipenv install chet-tools with 2018.7.1:
Installing chet-tools…
⠋Installing 'chet-tools'
$ "/home/p-himik/dev/git/strayhorn/.venv/bin/pip" install   --verbose    "chet-tools" -i https://pypi.python.org/simple --exists-action w
Created temporary directory: /tmp/pip-ephem-wheel-cache-26bmirnt
Created temporary directory: /tmp/pip-req-tracker-l4txd3kh
Created requirements tracker '/tmp/pip-req-tracker-l4txd3kh'
Created temporary directory: /tmp/pip-install-4_1mtwy0
Looking in indexes: https://pypi.python.org/simple, %private_repo_url%/
Collecting chet-tools
  2 location(s) to search for versions of chet-tools:
  * https://pypi.python.org/simple/chet-tools/
  * %private_repo_url%/chet-tools/
  Getting page https://pypi.python.org/simple/chet-tools/
  Looking up "https://pypi.python.org/simple/chet-tools/" in the cache
  Returning cached "301 Moved Permanently" response (ignoring date and etag information)
  Looking up "https://pypi.org/simple/chet-tools/" in the cache
  No cache entry available
  Starting new HTTPS connection (1): pypi.org:443
  https://pypi.org:443 "GET /simple/chet-tools/ HTTP/1.1" 404 13
  Status code 404 not in (200, 203, 300, 301)
  Could not fetch URL https://pypi.python.org/simple/chet-tools/: 404 Client Error: Not Found for url: https://pypi.org/simple/chet-tools/ - skipping
  Getting page %private_repo_url%/chet-tools/
  Looking up "%private_repo_url%/chet-tools/" in the cache
  Current age based on date: 357
  Freshness lifetime from request max-age: 600
  The response is "fresh", returning cached response
  600 > 357
  Analyzing links from page %private_repo_url%/chet-tools/
    Found link %private_repo_url%/-/ver_23V4MH/chet_tools-1.0.0.tar.gz#md5=1407a596a3c3d709d2dbfab4b323d2d6 (from %private_repo_url%/chet-tools/), version: 1.0.0
    Found link %private_repo_url%/-/ver_Gcesm/chet_tools-1.1.0.tar.gz#md5=c119a7c19ed47917a49d855dfd8f8445 (from %private_repo_url%/chet-tools/), version: 1.1.0
    Found link %private_repo_url%/-/ver_1GieGh/chet_tools-1.2.0.tar.gz#md5=77a095714272b8cc62b411d8b2b68b39 (from %private_repo_url%/chet-tools/), version: 1.2.0
    Found link %private_repo_url%/-/ver_Xw9IR/chet_tools-1.3.0.tar.gz#md5=28cae27c16f886c5cd6fbe69fd083747 (from %private_repo_url%/chet-tools/), version: 1.3.0
    Found link %private_repo_url%/-/ver_ebm1n/chet_tools-1.4.0.tar.gz#md5=57f922bb9f823f4076fcaf4856412273 (from %private_repo_url%/chet-tools/), version: 1.4.0
  Using version 1.4.0 (newest of versions: 1.0.0, 1.1.0, 1.2.0, 1.3.0, 1.4.0)
  Using cached wheel link: file:///home/p-himik/.cache/pip/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl
  Added chet-tools from file:///home/p-himik/.cache/pip/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl to build tracker '/tmp/pip-req-tracker-l4txd3kh'
  Removed chet-tools from file:///home/p-himik/.cache/pip/wheels/09/25/cc/8abe326483a97ab707612069145b173ba20e8035b57b349036/chet_tools-1.4.0-cp37-none-any.whl from build tracker '/tmp/pip-req-tracker-l4txd3kh'
Requirement already satisfied: attrs>=17.2 in ./.venv/lib/python3.7/site-packages (from chet-tools) (18.2.0)
Requirement already satisfied: pytz>=2017.3 in ./.venv/lib/python3.7/site-packages (from chet-tools) (2018.5)
Installing collected packages: chet-tools

Successfully installed chet-tools-1.4.0
Cleaning up...
Removed build tracker '/tmp/pip-req-tracker-l4txd3kh'

Adding chet-tools to Pipfile's [packages]…
Pipfile.lock (c5050c) out of date, updating to (c1e7c0)…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
None of the relevant steps described in "Frequently Encountered Pipenv Problems" work - removing cache does nothing and running pipenv lock --clear produces the same warning/error.
Expected result
I'd expect the result of 2018.7.1 to be the same as of 2018.5.18 and chet-tools being added to Pipfile.lock.
Actual result
Provided above in the comparison. chet-tools is not in Pipfile.lock.
Running pipenv install --skip-lock followed by pipenv graph does not show anything of interest.
Steps to replicate
Hard to provide the exact steps, given that the whole setup is more complicated than just a single file and involves a private repository. Please let me know what I should add to the issue description.
$ pipenv --support