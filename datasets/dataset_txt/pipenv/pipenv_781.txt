tgroshon commented on 31 Jul 2018 â€¢
edited
Issue description
tl;dr .venv files already exist in some dev setups but when present, pipenv attempts to use that file as a directory and install a virtualenv into it.
Virtualenvwrapper has suggested for awhile to use .venv files in your project directory to hold the name of your virtualenv so that you could automatically activate virtualenvs. Spacemacs (an Emacs editor setup) also does this behavior by default.
Two problems:
Pipenv will silently fail to create and activate a virtualenv when a .venv file is present.
If a .venv file is added to an existing pipenv project, pipenv breaks because it can't activate the virtualenv at <project_dir>/.venv ignoring the place where it had already created a virtualenv.
Prior Art Links:
Virtualenvwrapper Tips & Tricks: http://virtualenvwrapper.readthedocs.io/en/latest/tips.html
Spacemacs Python Layer: https://github.com/syl20bnr/spacemacs/tree/develop/layers/%2Blang/python#automatic-activation-of-local-pyenv-version
Virtualenv in git directories: https://hmarr.com/2010/jan/19/making-virtualenv-play-nice-with-git/
Sample .bash_profile using .venv files: justinabrahms/jlilly-bashy-dotfiles@04899f0#commitcomment-1526375
Expected result
At the least, Pipenv should check if .venv is a file or a directory before attempting to automatically use it as a directory and install a virtualenv into it. If it's a file, then behave as if no .venv was found at all.
Actual result
If a .venv file exists in the project directory, Pipenv will attempt to create and use a virtualenv at <project_dir>/.venv and yell at the user a bit because it's not a directory but (a) it won't actually fail and (b) it won't actually save a virtualenv anywhere.
Output:
Creating a virtualenv for this project...
Pipfile: <project_path>\Pipfile
Using <python_path> to create virtualenv...
Running virtualenv with interpreter <python_path>
ERROR: File already exists and is not a directory.
Please provide a different path or delete the file.

Virtualenv location: <project_path>\.venv
Steps to replicate
touch .venv
pipenv install
Also see output of pipenv --venv
$ pipenv --support