Contributor
immerrr commented on 9 Oct 2018
Be sure to check the existing issues (both open and closed!), and make sure you are running the latest version of Pipenv.
Check the diagnose documentation for common issues before posting! We may close your issue if it is very similar to one of them. Please be considerate, or be on your way.
Make sure to mention your debugging experience if the documented solution failed.
Issue description
Hi,
I've checked that name normalization problems have been encountered before (#1314, #1855) and should have been fixed in #1826. However, when one has a non-normalized name in Pipfile it's possible for the package to slip into Pipfile.lock in both normalized and non-normalized forms.
I was able to boil the example down to two packages: Pipfile would contain entries for "scrapy" and "zope.interface==4.4.3" (spelled exactly like that) and Pipfile.lock would end up with both "zope.interface==4.5.0" and "zope-interface==4.4.3". That probably indicates that a) package names from Pipfile are normalized and b) those that are from scrapy requirements are not.
Expected result
I would expect pipenv to normalize all package names during resolution stage.
Actual result
Both zope.interface and zope-interface are found in Pipfile.lock.
$ cat Pipfile.lock  | jq '[.default | to_entries[] | {key:.key, value: (.value.version)}] | from_entries'
{
  "asn1crypto": "==0.24.0",
  "attrs": "==18.2.0",
  "automat": "==0.7.0",
  "cffi": "==1.11.5",
  "constantly": "==15.1.0",
  "cryptography": "==2.3.1",
  "cssselect": "==1.0.3",
  "hyperlink": "==18.0.0",
  "idna": "==2.7",
  "incremental": "==17.5.0",
  "lxml": "==4.2.5",
  "parsel": "==1.5.0",
  "pyasn1": "==0.4.4",
  "pyasn1-modules": "==0.2.2",
  "pycparser": "==2.19",
  "pydispatcher": "==2.0.5",
  "pyhamcrest": "==1.9.0",
  "pyopenssl": "==18.0.0",
  "queuelib": "==1.5.0",
  "scrapy": "==1.5.1",
  "service-identity": "==17.0.0",
  "six": "==1.11.0",
  "twisted": "==18.7.0",
  "w3lib": "==1.19.0",
  "zope-interface": "==4.4.3",
  "zope.interface": "==4.5.0"
}
Steps to replicate
$ pipenv --support
Here's the Pipfile:
[[source]]
url = "https://pypi.org/simple"
verify_ssl = true
name = "pypi"

[packages]
scrapy = "*"
"zope.interface" = "==4.4.3"

[dev-packages]

[requires]
python_version = "3.6"