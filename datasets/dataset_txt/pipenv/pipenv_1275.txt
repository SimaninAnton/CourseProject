philosophicles commented on 28 Mar 2018
Pipenv seems to be unable to create a virtualenv on Windows when the current user's username starts with a dollar character: $johndoe in the results below.
$ python -m pipenv.help output
Expected result
Running pipenv install in a project folder should create a virtualenv for that project, as well as setting up Pipfile etc.
Actual result
Pipfile and Pipfile.lock are created as expect. Creating the virtualenv fails. I didn't actually notice this properly until I came to run pipenv shell which found no existing virtualenv, so tried again to create a virtualenv, and failed.
I've changed the actual project_folder and username $johndoe for privacy/security reasons but the username was still prefixed with a dollar character $ followed by only lowercase a-z characters. The project folder was a mix of lowercase a-z characters and a space.
c:\!DRSYSTEM\Scripts\project_folder>pipenv shell
Creating a virtualenv for this project…
Using C:\Program Files\Python36\python.exe (3.6.4) to create virtualenv…
Running virtualenv with interpreter C:\Program Files\Python36\python.exe
Using base prefix 'C:\\Program Files\\Python36'
New python executable in C:\Users\$johndoe\.virtualenvs\project_folder--vi7V_1k\Scripts\python.exe
Installing setuptools, pip, wheel...
  Complete output from command C:\Users\$johndoe\.vir...k\Scripts\python.exe - setuptools pip wheel:
  Collecting setuptools
Collecting pip
Collecting wheel
Installing collected packages: setuptools, pip, wheel
Exception:
Traceback (most recent call last):
  File "C:\Program Files\Python36\Lib\distutils\util.py", line 202, in subst_vars
    return re.sub(r'\$([a-zA-Z_][a-zA-Z_0-9]*)', _subst, s)
  File "C:\Users\$johndoe\.virtualenvs\project_folder--vi7V_1k\lib\re.py", line 191, in sub
    return _compile(pattern, flags).sub(repl, string, count)
  File "C:\Program Files\Python36\Lib\distutils\util.py", line 199, in _subst
    return os.environ[var_name]
  File "C:\Users\$johndoe\.virtualenvs\project_folder--vi7V_1k\lib\os.py", line 669, in __getitem__
    raise KeyError(key) from None
KeyError: 'johndoe'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\basecommand.py", line 215, in main
    status = self.run(options, args)
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\commands\install.py", line 342, in run
    prefix=options.prefix_path,
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\req\req_set.py", line 784, in install
    **kwargs
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\req\req_install.py", line 851, in install
    self.move_wheel_files(self.source_dir, root=root, prefix=prefix)
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\req\req_install.py", line 1064, in move_wheel_files
    isolated=self.isolated,
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\wheel.py", line 247, in move_wheel_files
    prefix=prefix,
  File "c:\program files\python36\lib\site-packages\virtualenv_support\pip-9.0.3-py2.py3-none-any.whl\pip\locations.py", line 153, in distutils_scheme
    i.finalize_options()
  File "C:\Program Files\Python36\Lib\distutils\command\install.py", line 307, in finalize_options
    self.expand_basedirs()
  File "C:\Program Files\Python36\Lib\distutils\command\install.py", line 475, in expand_basedirs
    self._expand_attrs(['install_base', 'install_platbase', 'root'])
  File "C:\Program Files\Python36\Lib\distutils\command\install.py", line 469, in _expand_attrs
    val = subst_vars(val, self.config_vars)
  File "C:\Program Files\Python36\Lib\distutils\util.py", line 204, in subst_vars
    raise ValueError("invalid variable '$%s'" % var)
ValueError: invalid variable '$'johndoe''
----------------------------------------
...Installing setuptools, pip, wheel...done.
Traceback (most recent call last):
  File "c:\program files\python36\lib\site-packages\virtualenv.py", line 2349, in <module>
    main()
  File "c:\program files\python36\lib\site-packages\virtualenv.py", line 712, in main
    symlink=options.symlink)
  File "c:\program files\python36\lib\site-packages\virtualenv.py", line 953, in create_environment
    download=download,
  File "c:\program files\python36\lib\site-packages\virtualenv.py", line 904, in install_wheel
    call_subprocess(cmd, show_stdout=False, extra_env=env, stdin=SCRIPT)
  File "c:\program files\python36\lib\site-packages\virtualenv.py", line 796, in call_subprocess
    % (cmd_desc, proc.returncode))
OSError: Command C:\Users\$johndoe\.vir...k\Scripts\python.exe - setuptools pip wheel failed with error code 2

Virtualenv location:
ERROR: Environment 'project_folder--vi7V_1k' does not exist. Create it with 'pew new project_folder--vi7V_1k'.

c:\!DRSYSTEM\Scripts\project_folder>
Steps to replicate
On Windows, create a user account that starts with a dollar character $ and log in as that user.
Create a new folder somewhere on C: drive for your python development project. (Not necessarily within user folder, it seems.)
Open cmd.exe with Administrator privileges, cd to the project folder.
Run pipenv install, or pipenv shell, or any command that should check for an existing virtualenv and create if it doesn't already exist.
Repeat with another Windows user account that is identical except for the leading $ character: pipenv works as expected.