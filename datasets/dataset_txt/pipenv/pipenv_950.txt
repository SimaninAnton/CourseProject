yoni1 commented on 18 Jun 2018
Describe the issue briefly here.
I want to install a package with platform-specific markers, for example by doing:
pipenv install "nsenter ; platform_system == 'Linux'"
This doesn't work (raises an exception). When doing this with pipenv install -r requirements.txt, the package is installed, ignoring the markers.
I'm showing Windows output below, but the same behavior happens on Linux as well.
Please run $ python -m pipenv.help, and paste the results here.
$ python -m pipenv.help output
Expected result
I expected the Pipfile to be populated with the line nsenter = { version = "*", markers = "platform_system == 'Linux'" }, and the package to be installed or not installed based the platform.
Actual result
When not using requirements.txt, I got this exception:
Traceback (most recent call last):
  File "c:\python36\lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "c:\python36\lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "C:\Python36\Scripts\pipenv.exe\__main__.py", line 9, in <module>
  File "c:\python36\lib\site-packages\pipenv\vendor\click\core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "c:\python36\lib\site-packages\pipenv\vendor\click\core.py", line 697, in main
    rv = self.invoke(ctx)
  File "c:\python36\lib\site-packages\pipenv\vendor\click\core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "c:\python36\lib\site-packages\pipenv\vendor\click\core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "c:\python36\lib\site-packages\pipenv\vendor\click\core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "c:\python36\lib\site-packages\pipenv\cli.py", line 402, in install
    selective_upgrade=selective_upgrade,
  File "c:\python36\lib\site-packages\pipenv\core.py", line 1982, in do_install
    converted = convert_deps_from_pip(package_name)
  File "c:\python36\lib\site-packages\pipenv\utils.py", line 639, in convert_deps_from_pip
    if isinstance(dependency[req.name], six.string_types):
KeyError: 'nsenter'
When using pipenv install -r requirements.txt, it just installed the package, ignoring the platform marker, and added nsenter = "*" to the Pipfile. The contents of my requirements.txt are:
nsenter ; platform_system == 'Linux'
Steps to replicate
Option 1:
pipenv install "nsenter ; platform_system == 'Linux'"
Option 2:
echo "nsenter ; platform_system == 'Linux'" > requirements.txt
pipenv install -r requirements.txt