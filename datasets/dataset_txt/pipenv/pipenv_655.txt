al4 commented on 19 Sep 2018 â€¢
edited
Issue description
When installing jinja2 under Python 2.7.15, the MarkupSafe dependency is omitted from Pipefile.lock.
Expected result
Pipenv adds markupsafe to Pipfile.lock
Actual result
The dependency is not recorded in Pipfile.lock. Note that the dependency is installed in the original venv, it's just not recorded in the lock, so if I remove and recreate the environment Jinja2 is unusable.
If I use --three to install under Python 3.7, the dependency is recorded in Pipfile.lock as expected.
Steps to replicate
In an empty dir:
$ pipenv --two install jinja2
[...]
Collecting MarkupSafe>=0.23 (from jinja2)
Installing collected packages: MarkupSafe, jinja2
Successfully installed MarkupSafe-1.0 jinja2-2.10

Adding jinja2 to Pipfile's [packages]...
Pipfile.lock not found, creating...
[...]
$ pipenv run pip freeze
Jinja2==2.10
MarkupSafe==1.0
$ pipenv --rm
$ pipenv install
$ pipenv run python -c 'import jinja2'
Traceback (most recent call last):
[...]
ImportError: No module named markupsafe
$ pipenv run pip freeze
Jinja2==2.10
In Pipfile.lock, markupsafe is missing.
If I repeat the process with --three instead of --two, markupsafe is added to Pipfile.lock as expected.
The dependency declaration looks standard, I can't see any reason why it should be treated differently under Python 2: https://github.com/pallets/jinja/blob/7a6704db55fcd9bbe5a90c3868e03f5a5fcf176a/setup.py#L74
$ pipenv --support