derphilipp commented on 2 Jul 2018
Issue description
It is possible to create directories starting with a dash ("-")
Though highly unpractical this can occur when using CI systems etc.
Pipenv fails setting up anything inside a directory of that nature, because parameters are parsed wrong (The directory name is considered a parameter because it starts with a dash)
Expected result
Pipenv working normally
Actual result
Example run on a machine:
~/BUILDPATH/-6SOMEDIRECTORYWITHADASH$ pipenv install --verbose
Creating a virtualenv for this project…
Using /usr/bin/python3 (3.6.5) to create virtualenv…
⠋usage: __main__.py [-h] [-p PYTHON] [-i PACKAGES] [-r REQUIREMENTS] [-d]
                   [-a PROJECT]
                   envname
__main__.py: error: the following arguments are required: envname

Virtualenv location:
Creating a virtualenv for this project…
Using /usr/bin/python3 (3.6.5) to create virtualenv…
⠙usage: __main__.py [-h] [-p PYTHON] [-i PACKAGES] [-r REQUIREMENTS] [-d]
                   [-a PROJECT]
                   envname
__main__.py: error: the following arguments are required: envname

Virtualenv location:
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Traceback (most recent call last):
  File "/usr/local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/cli.py", line 402, in install
    selective_upgrade=selective_upgrade,
  File "/usr/local/lib/python3.6/dist-packages/pipenv/core.py", line 1932, in do_install
    requirements_dir=requirements_directory,
  File "/usr/local/lib/python3.6/dist-packages/pipenv/core.py", line 1369, in do_init
    verbose=verbose,
  File "/usr/local/lib/python3.6/dist-packages/pipenv/core.py", line 1043, in do_lock
    allow_global=system,
  File "/usr/local/lib/python3.6/dist-packages/pipenv/utils.py", line 420, in venv_resolve_deps
    escape_grouped_arguments(which('python', allow_global=allow_global)),
  File "/usr/local/lib/python3.6/dist-packages/pipenv/core.py", line 128, in which
    p = os.sep.join([location] + ['bin/{0}'.format(command)])
TypeError: sequence item 0: expected str instance, NoneType found
USER@SERVER:~/BUILDPATH/-6SOMEDIRECTORYWITHADASH$
Steps to replicate
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
create directory starting with a dash
mkdir -- -foo
enter said directory
cd -- -foo
start pipenv:
pipenv install .
This is probably not a very high priority for most people but it can lead to broken builds when directories are created automatically;