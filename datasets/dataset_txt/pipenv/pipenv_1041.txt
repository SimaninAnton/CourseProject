Contributor
nelfin commented on 21 May 2018
Be sure to check the existing issues (both open and closed!).
same stack trace but unrelated: #1750
PR to fix a similar issue with pipenv update: #1268
do_clean assumes that the output of pip freeze produces only requirement lines, but it can in some cases produce #-prefixed comments (see https://github.com/pypa/pip/blob/729990c9869148f3f0098a2b2a0c0b92aefb8a69/src/pip/_internal/operations/freeze.py#L188 for one such example). It looks as though this was noticed and fixed for pipenv update in 9.1.0 (see f322d93)
$ python -m pipenv.help output
Expected result
$ pipenv clean
Uninstalling 'empty'…
Actual result
$ pipenv clean
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
Updated Pipfile.lock (dfae9f)!
Traceback (most recent call last):
  File "$HOME/.virtualenvs/pipenv-issue/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "$HOME/.virtualenvs/pipenv-issue/lib/python2.7/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "$HOME/.virtualenvs/pipenv-issue/local/lib/python2.7/site-packages/pipenv/cli.py", line 1009, in clean
    ctx=ctx, three=three, python=python, dry_run=dry_run, verbose=verbose
  File "$HOME/.virtualenvs/pipenv-issue/local/lib/python2.7/site-packages/pipenv/core.py", line 2539, in do_clean
    r = get_requirement(installed)
  File "$HOME/.virtualenvs/pipenv-issue/local/lib/python2.7/site-packages/pipenv/utils.py", line 142, in get_requirement
    req = [r for r in requirements.parse(dep)][0]
IndexError: list index out of range
Steps to replicate
$ cd $(mktemp -d)
$ cat <<EOF >setup.py
> from setuptools import setup
> setup(name='empty')
> EOF
$ mkdir .git
$ pipenv run pip install -e .
$ pipenv clean