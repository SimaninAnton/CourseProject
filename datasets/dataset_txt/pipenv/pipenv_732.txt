MichaelPak commented on 17 Aug 2018 •
edited
$ pipenv --support
I'm trying to download dependencies from private PyPi repository through http.
pip.conf:
➜ cat ~/.pip/pip.conf
[global]
external-index-url = http://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/
trusted-host=nexus01.domain.in
Pipfile:
[[source]]
url = "https://$REPO_USER:${REPO_PASS}@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/"
verify_ssl = false
name = "pypi-proxy"

[packages]
Flask = "*"
requests = "*"
furl = "*"
flask-restful = "*"
ipython = "*"
flask-wtf = "*"
gunicorn = "*"
flask-redis = "*"

[dev-packages]

[requires]
python_version = "3.7"
But when I trying to download dependencies, pipenv use wrong trusted host:
➜ REPO_USER=username REPO_PASS=password pipenv install --verbose
Pipfile.lock not found, creating...
Locking [dev-packages] dependencies...
Locking [packages] dependencies...
using sources: [{'url': 'https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/', 'verify_ssl': False, 'name': 'pypi-proxy'}]
Using pip: -i https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/ --trusted-host username


                          ROUND 1
Current constraints:
  Flask (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 3))
  flask-redis (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 10))
  flask-restful (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 6))
  flask-wtf (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 8))
  furl (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 5))
  gunicorn (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 9))
  ipython (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 7))
  requests (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 4))

Finding the best candidates:
Using pip: -i https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/ --trusted-host username

                          ROUND 1
Current constraints:
  Flask (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 3))
  flask-redis (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 10))
  flask-restful (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 6))
  flask-wtf (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 8))
  furl (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 5))
  gunicorn (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 9))
  ipython (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 7))
  requests (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 4))

Finding the best candidates:

INFO:notpip._internal.index:Could not fetch URL https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/flask/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='domain.in', port=8085): Max retries exceeded with url: /repo/repository/pypi-proxy/simple/flask/ (Caused by SSLError(SSLError(1, '[SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:1045)'))) - skipping
Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches Flask (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-ov53xm13-constraints.txt (line 3))
No versions found
Was https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/ reachable?
INFO:notpip._internal.index:Could not fetch URL https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/flask/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='nexus01.domain.in', port=8085): Max retries exceeded with url: /repo/repository/pypi-proxy/simple/flask/ (Caused by SSLError(SSLError(1, '[SSL: UNKNOWN_PROTOCOL] unknown protocol (_ssl.c:1045)'))) - skipping
Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches Flask (from -r /var/folders/x2/w2wlm7w10dx4f1fwflhjx8vc0000gq/T/pipenv-ae3njnee-requirements/pipenv-lrbg0l69-constraints.txt (line 3))
No versions found
Was https://username:password@nexus01.domain.in:8085/repo/repository/pypi-proxy/simple/ reachable?
Why pipenv uses first word from url in Pipfile, not from pip.conf?