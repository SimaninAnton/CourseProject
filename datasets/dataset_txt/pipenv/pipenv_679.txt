yohanboniface commented on 8 Sep 2018
Issue description
Error while autocompleting pipenv install requests under fish shell on a brand new directory.
Expected result
I can type the command pipenv install requests without error.
Actual result
$ mkdir hello
$ cd hello
$ pipenv install re/usr/share/fish/vendor_completions.d/pipenv.fish (line 1): Illegal command name “_pipenv_completion()”                                              16ms
_pipenv_completion() {
^
from sourcing file /usr/share/fish/vendor_completions.d/pipenv.fish
 called on standard input

in command substitution
 called on standard input

source: Error while reading file “/usr/share/fish/vendor_completions.d/pipenv.fish”
q
Steps to replicate
Issue only happen first time a I run a command in a new shell.
Please run $ pipenv --support, and paste the results here. Don't put backticks (`) around it! The output already contains Markdown formatting.
$ pipenv --support
$ fish --version
fish, version 2.7.1

$ pacman -Qo /usr/share/fish/vendor_completions.d/pipenv.fish
/usr/share/fish/vendor_completions.d/pipenv.fish is owned by python-pipenv 2018.7.1-2
This is what the python-pipenv package does:
https://git.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/python-pipenv#n69
SHELL=fish python -m pipenv --completion | install -Dm644 /dev/stdin "${pkgdir}/usr/share/fish/vendor_completions.d/pipenv.fish"
I do have virtualfish installed, but not the fisherman pipenv plugin.
I see BTW that there is also a builtin pipenv completion file in fish: https://github.com/fish-shell/fish-shell/blob/72d80c3d91bbd35bed0aafb5514c9834bb48e256/share/completions/pipenv.fish
So now I'm not sure where in all this chain [pipenv --completion, python-pipenv using it, fish completion…) the failing bit is, or is it some conflict between all those players trying to do their best, or any misconfiguration on my side, or…
Thanks for your hints :)
1