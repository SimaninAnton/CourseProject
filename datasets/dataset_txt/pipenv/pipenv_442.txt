Contributor
hynek commented on 16 Nov 2018
Issue description
As of 2018.11.14, running pipenv update --dev in a project that has an entry like "e1839a8" = {path = ".", editable = true} in its Pipfile create a new XXX.egg-info directory in the project directory even though the package lives actually in src (and that’s where the egg-info belongs to). This breaks a lot of stuff with very weird error messages.
E.g. when running tox (I’m pasting it here so lost souls trying to google the error will find it):
GLOB sdist-make: /Users/hynek/Work/cust-ws/setup.py
fmt recreate: /Users/hynek/Work/cust-ws/.tox/fmt
fmt installdeps: -rrequirements.txt, -rdev-requirements.txt
fmt inst: /Users/hynek/Work/cust-ws/.tox/.tmp/package/1/cust-ws-0.zip
ERROR: invocation failed (exit code 2), logfile: /Users/hynek/Work/cust-ws/.tox/fmt/log/fmt-2.log
ERROR: actionid: fmt
msg: installpkg
cmdargs: '/Users/hynek/Work/cust-ws/.tox/fmt/bin/python -m pip install --exists-action w /Users/hynek/Work/cust-ws/.tox/.tmp/package/1/cust-ws-0.zip'

Looking in indexes: https://pypi.vm.ag/root/vrmd/+simple/
Processing ./.tox/.tmp/package/1/cust-ws-0.zip
Building wheels for collected packages: cust-ws
  Running setup.py bdist_wheel for cust-ws: started
  Running setup.py bdist_wheel for cust-ws: finished with status 'done'
  Stored in directory: /Users/hynek/Library/Caches/pip/wheels/e7/0d/77/8ea9a7d3becf2c8edb801ea1baa7feaed0578536272b91b5dc
Successfully built cust-ws
Installing collected packages: cust-ws
  Found existing installation: cust-ws 0
Exception:
Traceback (most recent call last):
  File "/Users/hynek/Work/cust-ws/.tox/fmt/lib/python3.7/site-packages/pip/_internal/cli/base_command.py", line 143, in main
    status = self.run(options, args)
  File "/Users/hynek/Work/cust-ws/.tox/fmt/lib/python3.7/site-packages/pip/_internal/commands/install.py", line 366, in run
    use_user_site=options.use_user_site,
  File "/Users/hynek/Work/cust-ws/.tox/fmt/lib/python3.7/site-packages/pip/_internal/req/__init__.py", line 42, in install_given_reqs
    auto_confirm=True
  File "/Users/hynek/Work/cust-ws/.tox/fmt/lib/python3.7/site-packages/pip/_internal/req/req_install.py", line 682, in uninstall
    uninstalled_pathset = UninstallPathSet.from_dist(dist)
  File "/Users/hynek/Work/cust-ws/.tox/fmt/lib/python3.7/site-packages/pip/_internal/req/req_uninstall.py", line 369, in from_dist
    '(at %s)' % (link_pointer, dist.project_name, dist.location)
AssertionError: Egg-link /Users/hynek/Work/cust-ws/src does not match installed location of cust-ws (at /Users/hynek/Work/cust-ws)
Expected result
That it keeps working.
Actual result
I’m really having a hard time to distinguish “Issue description” from “Actual result". ;)
But yeah, you end up with multiple egg-info directories which is no bueno.
Steps to replicate
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
Have a package that has the package source somewhere else than in the project root and try to upgrade it. My guess is that pipenv install --dev -e . is gonna be broken too.
$ pipenv --support