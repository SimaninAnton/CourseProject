edsu commented on 17 Feb 2018 •
edited
Ubuntu: 16.04.3
Python: 3.5.2
Pipenv: 9.0.3
I was trying to initialize pipenv in a directory that happened to contain a file copy.py.
mkdir test
cd test
touch copy.py
pipenv --three
This fails with the following stack trace:
ubuntu@ip-172-30-1-145:~/test$ pipenv --three
Creating a virtualenv for this project…
Using /usr/bin/python3 to create virtualenv…
⠋Already using interpreter /usr/bin/python3
Using base prefix '/usr'
Traceback (most recent call last):
  File "/usr/lib/python3.5/runpy.py", line 184, in _run_module_as_main
    "__main__", mod_spec)
  File "/usr/lib/python3.5/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 2328, in <module>
    main()
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 713, in main
    symlink=options.symlink)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 925, in create_environment
    site_packages=site_packages, clear=clear, symlink=symlink))
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 1132, in install_python
    copy_required_modules(home_dir, symlink)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 1062, in copy_required_modules
    dst_filename = change_prefix(filename, dst_prefix)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/virtualenv.py", line 1036, in change_prefix
    (filename, prefixes)
AssertionError: Filename /home/ubuntu/test/copy.py does not start with any of these prefixes: ['/usr', '/usr']

Virtualenv location:
Creating a Pipfile for this project…
Traceback (most recent call last):
  File "/home/ubuntu/.local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/core.py", line 1043, in invoke
    return Command.invoke(self, ctx)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/cli.py", line 1724, in cli
    ensure_project(three=three, python=python, warn=True, site_packages=site_packages)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/cli.py", line 642, in ensure_project
    ensure_pipfile(validate=validate)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/cli.py", line 337, in ensure_pipfile
    project.create_pipfile(python=python)
  File "/home/ubuntu/.local/lib/python3.5/site-packages/pipenv/project.py", line 406, in create_pipfile
    data[u'requires'] = {'python_version': python_version(python)[:len('2.7')]}
TypeError: 'NoneType' object is not subscriptable
If I remove copy.py pipenv works fine. I initially discovered this on OS X, but tried it out on a brand new Ubuntu EC2 instance to verify the same behavior.