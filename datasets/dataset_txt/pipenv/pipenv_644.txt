ipmb commented on 21 Sep 2018 â€¢
edited
Issue description
pipenv install --two celery==3.1.25 flower==0.9.2
Locking fails looking for a suitable amqp library:
Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches amqp<2.0,<3.0,>=1.4.9,>=2.1.4
Tried: 0.9.1, 0.9.2, 0.9.3, 0.9.4, 1.0.0, 1.0.1, 1.0.2, 1.0.3, 1.0.4, 1.0.5, 1.0.6, 1.0.7, 1.0.8, 1.0.9, 1.0.10, 1.0.11, 1.0.12, 1.0.13, 1.2.0, 1.2.1, 1.3.0, 1.3.1, 1.3.2, 1.3.3, 1.4.0, 1.4.1, 1.4.2, 1.4.3, 1.4.3, 1.4.4, 1.4.4, 1.4.5, 1.4.5, 1.4.6, 1.4.6, 1.4.7, 1.4.8, 1.4.8, 1.4.9, 1.4.9, 2.0.0, 2.0.0, 2.0.1, 2.0.2, 2.0.2, 2.0.3, 2.0.3, 2.1.0, 2.1.0, 2.1.1, 2.1.1, 2.1.2, 2.1.2, 2.1.3, 2.1.3, 2.1.4, 2.1.4, 2.2.0, 2.2.0, 2.2.1, 2.2.1, 2.2.2, 2.2.2, 2.3.0, 2.3.0, 2.3.1, 2.3.1, 2.3.2, 2.3.2
There are incompatible versions in the resolved dependencies.
Expected result
amqp==1.4.9
anyjson==0.3.3
Babel==2.6.0
backports-abc==0.5
billiard==3.3.0.23
celery==3.1.25
flower==0.9.2
futures==3.2.0
kombu==3.0.37
pytz==2018.5
singledispatch==3.4.0.3
six==1.11.0
tornado==5.1.1
flower depends on celery>=3.1.0. celery==3.1.25 should satisfy that, but it ends up pulling requirements from a more recent version of celery which wants amqp<3.0,>=2.1.4 by way of kombu<5.0,>=4.2.0.
Actual result
$ pipenv lock --clear --verbose
Locking [dev-packages] dependencies...
Locking [packages] dependencies...
using sources: [{u'url': u'https://pypi.org/simple', u'verify_ssl': True, u'name': u'pypi'}]
Using pip: -i https://pypi.org/simple

                          ROUND 1
Current constraints:
  celery==3.1.25 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-pSJQfk-constraints.txt (line 2))
  flower==0.9.2 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-pSJQfk-constraints.txt (line 3))

Finding the best candidates:
  found candidate celery==3.1.25 (constraint was ==3.1.25)
  found candidate flower==0.9.2 (constraint was ==0.9.2)

Finding secondary dependencies:
  flower==0.9.2 not in cache, need to check index
  flower==0.9.2             requires amqp<3.0,>=2.1.4, babel>=1.0, billiard<3.6.0,>=3.5.0.2, celery>=3.1.0, flower==0.9.2, futures, kombu<5.0,>=4.2.0, pytz, tornado>=4.2.0, vine>=1.1.3
  celery==3.1.25 not in cache, need to check index
  celery==3.1.25            requires amqp<2.0,>=1.4.9, anyjson>=0.3.3, billiard<3.4,>=3.3.0.23, celery==3.1.25, kombu<3.1,>=3.0.37, pytz>dev

New dependencies found in this round:
  adding [u'amqp', '<2.0,<3.0,>=1.4.9,>=2.1.4', '[]']
  adding [u'anyjson', '>=0.3.3', '[]']
  adding [u'babel', '>=1.0', '[]']
  adding [u'billiard', '<3.4,<3.6.0,>=3.3.0.23,>=3.5.0.2', '[]']
  adding [u'celery', '==3.1.25,>=3.1.0', '[]']
  adding [u'flower', '==0.9.2', '[]']
  adding [u'futures', '', '[]']
  adding [u'kombu', '<3.1,<5.0,>=3.0.37,>=4.2.0', '[]']
  adding [u'pytz', '>dev', '[]']
  adding [u'tornado', '>=4.2.0', '[]']
  adding [u'vine', '>=1.1.3', '[]']
Removed dependencies in this round:
Unsafe dependencies in this round:
------------------------------------------------------------
Result of round 1: not stable

                          ROUND 2
Current constraints:
  amqp<2.0,<3.0,>=1.4.9,>=2.1.4
  anyjson>=0.3.3
  babel>=1.0
  billiard<3.4,<3.6.0,>=3.3.0.23,>=3.5.0.2
  celery==3.1.25,>=3.1.0 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-pSJQfk-constraints.txt (line 2))
  flower==0.9.2 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-pSJQfk-constraints.txt (line 3))
  futures
  kombu<3.1,<5.0,>=3.0.37,>=4.2.0
  pytz>dev
  tornado>=4.2.0
  vine>=1.1.3

Finding the best candidates:
Using pip: -i https://pypi.org/simple

                          ROUND 1
Current constraints:
  celery==3.1.25 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-oPIyzF-constraints.txt (line 2))
  flower==0.9.2 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-oPIyzF-constraints.txt (line 3))

Finding the best candidates:
  found candidate celery==3.1.25 (constraint was ==3.1.25)
  found candidate flower==0.9.2 (constraint was ==0.9.2)

Finding secondary dependencies:
  flower==0.9.2 not in cache, need to check index
  flower==0.9.2             requires amqp<3.0,>=2.1.4, babel>=1.0, billiard<3.6.0,>=3.5.0.2, celery>=3.1.0, flower==0.9.2, futures, kombu<5.0,>=4.2.0, pytz, tornado>=4.2.0, vine>=1.1.3
  celery==3.1.25 not in cache, need to check index
  celery==3.1.25            requires amqp<2.0,>=1.4.9, anyjson>=0.3.3, billiard<3.4,>=3.3.0.23, celery==3.1.25, kombu<3.1,>=3.0.37, pytz>dev

New dependencies found in this round:
  adding [u'amqp', '<2.0,<3.0,>=1.4.9,>=2.1.4', '[]']
  adding [u'anyjson', '>=0.3.3', '[]']
  adding [u'babel', '>=1.0', '[]']
  adding [u'billiard', '<3.4,<3.6.0,>=3.3.0.23,>=3.5.0.2', '[]']
  adding [u'celery', '==3.1.25,>=3.1.0', '[]']
  adding [u'flower', '==0.9.2', '[]']
  adding [u'futures', '', '[]']
  adding [u'kombu', '<3.1,<5.0,>=3.0.37,>=4.2.0', '[]']
  adding [u'pytz', '>dev', '[]']
  adding [u'tornado', '>=4.2.0', '[]']
  adding [u'vine', '>=1.1.3', '[]']
Removed dependencies in this round:
Unsafe dependencies in this round:
------------------------------------------------------------
Result of round 1: not stable

                          ROUND 2
Current constraints:
  amqp<2.0,<3.0,>=1.4.9,>=2.1.4
  anyjson>=0.3.3
  babel>=1.0
  billiard<3.4,<3.6.0,>=3.3.0.23,>=3.5.0.2
  celery==3.1.25,>=3.1.0 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-oPIyzF-constraints.txt (line 2))
  flower==0.9.2 (from -r /tmp/pipenv-RRj9zz-requirements/pipenv-oPIyzF-constraints.txt (line 3))
  futures
  kombu<3.1,<5.0,>=3.0.37,>=4.2.0
  pytz>dev
  tornado>=4.2.0
  vine>=1.1.3

Finding the best candidates:

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches amqp<2.0,<3.0,>=1.4.9,>=2.1.4
Tried: 0.9.1, 0.9.2, 0.9.3, 0.9.4, 1.0.0, 1.0.1, 1.0.2, 1.0.3, 1.0.4, 1.0.5, 1.0.6, 1.0.7, 1.0.8, 1.0.9, 1.0.10, 1.0.11, 1.0.12, 1.0.13, 1.2.0, 1.2.1, 1.3.0, 1.3.1, 1.3.2, 1.3.3, 1.4.0, 1.4.1, 1.4.2, 1.4.3, 1.4.3, 1.4.4, 1.4.4, 1.4.5, 1.4.5, 1.4.6, 1.4.6, 1.4.7, 1.4.8, 1.4.8, 1.4.9, 1.4.9, 2.0.0, 2.0.0, 2.0.1, 2.0.2, 2.0.2, 2.0.3, 2.0.3, 2.1.0, 2.1.0, 2.1.1, 2.1.1, 2.1.2, 2.1.2, 2.1.3, 2.1.3, 2.1.4, 2.1.4, 2.2.0, 2.2.0, 2.2.1, 2.2.1, 2.2.2, 2.2.2, 2.3.0, 2.3.0, 2.3.1, 2.3.1, 2.3.2, 2.3.2
There are incompatible versions in the resolved dependencies.
Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches amqp<2.0,<3.0,>=1.4.9,>=2.1.4
Tried: 0.9.1, 0.9.2, 0.9.3, 0.9.4, 1.0.0, 1.0.1, 1.0.2, 1.0.3, 1.0.4, 1.0.5, 1.0.6, 1.0.7, 1.0.8, 1.0.9, 1.0.10, 1.0.11, 1.0.12, 1.0.13, 1.2.0, 1.2.1, 1.3.0, 1.3.1, 1.3.2, 1.3.3, 1.4.0, 1.4.1, 1.4.2, 1.4.3, 1.4.3, 1.4.4, 1.4.4, 1.4.5, 1.4.5, 1.4.6, 1.4.6, 1.4.7, 1.4.8, 1.4.8, 1.4.9, 1.4.9, 2.0.0, 2.0.0, 2.0.1, 2.0.2, 2.0.2, 2.0.3, 2.0.3, 2.1.0, 2.1.0, 2.1.1, 2.1.1, 2.1.2, 2.1.2, 2.1.3, 2.1.3, 2.1.4, 2.1.4, 2.2.0, 2.2.0, 2.2.1, 2.2.1, 2.2.2, 2.2.2, 2.3.0, 2.3.0, 2.3.1, 2.3.1, 2.3.2, 2.3.2
There are incompatible versions in the resolved dependencies.
Steps to replicate
pipenv install --two celery==3.1.25 flower==0.9.2
$ pipenv --support