bw-matthew commented on 7 Mar 2018
When installing dependencies from setup.py using pipenv install -e . the private pypi repository defined in setup.cfg is not respected.
Describe your environment
Linux Ubuntu 16.04
Python version: 2.7.12
Pipenv version: 9.0.3
Expected result
I would expect the installation of packages to match the installation if I had run python setup.py install
Actual result
The Pipfile and Pipfile.lock generated use https://pypi.python.org/simple as the pypi.
Steps to replicate
setup.py
#!/usr/bin/env python

from setuptools import setup, find_packages

setup(
    name='example-problem-project',
    version='0.0.1',
    scripts=[],
    packages=find_packages(),
    install_requires=[
        'pyyaml==3.12',
    ]
)
setup.cfg
[easy_install]
index-url = https://this-will-never-work.com/repository/pypi-all/simple
Using python 3.6.4 in a pyenv:
pyenv virtualenv 3.6.4 setup-test
pyenv activate setup-test
python setup.py install
output:
running install
running bdist_egg
running egg_info
creating example_problem_project.egg-info
writing example_problem_project.egg-info/PKG-INFO
writing dependency_links to example_problem_project.egg-info/dependency_links.txt
writing requirements to example_problem_project.egg-info/requires.txt
writing top-level names to example_problem_project.egg-info/top_level.txt
writing manifest file 'example_problem_project.egg-info/SOURCES.txt'
reading manifest file 'example_problem_project.egg-info/SOURCES.txt'
writing manifest file 'example_problem_project.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-x86_64/egg
running install_lib
warning: install_lib: 'build/lib' does not exist -- no Python modules to install

creating build
creating build/bdist.linux-x86_64
creating build/bdist.linux-x86_64/egg
creating build/bdist.linux-x86_64/egg/EGG-INFO
copying example_problem_project.egg-info/PKG-INFO -> build/bdist.linux-x86_64/egg/EGG-INFO
copying example_problem_project.egg-info/SOURCES.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying example_problem_project.egg-info/dependency_links.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying example_problem_project.egg-info/requires.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
copying example_problem_project.egg-info/top_level.txt -> build/bdist.linux-x86_64/egg/EGG-INFO
zip_safe flag not set; analyzing archive contents...
creating dist
creating 'dist/example_problem_project-0.0.1-py3.6.egg' and adding 'build/bdist.linux-x86_64/egg' to it
removing 'build/bdist.linux-x86_64/egg' (and everything under it)
Processing example_problem_project-0.0.1-py3.6.egg
Copying example_problem_project-0.0.1-py3.6.egg to /home/matthew/.pyenv/versions/3.6.4/envs/setup-test/lib/python3.6/site-packages
Adding example-problem-project 0.0.1 to easy-install.pth file

Installed /home/matthew/.pyenv/versions/3.6.4/envs/setup-test/lib/python3.6/site-packages/example_problem_project-0.0.1-py3.6.egg
Processing dependencies for example-problem-project==0.0.1
Searching for pyyaml==3.12
Reading https://this-will-never-work.com/repository/pypi-all/simple/pyyaml/
Download error on https://this-will-never-work.com/repository/pypi-all/simple/pyyaml/: [Errno -2] Name or service not known -- Some packages may not be found!
Couldn't find index page for 'pyyaml' (maybe misspelled?)
Scanning index of all packages (this may take a while)
Reading https://this-will-never-work.com/repository/pypi-all/simple/
Download error on https://this-will-never-work.com/repository/pypi-all/simple/: [Errno -2] Name or service not known -- Some packages may not be found!
No local packages or working download links found for pyyaml==3.12
error: Could not find suitable distribution for Requirement.parse('pyyaml==3.12')
Using pipenv in a 3.6.4 pyenv:
pyenv virtualenv 3.6.4 setup-test-2
pyenv activate setup-test-2
pip install pipenv
pipenv install -e .
output:
Courtesy Notice: Pipenv found itself running within a virtual environment, so it will automatically use that environment, instead of creating its own for any project.
Creating a Pipfile for this project…
Installing -e .…
Obtaining file:///home/matthew/test/setup-test
Collecting pyyaml==3.12 (from example-problem-project==0.0.1)
Installing collected packages: pyyaml, example-problem-project
  Running setup.py develop for example-problem-project
Successfully installed example-problem-project pyyaml-3.12

Adding -e . to Pipfile's [packages]…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
Updated Pipfile.lock (6fc905)!
➜ grep pypi Pipfile*
Pipfile:url = "https://pypi.python.org/simple"
Pipfile:name = "pypi"
Pipfile.lock:                "name": "pypi",
Pipfile.lock:                "url": "https://pypi.python.org/simple",