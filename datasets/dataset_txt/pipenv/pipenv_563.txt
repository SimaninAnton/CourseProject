CoreyCole commented on 12 Oct 2018 ‚Ä¢
edited
When running pipenv install on ubuntu 16.04 with python 3.6.6 installed using pyenv, I get
$ pipenv install
Creating a virtualenv for this project‚Ä¶
Pipfile: /usr/local/src/Halloo/src/backend/Pipfile
Using /shims/python (None) to create virtualenv‚Ä¶
‚†ãThe path /shims/python (from --python=/shims/python) does not exist

Traceback (most recent call last):
  File "/home/ubuntu/.pyenv/versions/3.6.6/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/cli/command.py", line 249, in install
    editable_packages=state.installstate.editables,
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/core.py", line 1695, in do_install
    pypi_mirror=pypi_mirror,
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/core.py", line 561, in ensure_project
    pypi_mirror=pypi_mirror,
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/core.py", line 496, in ensure_virtualenv
    python=python, site_packages=site_packages, pypi_mirror=pypi_mirror
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/core.py", line 896, in do_create_virtualenv
    click.echo(crayons.blue("{0}".format(c.err)), err=True)
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 146, in err
    return self._pexpect_out
  File "/home/ubuntu/.pyenv/versions/3.6.6/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 114, in _pexpect_out
    result += self.subprocess.after
TypeError: must be str, not type
To get the install to work, I need to add --python 3.6.6 to my install command (even though it it declared in my pipfile as 3.6.6:
$ pipenv install --python 3.6.6
Creating a virtualenv for this project‚Ä¶
Pipfile: /usr/local/src/Halloo/src/backend/Pipfile
Using /home/ubuntu/.pyenv/versions/3.6.6/bin/python3.6 (3.6.6) to create virtualenv‚Ä¶
‚†ßAlready using interpreter /home/ubuntu/.pyenv/versions/3.6.6/bin/python3.6
Using base prefix '/home/ubuntu/.pyenv/versions/3.6.6'
New python executable in /usr/local/src/Halloo/src/backend/.venv/bin/python3.6
Also creating executable in /usr/local/src/Halloo/src/backend/.venv/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /usr/local/src/Halloo/src/backend/.venv
Pipfile.lock (279350) out of date, updating to (e6cb7e)‚Ä¶
Locking [dev-packages] dependencies‚Ä¶
Locking [packages] dependencies‚Ä¶
Updated Pipfile.lock (279350)!
Installing dependencies from Pipfile.lock (279350)‚Ä¶
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 28/28 ‚Äî 00:00:30
To activate this project's virtualenv, run pipenv shell.
Alternatively, run a command inside the virtualenv with pipenv run.
Note: this has been working in the past with the same pipfile on older releases of pipenv without the --python 3.6.6 flag
One difference I noticed is that in the regular pipenv install there is:
Using /shims/python (None) to create virtualenv‚Ä¶
While in the call with --python 3.6.6 there is:
Using /home/ubuntu/.pyenv/versions/3.6.6/bin/python3.6 (3.6.6) to create virtualenv‚Ä¶
Which is what leads me to believe this is a pyenv shims problem as I've seen in other issues on older releases of pipenv.
$ pipenv --support