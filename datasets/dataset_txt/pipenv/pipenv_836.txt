maxgrenderjones commented on 15 Jul 2018 â€¢
edited
Issue description
When attempting to install airflow, pipenv refuses to create a lock file, even though (I think) there's not actually a problem
> mkdir airflow-pipenv
> cd airflow-pipenv
> pipenv install airflow[mysql]==1.8.0
Creating a virtualenv for this project...
Pipfile: /Users/mgrenderjones/Documents/workspace/airflow-pipenv/Pipfile
... snip snip...
Adding airflow[mysql]==1.8.0 to Pipfile's [packages]...
Pipfile.lock not found, creating...
Locking [dev-packages] dependencies...
Locking [packages] dependencies...

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches jinja2<2.9.0,==2.8.1,>=2.10,>=2.4,>=2.7.3,>=2.8
Tried: 2.0, 2.1, 2.1.1, 2.2, 2.2.1, 2.3, 2.3.1, 2.4, 2.4.1, 2.5, 2.5.1, 2.5.2, 2.5.3, 2.5.4, 2.5.5, 2.6, 2.7, 2.7.1, 2.7.2, 2.7.3, 2.8, 2.8, 2.8.1, 2.8.1, 2.9, 2.9, 2.9.1, 2.9.1, 2.9.2, 2.9.2, 2.9.3, 2.9.3, 2.9.4, 2.9.4, 2.9.5, 2.9.5, 2.9.6, 2.9.6, 2.10, 2.10
But it's not clear to me that there's a >=2.10.0 dependency:
> pipenv graph | grep -i jinja
    - Jinja2 [required: >=2.4, installed: 2.8.1]
      - Jinja2 [required: >=2.4, installed: 2.8.1]
      - Jinja2 [required: >=2.4, installed: 2.8.1]
      - Jinja2 [required: >=2.4, installed: 2.8.1]
      - Jinja2 [required: >=2.4, installed: 2.8.1]
      - Jinja2 [required: >=2.4, installed: 2.8.1]
  - jinja2 [required: >=2.7.3,<2.9.0, installed: 2.8.1]
    - Jinja2 [required: >=2.8, installed: 2.8.1]
Expected result
Airflow should install (with Jinja2==2.8.1)
Actual result
Seems I can't have airflow and a lock file.
Looking at the output of pipenv lock --verbose (and setup.py) the issue appears to be that airflow requires a restricted set of versions of Jinja2 (<=2.9.0) as well as specific versions of flask and it's helpers e.g. flask-[admin|swagger] (there are more), which themselves require >=2.10 of Jinja2. And so kaboom.
But my project doesn't use flask-admin etc, and I've been happily using airflow for a long time now without issue - is there no way to force the issue? Sure, we could say this is an 'upstream' problem, but it feels like there ought to be a way to say 'please let me do this'!
Steps to replicate
See above
$ pipenv --support
4