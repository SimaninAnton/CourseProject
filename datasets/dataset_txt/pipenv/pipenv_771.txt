kuzmiigo commented on 2 Aug 2018
I have checked existing issues and could not find this specific problem.
Issue description
pipenv lock does not seem to use extra-index-url from pip.conf, so the generated pip commands do not include --extra-index-url and resolution fails for packages from a private PyPI repo. At the same time, pipenv install --skip-lock works fine.
It seems that lock generation and installation of packages work differently in regards to extra-index-url setting from pip.conf.
Expected result
Considering that pipenv install --skip-lock uses extra-index-url from pip.conf and finds packages from a private repo specified there, it is reasonable to expect that pipenv lock would do the same and generate the lock file successfully.
Actual result
$ rm -rf ~/.local/share/virtualenvs/test-* ~/Library/Caches/pip ~/Library/Caches/pipenv
$ pipenv lock -v
Creating a virtualenv for this project...
Pipfile: /Users/igor/dev/test/Pipfile
Using /Users/igor/.pyenv/versions/3.6.6/bin/python3.6m (3.6.6) to create virtualenv...
Running virtualenv with interpreter /Users/igor/.pyenv/versions/3.6.6/bin/python3.6m
Using base prefix '/Users/igor/.pyenv/versions/3.6.6'
New python executable in /Users/igor/.local/share/virtualenvs/test-zhjSazsP/bin/python3.6m
Also creating executable in /Users/igor/.local/share/virtualenvs/test-zhjSazsP/bin/python
Installing setuptools, pip, wheel...done.
Setting project for test-zhjSazsP to /Users/igor/dev/test

Virtualenv location: /Users/igor/.local/share/virtualenvs/test-zhjSazsP
Locking [dev-packages] dependencies...
Locking [packages] dependencies...
using sources: [{'url': 'https://pypi.org/simple', 'verify_ssl': True, 'name': 'pypi'}]
Using pip: -i https://pypi.org/simple

                          ROUND 1
Current constraints:
  clipper-admin (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-hop18nyp-constraints.txt (line 2))
  statlib-core (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-hop18nyp-constraints.txt (line 3))

Finding the best candidates:
  found candidate clipper-admin==0.3.0 (constraint was <any>)
Using pip: -i https://pypi.org/simple

                          ROUND 1
Current constraints:
  clipper-admin (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-jyp_cgb3-constraints.txt (line 2))
  statlib-core (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-jyp_cgb3-constraints.txt (line 3))

Finding the best candidates:
  found candidate clipper-admin==0.3.0 (constraint was <any>)

Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches statlib-core (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-hop18nyp-constraints.txt (line 3))
No versions found
Was https://pypi.org/simple reachable?
Warning: Your dependencies could not be resolved. You likely have a mismatch in your sub-dependencies.
  You can use $ pipenv install --skip-lock to bypass this mechanism, then run $ pipenv graph to inspect the situation.
  Hint: try $ pipenv lock --pre if it is a pre-release dependency.
Could not find a version that matches statlib-core (from -r /var/folders/5c/3n6h99cn0fb_1n1s5lm6klj00000gp/T/pipenv-slcmj1td-requirements/pipenv-jyp_cgb3-constraints.txt (line 3))
No versions found
Was https://pypi.org/simple reachable?
Steps to replicate
Include a dependency (statlib-core) from a private repo in Pipfile (see below).
Add URL to the private repo as extra-index-url in ~/.pip/pip.conf (not shown here as it contains credentials).
Clear Pipenv cache (rm -rf ~/.local/share/virtualenvs/test-* ~/Library/Caches/pip ~/Library/Caches/pipenv).
Run pipenv lock or pipenv install.
$ pipenv --support