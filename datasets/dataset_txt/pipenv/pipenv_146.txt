nyuszika7h commented on 6 Jun 2019 •
edited
Issue description
When using zsh, the virtualenv source line executed by pipenv shell is not automatically removed from the shell history until a new command is executed. I see that pipenv prefixes the command with a space in an attempt to exclude the line from the history, which works with HISTCONTROL=ignorespace in bash, however in zsh it's well-documented behavior that with setopt histignorespace the command will linger in the history until the next one is executed.
The solution is to have pipenv send an additional line after the source line, containing only a single space character. This will cause zsh to actually discard the source line from the history immediately (and the empty space line won't stay there either).
Expected result
The source line should not appear in the zsh history with setopt histignorespace.
Actual result
The source line does appear until the next command is executed, as described above.
Steps to replicate
nyuszika7h@cadoth ~/pipenvtest
% pipenv shell
Launching subshell in virtual environment…
 . /home/nyuszika7h/.local/share/virtualenvs/pipenvtest-SKcwrrwm/bin/activate
nyuszika7h@cadoth ~/pipenvtest
%  . /home/nyuszika7h/.local/share/virtualenvs/pipenvtest-SKcwrrwm/bin/activate
(pipenvtest) nyuszika7h@cadoth ~/pipenvtest
%
[press up arrow]
%  . /home/nyuszika7h/.local/share/virtualenvs/pipenvtest-SKcwrrwm/bin/activate
$ pipenv --support