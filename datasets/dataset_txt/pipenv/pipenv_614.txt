claudeleveille commented on 7 Oct 2018 •
edited
Issue description
pipenv fails to produce a lock file when installing the 'ansible-test' package.
Expected result
pipenv command exits with a zero status code and both Pipfile and Pipfile.lock are produced on the filesystem.
Actual result
Command output:
$ pipenv install --dev ansible-test --verbose
Installing ansible-test...
⠋Installing 'ansible-test'
$ "/home/claude/.local/share/virtualenvs/ansible-role-base-yifMWX3P/bin/pip" install   --verbose    "ansible-test" -i https://pypi.org/sim
ple --exists-action w
Created temporary directory: /tmp/pip-ephem-wheel-cache-gprwi7i2
Created temporary directory: /tmp/pip-req-tracker-hsdk8w3h
Created requirements tracker '/tmp/pip-req-tracker-hsdk8w3h'
Created temporary directory: /tmp/pip-install-300pjjev
Requirement already satisfied: ansible-test in /home/claude/.local/share/virtualenvs/ansible-role-base-yifMWX3P/lib/python3.6/site-package
s (1.0.1)
Requirement already satisfied: Jinja2 in /home/claude/.local/share/virtualenvs/ansible-role-base-yifMWX3P/lib/python3.6/site-packages (fro
m ansible-test) (2.10)
Requirement already satisfied: MarkupSafe>=0.23 in /home/claude/.local/share/virtualenvs/ansible-role-base-yifMWX3P/lib/python3.6/site-pac
kages (from Jinja2->ansible-test) (1.0)
Cleaning up...
Removed build tracker '/tmp/pip-req-tracker-hsdk8w3h'

Adding ansible-test to Pipfile's [dev-packages]...
Pipfile.lock not found, creating...
Locking [dev-packages] dependencies...
using sources: [{'url': 'https://pypi.org/simple', 'verify_ssl': True, 'name': 'pypi'}]

Traceback (most recent call last):
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 87, in <module>
    main()
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 76, in main
    system=system,
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 63, in resolve
    allow_global=system,
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/utils.py", line 402, in resolve_deps
    req_dir=req_dir
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/utils.py", line 250, in actually_resolve_deps
    req = Requirement.from_line(dep)
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/requirements.py", line 704, in from_line
    line, extras = _strip_extras(line)
TypeError: 'module' object is not callable
pipenv lock --clear --verbose didn't fix it:
$ pipenv lock --clear --verbose
Locking [dev-packages] dependencies...
using sources: [{'url': 'https://pypi.org/simple', 'verify_ssl': True, 'name': 'pypi'}]

Traceback (most recent call last):
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 87, in <module>
    main()
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 76, in main
    system=system,
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/resolver.py", line 63, in resolve
    allow_global=system,
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/utils.py", line 402, in resolve_deps
    req_dir=req_dir
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/utils.py", line 250, in actually_resolve_deps
    req = Requirement.from_line(dep)
  File "/home/claude/.local/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/requirements.py", line 704, in from_line
    line, extras = _strip_extras(line)
TypeError: 'module' object is not callable
Steps to replicate
pipenv install --dev ansible-test (version 1.0.1, specifying version doesn't help).
My Pipfile (results from running above command):
[[source]]
url = "https://pypi.org/simple"
verify_ssl = true
name = "pypi"

[packages]

[dev-packages]
ansible-test = "*"

[requires]
python_version = "3.6"
$ pipenv --support