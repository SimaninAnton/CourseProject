amirouche commented on 28 Oct 2018
Issue description
I try to install a python project using pipenv on Ubuntu trusty with a dependency on CPython 3.6
Expected result
CPython 3.6 is installed and pipenv install succeed
Actual result
pipenv fails.
Steps to replicate
It's prolly a problem with python 3.4. I use LXC to spawn a trusty container. Something like the following should reproduce the issue:
sudo lxc-create -t download -n trusty -- --dist ubuntu --release trusty --arch amd64
sudo lxc-start -n trusty
sudo lxc-attach -n trusty
Inside the trusty lxc do the following:
apt install git
git clone https://github.com/amirouche/hoply
cd hoply
make install
It should raise the following error:
Warning: Python 3.6 was not found on your system…
Would you like us to install CPython 3.6.7 with pyenv? [Y/n]: y
Installing CPython 3.6.7 with pyenv (this may take a few minutes)…
Traceback (most recent call last):
  File "/usr/local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/cli/command.py", line 249, in install
    editable_packages=state.installstate.editables,
  File "/usr/local/lib/python3.4/dist-packages/pipenv/core.py", line 1724, in do_install
    pypi_mirror=pypi_mirror,
  File "/usr/local/lib/python3.4/dist-packages/pipenv/core.py", line 565, in ensure_project
    pypi_mirror=pypi_mirror,
  File "/usr/local/lib/python3.4/dist-packages/pipenv/core.py", line 488, in ensure_virtualenv
    python = ensure_python(three=three, python=python)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/core.py", line 451, in ensure_python
    c = pyenv.install(version)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/pyenv.py", line 117, in install
    timeout=PIPENV_INSTALL_TIMEOUT,
  File "/usr/local/lib/python3.4/dist-packages/pipenv/pyenv.py", line 73, in _pyenv
    raise PyenvError('faild to run {0}'.format(args), c)
  File "/usr/local/lib/python3.4/dist-packages/pipenv/pyenv.py", line 56, in __init__
    self.err = c.err
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/delegator.py", line 146, in err
    return self._pexpect_out
  File "/usr/local/lib/python3.4/dist-packages/pipenv/vendor/delegator.py", line 114, in _pexpect_out
    result += self.subprocess.after
TypeError: Can't convert 'type' object to str implicitly
make: *** [install] Error 1
$ pipenv --support