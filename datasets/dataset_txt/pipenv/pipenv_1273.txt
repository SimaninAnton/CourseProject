LegoStormtroopr commented on 29 Mar 2018
Unable to correct install packages that are defined locally.
Using pipenv 11.8.3 to target Heroku, so upgrading is hard.
I'm trying to build an application that has quite a few components, and want a Pipfile at the root which installs a bunch of packages that are in a subdirectory, each with a setup.py. I'm doing this in editable mode, so I can do development work.
The initial pipenv install -e ./some-local-package works fine, but inserts a .egg directory, which is ignore by git when committing. If another developer tries to check this code out, without the egg and just runs pipenv install or pipenv lock pipenv crashes, especially if the lock file (which changes a lot in dev) isn't present.
So if the .egg directories are removed (which aren't in source control), pipenv locks fail with an intuitive message.
So what am I doing wrong?
$ python -m pipenv.help output
Expected result
A lock file is generated
Actual result
Creating a virtualenv for this project…
Using /usr/local/bin/python3.6m (3.6.4) to create virtualenv…
Running virtualenv with interpreter /usr/local/bin/python3.6m
Using base prefix '/usr/local'
New python executable in /root/.local/share/virtualenvs/dev-mLGR0Vyd/bin/python3.6m
Also creating executable in /root/.local/share/virtualenvs/dev-mLGR0Vyd/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /root/.local/share/virtualenvs/dev-mLGR0Vyd
Locking [dev-packages] dependencies…
Using pip: -i https://pypi.python.org/simple

                          ROUND 1                           
Current constraints:

Finding the best candidates:

Finding secondary dependencies:
------------------------------------------------------------
Result of round 1: stable, done

Locking [packages] dependencies…
Using pip: -i https://pypi.python.org/simple

                          ROUND 1                           
Current constraints:
  file:///usr/src/app/aristotle-metadata-registry/python/aristotle-metadata-registry

Finding the best candidates:
  found candidate -e file:///usr/src/app/aristotle-metadata-registry/python/aristotle-metadata-registry (constraint was <any>)

Finding secondary dependencies:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/site-packages/pipenv/resolver.py", line 82, in <module>
    main()
  File "/usr/local/lib/python3.6/site-packages/pipenv/resolver.py", line 71, in main
    clear=do_clear,
  File "/usr/local/lib/python3.6/site-packages/pipenv/resolver.py", line 63, in resolve
    verbose=verbose,
  File "/usr/local/lib/python3.6/site-packages/pipenv/utils.py", line 425, in resolve_deps
    pre,
  File "/usr/local/lib/python3.6/site-packages/pipenv/utils.py", line 336, in actually_resolve_reps
    resolved_tree.update(resolver.resolve(max_rounds=PIPENV_MAX_ROUNDS))
  File "/usr/local/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 102, in resolve
    has_changed, best_matches = self._resolve_one_round()
  File "/usr/local/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 200, in _resolve_one_round
    for dep in self._iter_dependencies(best_match):
  File "/usr/local/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 275, in _iter_dependencies
    for dependency in self.repository.get_dependencies(ireq):
  File "/usr/local/lib/python3.6/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 174, in get_dependencies
    legacy_results = self.get_legacy_dependencies(ireq)
  File "/usr/local/lib/python3.6/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 193, in get_legacy_dependencies
    dist = ireq.get_dist()
  File "/usr/local/lib/python3.6/site-packages/pipenv/vendor/pip9/req/req_install.py", line 1069, in get_dist
    egg_info = self.egg_info_path('').rstrip('/')
  File "/usr/local/lib/python3.6/site-packages/pipenv/vendor/pip9/req/req_install.py", line 515, in egg_info_path
    'No files/directories in %s (from %s)' % (base, filename)
pip9.exceptions.InstallationError: No files/directories in /usr/src/app/aristotle-metadata-registry/python/aristotle-metadata-registry (from )
Steps to replicate
mkdir tmp && cd tmp
git clone https://github.com/aristotle-mdr/aristotle-metadata-registry
pipenv install -e ./aristotle-metadata-registry/python/aristotle-metadata-registry
rm ./aristotle-metadata-registry/python/aristotle-metadata-registry/aristotle_metadata_registry.egg-info -rf
rm Pipfile.lock
pipenv --rm && pipenv install
ls ./aristotle-metadata-registry/python/aristotle-metadata-registry/