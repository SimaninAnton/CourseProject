ldgabbay commented on 29 Apr 2018 •
edited
pipenv is failing due to TLS issues on a new High Sierra 10.13.4 system with python 2.7.14 from python.org's pkg installed. I have updated pip to support the latest TLS.
FYI someone mentioned this issue before but closed their issue because it "resolved itself" without explanation.
$ pip --version
pip 10.0.1 from /Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pip (python 2.7)

$ python -c "import ssl; print(ssl.OPENSSL_VERSION)"
OpenSSL 0.9.8zh 14 Jan 2016
$ python -m pipenv.help output
Expected result
$ pipenv install -r requirements.txt
Creating a virtualenv for this project…
Using /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python (2.7.14) to create virtualenv…
⠋Already using interpreter /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
New python executable in /Users/rick/.local/share/virtualenvs/voice-quickstart-server-python-zVwW_i1A/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /Users/rick/.local/share/virtualenvs/voice-quickstart-server-python-zVwW_i1A
Creating a Pipfile for this project…
Requirements file provided! Importing into Pipfile…
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
... sunshine and rainbows ...
Done.
Actual result
$ pipenv install -r requirements.txt
Creating a virtualenv for this project…
Using /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python (2.7.14) to create virtualenv…
⠋Already using interpreter /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python
New python executable in /Users/rick/.local/share/virtualenvs/voice-quickstart-server-python-zVwW_i1A/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /Users/rick/.local/share/virtualenvs/voice-quickstart-server-python-zVwW_i1A
Creating a Pipfile for this project…
Requirements file provided! Importing into Pipfile…
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
/Library/Python/2.7/lib/python/site-packages/pipenv/vendor/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Users/rick/Library/Python/2.7/lib/python/site-packages/pipenv/vendor/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Users/rick/Library/Python/2.7/lib/python/site-packages/pipenv/vendor/requests/adapters.py", line 506, in send
    raise SSLError(e, request=request)
requests.exceptions.SSLError: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /pypi/itsdangerous/json (Caused by SSLError(SSLError(1, u'[SSL: TLSV1_ALERT_PROTOCOL_VERSION] tlsv1 alert protocol version (_ssl.c:661)'),))

/Users/rick/Library/Python/2.7/lib/python/site-packages/pipenv/utils.py:1288: ResourceWarning: Implicitly cleaning up <TemporaryDirectory '/var/folders/7x/pfyb8v_j13bdvsj9rrgftq8w0000gn/T/pipenv-L14PsE-requirements'>
  warnings.warn(warn_message, ResourceWarning)
Steps to replicate
new macOS High Sierra 10.13.4
install Python 2.7.14 from python.org here: https://www.python.org/ftp/python/2.7.14/python-2.7.14-macosx10.6.pkg
update pip with curl https://bootstrap.pypa.io/get-pip.py -O; sudo python get-pip.py
go into project with this requirements.txt file:
Flask==0.10.1
Jinja2==2.7.3
MarkupSafe==0.23
Werkzeug==0.9.6
httplib2==0.9
itsdangerous==0.24
six==1.*
twilio==6.10.0
wsgiref==0.1.2
nose
requests
pyjwt
run pipenv install -r requirements.txt