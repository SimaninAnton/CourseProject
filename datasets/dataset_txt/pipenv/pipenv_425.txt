mndavidoff commented on 21 Nov 2018
Issue description
Creating a virtual environment raises TypeError if the PYENV_ROOT environment variable is set.
Actual result
$ export PYENV_ROOT=~/.pyenv
$ pipenv --three
Traceback (most recent call last):
  File "/home/mdavidoff/.pyenv/versions/3.7.1/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 1114, in invoke
    return Command.invoke(self, ctx)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/cli/command.py", line 203, in cli
    clear=state.clear,
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/core.py", line 569, in ensure_project
    pypi_mirror=pypi_mirror,
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/core.py", line 489, in ensure_virtualenv
    python = ensure_python(three=three, python=python)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/core.py", line 397, in ensure_python
    path_to_python = find_a_system_python(python)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/core.py", line 360, in find_a_system_python
    python_entry = finder.find_python_version(line)
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/pythonfinder.py", line 113, in find_python_version
    return self.system_path.find_python_version(
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/pythonfinder.py", line 54, in system_path
    ignore_unsupported=self.ignore_unsupported,
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/path.py", line 451, in create
    ignore_unsupported=ignore_unsupported,
  File "<attrs generated init 75e45f144e3d5510d54dd5fca6730b98fa0220a9>", line 38, in __init__
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/path.py", line 116, in __attrs_post_init__
    self._setup_pyenv()
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/path.py", line 196, in _setup_pyenv
    version_glob_path="versions/*", ignore_unsupported=self.ignore_unsupported
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/python.py", line 154, in create
    sort_function=sort_function, version_glob_path=version_glob_path)
  File "<attrs generated init 70e7caa08623cefd387bb53355fd897fab63b913>", line 17, in __init__
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/python.py", line 98, in get_versions
    for p in self.get_version_order():
  File "/home/mdavidoff/.pyenv/versions/3.7.1/lib/python3.7/site-packages/pipenv/vendor/pythonfinder/models/python.py", line 70, in get_version_order
    version_order = [versions[v] for v in parse_pyenv_version_order()]
TypeError: 'NoneType' object is not iterable
If the PYENV_ROOT environment variable is not set, the virtual environment is created without error.
I installed pipenv using pip install pipenv.
This problem occurred in pipenv 2018.11.14; pipenv 2018.10.13 didn't have this problem.
See sarugaku/pythonfinder#48.
PYENV_ROOT not set:
$ pipenv --support
PYENV_ROOT set:
$ pipenv --support









































2