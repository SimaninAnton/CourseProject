whren commented on 17 Oct 2018
Issue description
I'm under WSL 14.04, running python 3.6.6 and upgraded from pipenv 2018.7.1 to the last release, 2018.10.13.
I then try to run a pipenv clean on a virtualenv (existing or new no difference) and I'm getting an error about an include file not found.
It was working before the update of pipenv.
I've located source modification from the stacktrace coming from #2849 with the following commit
Following informations have been anonymised due to client and project informations
Expected result
pipenv clean run successfully without error
Actual result
$ pipenv clean

Traceback (most recent call last):
  File "/usr/local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/cli/command.py", line 602, in clean
    do_clean(ctx=ctx, three=state.three, python=state.python, dry_run=dry_run)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/core.py", line 2526, in do_clean
    canonicalize_name(pkg.project_name) for pkg in project.get_installed_packages()
  File "/usr/local/lib/python3.6/dist-packages/pipenv/project.py", line 320, in get_installed_packages
    packages = [pkg for pkg in workingset if self.dist_is_in_project(pkg)]
  File "/usr/local/lib/python3.6/dist-packages/pipenv/project.py", line 320, in <listcomp>
    packages = [pkg for pkg in workingset if self.dist_is_in_project(pkg)]
  File "/usr/local/lib/python3.6/dist-packages/pipenv/project.py", line 311, in dist_is_in_project
    prefix = _normalized(self.env_paths["prefix"])
  File "/usr/local/lib/python3.6/dist-packages/pipenv/project.py", line 948, in env_paths
    config.update(self._pyversion)
  File "/usr/local/lib/python3.6/dist-packages/pipenv/project.py", line 929, in _pyversion
    python_path = next(iter(list(include_dir.iterdir())), None)
  File "/usr/lib/python3.6/pathlib.py", line 1079, in iterdir
    for name in self._accessor.listdir(self):
  File "/usr/lib/python3.6/pathlib.py", line 387, in wrapped
    return strfunc(str(pathobj), *args)
FileNotFoundError: [Errno 2] No such file or directory: '/home/xxx/.local/share/virtualenvs/create-service1-EZvUL_lY/include'
Of course, no include file or directory in the virtualenv fs:
$ ls -lh /home/xxx/.local/share/virtualenvs/create-service1-EZvUL_lY
total 0
drwxrwxrwx 1 xxx xxx 512 oct.  17 11:16 bin
drwxrwxrwx 1 xxx xxx 512 oct.  17 11:16 lib
-rw-rw-rw- 1 xxx xxx  59 oct.  17 11:16 pip-selfcheck.json
drwxrwxrwx 1 xxx xxx 512 oct.  17 11:17 src
Steps to replicate
$ pipenv install

Creating a virtualenv for this project‚Ä¶
Pipfile: /mnt/c/Users/xxx/docker-datas/project/project-api/terraform/live/services/service1/lambdas-src/create-service1/Pipfile
Using /usr/bin/python3.6 (3.6.6) to create virtualenv‚Ä¶
‚†¶Already using interpreter /usr/bin/python3.6
Using base prefix '/usr'
New python executable in /home/xxx/.local/share/virtualenvs/create-service1-EZvUL_lY/bin/python3.6
Also creating executable in /home/xxx/.local/share/virtualenvs/create-service1-EZvUL_lY/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /home/xxx/.local/share/virtualenvs/create-service1-EZvUL_lY
Installing dependencies from Pipfile.lock (da2531)‚Ä¶
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 1/1 ‚Äî 00:00:09
To activate this project's virtualenv, run pipenv shell.
Alternatively, run a command inside the virtualenv with pipenv run.

$ pipenv clean
$ pipenv --support