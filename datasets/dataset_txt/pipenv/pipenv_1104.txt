dangunter commented on 2 May 2018
Be sure to check the existing issues (both open and closed!).
pipenv install with an existing requirements.txt fails with a stack trace.
$ python -m pipenv.help output
Expected result
Installation of the Python package in the current directory.
Actual result
Stack trace.
Creating a virtualenv for this project…
Using /home/dang/anaconda3/envs/idaes-dev3/bin/python (3.6.2) to create virtualenv…
⠋Already using interpreter /home/dang/anaconda3/envs/idaes-dev3/bin/python
Using base prefix '/home/dang/anaconda3/envs/idaes-dev3'
New python executable in /home/dang/.local/share/virtualenvs/idaes-Kqcjy-GI/bin/python
Installing setuptools, pip, wheel...
  Complete output from command /home/dang/.local/sh...-Kqcjy-GI/bin/python - setuptools pip wheel:
  Exception:
Traceback (most recent call last):
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/basecommand.py", line 215, in main
    status = self.run(options, args)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/commands/install.py", line 272, in run
    with self._build_session(options) as session:
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/basecommand.py", line 72, in _build_session
    insecure_hosts=options.trusted_hosts,
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/download.py", line 329, in __init__
    self.headers["User-Agent"] = user_agent()
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/download.py", line 69, in user_agent
    "python": platform.python_version(),
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/platform.py", line 1244, in python_version
    return _sys_version()[1]
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/platform.py", line 1192, in _sys_version
    repr(sys_version))
ValueError: failed to parse CPython sys.version: '3.6.5 (default, Apr 14 2018, 13:17:30) \n[GCC 7.3.1 20180406]'
Traceback (most recent call last):
  File "<stdin>", line 23, in <module>
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/__init__.py", line 233, in main
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/basecommand.py", line 251, in main
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/basecommand.py", line 72, in _build_session
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/download.py", line 329, in __init__
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv_support/pip-9.0.1-py2.py3-none-any.whl/pip/download.py", line 69, in user_agent
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/platform.py", line 1244, in python_version
    return _sys_version()[1]
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/platform.py", line 1192, in _sys_version
    repr(sys_version))
ValueError: failed to parse CPython sys.version: '3.6.5 (default, Apr 14 2018, 13:17:30) \n[GCC 7.3.1 20180406]'
----------------------------------------
...Installing setuptools, pip, wheel...done.
Traceback (most recent call last):
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv.py", line 2328, in <module>
    main()
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv.py", line 713, in main
    symlink=options.symlink)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv.py", line 945, in create_environment
    download=download,
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv.py", line 901, in install_wheel
    call_subprocess(cmd, show_stdout=False, extra_env=env, stdin=SCRIPT)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/virtualenv.py", line 797, in call_subprocess
    % (cmd_desc, proc.returncode))
OSError: Command /home/dang/.local/sh...-Kqcjy-GI/bin/python - setuptools pip wheel failed with error code 1

Virtualenv location: 
requirements.txt found, instead of Pipfile! Converting…
Traceback (most recent call last):
  File "/home/dang/anaconda3/envs/idaes-dev3/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/cli.py", line 402, in install
    selective_upgrade=selective_upgrade,
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/core.py", line 1787, in do_install
    skip_requirements=skip_requirements,
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/core.py", line 648, in ensure_project
    ensure_pipfile(validate=validate, skip_requirements=skip_requirements, system=system)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/core.py", line 279, in ensure_pipfile
    project.create_pipfile(python=python)
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/project.py", line 588, in create_pipfile
    required_python = self.which('python')
  File "/home/dang/anaconda3/envs/idaes-dev3/lib/python3.6/site-packages/pipenv/core.py", line 126, in which
    p = os.sep.join([location] + ['bin/{0}'.format(command)])
TypeError: sequence item 0: expected str instance, NoneType found
```
##### Steps to replicate

Command run was `pipenv install`. Was working in a Python 3.6 Conda environment.

The requirements.txt file follows.

```
# general
alabaster>=0.7.7
bunch
codecov
jupyter
networkx
#pyomo
pytest
pytest-cov
snowballstemmer==1.2.1
# Need Sphinx >=1.74 due to bug #4897
# See: https://github.com/sphinx-doc/sphinx/issues/4897
Sphinx>=1.7.4
sphinx-rtd-theme>=0.1.9
sphinxcontrib-napoleon>=0.5.0
tox
# DMF
backports.tempfile
flake8
flask>=1.0
flask-bower
flask-restful
lxml
mock
pandas==0.19.2
pendulum
psutil
pyyaml
# For ALAMO examples
numpy
scipy
tinydb
traitlets

# ****** NEED TO ADD THIS SOMEWHERE
# Used for testing: geckodriver
# https://github.com/mozilla/geckodriver/releases
# Used for testing: pytest-selenium

# dev version of pyomo
# https://software.sandia.gov/svn/public/pyomo/pyomo/trunk
git+https://github.com/pyomo/pyomo.git@IDAES
git+https://github.com/PyUtilib/pyutilib
bokeh==0.12.9
```