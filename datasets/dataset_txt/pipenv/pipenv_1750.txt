ipfans commented on 5 Dec 2017
Describe your environment
OS Type
macOS 12.13.1
Python version: $ python -V
$ python -V
Python 3.6.3
Pipenv version: $ pipenv --version
$ pipenv --version
pipenv, version 8.3.2
Expected result
Upgrade/Lock exists package from a exists project virtualenv. I think it should be works.
Actual result
$ pipenv lock --three
Virtualenv already exists!
Removing existing virtualenv…
Creating a virtualenv for this project…
Using /Users/user/.pyenv/versions/3.6.3/bin/python3 to create virtualenv…
⠋Running virtualenv with interpreter /Users/user/.pyenv/versions/3.6.3/bin/python3
Using base prefix '/Users/user/.pyenv/versions/3.6.3'
New python executable in /Users/user/.local/share/virtualenvs/hhhh-news-y2QdrW3f/bin/python3
Also creating executable in /Users/user/.local/share/virtualenvs/hhhh-news-y2QdrW3f/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /Users/user/.local/share/virtualenvs/hhhh-news-y2QdrW3f
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
Traceback (most recent call last):
  File "/Users/user/.pyenv/versions/3.6.3/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/cli.py", line 2061, in lock
    do_lock(verbose=verbose, clear=clear, pre=pre)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/cli.py", line 1121, in do_lock
    pre=pre
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/utils.py", line 461, in resolve_deps
    resolved_tree.update(resolver.resolve(max_rounds=PIPENV_MAX_ROUNDS))
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 102, in resolve
    has_changed, best_matches = self._resolve_one_round()
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 200, in _resolve_one_round
    for dep in self._iter_dependencies(best_match):
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/piptools/resolver.py", line 296, in _iter_dependencies
    dependencies = self.repository.get_dependencies(ireq)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 153, in get_dependencies
    result = reqset._prepare_file(self.finder, ireq)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/pip/req/req_set.py", line 671, in _prepare_file
    check_dist_requires_python(dist)
  File "/Users/user/.pyenv/versions/3.6.3/lib/python3.6/site-packages/pipenv/patched/pip/utils/packaging.py", line 56, in check_dist_requires_python
    os.environ['PIP_PYTHON_VERSION']
pip.exceptions.UnsupportedPythonVersion: futures requires Python '>=2.6, <3' but the running Python is 3.6.3
Steps to replicate
Using pipenv with this pipfile:
[[source]]

url = "https://mirrors.aliyun.com/pypi/simple"
verify_ssl = true
name = "pypi"


[packages]

aiohttp = "*"
aiohttp-debugtoolbar = "*"
"aiohttp-jinja2" = "*"
aiohttp-session = "*"
aioredis = "*"
cchardet = "*"
cython = "*"
grpcio-tools = "*"
motor = "*"
python-dateutil = "*"
pyyaml = "*"
umongo = "*"
simple-settings = "*"
aiohttp-swagger = "*"


[dev-packages]

pytest-aiohttp = "*"
flake8 = "*"
jedi = "*"
isort = "*"
autopep8 = "*"
mypy = "*"
aiohttp-devtools = "*"