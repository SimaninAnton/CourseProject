jakul commented on 15 Nov 2018
Issue description
pipenv lock -r fails when using a Pipfile which is not called Pipfile
Expected result
pipenv lock -r works
Actual result
pipenv.vendor.requirementslib.exceptions.PipfileNotFound error
Steps to replicate
craig@amogato2:/tmp/named-pipfile
$ cat NamedPipfile
[[source]]
name = "pypi"
url = "https://pypi.org/simple"
verify_ssl = true

[dev-packages]

[packages]
requests = "*"

[requires]
python_version = "3.7"

craig@amogato2:/tmp/named-pipfile
$ PIPENV_PIPFILE=NamedPipfile pipenv lock -r
ERROR: The file could not be found: /private/tmp/named-pipfile/Pipfile
Aborting...
ERROR: The file could not be found: /private/tmp/named-pipfile/Pipfile
Aborting...
Traceback (most recent call last):
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/project.py", line 737, in get_or_create_lockfile
    lockfile = Req_Lockfile.load(self.lockfile_location)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 226, in load
    projectfile = cls.load_projectfile(path, create=create)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 171, in load_projectfile
    lf = cls.lockfile_from_pipfile(project_path.joinpath("Pipfile"))
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 145, in lockfile_from_pipfile
    raise PipfileNotFound(pipfile_path)
pipenv.vendor.requirementslib.exceptions.PipfileNotFound

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/craig/.local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/cli/command.py", line 318, in lock
    pre=state.installstate.pre,
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/core.py", line 1232, in do_init
    pypi_mirror=pypi_mirror,
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/core.py", line 781, in do_install_dependencies
    lockfile = project.get_or_create_lockfile()
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/project.py", line 739, in get_or_create_lockfile
    lockfile = Req_Lockfile.from_data(self.lockfile_location, self.lockfile_content)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 202, in from_data
    lockfile = cls.lockfile_from_pipfile(pipfile_path)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 145, in lockfile_from_pipfile
    raise PipfileNotFound(pipfile_path)
pipenv.vendor.requirementslib.exceptions.PipfileNotFound

craig@amogato2:/tmp/named-pipfile
$ PIPENV_PIPFILE=NamedPipfile pipenv lock -r -v
ERROR: The file could not be found: /private/tmp/named-pipfile/Pipfile
Aborting...
ERROR: The file could not be found: /private/tmp/named-pipfile/Pipfile
Aborting...
Traceback (most recent call last):
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/project.py", line 737, in get_or_create_lockfile
    lockfile = Req_Lockfile.load(self.lockfile_location)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 226, in load
    projectfile = cls.load_projectfile(path, create=create)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 171, in load_projectfile
    lf = cls.lockfile_from_pipfile(project_path.joinpath("Pipfile"))
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 145, in lockfile_from_pipfile
    raise PipfileNotFound(pipfile_path)
pipenv.vendor.requirementslib.exceptions.PipfileNotFound

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/craig/.local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/cli/command.py", line 318, in lock
    pre=state.installstate.pre,
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/core.py", line 1232, in do_init
    pypi_mirror=pypi_mirror,
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/core.py", line 781, in do_install_dependencies
    lockfile = project.get_or_create_lockfile()
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/project.py", line 739, in get_or_create_lockfile
    lockfile = Req_Lockfile.from_data(self.lockfile_location, self.lockfile_content)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 202, in from_data
    lockfile = cls.lockfile_from_pipfile(pipfile_path)
  File "/Users/craig/.local/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/requirementslib/models/lockfile.py", line 145, in lockfile_from_pipfile
    raise PipfileNotFound(pipfile_path)
pipenv.vendor.requirementslib.exceptions.PipfileNotFound
$ pipenv --support

I think this is caused by https://github.com/sarugaku/requirementslib/blob/eb8152c4394c0b447dc0ec4420f9f86f5ab596a3/src/requirementslib/models/lockfile.py#L198-L199
1