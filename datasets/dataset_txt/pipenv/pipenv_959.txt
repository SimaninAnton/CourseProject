ptink commented on 14 Jun 2018 â€¢
edited
A sys_platform marker is occasionally being erroneously added to Pipfile.lock when installing certain libraries.
$ python -m pipenv.help output
Expected result
When running pipenv install --dev to install libraries, one of which has a sys_platform specific dependency and the other that has the same dependency regardless of sys_platform. I would expect the dependency in question to be added to Pipfile.lock without any sys_platform markers
Actual result
Pipfile.lock output can vary without Pipfile contents changing, sometimes the sys_platform marker is present, occasionally it isn't
Steps to replicate
Create a Pipfile with two libraries with the same sub-dependency but different sys_platform requirements (e.g. sphinx and pinocchio, sphinx only requires the dependency colorama on win32, pinocchio requires colorama regardless of platform)
run pipenv install, observe output of Pipfile.lock
delete Pipfile.lock
run pipenv install again, observe output
repeat, the "markers": "sys_platform == 'win32'", will sometimes show in Pipfile.lock, occasionally it won't. I believe the marker should never appear, as pinocchio always requires colorama.
I am running pipenv via git-bash on Windows, however I have tested and the same thing happens via powershell