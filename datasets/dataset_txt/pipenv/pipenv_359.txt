andreineculau commented on 18 Dec 2018 •
edited
I should say first that I'm not sure whether this is a pipenv or pyenv or virtualenv or linuxbrew issue, but here goes.
Issue description
In a "vanilla" Ubuntu 18.04 image (tested this in Parallels Desktop and on Travis CI),
I install pipenv via linuxbrew and then try to install a simple Pipfile.
sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"
eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
brew install pipenv
pipenv install --skip-lock --dev
The Pipfile is
[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true

[requires]
python_version = "3.7"

[dev-packages]
"boto3" = "*"
"flake8" = "*"

[packages]
requests = "*"
Expected result
I expect to get no errors.
Actual result
Creating a virtualenv for this project…
Pipfile: /home/travis/build/tobiipro/atex-platform/apex/functions/python/Pipfile
Using /home/linuxbrew/.linuxbrew/bin/python3.7m (3.7.1) to create virtualenv…
Using base prefix '/home/linuxbrew/.linuxbrew/bin/../Cellar/python/3.7.1'
New python executable in /home/travis/build/tobiipro/atex-platform/apex/functions/python/.venv/bin/python3.7
Also creating executable in /home/travis/build/tobiipro/atex-platform/apex/functions/python/.venv/bin/python
Overwriting /home/travis/build/tobiipro/atex-platform/apex/functions/python/.venv/lib/python3.7/distutils/__init__.py with new content
Running virtualenv with interpreter /home/linuxbrew/.linuxbrew/bin/python3.7m
FAIL
['Traceback (most recent call last):\n', '  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/utils.py", line 501, in create_spinner\n    yield sp\n', '  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/core.py", line 935, in do_create_virtualenv\n    extra=[crayons.blue("{0}".format(c.err)),]\n', 'pipenv.exceptions.VirtualenvCreationException: Failed to create virtual environment.\n']
[pipenv.exceptions.VirtualenvCreationException]:   File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/cli/command.py", line 254, in install
[pipenv.exceptions.VirtualenvCreationException]:       editable_packages=state.installstate.editables,
[pipenv.exceptions.VirtualenvCreationException]:   File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/core.py", line 1741, in do_install
[pipenv.exceptions.VirtualenvCreationException]:       pypi_mirror=pypi_mirror,
[pipenv.exceptions.VirtualenvCreationException]:   File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/core.py", line 574, in ensure_project
[pipenv.exceptions.VirtualenvCreationException]:       pypi_mirror=pypi_mirror,
[pipenv.exceptions.VirtualenvCreationException]:   File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/core.py", line 506, in ensure_virtualenv
[pipenv.exceptions.VirtualenvCreationException]:       python=python, site_packages=site_packages, pypi_mirror=pypi_mirror
[pipenv.exceptions.VirtualenvCreationException]:   File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/pipenv/core.py", line 935, in do_create_virtualenv
[pipenv.exceptions.VirtualenvCreationException]:       extra=[crayons.blue("{0}".format(c.err)),]
[pipenv.exceptions.VirtualenvCreationException]: Traceback (most recent call last):
  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/virtualenv.py", line 2462, in <module>
    main()
  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/virtualenv.py", line 762, in main
    symlink=options.symlink,
  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/virtualenv.py", line 1001, in create_environment
    install_distutils(home_dir)
  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/virtualenv.py", line 1580, in install_distutils
    writefile(os.path.join(distutils_path, "__init__.py"), DISTUTILS_INIT)
  File "/home/linuxbrew/.linuxbrew/Cellar/pipenv/2018.11.26/libexec/lib/python3.7/site-packages/virtualenv.py", line 431, in writefile
    with open(dest, "wb") as f:
PermissionError: [Errno 13] Permission denied: '/home/travis/build/tobiipro/atex-platform/apex/functions/python/.venv/lib/python3.7/distutils/__init__.py'
Failed to create virtual environment.
When possible, provide the verbose output (--verbose), especially for locking and dependencies resolving issues.
Steps to replicate
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
$ pipenv --support
3