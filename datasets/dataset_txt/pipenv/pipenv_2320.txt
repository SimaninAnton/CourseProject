musicformellons commented on 19 May 2017 â€¢
edited
I have a working ansible script on ubuntu 16.04:
name: create a virtualenv with pipenv and python 3
command: pipenv install {{item}} --three chdir={{ virtualenv_dir }}
with_items:
argparse==1.2.1
boto==2.33.0
future==0.15.2
However now I have to adjust it to ubuntu 14.04 (and using python 2 in the virtual environment):
name: create a virtualenv with pipenv and python 2
command: pipenv install {{item}} --two chdir={{ virtualenv_dir }}
with_items:
argparse==1.2.1
boto==2.33.0
future==0.15.2
For each package I get the error:
failed: [92.222.10.96] (item=argparse==1.2.1) => {"changed": true, "cmd": ["pipenv", "install", "argparse==1.2.1", "--two", "state=present"], "delta": "0:00:00.402764", "end": "2017-05-18 21:47:04.291328", "failed": true, "item": "argparse==1.2.1", "rc": 1, "start": "2017-05-18 21:47:03.888564", "stderr": "Traceback (most recent call last):\n File \"/usr/local/bin/pipenv\", line 7, in <module>\n from pipenv import cli\n File \"/usr/local/lib/python3.4/dist-packages/pipenv/__init__.py\", line 14, in <module>\n from .cli import cli\n File \"/usr/local/lib/python3.4/dist-packages/pipenv/cli.py\", line 21, in <module>\n from requests.packages.urllib3.exceptions import InsecureRequestWarning\nImportError: No module named 'requests.packages'", "stderr_lines": ["Traceback (most recent call last):", " File \"/usr/local/bin/pipenv\", line 7, in <module>", " from pipenv import cli", " File \"/usr/local/lib/python3.4/dist-packages/pipenv/__init__.py\", line 14, in <module>", " from .cli import cli", " File \"/usr/local/lib/python3.4/dist-packages/pipenv/cli.py\", line 21, in <module>", " from requests.packages.urllib3.exceptions import InsecureRequestWarning", "ImportError: No module named 'requests.packages'"], "stdout": "", "stdout_lines": []}
So something is wrong with requests package it seems. But when I check the requests package is installed (both for python 2 and for python 3), so I do not quite get why it 'is missing'.
BTW, I also ssh'ed into the server and tried to manually install some packages with pipenv but got similar errormessage:
/home/usr/env# pipenv install argparse==1.2.1
Traceback (most recent call last):
  File "/usr/local/bin/pipenv", line 7, in <module>
    from pipenv import cli
  File "/usr/local/lib/python3.4/dist-packages/pipenv/__init__.py", line 14, in <module>
    from .cli import cli
  File "/usr/local/lib/python3.4/dist-packages/pipenv/cli.py", line 21, in <module>
    from requests.packages.urllib3.exceptions import InsecureRequestWarning
ImportError: No module named 'requests.packages'
UPDATE: I noticed when ssh'ed into the server it gives this error-message for all pipenv commands: 'pipenv shell' etc. I then installed pew and pipenv with pipsi and then I can install packages into the virtualenv, but when subsequently trying to run ansible I get exact same errors again.