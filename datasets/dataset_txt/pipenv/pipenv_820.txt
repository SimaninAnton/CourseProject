Contributor
atzannes commented on 20 Jul 2018
Issue description
This seems to be a regression introduced in v2018.6.25 with respect to installing libraries whose setup.py contains a dependency_links section (which is used when the library depends on a package from a private VCS repository). Starting with v2018.6.25, pipenv fails to install such libraries.
I wrote a test to demonstrate that behavior here.
When I cherry-pick this commit on top of the tag:v2018.5.18 the test passes, but it fails when I cherry-pick it on top of the current master branch.
I'm glad to try and fix this if it is a simple problem and given some guidance.
Expected result
The test should pass.
Actual result
The test fails with this error
...
Locking [packages] dependenciesâ€¦
patched/piptools/repositories/pypi.py", line 448, in <setcomp>
    for candidate in matching_candidates
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/piptools/repositories/pypi.py", line 72, in get_hash
    hash_value = self._get_file_hash(location)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/piptools/repositories/pypi.py", line 80, in _get_file_hash
    with open_local_or_remote_file(location, self.session) as fp:
  File "/usr/local/Cellar/python/3.6.5/Frameworks/Python.framework/Versions/3.6/lib/python3.6/contextlib.py", line 81, in __enter__
    return next(self.gen)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/piptools/repositories/pypi.py", line 506, in open_local_or_remote_file
    response = session.get(url, headers=headers, stream=True)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/notpip/_vendor/requests/sessions.py", line 521, in get
    return self.request('GET', url, **kwargs)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/notpip/_internal/download.py", line 398, in request
    return super(PipSession, self).request(method, url, *args, **kwargs)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/notpip/_vendor/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/notpip/_vendor/requests/sessions.py", line 612, in send
    adapter = self.get_adapter(url=request.url)
File "/Users/alextzannes/src/pipenv-altfork/pipenv/patched/notpip/_vendor/requests/sessions.py", line 703, in get_adapter
    raise InvalidSchema("No connection adapters were found for '%s'" % url)
pipenv.patched.notpip._vendor.requests.exceptions.InvalidSchema: No connection adapters were found for 'git+https://github.com/Altschool/django-wellknown@v0.3.0'
Full error log here
Note that the error happens during locking, after the dependency-link has been fetched successfully and installed during the initial install phase.
Steps to replicate
git clone git@github.com:AltSchool/pipenv.git
git checkout test/deplinks
<install whatever you need to run the test>
pytest tests/integration/test_install_twists.py::test_local_dependency_links_install
$ pipenv --support