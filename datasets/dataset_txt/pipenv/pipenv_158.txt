rh0dium commented on 25 May 2019
Issue description
In reviewing #3762 for a possible workaround I observed that when VCS dependancies ARE present pip universally removes --no-deps option. This will cause most installs to fail due to HashError (#3762) on sub packages.
Expected result
The --no-deps option should be not be universally removed unless the user specifically requests it.
As reported in the logs without a VCS Dependancy
Installing u'django-select2'
REQUIREMENTS: django-select2==6.3.1 --hash=sha256:7e5a3da54332cb94174a91e0a03177ce44c152049b0876424ba81fc805dbb89f --hash=sha256:f93b5b626e5c0e8ced24e1e31027eb4850649216e4132cdc3f3880c0bed241c9
>   $ ['/data/app/test/.venv/bin/pip', 'install', '--verbose', '--upgrade', '--no-deps', '-r', '/tmp/pipenv-UmIG73-requirements/pipenv-Gzx0GE-requirement.txt', '-i', u'https://pypi.org/simple', '--require-hashes']
Actual result
When VCS dependancies are used (editable or not) --no-deps are added to all package installs. This fails to install the packages but also fails to report them (#3762)
As reported in the logs with a VCS Dependancy
Installing u'django-select2'
REQUIREMENTS: django-select2==6.3.1 --hash=sha256:7e5a3da54332cb94174a91e0a03177ce44c152049b0876424ba81fc805dbb89f --hash=sha256:f93b5b626e5c0e8ced24e1e31027eb4850649216e4132cdc3f3880c0bed241c9
>   $ ['/data/app/test/.venv/bin/pip', 'install', '--verbose', '--upgrade', '-r', '/tmp/pipenv-tW49Z1-requirements/pipenv-mTlzBo-requirement.txt', '-i', u'https://pypi.org/simple', '--require-hashes']
Steps to replicate
Docker / Testcase demonstrating failure: https://github.com/pivotal-energy-solutions/pipenv-no-report-fail
This does nothing other than injects a modified pyenv/core.py so we can fake fix it and show the issues more clearly.
To see this bug fail simply do the following
```
docker-compose build --build-arg BUILD_VERSION=0.0.1
```
To enable it to pass - simply modify the Pipfile by removing the VCS dependancies and rebuild.
docker-compose build --build-arg --build-arg BUILD_VERSION=0.0.2
$ pipenv --support