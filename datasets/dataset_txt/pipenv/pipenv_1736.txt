zsimic commented on 11 Dec 2017
Describe your environment
macOS 10.12.6
Python version: any python version, bug seen with 2.7 and 3.6
Pipenv version: 9.0.0
Expected result
Expecting pipenv install to yield same result consistently, in this particular case setuptools 33.1.1 should be resolved (due to pex constraint)
Actual result
pipenv resolves setuptools 33.1.1 on 1st installation, but not on 2nd
Steps to replicate
You can reproduce like so (in any folder, using a scratch one here).
First time around, everything looks good (pex wants setuptools<34), note the minor annoying question "Did you mean pexpect?":
pipenv --rm ; rm -f Pipfile* ; pipenv install pex ; pipenv install pytest --dev ; pipenv graph
...
Did you mean pexpect? [Y/n]: n
Installing pexâ€¦
...
pex==1.2.15
  - setuptools [required: >=20.3,<34.0, installed: 33.1.1]
...
pytest==3.3.1
  - setuptools [required: Any, installed: 33.1.1]
...
Now delete venv and install again -> wrong setuptools is resolved:
pipenv --rm ; pipenv install ; pipenv graph
...
pex==1.2.15
  - setuptools [required: >=20.3,<34.0, installed: 38.2.4]
...
pytest==3.3.1
  - setuptools [required: Any, installed: 38.2.4]
...
Also note that pipenv install acted here as-if I state --dev... wasn't expecting pytest to be installed here (was expecting it to be installed if I stated --dev).