msheiny commented on 19 Mar 2018
I'm hitting issues when install the latest vcrpy under pipenv 11.8.3.
Expected result
I'm running pipenv lock -v and its barking on vcrpy 's dependencies. specifically looks like yarl and the python_version syntax. It seems like pipenv is adding some duplication to what i see in the vcrpy dependency list.
Actual result
Here's a dump from my shell:
$ pipenv lock -v                                                                                                                                                                                                
Locking [dev-packages] dependenciesâ€¦                                                                                                                                                                               
Using pip: -i https://pypi.python.org/simple                                                                                                                                                                       
                                                                                                                                                                                                                   
                          ROUND 1                                                                                                                                                                                  
Current constraints:                                                                                                                                                                                               
  factory_boy                                                                                                                                                                                                      
  vcrpy==1.10.5                                                                                                                                                                                                    
                                                                                                                                                                                                                   
Finding the best candidates:                                                                                                                                                                                       
  found candidate factory-boy==2.10.0 (constraint was <any>)                                                                                                                                                       
  found candidate vcrpy==1.10.5 (constraint was ==1.10.5)                                                                                                                                                          
                                                                                                                                                                                                                   
Finding secondary dependencies:                                                                                                                                                                                    
  factory-boy==2.10.0       requires Faker>=0.7.0                                                                                                                                                                  
  vcrpy==1.10.5             requires PyYAML, six>=1.5, wrapt, yarl; python_version in "3.4, 3.5, 3.6"; python_version in "3.4, 3.5, 3.6"                                                                           
                                                                                                                                                                                                                   
INFO:pip9._vendor.requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): pypi.python.org                                                                                                      
Traceback (most recent call last):                                                                                                                                                                                 
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/_vendor/packaging/markers.py", line 278, in __init__                                                                                   
    self._markers = _coerce_parse_result(MARKER.parseString(marker))                                                                                                                                               
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1617, in parseString                                                                                          
    raise exc                                                                                                                                                                                                      
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1607, in parseString                                                                                          
    loc, tokens = self._parse( instring, 0 )                                                                                                                                                                       
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1379, in _parseNoCache                                                                                        
    loc,tokens = self.parseImpl( instring, preloc, doActions )                                                                                                                                                     
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 3376, in parseImpl                                                                                            
    loc, exprtokens = e._parse( instring, loc, doActions )                                                                                                                                                         
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1383, in _parseNoCache                                                                                        
    loc,tokens = self.parseImpl( instring, preloc, doActions )                                                                                                                                                     
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 3164, in parseImpl                                                                                            
    raise ParseException(instring, loc, self.errmsg, self)                                                                                                                                                         
pip9._vendor.pyparsing.ParseException: Expected stringEnd (at char 28), (line:1, col:29)                                                                                                                           
                                                                                                                                                                                                                   
During handling of the above exception, another exception occurred:                                                                                                                                                
                                                                                                                                                                                                                   
Traceback (most recent call last):
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/piptools/resolver.py", line 329, in _iter_dependencies
    yield InstallRequirement.from_line(_dependency_string, constraint=ireq.constraint)
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/req/req_install.py", line 181, in from_line
    markers = Marker(markers)
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/_vendor/packaging/markers.py", line 282, in __init__
    raise InvalidMarker(err_str)
notpip._vendor.packaging.markers.InvalidMarker: Invalid marker: 'python_version in "3.4, 3.6"; python_version in "3.4', parse error at '; python'


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/_vendor/packaging/markers.py", line 278, in __init__
    self._markers = _coerce_parse_result(MARKER.parseString(marker))
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1617, in parseString
    raise exc
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1607, in parseString
    loc, tokens = self._parse( instring, 0 )
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1379, in _parseNoCache
    loc,tokens = self.parseImpl( instring, preloc, doActions )
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 3376, in parseImpl
    loc, exprtokens = e._parse( instring, loc, doActions )
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 1383, in _parseNoCache
    loc,tokens = self.parseImpl( instring, preloc, doActions )
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/vendor/pip9/_vendor/pyparsing.py", line 3164, in parseImpl
    raise ParseException(instring, loc, self.errmsg, self)
pip9._vendor.pyparsing.ParseException: Expected stringEnd (at char 33), (line:1, col:34)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/resolver.py", line 82, in <module>
    main()
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/resolver.py", line 71, in main
    clear=do_clear,
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/resolver.py", line 63, in resolve
    verbose=verbose,
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/utils.py", line 425, in resolve_deps
    pre,
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/utils.py", line 336, in actually_resolve_reps
    resolved_tree.update(resolver.resolve(max_rounds=PIPENV_MAX_ROUNDS))
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/piptools/resolver.py", line 102, in resolve
    has_changed, best_matches = self._resolve_one_round()
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/piptools/resolver.py", line 200, in _resolve_one_round
    for dep in self._iter_dependencies(best_match):
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/piptools/resolver.py", line 331, in _iter_dependencies
    yield InstallRequirement.from_line(dependency_string, constraint=ireq.constraint)
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/req/req_install.py", line 181, in from_line
    markers = Marker(markers)
  File "/home/mike/.local/lib/python2.7/site-packages/pipenv/patched/notpip/_vendor/packaging/markers.py", line 282, in __init__
    raise InvalidMarker(err_str)
notpip._vendor.packaging.markers.InvalidMarker: Invalid marker: 'python_version in "3.4, 3.5, 3.6"; python_version in "3.4, 3.5, 3.6"', parse error at '; python'
Steps to replicate
See my Pipfile output below in the system debug. This doesn't seem to be an error when I remove the python requirements in the Pipfile and it uses my system default (python2).
Here's my system debug output.
$ python -m pipenv.help output