alexrecarey commented on 29 Aug 2018 •
edited
I expect something is wrong in my environment with this issue. Any pointers as to how to troubleshoot it are appreciated.
Issue description
On a new install of Pipenv using Homebrew, I cannot create a new environment when targetting a pyenv installed version of python.
alex@NerdPro ~/code/hack/pipenv-test                                                                                                           [16:38:08] 
> $ pipenv --python 3.6                                                                                                                                  
Creating a virtualenv for this project...
Pipfile: /Users/alex/code/hack/pipenv-test/Pipfile
Using /Users/alex/.pyenv/versions/3.6.6/bin/python3.6m (3.6.6) to create virtualenv...
⠋Running virtualenv with interpreter /Users/alex/.pyenv/versions/3.6.6/bin/python3.6m
Using base prefix '/Users/alex/.pyenv/versions/3.6.6/Python.framework/Versions/3.6'
Traceback (most recent call last):
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 2343, in <module>
    main()
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 712, in main
    symlink=options.symlink)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 927, in create_environment
    site_packages=site_packages, clear=clear, symlink=symlink))
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 1134, in install_python
    copy_required_modules(home_dir, symlink)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 1064, in copy_required_modules
    dst_filename = change_prefix(filename, dst_prefix)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/virtualenv.py", line 1038, in change_prefix
    (filename, prefixes)
AssertionError: Filename /Users/alex/.pyenv/versions/3.6.6/lib/python3.6/lib-dynload/zlib.cpython-36m-darwin.so does not start with any of these prefixes: ['/Users/alex/.pyenv/versions/3.6.6/Python.framework/Versions/3.6/Extras/lib/python', '/Users/alex/.pyenv/versions/3.6.6/Python.framework/Versions/3.6', '/Users/alex/.pyenv/versions/3.6.6/Python.framework/Versions/3.6', '/Users/alex/Library/Python/3.6/lib/python/site-packages', '/Users/alex/.local/lib/python/3.6/site-packages', '/Users/alex/Library/Python/3.6/site-packages', '/Library/Python/3.6/site-packages']

Virtualenv location: 
Traceback (most recent call last):
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/bin/pipenv", line 11, in <module>
    load_entry_point('pipenv==2018.7.1', 'console_scripts', 'pipenv')()
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 1043, in invoke
    return Command.invoke(self, ctx)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/cli.py", line 294, in cli
    three=three, python=python, warn=True, site_packages=site_packages, pypi_mirror=pypi_mirror
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/core.py", line 639, in ensure_project
    ensure_pipfile(validate=validate, skip_requirements=skip_requirements, system=system)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/core.py", line 244, in ensure_pipfile
    python = which('python') if not (USING_DEFAULT_PYTHON or system) else None
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/lib/python3.7/site-packages/pipenv/core.py", line 115, in which
    p = os.path.join(location, 'bin', command)
  File "/usr/local/Cellar/pipenv/2018.7.1/libexec/bin/../lib/python3.7/posixpath.py", line 80, in join
    a = os.fspath(a)
TypeError: expected str, bytes or os.PathLike object, not NoneType
Expected result
I expected to get a virtual environment based on python 3.6.6.
Actual result
When possible, provide the verbose output (--verbose), especially for locking and dependencies resolving issues.
Steps to replicate
On an OSX machine:
brew install python
brew install pyenv
brew install pipenv
pyenv install 3.6.6
pipenv --python 3.6
$ pipenv --support
4