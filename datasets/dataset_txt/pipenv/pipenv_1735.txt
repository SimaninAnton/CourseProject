jmurrayufo commented on 11 Dec 2017
Installing python-logstash and smbus2 from pipenv on a Raspberry Pi results in errors that seem to be related to Pipenv's hashing?
Describe your environment
Linux roachhab 4.9.59-v7+ #1047 SMP Sun Oct 29 12:19:23 GMT 2017 armv7l GNU/Linux (Raspberrian Debian)
Python version: Python 2.7.13 and Python 3.6.3
Pipenv version: pipenv, version 9.0.0
Expected result
Virtualenv install of python-logstash and smbus2
Actual result
Sample run of actual development Pipfile
pipenv update
Updating all dependencies from Pipfile‚Ä¶
Found 11 installed package(s), purging‚Ä¶
Uninstalling aiofiles-0.3.2:
  Successfully uninstalled aiofiles-0.3.2
Uninstalling crc16-0.1.1:
  Successfully uninstalled crc16-0.1.1
Uninstalling crcmod-1.7:
  Successfully uninstalled crcmod-1.7
Uninstalling httptools-0.0.9:
  Successfully uninstalled httptools-0.0.9
Uninstalling logstash-formatter-0.5.16:
  Successfully uninstalled logstash-formatter-0.5.16
Uninstalling python-logstash-0.4.6:
  Successfully uninstalled python-logstash-0.4.6
Uninstalling sanic-0.7.0:
  Successfully uninstalled sanic-0.7.0
Uninstalling Sanic-Auth-0.2.0:
  Successfully uninstalled Sanic-Auth-0.2.0
Uninstalling smbus2-0.2.0:
  Successfully uninstalled smbus2-0.2.0
Uninstalling ujson-1.35:
  Successfully uninstalled ujson-1.35
Uninstalling websockets-4.0.1:
  Successfully uninstalled websockets-4.0.1

Environment now purged and fresh!
Locking [dev-packages] dependencies‚Ä¶
Locking [packages] dependencies‚Ä¶
Updated Pipfile.lock (48f27e)!
Installing dependencies from Pipfile.lock (48f27e)‚Ä¶
An error occurred while installing python-logstash==0.4.6! Will try again.
An error occurred while installing smbus2==0.2.0! Will try again.
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 12/12 ‚Äî 00:00:17
Installing initially‚Äìfailed dependencies‚Ä¶
Collecting python-logstash==0.4.6 ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî 00:00:00
  Using cached https://www.piwheels.hostedpi.com/simple/python-logstash/python_l                                                                                                  ogstash-0.4.6-py3-none-any.whl

THESE PACKAGES DO NOT MATCH THE HASHES FROM Pipfile.lock!. If you have updated t                                                                                                  he package versions, please update the hashes. Otherwise, examine the package co                                                                                                  ntents carefully; someone may have tampered with them.
    python-logstash==0.4.6 from https://www.piwheels.hostedpi.com/simple/python-                                                                                                  logstash/python_logstash-0.4.6-py3-none-any.whl#sha256=0a184b86c27d17fe328247347                                                                                                  3568da545f8b51b1201697d01576ddef0790e97 (from -r /tmp/pipenv-3qjbcm_e-requiremen                                                                                                  t.txt (line 1)):
        Expected sha256 10943e5df83f592b4d61b63ad1afff855ccc8c9467f78718f0a59809                                                                                                  ba1fe68c
             Got        0a184b86c27d17fe3282473473568da545f8b51b1201697d01576dde                                                                                                  f0790e97


  ‚ò§  ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî 
Of note, only these two packages seem to have this error. I am unsure as to why this is (not really knowing enough about the pip system in general to see how they might be different).
Reducing the Pipfile to just smbus2 and python-logstash as follows:
Test Pipfile
[[source]]

url = "https://pypi.python.org/simple"
verify_ssl = true
name = "pypi"


[packages]

"smbus2" = "*"
python-logstash = "*"

[dev-packages]



[requires]

python_version = "3.6"
Resulting Error
pipenv install
Installing dependencies from Pipfile.lock (58d3ae)‚Ä¶
An error occurred while installing python-logstash==0.4.6! Will try again.
An error occurred while installing smbus2==0.2.0! Will try again.
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 2/2 ‚Äî 00:00:03
Installing initially‚Äìfailed dependencies‚Ä¶
Collecting python-logstash==0.4.6 ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî 00:00:00
  Using cached https://www.piwheels.hostedpi.com/simple/python-logstash/python_logstash-0.4.6-py3-none-any.whl

THESE PACKAGES DO NOT MATCH THE HASHES FROM Pipfile.lock!. If you have updated the package versions, please update the hashes. Otherwise, examine the package contents carefully; someone may have tampered with them.
    python-logstash==0.4.6 from https://www.piwheels.hostedpi.com/simple/python-logstash/python_logstash-0.4.6-py3-none-any.whl#sha256=0a184b86c27d17fe3282473473568da545f8b51b1201697d01576ddef0790e97 (from -r /tmp/pipenv-ijo7c_vx-requirement.txt (line 1)):
        Expected sha256 10943e5df83f592b4d61b63ad1afff855ccc8c9467f78718f0a59809ba1fe68c
             Got        0a184b86c27d17fe3282473473568da545f8b51b1201697d01576ddef0790e97


  ‚ò§  ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî
Results seem the same if using pipenv install on a fresh OS, and git checkout, or when using pipenv update otherwise. Doing a pip3 install of the packages succeeds, but sort of removes the utility of pipenv.
Steps to replicate
Fresh install of Raspberrian on a Raspberry Pi 3
Fresh compile of Python 3.6.3 (Tested for functionality, works as expected)
Install pip3
Install pipenv from pip3
Create test directory
Setup work space with pipenv --python 3.6
Run command pipenv install python-logstash smbus2 (This will succeed, and simulates the creation of the git downloaded Pipfile. Note: I am not using git to push the Pipfile.lock at this time.)
Run command pipenv update (This will fail with the following)
pipenv update
Updating all dependencies from Pipfile‚Ä¶
Found 2 installed package(s), purging‚Ä¶
Uninstalling python-logstash-0.4.6:
  Successfully uninstalled python-logstash-0.4.6
Uninstalling smbus2-0.2.0:
  Successfully uninstalled smbus2-0.2.0

Environment now purged and fresh!
Locking [dev-packages] dependencies‚Ä¶
Locking [packages] dependencies‚Ä¶
Updated Pipfile.lock (58d3ae)!
Installing dependencies from Pipfile.lock (58d3ae)‚Ä¶
An error occurred while installing python-logstash==0.4.6! Will try again.
An error occurred while installing smbus2==0.2.0! Will try again.
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 2/2 ‚Äî 00:00:03
Installing initially‚Äìfailed dependencies‚Ä¶
Collecting python-logstash==0.4.6 ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî 00:00:00
  Using cached https://www.piwheels.hostedpi.com/simple/python-logstash/python_logstash-0.4.6-py3-none-any.whl

THESE PACKAGES DO NOT MATCH THE HASHES FROM Pipfile.lock!. If you have updated the package versions, please update the hashes. Otherwise, examine the package contents carefully; someone may have tampered with them.
    python-logstash==0.4.6 from https://www.piwheels.hostedpi.com/simple/python-logstash/python_logstash-0.4.6-py3-none-any.whl#sha256=0a184b86c27d17fe3282473473568da545f8b51b1201697d01576ddef0790e97 (from -r /tmp/pipenv-qs2e80iu-requirement.txt (line 1)):
        Expected sha256 10943e5df83f592b4d61b63ad1afff855ccc8c9467f78718f0a59809ba1fe68c
             Got        0a184b86c27d17fe3282473473568da545f8b51b1201697d01576ddef0790e97


  ‚ò§  ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/2 ‚Äî 