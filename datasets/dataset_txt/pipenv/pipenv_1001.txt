meronym commented on 1 Jun 2018 â€¢
edited
Looks like pipenv has trouble interacting with the terminal (see traceback below).
Expected result
Pipenv should display the help prompt.
Actual result
$ pipenv
Traceback (most recent call last):
  File "/usr/bin/pipenv", line 11, in <module>
    load_entry_point('pipenv==11.10.1', 'console_scripts', 'pipenv')()
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/core.py", line 1043, in invoke
    return Command.invoke(self, ctx)
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/usr/lib/python3/dist-packages/pipenv/cli.py", line 275, in cli
    echo(format_help(ctx.get_help()))
  File "/usr/lib/python3/dist-packages/pipenv/vendor/click/utils.py", line 259, in echo
    file.write(message)
UnicodeEncodeError: 'latin-1' codec can't encode character '\u2013' in position 1740: ordinal not in range(256)
Steps to replicate
I installed pipenv via the official ppa:pypa/ppa in an Ubuntu 17.10 image running on Vagrant ("bento/ubuntu-17.10").
Running $ python -m pipenv.help would say /usr/bin/python: No module named pipenv.
Running pipenv --help would get me the same UnicodeEncodeError.
Additional notes
Expicitly exporting the LC_ALL/LANG variables in .bash_profile or .bashrc fixes the problem when running pipenv manually from the terminal, however the encoding issue still persists when launching pipenv through a provisioning tool (Ansible).