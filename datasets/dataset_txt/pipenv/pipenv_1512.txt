apollo13 commented on 27 Feb 2018
Pipenv fails to work with custom python installation in various ways.
Describe your environment
I have compiled my custom python and set $PATH to ~/bap_libraries/bin which contains python3 etc:
which python3
/home/apollo13/bap_libraries/bin//python3
which pipenv 
/home/apollo13/.local/bin/pipenv 
Ubuntu 16.04
Python version: $ python3 -V -> Python 3.6.2
Pipenv version: $ pipenv --version -> pipenv, version 10.1.0
Expected result
I am trying to run pipenv install and expect the proper creation of a virtual env
Actual result
Creating a virtualenv for this project‚Ä¶
Using /home/apollo13/bap_libraries/bin//python3.6m to create virtualenv‚Ä¶
‚†ãRunning virtualenv with interpreter /home/apollo13/bap_libraries/bin//python3.6m
Using base prefix '/home/apollo13/bap_libraries'
New python executable in /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6m
Also creating executable in /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python
/home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6m: error while loading shared libraries: libpython3.6m.so.1.0: cannot open shared object file: No such file or directory
ERROR: The executable /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6m is not functioning
ERROR: It thinks sys.prefix is '/home/apollo13/bap-services' (should be '/home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr')
ERROR: virtualenv is not compatible with this system or executable

Virtualenv location: 
Warning: Your Pipfile requires python_version 3.6, but you are using None (/bin/python).
  $ pipenv check will surely fail.
Creating a virtualenv for this project‚Ä¶
‚†ôUsing base prefix '/home/apollo13/bap_libraries'
New python executable in /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6
Also creating executable in /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python
/home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6: error while loading shared libraries: libpython3.6m.so.1.0: cannot open shared object file: No such file or directory
ERROR: The executable /home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr/bin/python3.6 is not functioning
ERROR: It thinks sys.prefix is '/home/apollo13/bap-services' (should be '/home/apollo13/.local/share/virtualenvs/bap-services-URy38Dbr')
ERROR: virtualenv is not compatible with this system or executable

Virtualenv location: 
Installing dependencies from Pipfile.lock (45bf35)‚Ä¶
Installing 'django==2.0.2 --hash=sha256:7c8ff92285406fb349e765e9ade685eec7271d6f5c3f918e495a74768b765c99  --hash=sha256:dc3b61d054f1bced64628c62025d480f655303aea9f408e5996c339a543b45f0'
$ "/bin/pip" install   --verbose  --no-deps  -r /tmp/pipenv-plb8tt85-requirement.txt --require-hashes -i https://pypi.python.org/simple --exists-action w
Traceback (most recent call last):
  File "/home/apollo13/.local/bin/pipenv", line 11, in <module>
    load_entry_point('pipenv==10.1.0', 'console_scripts', 'pipenv')()
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/cli.py", line 197, in install
    selective_upgrade=selective_upgrade
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/core.py", line 1795, in do_install
    do_init(dev=dev, allow_global=system, ignore_pipfile=ignore_pipfile, system=system, skip_lock=skip_lock, verbose=verbose, concurrent=concurrent, deploy=deploy, pre=pre)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/core.py", line 1355, in do_init
    skip_lock=skip_lock, verbose=verbose, concurrent=concurrent)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/core.py", line 837, in do_install_dependencies
    index=index
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/core.py", line 1455, in pip_install
    c = delegator.run(pip_command, block=block)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 267, in run
    c.run(block=block, binary=binary)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/delegator.py", line 156, in run
    s = PopenSpawn(self._popen_args, **pexpect_kwargs)
  File "/home/apollo13/.local/lib/python3.6/site-packages/pipenv/vendor/pexpect/popen_spawn.py", line 46, in __init__
    self.proc = subprocess.Popen(cmd, **kwargs)
  File "/home/apollo13/bap_libraries/lib/python3.6/subprocess.py", line 707, in __init__
    restore_signals, start_new_session)
  File "/home/apollo13/bap_libraries/lib/python3.6/subprocess.py", line 1333, in _execute_child
    raise child_exception_type(errno_num, err_msg)
FileNotFoundError: [Errno 2] No such file or directory: '/bin/pip'
  üêç   ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ‚ñâ 0/5 ‚Äî 00:00:00
As you can see pipenv has issues loading a shared library, but python3.6m has runpath set properly ($ORIGIN/../lib) and it also tries to run pip (which indeed does not exist, but `python3 -mpip works and should probably be a good replacement?)
Steps to replicate
Compile & install python, set the path to it
Run python3 -m pip install --user pipenv
Run pipenv install in a projecz