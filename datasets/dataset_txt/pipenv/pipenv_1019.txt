dmfigol commented on 25 May 2018 •
edited
pipenv run throws
Warning: There was an unexpected error while activating your virtualenv. Continuing anyway… and uses system Python binary when python3 -m venv .venv is used to create virtual environment.
pipenv shell runs as expected.
$ python -m pipenv.help output
Expected result
pipenv run should not throw an error and use correct python binary
Actual result
dmfigol@mbp [22:50:59] [~/projects/my]
-> % mkdir test
dmfigol@mbp [22:51:03] [~/projects/my]
-> % cd test
dmfigol@mbp [22:51:07] [~/projects/my/test]
-> % python3 -m venv .venv
dmfigol@mbp [22:51:33] [~/projects/my/test]
-> % pipenv install requests
Creating a Pipfile for this project…
Installing requests…
Collecting requests
  Using cached https://files.pythonhosted.org/packages/49/df/50aa1999ab9bde74656c2919d9c0c085fd2b3775fd3eca826012bef76d8c/requests-2.18.4-py2.py3-none-any.whl
Collecting idna<2.7,>=2.5 (from requests)
  Using cached https://files.pythonhosted.org/packages/27/cc/6dd9a3869f15c2edfab863b992838277279ce92663d334df9ecf5106f5c6/idna-2.6-py2.py3-none-any.whl
Collecting urllib3<1.23,>=1.21.1 (from requests)
  Using cached https://files.pythonhosted.org/packages/63/cb/6965947c13a94236f6d4b8223e21beb4d576dc72e8130bd7880f600839b8/urllib3-1.22-py2.py3-none-any.whl
Collecting certifi>=2017.4.17 (from requests)
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/usr/local/sbin:/opt/local/bin"
  Using cached https://files.pythonhosted.org/packages/7c/e6/92ad559b7192d846975fc916b65f667c7b8c3a32bea7372340bfe9a15fa5/certifi-2018.4.16-py2.py3-none-any.whl
Collecting chardet<3.1.0,>=3.0.2 (from requests)
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Installing collected packages: idna, urllib3, certifi, chardet, requests
Successfully installed certifi-2018.4.16 chardet-3.0.4 idna-2.6 requests-2.18.4 urllib3-1.22

Adding requests to Pipfile's [packages]…
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
Updated Pipfile.lock (b14837)!
Installing dependencies from Pipfile.lock (b14837)…
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ 5/5 — 00:00:00
To activate this project's virtualenv, run the following:
 $ pipenv shell
dmfigol@mbp [22:52:00] [~/projects/my/test]
-> % pipenv run python3
Warning: There was an unexpected error while activating your virtualenv. Continuing anyway…
Python 3.6.5 (default, Apr 25 2018, 14:23:58)
[GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.1)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import requests
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ModuleNotFoundError: No module named 'requests'
>>> quit()
dmfigol@mbp [22:53:09] [~/projects/my/test]
-> % pipenv shell
Spawning environment shell (/bin/zsh). Use 'exit' to leave.
. /Users/dmfigol/projects/my/test/.venv/bin/activate
dmfigol@mbp [22:57:30] [~/projects/my/test]
-> % . /Users/dmfigol/projects/my/test/.venv/bin/activate
(.venv) dmfigol@mbp [22:57:30] [~/projects/my/test]
-> % python
Python 3.6.5 (default, Apr 25 2018, 14:23:58)
[GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.1)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import requests
>>> quit()
Steps to replicate
python3 -m venv .venv
pipenv install requests
pipenv run python3
>>> import requests