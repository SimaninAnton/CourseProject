anlutro commented on 7 Mar 2018
I've got a project where I depend on the behave package. For some reason, this fails with Python 3.6 whereas it works fine in Python 3.5. I can pip install behave just fine if I create a virtualenv manually.
Describe your environment
Linux and MacOS (tested on both)
Python 3.6.4 and Python 3.6.2 (tested on both)
pipenv, version 11.0.2
Steps to replicate
$ cat Pipfile
[dev-packages]
behave = "*"
Output on Linux - I notice that some paths are using python2.7:
$ pipenv --python python3.6 install --dev
Creating a virtualenv for this project…
Using /usr/local/bin/python3.6 to create virtualenv…
⠋Running virtualenv with interpreter /usr/local/bin/python3.6
Using base prefix '/opt/python-3.6.2'
New python executable in /home/andreas/.local/share/virtualenvs/pipenv-bug-YcRV7ASz/bin/python3.6
Also creating executable in /home/andreas/.local/share/virtualenvs/pipenv-bug-YcRV7ASz/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /home/andreas/.local/share/virtualenvs/pipenv-bug-YcRV7ASz
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
python2.7/site-packages/pipenv/patched/piptools/resolver.py", line 279, in _iter_dependencies
    for dependency in self.repository.get_dependencies(ireq):
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 162, in get_dependencies
    legacy_results = self.get_legacy_dependencies(ireq)
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 199, in get_legacy_dependencies
    result = reqset._prepare_file(self.finder, ireq)
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/pip/req/req_set.py", line 639, in _prepare_file
    abstract_dist.prep_for_dist()
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/pip/req/req_set.py", line 134, in prep_for_dist
    self.req_to_install.run_egg_info()
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/pip/req/req_install.py", line 438, in run_egg_info
    command_desc='python setup.py egg_info')
  File "/home/andreas/.local/venvs/pipenv/lib/python2.7/site-packages/pipenv/patched/pip/utils/__init__.py", line 707, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pip.exceptions.InstallationError: Command "python setup.py egg_info" failed with error code 1 in /tmp/tmpmo0zcw2_build/importlib/
Output on MacOS - I don't see any references to python 2.7 here:
$ pipenv --python python3.6 install --dev
Creating a virtualenv for this project…
Using /usr/local/bin/python3.6 to create virtualenv…
⠋Running virtualenv with interpreter /usr/local/bin/python3.6
Using base prefix '/usr/local/Cellar/python/3.6.4_3/Frameworks/Python.framework/Versions/3.6'
New python executable in /Users/andreas/.local/share/virtualenvs/pipenv-test-OWzYFdID/bin/python3.6
Also creating executable in /Users/andreas/.local/share/virtualenvs/pipenv-test-OWzYFdID/bin/python
Installing setuptools, pip, wheel...done.

Virtualenv location: /Users/andreas/.local/share/virtualenvs/pipenv-test-OWzYFdID
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
hed/piptools/resolver.py", line 279, in _iter_dependencies
    for dependency in self.repository.get_dependencies(ireq):
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 162, in get_dependencies
    legacy_results = self.get_legacy_dependencies(ireq)
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/piptools/repositories/pypi.py", line 199, in get_legacy_dependencies
    result = reqset._prepare_file(self.finder, ireq)
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/pip/req/req_set.py", line 639, in _prepare_file
    abstract_dist.prep_for_dist()
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/pip/req/req_set.py", line 134, in prep_for_dist
    self.req_to_install.run_egg_info()
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/pip/req/req_install.py", line 438, in run_egg_info
    command_desc='python setup.py egg_info')
  File "/Users/andreas/Library/Python/3.6/lib/python/site-packages/pipenv/patched/pip/utils/__init__.py", line 707, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pip.exceptions.InstallationError: Command "python setup.py egg_info" failed with error code 1 in /var/folders/2z/hjz3scbd5wjbr4pl93f92ypm0000gn/T/tmpyu0ig0wzbuild/importlib/