theodox commented on 9 Jan 2019 •
edited
Issue description
Attempting to install a vcs dependencies fails with .fatal: Could not get current working directory: No such file or directory . In order to get a clean repro case I simply made a new directory, cd'd into it, and used the vcs example from the docs,
 pipenv install -e git+https://github.com/requests/requests.git@v2.19#egg=requests
Expected result
I expected the installation to succeed
Actual result
Here's the traceback.
In previous trial runs I believe I observed an off-by-one problem in the tracebacks: the run prior to this referred to a different repo -- not requests -- that I had tried to install earlier and which had failed the same way. This traceback is the second attempt to use the requests example in a row so if the same incorrect traceback was generated it's not obvious because I used the same URL twice in a row.
steve@DRIFT MINGW64 ~/prj
$ mkdir dev2

steve@DRIFT MINGW64 ~/prj
$ cd dev2

steve@DRIFT MINGW64 ~/prj/dev2
$ pipenv install -e git+https://github.com/requests/requests.git@v2.19#egg=requests
Creating a virtualenv for this project…
Pipfile: C:\Users\steve\prj\dev2\Pipfile
Using d:\pythons\371\python.exe (3.7.1) to create virtualenv…
[=   ] Creating virtual environment...Already using interpreter d:\pythons\371\python.exe
Using base prefix 'd:\\pythons\\371'
New python executable in C:\Users\steve\.virtualenvs\dev2-MdgJu4jJ\Scripts\python.exe
Installing setuptools, pip, wheel...
done.

Successfully created virtual environment!
Virtualenv location: C:\Users\steve\.virtualenvs\dev2-MdgJu4jJ
Creating a Pipfile for this project…
Installing -e git+https://github.com/requests/requests.git@v2.19#egg=requests…
Adding requests to Pipfile's [packages]…
Installation Succeeded
Pipfile.lock not found, creating…
Locking [dev-packages] dependencies…
Locking [packages] dependencies…
[    ] Pinning VCS Packages...fatal: Could not get current working directory: No such file or directory
Traceback (most recent call last):
  File "d:\pythons\371\lib\runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "d:\pythons\371\lib\runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "D:\pythons\371\Scripts\pipenv.exe\__main__.py", line 9, in <module>
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 717, in main
    rv = self.invoke(ctx)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 1137, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\click\decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "d:\pythons\371\lib\site-packages\pipenv\cli\command.py", line 254, in install
    editable_packages=state.installstate.editables,
  File "d:\pythons\371\lib\site-packages\pipenv\core.py", line 1992, in do_install
    skip_lock=skip_lock,
  File "d:\pythons\371\lib\site-packages\pipenv\core.py", line 1244, in do_init
    pypi_mirror=pypi_mirror,
  File "d:\pythons\371\lib\site-packages\pipenv\core.py", line 1068, in do_lock
    lockfile=lockfile
  File "d:\pythons\371\lib\site-packages\pipenv\utils.py", line 626, in venv_resolve_deps
    dev=dev,
  File "d:\pythons\371\lib\site-packages\pipenv\utils.py", line 1311, in get_vcs_deps
    with locked_repository(requirement) as repo:
  File "d:\pythons\371\lib\contextlib.py", line 112, in __enter__
    return next(self.gen)
  File "d:\pythons\371\lib\site-packages\pipenv\utils.py", line 1447, in locked_repository
    with requirement.req.locked_vcs_repo(src_dir=src_dir) as repo:
  File "d:\pythons\371\lib\contextlib.py", line 112, in __enter__
    return next(self.gen)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\requirementslib\models\requirements.py", line 840, in locked_vcs_repo
    vcsrepo = self.get_vcs_repo(src_dir=src_dir)
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\requirementslib\models\requirements.py", line 802, in get_vcs_repo
    vcsrepo.obtain()
  File "d:\pythons\371\lib\site-packages\pipenv\vendor\requirementslib\models\vcs.py", line 37, in obtain
    self.repo_instance.obtain(self.checkout_directory)
  File "d:\pythons\371\lib\site-packages\pipenv\patched\notpip\_internal\vcs\__init__.py", line 332, in obtain
    self.fetch_new(dest, url, rev_options)
  File "d:\pythons\371\lib\site-packages\pipenv\patched\notpip\_internal\vcs\git.py", line 198, in fetch_new
    self.run_command(['clone', '-q', url, dest])
  File "d:\pythons\371\lib\site-packages\pipenv\patched\notpip\_internal\vcs\__init__.py", line 456, in run_command
    spinner=spinner)
  File "d:\pythons\371\lib\site-packages\pipenv\patched\notpip\_internal\utils\misc.py", line 705, in call_subprocess
    % (command_desc, proc.returncode, cwd))
pipenv.patched.notpip._internal.exceptions.InstallationError: Command "git clone -q https://github.com/requests/requests.git C:\Users\steve\AppData\Local\Temp\requirementslib3op9tjg6\requests" failed with error code 128 in None       
Steps to replicate
Provide the steps to replicate (which usually at least includes the commands and the Pipfile).
make a new directory
cd into the new directory
pipenv install -e git+https://github.com/requests/requests.git@v2.19#egg=requests
$ pipenv --support