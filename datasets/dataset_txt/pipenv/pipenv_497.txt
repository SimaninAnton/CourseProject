Zelgius commented on 30 Oct 2018
Issue description
Using pyenv 1.2.7 and pipenv 2018.10.13 I cannot install any variant of Python 3.4 without a stack trace. I have tested it with Python 3.5., 3.6., and 3.7.* and all of those versions work just fine.
Expected result
pipenv --python 3.4.9 correctly installs Python 3.4 with pyenv and the environment functions as expected.
Actual result
A stack trace is thrown from the pipenv code
Steps to replicate
Operating System: Fedora 27 on a desktop
Install pyenv and pipenv as usual, setting up all necessary env variables. (I know these work since pipenv handles all other supported versions of Python 3 just fine
run the command pipenv --install python 3.4
Will be prompted to have pyenv install Python 3.4.9. Accept.
Stack trace
[18:09:41] megger:~ $ pipenv --python 3.4
Warning: Python 3.4 was not found on your system…
Would you like us to install CPython 3.4.9 with pyenv? [Y/n]: y
Installing CPython 3.4.9 with pyenv (this may take a few minutes)…
Traceback (most recent call last):
  File "/home/megger/.local/bin/pipenv", line 11, in <module>
    sys.exit(cli())
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 764, in __call__
    return self.main(*args, **kwargs)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 717, in main
    rv = self.invoke(ctx)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 1114, in invoke
    return Command.invoke(self, ctx)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 956, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 64, in new_func
    return ctx.invoke(f, obj, *args, **kwargs)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/core.py", line 555, in invoke
    return callback(*args, **kwargs)
  File "/home/megger/.local/pipx/venvs/pipenv/lib/python3.6/site-packages/pipenv/vendor/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/cli/command.py", line 203, in cli
    clear=state.clear,
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/core.py", line 565, in ensure_project
    pypi_mirror=pypi_mirror,
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/core.py", line 488, in ensure_virtualenv
    python = ensure_python(three=three, python=python)
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/core.py", line 451, in ensure_python
    c = pyenv.install(version)
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/pyenv.py", line 117, in install
    timeout=PIPENV_INSTALL_TIMEOUT,
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/pyenv.py", line 73, in _pyenv
    raise PyenvError('faild to run {0}'.format(args), c)
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/pyenv.py", line 56, in __init__
    self.err = c.err
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/vendor/delegator.py", line 146, in err
    return self._pexpect_out
  File "/home/megger/.local/pipx/venvs/pipenv/lib64/python3.6/site-packages/pipenv/vendor/delegator.py", line 114, in _pexpect_out
    result += self.subprocess.after
TypeError: must be str, not type
$ pipenv --support
2