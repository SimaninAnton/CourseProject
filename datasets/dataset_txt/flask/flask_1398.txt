Contributor
maxcountryman commented on 17 Jun 2013
This appears to be an issue with how Werkzeug is encoding headers, new to the version series 0.9.x:
>>> from flask import Flask
>>> app = Flask(__name__)
>>> app.test_client().get('/', headers=[('User-Agent', u'中文')])
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 760, in get
    return self.open(*args, **kw)
  File "/Library/Python/2.7/site-packages/flask/testing.py", line 108, in open
    follow_redirects=follow_redirects)
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 724, in open
    environ = args[0].get_environ()
  File "/Library/Python/2.7/site-packages/werkzeug/test.py", line 573, in get_environ
    for key, value in self.headers.to_wsgi_list():
  File "/Library/Python/2.7/site-packages/werkzeug/datastructures.py", line 1185, in to_wsgi_list
    return [(k, v.encode('latin1')) for k, v in self]
UnicodeEncodeError: 'latin-1' codec can't encode characters in position 0-1: ordinal not in range(256)
This affects maxcountryman/flask-login#78.