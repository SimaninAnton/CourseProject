italojs commented on 18 Dec 2018
My Problem
I'm getting 404 for all routes, my flask api is running, and when i run it, the api receive the request and log it, but, it give 404 http status for every request;
127.0.0.1 - - [17/Dec/2018 16:49:12] "GET /api/ping/ HTTP/1.1" 404 -
127.0.0.1 - - [17/Dec/2018 16:50:10] "POST /api/blur/ HTTP/1.1" 404 -
My code
I' have a class Server, this Server class receive a Flask app and run it:
from jsonmerge import merge

class Server():
    def __init__(self, app):
        self.__app = app
        self.__config = #snip
        #snip

    def start(self, options=None):
        #snip
        
        self.__app.run(debug=self.__config["debug"], port=self.__config["server"]["port"], host=self.__config["server"]["ip"])
and i have my run.py that run my aplication:
if __name__ == '__main__':
    srv = Server(app)
    srv.start(config)
when I print my self.__app infromations, i get:
<Flask 'appfly.app'>

<Config {'ENV': 'production', 'DEBUG': False, 'TESTING': False, 'PROPAGATE_EXCEPTIONS': None, 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'SECRET_KEY': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'USE_X_SENDFILE': False, 'SERVER_NAME': None, 'APPLICATION_ROOT': '/', 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_SECURE': False, 'SESSION_COOKIE_SAMESITE': None, 'SESSION_REFRESH_EACH_REQUEST': True, 'MAX_CONTENT_LENGTH': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'TRAP_BAD_REQUEST_ERRORS': None, 'TRAP_HTTP_EXCEPTIONS': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'PREFERRED_URL_SCHEME': 'http', 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS':True, 'JSONIFY_PRETTYPRINT_REGULAR': False, 'JSONIFY_MIMETYPE': 'application/json', 'TEMPLATES_AUTO_RELOAD': None, 'MAX_COOKIE_SIZE': 4093}>

Map([<Rule '/api/ping' (GET, HEAD, OPTIONS) -> ping>,
 <Rule '/api/blur' (POST, OPTIONS) -> blur>,
 <Rule '/static/<filename>' (GET, HEAD, OPTIONS) -> static>])
look, my url_map list all my routes, the api/ping route and api/blur route is there.
My faill solutions
many stackover flow responses say to change the config["server_name"] but it doesnt works
I already tried set SERVER_NAME to 0.0.0.0:9000,localhost:9000, 127.0.0.1:9000
I make an flask tutorial to verify the SERVER_NAME and it is None
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == '__main__':
print(app.config["SERVER_NAME"])
#app.run(...)
> None
I tried set the to Flask ENV to development but it doest works to:
self.__app.config["ENV"]='development'
how it works before
I aways used Flask in this way and aways worked fine:
---> app.py
from flask import Flask

app = Flask(__name__)

# Routes files
from app.presentation.routes import ping
from app.presentation.routes import rg as rg_scan

# Routes rules
app.add_url_rule('/api/ping', 'Ping', ping.route, methods=['GET'])
app.add_url_rule('/api/rg', 'RG', rg_scan.route, methods=['POST'])
print('API is running...')
---> run.py
from app import app

if __name__ == '__main__':
    app.run(debug=True, port=9000, host='0.0.0.0')
but now i wanna do it in a diferent way, i wanna use my Server Class to start my flask api.
Environment
Python version: 3.7.0
Flask version: 1.0.2
OS Version: Manjaro Linux 18.0.0-rc