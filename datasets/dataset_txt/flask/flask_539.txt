xliiv commented on 8 Sep 2017 â€¢
edited
Expected Behavior
send_file closes the file which it opens
https://github.com/pallets/flask/blob/0.12.2/flask/helpers.py#L549
Actual Behavior
File is not closed.
Tests are yelling:
tests2.py:14: ResourceWarning: unclosed file <_io.BufferedReader name='path/tests2.py'>
> python3 tests2.py 
tests2.py:14: ResourceWarning: unclosed file <_io.BufferedReader name='path/tests2.py'>
  self.client.get('/')
.
----------------------------------------------------------------------
Ran 1 test in 0.012s

OK

> cat tests2.py 
import unittest
from flask import Flask
from flask import current_app, send_from_directory
app = Flask(__name__)

@app.route("/")
def hello():
    return send_from_directory('.', __file__)

class TestCase(unittest.TestCase):
    def test_x(self):
        self.client = app.test_client()

        self.client.get('/')


if __name__ == '__main__':
    unittest.main()
Environment
Python version: Python 3.5.3
Flask version: Flask==0.12.2
Werkzeug version: Werkzeug==0.12.2