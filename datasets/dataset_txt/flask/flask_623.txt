amiden commented on 9 May 2017 â€¢
edited
import re

import json
import time
import mapi
import sys
from flask import Flask, request, abort, render_template

app = Flask(__name__)

@app.route('/cityinfo', methods=['GET'])
def cityinfo():
    if request.method == 'GET':
        echo_str = request.args.get('echostr', '')
        try:
            key = request.headers.get('location')
        except:
            return ''
        return mapi.getcity(key) #about use 10~59ms


@app.route('/alive', methods=['GET'])
def alive():
    return 'ok'
if __name__ == '__main__':
    crt = 'key/Nginx/1_bg.xxxx.club_bundle.crt'
    key = 'key/Nginx/2_bg.xxxx.club.key'
    try:
        app.run('0.0.0.0',port=443,threaded=True,ssl_context=(crt,key))
    except:
        print 'error'`
nohup sudo python as.py >1.log 2>&1 &
about run in 1000+/day for wechatapp ,then it down by CLOSE_WAIT