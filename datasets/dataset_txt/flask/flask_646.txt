koddr commented on 11 Apr 2017 •
edited
Note: I don't observe this bug if I run application on a dedicated server (VDS) with Nginx and uWSGI or Gunicorn, only on an shared hosting (Apache2).
My application structure:
└─ site.com
     └── public_html
             ├─ venv             <-- virtualenv dir with Python 3.4.3
             ├─ templates        <-- templates dir with `page.html`
             ├─ .htaccess        <-- HTACCESS file
             ├─ app.cgi          <-- CGI script
             └─ app.py           <-- Very basic Flask application
Files .htaccess and app.cgi I take from official docs, but duplicate for comfort.
And this is .htaccess file:
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /home/XXXX/site.com/public_html/app.cgi/$1 [L]
Yep, it's app.cgi:
#!/home/XXXX/site.com/public_html/venv/bin/python3.4
# -*- coding: utf-8 -*-

from wsgiref.handlers import CGIHandler
from app import app

CGIHandler().run(app)
This is my app.py file:
# -*- coding: utf-8 -*-

from flask import Flask, render_template, url_for

app = Flask(__name__)

@app.route('/<slug>')
def page(slug):
    return render_template('page.html', slug=slug)

if __name__ == '__main__':
    app.run(host='0.0.0.0')
Template is:
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>{{ slug }}</title>
</head>
<body>
    <a href="{{ url_for('page', slug='about') }}">About page</a>
    <a href="{{ url_for('page', slug='contacts') }}">Contacts page</a>
</body>
</html>
All working fine, but if I go to http://site.com/about and click to Contacts page link — URL on browser adress is http://site.com/app.cgi/contacts instead http://site.com/contacts O_o I delete /app.cgi/ from adress stroke and get the same page!
What is this? Bug in url_for() functon? Fix it please.