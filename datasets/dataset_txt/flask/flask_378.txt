galuszkak commented on 6 May 2018
Expected Behavior
Flask should work on subpath with proper url generation by url_for.
So url in example below should be: /myapp/static/css/bootstrap.min.css
from flask import Flask
from flask.views import MethodView

class ListConsumer(MethodView):
    def get(self):
        return render_template('list.html')

app = Flask(name)
app.config['APPLICATION_ROOT'] = '/myapp'
app.add_url_rule('/', view_func=ListView.as_view('list_view'))

# list.html
# <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
Actual Behavior
Actual generated URL is /static/css/bootstrap.min.css and this should be /myapp/static/css/bootstrap.min.css. Although this is when application just work.
If I add env SCRIPT_NAME=/myapp I get error:
  File "/usr/local/lib/python3.6/site-packages/gunicorn/workers/sync.py", line 135, in handle
    self.handle_request(listener, req, client, addr)
  File "/usr/local/lib/python3.6/site-packages/gunicorn/workers/sync.py", line 167, in handle_request
    listener.getsockname(), self.cfg)
  File "/usr/local/lib/python3.6/site-packages/gunicorn/http/wsgi.py", line 193, in create
    path_info = path_info.split(script_name, 1)[1]
IndexError: list index out of range
Environment
Python version: 3.6.4
Flask version: 1.0.2
Werkzeug version: 0.14.1