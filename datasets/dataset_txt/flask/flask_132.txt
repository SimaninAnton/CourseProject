kanglue commented on 28 May 2019
This issue tracker is a tool to address bugs in Flask itself.
Please use the #pocoo IRC channel on freenode or Stack Overflow for general
questions about using Flask or issues not related to Flask.
If you'd like to report a bug in Flask, fill out the template below. Provide
any extra information that may be useful / related to your problem.
Ideally, create an MCVE, which helps us
understand the problem and helps check that it is not caused by something in
your code.
Expected Behavior
Start a Flask server, and received a http post msg, and handle well.
threading.Thread(target=MpPool._handle_results, args=(self,))

def _handle_results(self):
     self._passback.handle(tid, result, ex)

here self._passback is start_serving function, and exception where it is.
Actual Behavior
Start a Flask server, and received a http post msg, and encounter exception.
Traceback (most recent call last):
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\app.py", line 1813, in full_dispatch_request
    rv = self.dispatch_request()
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\app.py", line 1799, in dispatch_request
    return self.view_functions[rule.endpoint](**req.view_args)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask_restful\__init__.py", line 458, in wrapper
    resp = resource(*args, **kwargs)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask\views.py", line 88, in view
    return self.dispatch_request(*args, **kwargs)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\site-packages\flask_restful\__init__.py", line 573, in dispatch_request
    resp = meth(*args, **kwargs)
  File "D:\Dev\source\Python\Base\src\main\inference\Server.py", line 75, in post
    return server.submit(tid)
  File "D:\Dev\source\Python\Base\src\main\inference\Server.py", line 35, in submit
    if self._inference.submit(tid, _task_json):
  File "D:\Dev\source\Python\Base\src\main\inference\Inference.py", line 34, in submit
    self._executor_pool.submit(tid, task)
  File "D:\Dev\source\Python\Base\src\main\hwv_concurrent\process.py", line 194, in submit
    worker.start()
  File "D:\Dev\source\Python\Base\src\main\hwv_concurrent\process.py", line 40, in start
    self._process.start()
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\process.py", line 105, in start
    self._popen = self._Popen(self)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\context.py", line 223, in _Popen
    return _default_context.get_context().Process._Popen(process_obj)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\context.py", line 322, in _Popen
    return Popen(process_obj)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\popen_spawn_win32.py", line 65, in __init__
    reduction.dump(process_obj, to_child)
  File "D:\Dev\Anaconda3\envs\jlpy\lib\multiprocessing\reduction.py", line 60, in dump
    ForkingPickler(file, protocol).dump(obj)
AttributeError: Can't pickle local object 'start_serving.<locals>.AIServer'
Environment
Windows10
Python version:3.6
Flask version:1.0.2
Werkzeug version:0.15.4