ym13349140 commented on 19 Oct 2017
hi,I used Flask to upload files to the server,.while I was uploading,nothing went wrong and there were not any bugs either, after the file was uploaded,the database was also modified, but when uploading finished, I clicked on the file link to find that no corresponding file on the server so the downloading process failed.Actually,there was a judgment after uploading,only when the file saved successfully success that it would write the database, but now the result turned out to be opposite,so I don't know where went wrong.Can somebody have a look?
my upload file function
def upload_file(file_src, des_path, allowed_type=None):
    if file_src.filename == '':
        message = gettext('No selected file')
        return False, message

    extension = file_src.filename[file_src.filename.rfind('.')+1:]
    file_type = extension_to_file_type(extension)
    folder = des_path[:des_path.rfind('/')]

    if not allowed_type:
        allowed_type = current_app.config['ALLOWED_RESOURCE_TYPE']

    if file_src and '.' in file_src.filename and file_type in allowed_type:
        if not os.path.exists(folder):
            os.makedirs(folder)
        file_src.save(des_path)
        unique_uri = os.stat(des_path).st_mtime
        if os.path.exists(des_path):
            return True, unique_uri
        else:
            message = gettext("Save File Failed!")
            return False, message
    else:
        message = gettext("Invalid file")
        return False, message
Paste a minimal example that causes the problem.
Environment
Python version: 2.7.14
Flask version: 0.11.1
Werkzeug version: