tedostrem commented on 30 Oct 2013
Today in our system, one user managed to update the profile of another user.(
The only explanation I can come up with to this is that the Flask g context contained
the user_id of user_a when user_b updated his profile.
Am I using g incorrectly or is this maybe a bug?
We have about 15k users and this is the first time I saw this happen.
Flask==0.10.1
@app.before_request
def before_request():
    g.user_token = UserToken.from_request_token(
        request.headers.get('Authorization')
        .replace('Token token="', '').replace('"', ''))

@app.route('/api/profile',  methods=['GET', 'PUT'])
def profile():
    if request.method == 'PUT':
        try:
            user_service.update_userprofile(
                UserProfile(
                    g.user_token.user_id,
                    request.json.get('name'),
                    request.json.get('gender'),
                    request.json.get('location')
                    None))
            return PostResultModel(PostResult.Success,
                                   'Userprofile updated',
                                   PostResultErrorCode.NoError).json()
        except:
            return PostResultModel(PostResult.Error,
                                   'Could not update profile',
                                   PostResultErrorCode.ServerError).json()