imqi0qi commented on 28 Nov 2018
Expected Behavior
i hope people visit index, the flask application can create a schedule task and we can see the terminate print "hello,world" immediately.
#--coding:utf-8 --*--
import sys
import os 
reload(sys)  
sys.setdefaultencoding('utf-8')
 
from flask import Flask
from flask_apscheduler import APScheduler
 
from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore
 
class Config():
    SCHEDULER_JOBSTORES = {
            'default': SQLAlchemyJobStore(url='sqlite:///flask_aps_test.db')
        }
 
    SCHEDULER_API_ENABLED = True
 
    JSON_AS_ASCII = False
 
    ENSURE_ASCII = False
 
    ENCODING = 'utf8'
 
    DEBUG = True
 
    THREADED = True
 
    JSON_AS_ASCII = False
 
app = Flask(__name__)
 
app.config.from_object(Config())
 
scheduler = APScheduler()
 
scheduler.init_app(app)
 
scheduler.start()
 
 
def hello():
 
    print "hello, world."
 
@app.route('/index')
def test_aps():
    print "before,",scheduler.get_jobs()
 
    if scheduler.get_job(id='1001'):
 
        scheduler.remove_job(id = '1001')
 
    else:
        scheduler.add_job( id = '1001',
                        func = hello,
                        trigger = 'interval',
                        seconds = 5,
                        replace_existing = True)
 
    print "after,",scheduler.get_jobs()
 
    return "ok."
 
 
if __name__ == '__main__':
 
    app.run(processes = 2)
Actual Behavior
we can't see anything, no error and warning. if i reload the code or set processes = 1 then it work immediately.
Environment
Python version:2.7.14
Flask version:0.12.2