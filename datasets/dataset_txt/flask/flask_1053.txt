b4stien commented on 10 Apr 2015
Hey there,
I don't know if anyone ran into this problem before because it works "by chance" in py2, but in py3 you can't send temporary file with send_file by passing a fp.
The main problems are here https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L477 and there https://github.com/mitsuhiko/flask/blob/master/flask/helpers.py#L496.
Under py2 a tempfile.TemporaryFile is given the name '<fdopen>' whereas under py3 it's an integer.
Python 2.7.9 (default, Dec 15 2014, 10:01:34)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from tempfile import TemporaryFile
>>> fp = TemporaryFile()
>>> fp.name
'<fdopen>'
Python 3.4.3 (default, Mar 23 2015, 04:19:36)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.57)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from tempfile import TemporaryFile
>>> fp = TemporaryFile()
>>> fp.name
4
Then when Flask tries to build filename it crashes (trying to concatenate a string and an integer in os.path.join(current_app.root_path, filename)).
Would you consider merging a workaround for this problem? (like setting filename to None if we don't have a string_types for instance)