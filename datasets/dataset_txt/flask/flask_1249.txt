pypingou commented on 20 May 2014
I have a flask application deployed behind a reversed proxy.
The proxy is configured to use https, the application server running the flask application is using http.
When setting PREFERRED_URL_SCHEME='https' in the configuration I expected flask to return a location in the headers using https. Using curl we could check the location returned and they are using http.
I added debugging statement to the application just before the return flask.redirect(flask.url_for()) is called.
print APP.config['PREFERRED_URL_SCHEME'] returns 'https'
print flask.current_app.config['PREFERRED_URL_SCHEME'] returns 'https'
print flask.redirect(url) returns <BaseResponse 249 bytes [302 FOUND]>
Using the logic presented at http://flask.pocoo.org/snippets/35/ we could make the location returned use https however it was my understanding that setting correctly PREFERRED_URL_SCHEME would spare us from having to add more code in our application to support https.
Could you please let me know whether this is indeed the expected behavior or our original expectations were the correct one?
Full disclaimer: the application is still running flask 0.9