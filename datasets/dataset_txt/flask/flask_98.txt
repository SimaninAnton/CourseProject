jkozlowicz commented on 14 Jul 2019
Expected Behavior
After installing flask and implementing tests using pytest I noticed some DepracatedWarnings coming from the default Jinja2 installation that comes with flask (pip install flask), see traceback below for details.
It shouldn't be the case, because it has been fixed already and merged:
pallets/jinja@31bf9b7#diff-be2eb7812ee39a4147506e10763f89c6L13
Yet I can see in site-packages/jinja2/tests.py line:13 "from collections import Mapping" (also in other files under site-packages/jinja2).
Uninstalling jinja2 and reinstalling it via "pip install https://github.com/pallets/jinja/zipball/master" makes those warnings disappear.
Minimal project setup:
(test-collections-warning) ➜  TestCollectionsWarning tree .
.
├── app.py
├── requirements.txt
└── tests
    ├── __init__.py
    └── test_app.py

#app.py
from flask import Flask

flask_app = Flask(__name__)

@flask_app.route('/')
def root():
    return 'Hello world'


#tests/test_app.py
import app

def test_hello_world():
    assert 1 == 1

#requirements.txt
flask
pytest
Steps to reproduce:
mkvirtualenv --python=`which python3` test-collections-warning
pip --no-cache-dir install -r requirements.txt
...
(Collecting Jinja2>=2.10.1 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/1d/e7/fd8b501e7a6dfe492a433deb7b9d833d39ca74916fa8bc63dd1a4947a671/Jinja2-2.10.1-py2.py3-none-any.whl)
...
pytest
Actual Behavior
DeprecationWarnings are shown.
(test-collections-warning) ➜  TestCollectionsWarning pytest
================================================= test session starts =================================================
platform darwin -- Python 3.7.3, pytest-5.0.1, py-1.8.0, pluggy-0.12.0
rootdir: /Users/jkozlowicz/PycharmProjects/TestCollectionsWarning
collected 1 item

tests/test_app.py .                                                                                             [100%]

================================================== warnings summary ===================================================
/Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/utils.py:485
  /Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/utils.py:485: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import MutableMapping

/Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/runtime.py:318
  /Users/jkozlowicz/.virtualenvs/test-collections-warning/lib/python3.7/site-packages/jinja2/runtime.py:318: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working
    from collections import Mapping

-- Docs: https://docs.pytest.org/en/latest/warnings.html
Environment
Python version: 3.7.3
Flask version: 1.1.1
Werkzeug version: 0.15.4
OS: macOS Mojave 10.14.5
pip: 19.1.1