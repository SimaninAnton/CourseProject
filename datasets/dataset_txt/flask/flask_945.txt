erxnmedia commented on 20 Nov 2015
Hi,
Iâ€™ve noticed that Flask takes 10 or 20 seconds to display a page based on a view query but will display the page in less than a second for a non-view version of the same query. For example here is a query on view CurveVersionReport:
select CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints
FROM CurveVersionReport
where market = 'Commodity' and submarket = 'Agriculture' and activeversion='Yes' and curvename='CO_PRICE_VAR_USD_OTC_BO'
order by curvename, curveeditid
and the corresponding non-view version:
select a.[CurveEditID],[AsOfDate],TaskDefinition
,[CurveVersion] as VersionName
, tree + '.' + attribute as acattribute
,count(*) AS DataPoints
FROM [CurveEdits] a, curvedefinition b, submarket c, TaskDefinition d, curveversion e, curvepoints f, acattribute g
where a.curveid = b.curveid
and b.marketid = c.marketid
and a.TaskDefinitionID=d.TaskDefinitionID
and a.[CurveVersionID]=e.[CurveVersionID]
and f.curveeditid = a.curveeditid
and f.acattributeid = g.acattributeid
and market = 'Commodity' and submarket = 'Agriculture' and activeversion=1 and curvename='CO_PRICE_VAR_USD_OTC_BO'
group by market, submarket, curvename, a.[CurveEditID],[AsOfDate],TaskDefinition,[CurveVersion],[ActiveVersion], tree, attribute
order by acattribute
This is the Flask method that processes the query:
@app.route('/curve///')
def Curve(market, submarket, curve):
global cur
query = ...one of the above
cur.execute(query, (market, submarket, curve))
edits=[x for x in cur.fetchall()]
return render_template('curve.html', market=market, submarket=submarket, curve=curve, edits=edits)
Here is the template file:
PFE Analytics: Market: Submarket: Curve: {{market}} {{submarket}} {{curve}}
{% for (CurveEditID,AsOfDate,TaskDefinition,VersionName,acattribute,DataPoints) in edits %}
{% endfor %}
CurveEditID AsOfDate TaskDefinition VersionName acattribute DataPoints
{{CurveEditID}} {{AsOfDate}} {{TaskDefinition}} {{VersionName}} {{acattribute}} {{DataPoints}}
Do you know why view version would be extremely slow versus non-view?
Thanks,
Lars Ericson
Quantitative Analytics Consultant
Market & Institutional Risk Management
Wells Fargo Bank, N.A. | 301 S. College St., 4th Floor | Charlotte, NC 28202-6000
MAC D1053-04X
Tel 704-410-2219 | Cell 917-891-1639
lars.ericson@wellsfargo.com