ryanolson commented on 23 Jul 2013
The following fails at the assert inside the index subroutine.
import unittest
from flask import Flask, url_for, request, jsonify

class TestFlask(unittest.TestCase):

    def test_get_with_arguments(self):
        app = Flask(__name__)
        app.debug = True

        @app.route('/echo')
        def index():
            assert 'key' in request.args
            return jsonify( dict(key=request.args['key']) )

        url = None
        with app.test_request_context():
            url = url_for('index', key='test', _external=True)

        assert url == 'http://localhost/echo?key=test'

        rv = app.test_client().get(url)
        assert 'key' in rv.data