taosean commented on 14 Dec 2018 â€¢
edited
Hi guys, I used Flask as a server for my image object detection program, but I found that the execution time of object detection are not stable some times.
The main goal of my program is doing object detection on an image with neural network. Since it takes too much time loading the neural netwrok model every time an input image comes, I used Flask as server and the server loads the neural network model once when the server starts up. Then, when the server is running, another program, the clinet, will send a request to the server with the image directory as the parameter. When received the request, the server will read in the specified image, do object detection (executing some functions) and output the detection results in JSON format.
This process works fine most of the time and finishes within about 500ms. However, in some rare cases, the process of performing object detection took several seconds, even up to a minute . I looked into my log files and found that they halted at different functions when this case happened.
I'm wondering if this has something to do with the Flask.
I'm sorry for this long description and I'm grateful if someone can give any advices.
Expected Behavior
Execution time should be around 500ms.
The following are normal cases
case 1
2018-12-12 04:00:03,822:fpn_server.py:_clip_boxes:122:2500:11848:DEBUG:start
2018-12-12 04:00:03,822:fpn_server.py:_clip_boxes:131:2500:11848:DEBUG:end
case2
2018-12-12 17:40:36,674:fpn_server.py:calc_num:225:2500:11848:DEBUG:end
2018-12-12 17:40:36,676:fpn_server.py:detect_and_save:968:2500:11848:INFO:Writing file C:\Windows\system32\config\systemprofile\AppData\Local\detection_results\cls_nums_2.pkl
Actual Behavior
Sometimes it takes several seconds or even a minute to finish.
The following are unusual cases.
case 1
2018-12-12 04:00:04,834:fpn_server.py:_clip_boxes:122:2500:11848:DEBUG:start
2018-12-12 04:00:08,553:fpn_server.py:_clip_boxes:131:2500:11848:DEBUG:end
case 2
2018-12-12 17:40:28,677:fpn_server.py:calc_num:225:2500:11848:DEBUG:end
2018-12-12 17:40:31,210:fpn_server.py:detect_and_save:968:2500:11848:INFO:Writing file C:\Windows\system32\config\systemprofile\AppData\Local\detection_results\cls_nums_2.pkl
Environment
Python version: 2.7.14
Flask version: 0.12.2
Werkzeug version: 0.14.1
PS:
The server can receive the request from client quickly, it was the execution after receving request halts sometimes.
I was runing app.run() to launch the server since the server and client runs on the same machine.
Server runs in single thread is not a problem for me, I just need to process the image one at a time.
I'm running on Windows 10.
Thank you!