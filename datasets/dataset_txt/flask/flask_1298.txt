tbicr commented on 6 Feb 2014
See next example with python 2.7.5, flask=0.10.1, werkzeug==0.9.4:
import unittest
from cStringIO import StringIO
from flask import Flask, request


app = Flask(__name__)

@app.route('/', methods=["POST"])
def test_view():
    print(request.values, request.files)
    return "OK"


class UnicodeTestCase(unittest.TestCase):
    def setUp(self):
        self.client = app.test_client(use_cookies=False)

    def test_unicode_file(self):
        file = (StringIO("0" * 1000), "filename.txt")
        self.assertEquals(200, self.client.post('/', data={'file': file}).status_code)

    def test_unicode_string(self):
        string = u"∆_∆"
        self.assertEquals(200, self.client.post('/', data={'string': string}).status_code)

    def test_unicode_file_and_string(self):
        file = (StringIO("0" * 1000), "filename.txt")
        string = u"∆_∆"
        self.assertEquals(200, self.client.post('/', data={'file': file, 'string': string}).status_code)


if __name__ == '__main__':
    app.run('0.0.0.0', 8080, True)
When I make request directly all work fine. But with test client have error:
Error
Traceback (most recent call last):
  File "/Users/user1/tests/test_uni.py", line 108, in test_unicode
    self.assertEquals(200, client.post('/', data={'file': file, 'string': string}).status_code)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 771, in post
    return self.open(*args, **kw)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/flask/testing.py", line 108, in open
    follow_redirects=follow_redirects)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 725, in open
    environ = args[0].get_environ()
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 535, in get_environ
    stream_encode_multipart(values, charset=self.charset)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 104, in stream_encode_multipart
    write('\r\n\r\n' + value)
  File "/Users/user1/.virtualenvs/test/lib/python2.7/site-packages/werkzeug/test.py", line 71, in write
    write_binary(string.encode(charset))
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 4: ordinal not in range(128)
See details http://stackoverflow.com/q/21584413/880326.