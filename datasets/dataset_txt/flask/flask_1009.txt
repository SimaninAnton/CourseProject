Member
ThiefMaster commented on 20 Jun 2015
diff --git a/tests/test_basic.py b/tests/test_basic.py
index 695e346..1e064ff 100644
--- a/tests/test_basic.py
+++ b/tests/test_basic.py
@@ -387,6 +387,7 @@ def test_session_special_types():
         flask.session['dt'] = now
         flask.session['b'] = b'\xff'
         flask.session['t'] = (1, 2, 3)
+        flask.session['spacefirst'] = {' t': 'not-a-tuple'}
         return response

     @app.route('/')
@@ -403,6 +404,7 @@ def test_session_special_types():
     assert rv['b'] == b'\xff'
     assert type(rv['b']) == bytes
     assert rv['t'] == (1, 2, 3)
+    assert rv['spacefirst'] == {' t': 'not-a-tuple'}


 def test_session_cookie_setting():
While I don't see any cases where this would be likely to result in security problems (it would require custom types that are not safe to recreate with arbitrary arguments AND code that serializes a dict with both the key and value being provided by the user), I don't like that there's any input where value != loads(dumps(value)) without an exception.
Two ways to fix this:
raise an exception when trying to encode a dict that has a single item with a key starting with a space.
tag such dictionaries so they are decoded properly instead of being decoded as if they are a valid tagged it em