decentral1se commented on 26 May 2017
I am using the RedisSessionInterface of flask-session to implement my server side sessions. I have a test case that relies on mutating the session and I have read that this is possible from the Flask documentation.
Here's my test code (using pytest):
def test_code_already_used(app, client):
    uri = url_for("login.username")
    response = client.get(uri)  # stores the initial state in the session
    assert response.status_code == 302

    query = urlparse(response.location).query
    payload = dict(parse_qsl(query))
    state = payload['state']  # get key for session state

    with app.test_client() as context:
        transaction = context.session_transaction()
        with transaction as mutable_session:
            mutable_session[state] = {'exchanged': True}  # mutates the session

    # test code later fails becase the modification is not propagated
My application relies on seeing exchanged=True but this change is not there.
Any ideas!?