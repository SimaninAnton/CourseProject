ghost commented on 15 Nov 2017 â€¢
edited by ghost
When Flask.create_url_adapter is supplied with a request, it passes the request on to Map.bind_to_environment from werkzeug.routing. This will result in a call to Map.bind, where the script_name argument is set to the value of the environment variable SCRIPT_NAME.
However, when it isn't supplied with a request, Flask.create_url_adapter will call Map.bind directly. Instead of SCRIPT_NAME, it passes the value of APPLICATION_NAME via the script_name argument. Per #1714, I understand that APPLICATION_NAME has nothing to do with routing. I guess this should change, but I'm not sure.
I discovered this when debugging a tangentially related issue that turned out to be in my own code (I assumed MapAdapter could ultimately be used to translate whole URL paths to endpoints, but it seems I have to strip off SCRIPT_NAME myself).