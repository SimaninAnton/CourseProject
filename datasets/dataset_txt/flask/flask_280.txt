wiwengweng commented on 11 Oct 2018 •
edited by ThiefMaster
Expected Behavior
I have templates layout.html, index.html and 200.html, index and 200 inherit layout.html
I try to submit a picture(base64 encoded) in index page, and if successful, redirect to 200.html
<!-- extend base layout -->
{% extends "layout.html" %}

{% block content %}
<body>

<div align="center" id="container">

    <h2>Demo</h2>

    <video playsinline autoplay></video>
    <button type="submit" class="btn btn-primary">snapshot</button>
    <canvas></canvas>
    <br>
    <label>name：</label><input type="text">
        <br><br>
 <button id="submit" type="submit" class="btn btn-primary">submit</button>


</div>
<div id="myDiv"></div>
<script type="text/javascript" src="{{ url_for('static', filename='js/lib/adapter.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}" async></script>

</body>
{% endblock %}
main.js
const submit = document.getElementById("submit");

submit.onclick = function() {  // post submit
const xmlhttp =new XMLHttpRequest();
 xmlhttp.onreadystatechange=function()
   {
   if (xmlhttp.readyState==4 && xmlhttp.status==200)
  {
  document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
  }
   }
const name = document.querySelector('input').value;   
xmlhttp.open("POST","/save_img/"+name,true);
xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
// dataURL = dataURL.replaceAll("\\+", "%2B");
dataURL = encodeURIComponent(dataURL)
    xmlhttp.send("img=" + dataURL);
}
@app.route('/save_img/<string:name>', methods=['POST', 'GET'])
def save_image(name):
    # todo feature code
    img_base64 = request.form.get("img")
    base64_data = re.sub('^data:image/.+;base64,', '', img_base64).encode()
    feature_code = codec.func_call(base64_data, name)
    # todo save img and name to db
    data = Feature(feature_code, name)
    db.session.add(data)
    db.session.commit()
    flash('successful!!')
    return redirect(url_for('successful'))

@app.route('/successful')
def successful():
    return render_template('200.html')
Actual Behavior
content of index.html still remains in the page, and content in 200.html also show on the page.
no exception
Environment
Python version: 2.7.13
Flask version:1.0.2 and 0.12
Werkzeug version: 0.14.1