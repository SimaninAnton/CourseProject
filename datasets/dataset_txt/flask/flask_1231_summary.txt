Issue with deferred callbacks pattern when an exception occurs in a @teardown_request decorated function