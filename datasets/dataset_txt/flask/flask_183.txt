yiwong commented on 6 Mar 2019 â€¢
edited
flask01.py
@app.route('/')
def hello_world1():
client = papirpcclient01.RPCMSG()
data = {'jsonrpc': '2.0', 'method': 'get_bdevs', 'id': 1}
time.sleep(15)
recvdata = json.dumps(client.receivemsg())
print("route1:", recvdata)
return Response(recvdata, mimetype='application/json')
@app.route('/1')
def papihello():
print("/route1")
papirpcclient01.reactor.run()
#papirpcclient01.reactor.run(installSignalHandlers=0)
return "reactor.run"+'\n'
papirpcclient01.py
class RPCClient(protocol.Protocol):
def connectionMade(self):
print("connectionMade:")

def dataReceived(self, data):
    "As soon as any data is received, write it back."
    #print("Server said:", data)
    log.msg("dataReceived=:"+data)
response = json.loads(data)
#recvmsg.append(response)
    reactor.callInThread(sendtoqueue,response)

def connectionLost(self, reason):
    print("connection lost")
class RPCClientFactory(protocol.ClientFactory):
def __init__(self):
 self.deferred=defer.Deferred()
     self.protocol = None

def startedConnecting(self, connector):
 print('Started to connect.')

def buildProtocol(self, addr):
     print('Connected.')
     self.protocol = RPCClient()
     return self.protocol
def clientConnectionFailed(self, connector, reason):
     print("Connection failed - goodbye!")
 self.deferred.errback(reason)
    #reactor.stop()
 def clientConnectionLost(self, connector, reason):
     print("Connection lost - goodbye!")
 self.deferred.errback(reason)
    #reactor.stop()
def Send(sendmsg):
if factory.protocol and factory.protocol.connected:
print("send said:", sendmsg)
if (len(recvmsg)> 0):
recvmsg.pop()
factory.protocol.transport.write(sendmsg)
factory= RPCClientFactory ()
reactor.connectTCP(host,port,factory)
pmasterconnet=factory.deferred
pmasterconnet.addCallback(connectSuccess,port)
pmasterconnet.addErrback(connectFailure,port)
Expected Behavior
Tell us what should happen.
run "curl http://127.0.0.1:5000/1" block the flask process,but run "curl http://127.0.0.1:5000" still work
pls tell how to resoule it , thank you
Paste a minimal example that causes the problem.
Actual Behavior
Tell us what happens instead.
Paste the full traceback if there was an exception.
Environment
Python version:2.7.5
Flask version:1.0.2
Twisted version:18.9.0
Werkzeug version: