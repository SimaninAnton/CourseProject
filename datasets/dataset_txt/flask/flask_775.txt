mavjop commented on 2 Aug 2016 â€¢
edited by untitaker
Problem description:
In a URL with two path:... type arguments (both need to accept URL-path-encoded data) next to each other, a %2F (encoded /) gets included in the wrong parameter.
Versions:
Python 2.7.11
Flask 0.11
Werkzeug 0.11.10
Request URL:
http://localhost:5000/api/v1/entry/foo.com/%2Fbar%2Fbaz/block/12345/get
Result:
{"this_is_a_test": "XXX this is test code, not a real thing", "path": "bar/baz", "name": "foo.com/"}
That is:
name: foo.com/
path: bar/baz
Expected Result:
{"this_is_a_test": "XXX this is test code, not a real thing", "path": "/bar/baz", "name": "foo.com"}
That is:
name: foo.com
path: /bar/baz
The code:
# The special modifier "path" as in "<path:somevariablename>" means
# "somevariablename" may be URL path encoded data.
@app.route('/api/v1/entry/<path:name>/get')
@app.route('/api/v1/entry/<path:name>/<path:path>/get')
def get_entry(name, path=None, methods=['GET']):
    name = urllib.unquote(name)

    if path is not None:
        path = urllib.unquote(path)

    return json.dumps({
        'this_is_a_test': 'XXX this is test code, not a real thing',
        'name': name,
        'path': path,
    })