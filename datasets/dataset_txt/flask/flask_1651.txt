foresto commented on 28 Apr 2011
I recently added message flashing to one of my apps, and noticed that it started re-issuing the session cookie on every response.
A bit of digging revealed that get_flashed_messages() calls session.pop('_flashes') without first checking to see if session['_flashes'] is missing or empty. This has a side effect of triggering ModificationTrackingDict.on_update(), which in turn marks the session as modified even though it wasn't. It happens even when no flash messages are set.
The fix should be easy. Replace this part of get_flashed_messages():
if flashes is None:
    _request_ctx_stack.top.flashes = flashes = session.pop('_flashes', [])
With something like this:
if flashes is None and '_flashes' in session:
    _request_ctx_stack.top.flashes = flashes = session.pop('_flashes')
else:
    _request_ctx_stack.top.flashes = flashes =  []