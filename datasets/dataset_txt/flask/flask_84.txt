gelflein commented on 9 Aug 2019
Hello,
I am submitting a form to insert data in my oracle-database.
Because I don't want to reload the page when submitting the form I am calling a js-function.
Here is my submit-button:
<button class="btn btn-primary mt-3" type="button" onclick="createSubmit()">Speichern</button>
The js-function called by the button:
function createSubmit() {
    var shortcode = document.getElementById("shortcode").value;
    var product = document.getElementById("productInput-hidden").value;
    var serialnumber = document.getElementById("serialnumber").value;
    var status = document.getElementById("statusInput-hidden").value;
    var user = document.getElementById("userInput-hidden").value;
    var acquireddate = document.getElementById("acquireddate").value;
    var installdate = document.getElementById("installdate").value;
    var remarks = document.getElementById("remarks").value;

    req = $.ajax({
        url : "/create_submit",
        type : "POST",
        data : { shortcode : shortcode, product : product, serialnumber : serialnumber, status : status, user : user, acquireddate : acquireddate, installdate : installdate, remarks : remarks }
    });
}
And here we got the route:
@bp.route('/create_submit', methods=['POST'])
@login_required
def create_submit():
    error = None
    short_code = request.form['shortcode']
    product = request.form['product']
    serial_number = request.form['serialnumber']
    status = request.form['status']
    user = request.form['user']
    acquired_date = request.form['acquireddate']
    date_installed = request.form['installdate']
    remarks = request.form['remarks']

    try:
        new = Items(short_code, remarks, short_code, '38', acquired_date, date_installed, product, serial_number,
                    status, '1', user, g.user[1])
        new.post()
    except:
        error = 'Request Fehler'
        new = False

    if new is not False:
        if new.r_status_code == 201:
            flash('Asset angelegt', 'success')
        elif new.r_status_code is not None:
            error = 'API Fehler'
        else:
            error = 'Keine Antwort'
    else:
        error = 'Objekt Fehler'

    if error is not None:
        flash(error, 'error')

    return jsonify({'result' : 'success'})
In general the mechanism is working corret, but the flash-messages generated by /create_submit are not showing immediately. The show up after a page refresh.
I think this happens because I am using ajax to call /create_submit and the return is not correct.
Is there a way to get the flash-messages to show immediately?
Environment
Python version: 3.7.3
Flask version: 1.0.3
Werkzeug version: 0.15.4